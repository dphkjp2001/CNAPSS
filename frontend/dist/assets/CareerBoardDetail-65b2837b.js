import{e as R,b as _,f as A,a as I,u as T,c as $,r as n,R as e}from"./index-aeb17b9a.js";import{C as B}from"./CommentSection-b3b14a8f.js";import{d as p,r as z}from"./relativeTime-8749f4c7.js";import"./en-438d16f7.js";import{a as M,d as O,t as q,u as G}from"./careerPosts-57396a9f.js";import{a as H}from"./http-e9473a88.js";p.extend(z);p.locale("en");function Y(){var U;const{id:x}=R(),y=_(),b=A(),{user:a}=I(),{school:o,schoolTheme:s}=T(),h=$(),[r,m]=n.useState(null),[E,P]=n.useState(""),[i,d]=n.useState(!1),[C,u]=n.useState(""),[v,g]=n.useState(""),[w,N]=n.useState(!1),k=async()=>{try{const t=await M({school:o,id:x});m(t),u((t==null?void 0:t.title)||""),g((t==null?void 0:t.content)||"")}catch(t){P(t.message||"Failed to load the post.")}};n.useEffect(()=>{k()},[x,o]),n.useEffect(()=>{const c=new URLSearchParams(b.search).get("nid");async function l(){if(!(!c||!(a!=null&&a.email)||!o))try{const f="https://api.cnapss.com/api".replace(/\/+$/,"");await H(`${f}/${o}/notification/mark-read`,{method:"POST",headers:{"Content-Type":"application/json"},body:{commentId:c,email:a.email}})}catch{}}l()},[b.search,a==null?void 0:a.email,o]);const S=n.useMemo(()=>((a==null?void 0:a.email)||"").toLowerCase()===((r==null?void 0:r.email)||"").toLowerCase(),[a,r]),L=async()=>{if(window.confirm("Delete this post?"))try{await O({school:o,id:r._id}),alert("Post deleted."),y(h("/career"))}catch(t){alert("Delete failed: "+(t.message||"Unknown error"))}},j=async()=>{try{await q({school:o,id:r._id}),m(t=>t&&{...t,thumbsUpUsers:(t.thumbsUpUsers||[]).includes(((a==null?void 0:a.email)||"").toLowerCase())?t.thumbsUpUsers.filter(c=>c.toLowerCase()!==((a==null?void 0:a.email)||"").toLowerCase()):[...t.thumbsUpUsers||[],((a==null?void 0:a.email)||"").toLowerCase()]}),await k()}catch(t){alert("Failed to like: "+(t.message||"Unknown error"))}},D=async()=>{const t=C.trim(),c=v.trim();if(!(!t||!c)){N(!0);try{const l=await G({school:o,id:r._id,title:t,content:c}),f=(l==null?void 0:l.post)||l;m(f),d(!1)}catch(l){alert("Update failed: "+(l.message||"Unknown error"))}finally{N(!1)}}},F=()=>{u((r==null?void 0:r.title)||""),g((r==null?void 0:r.content)||""),d(!1)};return E?e.createElement("div",{className:"flex min-h-screen items-center justify-center text-sm text-red-700",style:{backgroundColor:(s==null?void 0:s.bg)||"#f6f3ff"}},E):r?e.createElement("div",{className:"min-h-screen px-4 py-6 sm:px-6",style:{backgroundColor:(s==null?void 0:s.bg)||"#f6f3ff"}},e.createElement("div",{className:"mx-auto max-w-3xl"},e.createElement("div",{className:"overflow-hidden rounded-2xl border border-gray-200 bg-white shadow-sm"},e.createElement("div",{className:"border-b border-gray-100 p-5 sm:p-6"},i?e.createElement("input",{value:C,onChange:t=>u(t.target.value),placeholder:"Title",className:"w-full rounded-xl border border-gray-300 px-3 py-2 text-lg font-semibold text-gray-900 focus:border-gray-900 focus:ring-2 focus:ring-gray-900/10"}):e.createElement("h1",{className:"text-2xl font-bold text-gray-900"},r.title),e.createElement("p",{className:"mt-1 text-sm text-gray-500"},"Posted by ",e.createElement("span",{className:"font-medium"},"anonymous")," ‚Ä¢"," ",p(r.createdAt).fromNow())),e.createElement("div",{className:"p-5 sm:p-6"},i?e.createElement("textarea",{value:v,onChange:t=>g(t.target.value),placeholder:"Content",className:"h-56 w-full resize-y rounded-xl border border-gray-300 px-3 py-2 text-sm text-gray-800 focus:border-gray-900 focus:ring-2 focus:ring-gray-900/10"}):e.createElement("div",{className:"prose max-w-none whitespace-pre-wrap text-sm text-gray-900"},r.content)),e.createElement("div",{className:"flex items-center justify-between border-t border-gray-100 px-5 py-3 sm:px-6"},e.createElement("div",{className:"flex items-center gap-2"},e.createElement("button",{onClick:j,className:"rounded-lg border px-3 py-1 text-sm hover:bg-gray-50"},"üëç Like"),e.createElement("span",{className:"text-xs text-gray-500"},((U=r.thumbsUpUsers)==null?void 0:U.length)||0," likes")),e.createElement("div",{className:"flex items-center gap-2"},S&&!i&&e.createElement(e.Fragment,null,e.createElement("button",{onClick:()=>d(!0),className:"rounded-lg border px-3 py-1 text-sm hover:bg-gray-50"},"‚úèÔ∏è Edit"),e.createElement("button",{onClick:L,className:"rounded-lg border px-3 py-1 text-sm text-red-600 hover:bg-red-50"},"üóëÔ∏è Delete")),S&&i&&e.createElement(e.Fragment,null,e.createElement("button",{onClick:D,disabled:w,className:"rounded-lg border px-3 py-1 text-sm text-white",style:{backgroundColor:"#111827"}},w?"Saving...":"Save"),e.createElement("button",{onClick:F,className:"rounded-lg border px-3 py-1 text-sm"},"Cancel")))),e.createElement("div",{className:"border-t border-gray-100 p-5 sm:p-6"},e.createElement(B,{postId:r._id}))),e.createElement("div",{className:"mt-6"},e.createElement("button",{onClick:()=>y(h("/career")),className:"text-sm text-gray-600 hover:underline"},"‚Üê Back to list")))):e.createElement("div",{className:"flex min-h-screen items-center justify-center text-sm text-gray-600",style:{backgroundColor:(s==null?void 0:s.bg)||"#f6f3ff"}},"Loading‚Ä¶")}export{Y as default};
