import{c as y,j as V,u as $,a as H,d as z,b as O,e as q,r as s,R as t,T as K,k as W,l as X,m as G,n as J,o as Q}from"./index-f5d06e92.js";import{A as Y,U as Z,C as ee}from"./CommentSection-2998421b.js";import{d as p,r as te}from"./relativeTime-0382aa45.js";import"./useLoginGate-5c668411.js";/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],ne=y("pen",ae);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],re=y("save",se);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],le=y("x",oe);p.extend(te);p.locale("en");const ce={accent:"#FF7A70",accentHover:"#FF6B61"};function pe(){const{id:i}=V(),x=$(),c=H(),{user:r,token:E}=z(),{school:l,schoolTheme:ie}=O(),b=q(),[a,g]=s.useState(null),[v,N]=s.useState(""),[m,f]=s.useState(!1),[w,d]=s.useState(""),[C,u]=s.useState(""),[F,S]=s.useState(!1),k=!!(r!=null&&r.email||E&&String(E).length>0),[me,P]=s.useState(0),[de,A]=s.useState(0),[ue,I]=s.useState(null),M=async()=>{N("");try{const e=await W({school:l,id:i});g(e),d((e==null?void 0:e.title)||""),u((e==null?void 0:e.content)||""),P((e==null?void 0:e.upCount)||0),A((e==null?void 0:e.downCount)||0)}catch(e){if((e==null?void 0:e.status)!==404){N((e==null?void 0:e.message)||"Failed to load the post.");return}}if(k)try{const e=await X({school:l,id:i});g(e),d((e==null?void 0:e.title)||""),u((e==null?void 0:e.content)||""),P((e==null?void 0:e.upCount)||0),A((e==null?void 0:e.downCount)||0),I((e==null?void 0:e.myVote)??null)}catch{}};s.useEffect(()=>{!l||!i||M()},[i,l,k]),s.useEffect(()=>{const o=new URLSearchParams(c.search).get("nid");async function n(){if(!(!o||!(r!=null&&r.email)||!l))try{const h="https://api.cnapss.com/api".replace(/\/+$/,"");await G(`${h}/${l}/notification/mark-read`,{method:"POST",headers:{"Content-Type":"application/json"},body:{commentId:o,email:r.email}})}catch{}}n()},[c.search,r==null?void 0:r.email,l]);const U=s.useMemo(()=>{const e=c.hash||"",o=e.startsWith("#comment-")?e.slice(9):null,n=new URLSearchParams(c.search).get("nid");return o||n||null},[c.hash,c.search]),j=s.useMemo(()=>{var _,T;const e=a,o=r;if(!e||!o)return!1;const n=[o.id,o._id].filter(Boolean).map(String);return[e.userId,e.authorId,(_=e.author)==null?void 0:_._id,(T=e.author)==null?void 0:T.id].filter(Boolean).map(String).some(R=>n.includes(R))},[r,a]),B=async()=>{if(window.confirm("Delete this post?"))try{await J({school:l,id:a._id}),alert("Post deleted."),x(b("/dashboard?tab=free"))}catch(e){alert("Delete failed: "+((e==null?void 0:e.message)||"Unknown error"))}},L=async()=>{const e=w.trim(),o=C.trim();if(!e||!o){alert("Title and content are required.");return}S(!0);try{const n=await Q({school:l,id:a._id,title:e,content:o}),h=(n==null?void 0:n.post)||n;g(h),f(!1)}catch(n){alert("Update failed: "+((n==null?void 0:n.message)||"Unknown error"))}finally{S(!1)}},D=()=>{d((a==null?void 0:a.title)||""),u((a==null?void 0:a.content)||""),f(!1)};return v?t.createElement("div",{className:"min-h-screen bg-[#F8F9FA] flex items-center justify-center"},t.createElement("div",{className:"text-red-600"},v)):a?t.createElement("div",{className:"min-h-screen bg-[#F8F9FA] py-8"},t.createElement("div",{className:"mx-auto max-w-4xl px-4 sm:px-6 lg:px-8"},t.createElement("button",{onClick:()=>x(b("/dashboard?tab=free")),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-6 font-medium transition-colors"},t.createElement(Y,{className:"w-4 h-4"}),t.createElement("span",null,"Back to Free Board")),t.createElement("div",{className:"bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden"},t.createElement("div",{className:"border-b border-gray-100 px-6 py-5"},t.createElement("div",{className:"flex items-start justify-between gap-4 mb-4"},t.createElement("div",{className:"flex items-start gap-3 flex-1"},t.createElement("div",{className:"w-11 h-11 rounded-full bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center shrink-0"},t.createElement(Z,{className:"w-5 h-5 text-gray-600"})),t.createElement("div",{className:"flex-1 min-w-0"},t.createElement("div",{className:"flex items-center gap-2 flex-wrap"},t.createElement("span",{className:"font-semibold text-gray-900"},"Anonymous"),t.createElement("span",{className:"text-gray-400"},"•"),t.createElement("span",{className:"text-sm text-gray-500"},p(a.createdAt).fromNow())),t.createElement("div",{className:"flex items-center gap-2 mt-1"},t.createElement("span",{className:"text-sm text-gray-500"},"Free Board")))),j&&!m&&t.createElement("div",{className:"flex items-center gap-2"},t.createElement("button",{onClick:()=>f(!0),className:"p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg transition-colors",title:"Edit post"},t.createElement(ne,{className:"w-4 h-4"})),t.createElement("button",{onClick:B,className:"p-2 text-red-500 hover:text-red-700 hover:bg-red-50 rounded-lg transition-colors",title:"Delete post"},t.createElement(K,{className:"w-4 h-4"})))),m?t.createElement("input",{value:w,onChange:e=>d(e.target.value),placeholder:"Title",className:"w-full text-2xl font-bold text-gray-900 bg-transparent border-b-2 border-gray-300 focus:border-[#FF7A70] outline-none pb-2 transition-colors"}):t.createElement("h1",{className:"text-2xl font-bold text-gray-900 leading-tight"},a.title)),t.createElement("div",{className:"px-6 py-6"},m?t.createElement("textarea",{value:C,onChange:e=>u(e.target.value),placeholder:"Content",className:"w-full min-h-[240px] text-gray-900 bg-gray-50 rounded-xl border border-gray-300 focus:border-[#FF7A70] focus:ring-2 focus:ring-[#FF7A70]/20 outline-none px-4 py-3 resize-y transition-all"}):t.createElement("div",{className:"prose prose-gray max-w-none"},t.createElement("p",{className:"text-gray-900 whitespace-pre-wrap leading-relaxed"},a.content)),m&&t.createElement("div",{className:"mt-6 flex items-center gap-3"},t.createElement("button",{onClick:L,disabled:F,style:{backgroundColor:ce.accent},className:"inline-flex items-center gap-2 px-5 py-2.5 text-white font-medium rounded-lg hover:opacity-90 active:scale-[0.98] disabled:opacity-60 transition-all shadow-sm"},t.createElement(re,{className:"w-4 h-4"}),t.createElement("span",null,F?"Saving…":"Save Changes")),t.createElement("button",{onClick:D,className:"inline-flex items-center gap-2 px-5 py-2.5 bg-white border border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-50 active:scale-[0.98] transition-all"},t.createElement(le,{className:"w-4 h-4"}),t.createElement("span",null,"Cancel")))),(a==null?void 0:a._id)&&t.createElement("div",{className:"border-t border-gray-200 bg-gray-50/50"},t.createElement("div",{className:"px-6 py-6"},t.createElement("h3",{className:"font-semibold text-gray-900 mb-4"},"Comments"),t.createElement(ee,{postId:a._id,authorEmail:a.email,highlightId:U,anonymousMode:!0})))))):t.createElement("div",{className:"min-h-screen bg-[#F8F9FA] flex items-center justify-center"},t.createElement("div",{className:"text-gray-600"},"Loading…"))}export{pe as default};
