import{f as S,b as k,u as I,a as q,c as C,r as l,q as D,s as A,R as e,L as F,t as M,v as j}from"./index-5a00037f.js";const R=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0});function P(){const{id:n}=S(),m=k(),{user:a}=I(),{school:c,schoolTheme:d}=q(),i=C(),[s,y]=l.useState(null),[u,f]=l.useState(null),[g,v]=l.useState(""),[x,h]=l.useState("idle"),[p,b]=l.useState(""),o=(a==null?void 0:a.token)||(localStorage.getItem("token")||"").replace(/^Bearer\s+/i,"");l.useEffect(()=>{let t=!0;return(async()=>{try{const r=await D({school:c,token:o,id:n});if(!t)return;y(r),f(Array.isArray(r.images)&&r.images.length?r.images[0]:null)}catch(r){if(!t)return;console.error("load item failed",r),b("Failed to load the listing.")}})(),a!=null&&a.email&&(async()=>{try{const r=await A({school:c,token:o,itemId:n,email:a.email});r!=null&&r.alreadySent&&h("already")}catch(r){console.warn("request-check failed",r)}})(),()=>{t=!1}},[n,c,a==null?void 0:a.email,o]);const N=l.useMemo(()=>!!(a!=null&&a.email&&(s!=null&&s.seller)&&a.email===s.seller),[a,s]),E=async()=>{if(window.confirm("Delete this listing?"))try{await M({school:c,token:o,id:n}),m(i("/market"))}catch{alert("Failed to delete.")}},w=async()=>{if(g.trim())try{const t=await j({school:c,token:o,itemId:n,buyer:a.email,message:g});if(t.alreadySent&&t.conversationId){m(i(`/messages?conversation=${t.conversationId}`));return}if(t.conversationId){m(i(`/messages?conversation=${t.conversationId}`));return}alert("Message sent, but couldn’t find the chat link.")}catch(t){console.error("send request failed",t),alert("Failed to send the message.")}};return s?e.createElement("div",{className:"mx-auto max-w-5xl py-8 px-4"},e.createElement("div",{className:"flex items-center justify-between mb-6"},e.createElement("h1",{className:"text-2xl font-semibold"},s.title||"Untitled"),N&&e.createElement("button",{onClick:E,className:"rounded-md px-3 py-1.5 text-sm bg-red-500 text-white hover:bg-red-600"},"Delete")),e.createElement("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6"},e.createElement("div",{className:"md:col-span-2"},u?e.createElement("img",{src:u,alt:"",className:"w-full aspect-square object-cover rounded-xl border border-gray-200"}):e.createElement("div",{className:"w-full aspect-square rounded-xl bg-gray-100 border border-gray-200"}),Array.isArray(s.images)&&s.images.length>1&&e.createElement("div",{className:"mt-3 flex gap-2"},s.images.map((t,r)=>e.createElement("button",{key:t+r,onClick:()=>f(t),className:`w-24 h-24 rounded-lg overflow-hidden border ${t===u?"border-violet-500":"border-gray-200"}`},e.createElement("img",{src:t,alt:"",className:"w-full h-full object-cover"}))))),e.createElement("aside",{className:"md:col-span-1"},e.createElement("div",{className:"text-xl font-medium"},R.format(s.price||0)),e.createElement("div",{className:"text-sm text-gray-500 mt-1"},"Seller: ",e.createElement("span",{className:"font-medium"},s.sellerName||s.seller)),e.createElement("p",{className:"mt-4 whitespace-pre-wrap text-sm text-gray-700"},s.description||"No description."),e.createElement("div",{className:"mt-6 p-3 rounded-xl border border-gray-200"},x==="already"?e.createElement("div",{className:"text-sm"},"You’ve already sent a request."," ",e.createElement(F,{to:i("/messages"),className:"text-violet-600 hover:underline font-medium"},"Go to Chat")):e.createElement("div",{className:"flex gap-2"},e.createElement("input",{value:g,onChange:t=>v(t.target.value),placeholder:"Type a short message…",className:"flex-1 rounded-lg border border-gray-300 px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-violet-300"}),e.createElement("button",{onClick:w,className:"rounded-lg px-4 py-2 bg-violet-600 text-white text-sm hover:bg-violet-700"},"Send")))))):e.createElement("div",{className:"min-h-screen flex items-center justify-center text-sm text-gray-600",style:{backgroundColor:(d==null?void 0:d.bg)||"#f6f3ff"}},p||"Loading…")}export{P as default};
