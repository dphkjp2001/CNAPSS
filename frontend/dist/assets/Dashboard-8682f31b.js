import{u as Ie,a as He,b as De,c as ze,d as Ye,r as p,R as r}from"./index-d226040e.js";import{u as Fe}from"./uploadToCloudinary-dc971086.js";import{g as Ue,a as Be,c as Ke,b as W}from"./academicPosts-08304d57.js";import"./http-a6fe908c.js";var be={exports:{}},c={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var X=Symbol.for("react.transitional.element"),Qe=Symbol.for("react.portal"),Ge=Symbol.for("react.fragment"),We=Symbol.for("react.strict_mode"),Ze=Symbol.for("react.profiler"),Ve=Symbol.for("react.consumer"),Xe=Symbol.for("react.context"),Je=Symbol.for("react.forward_ref"),et=Symbol.for("react.suspense"),tt=Symbol.for("react.memo"),ve=Symbol.for("react.lazy"),rt=Symbol.for("react.activity"),pe=Symbol.iterator;function st(e){return e===null||typeof e!="object"?null:(e=pe&&e[pe]||e["@@iterator"],typeof e=="function"?e:null)}var _e={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},we=Object.assign,ke={};function R(e,t,n){this.props=e,this.context=t,this.refs=ke,this.updater=n||_e}R.prototype.isReactComponent={};R.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};R.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function Ne(){}Ne.prototype=R.prototype;function J(e,t,n){this.props=e,this.context=t,this.refs=ke,this.updater=n||_e}var ee=J.prototype=new Ne;ee.constructor=J;we(ee,R.prototype);ee.isPureReactComponent=!0;var ge=Array.isArray;function V(){}var g={H:null,A:null,T:null,S:null},Ce=Object.prototype.hasOwnProperty;function te(e,t,n){var a=n.ref;return{$$typeof:X,type:e,key:t,ref:a!==void 0?a:null,props:n}}function nt(e,t){return te(e.type,t,e.props)}function re(e){return typeof e=="object"&&e!==null&&e.$$typeof===X}function at(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(n){return t[n]})}var ye=/\/+/g;function Z(e,t){return typeof e=="object"&&e!==null&&e.key!=null?at(""+e.key):t.toString(36)}function ot(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch(typeof e.status=="string"?e.then(V,V):(e.status="pending",e.then(function(t){e.status==="pending"&&(e.status="fulfilled",e.value=t)},function(t){e.status==="pending"&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}function M(e,t,n,a,l){var o=typeof e;(o==="undefined"||o==="boolean")&&(e=null);var f=!1;if(e===null)f=!0;else switch(o){case"bigint":case"string":case"number":f=!0;break;case"object":switch(e.$$typeof){case X:case Qe:f=!0;break;case ve:return f=e._init,M(f(e._payload),t,n,a,l)}}if(f)return l=l(e),f=a===""?"."+Z(e,0):a,ge(l)?(n="",f!=null&&(n=f.replace(ye,"$&/")+"/"),M(l,t,n,"",function(h){return h})):l!=null&&(re(l)&&(l=nt(l,n+(l.key==null||e&&e.key===l.key?"":(""+l.key).replace(ye,"$&/")+"/")+f)),t.push(l)),1;f=0;var m=a===""?".":a+":";if(ge(e))for(var y=0;y<e.length;y++)a=e[y],o=m+Z(a,y),f+=M(a,t,n,o,l);else if(y=st(e),typeof y=="function")for(e=y.call(e),y=0;!(a=e.next()).done;)a=a.value,o=m+Z(a,y++),f+=M(a,t,n,o,l);else if(o==="object"){if(typeof e.then=="function")return M(ot(e),t,n,a,l);throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return f}function z(e,t,n){if(e==null)return e;var a=[],l=0;return M(e,a,"","",function(o){return t.call(n,o,l++)}),a}function it(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(n){(e._status===0||e._status===-1)&&(e._status=1,e._result=n)},function(n){(e._status===0||e._status===-1)&&(e._status=2,e._result=n)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var he=typeof reportError=="function"?reportError:function(e){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof e=="object"&&e!==null&&typeof e.message=="string"?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",e);return}console.error(e)},lt={map:z,forEach:function(e,t,n){z(e,function(){t.apply(this,arguments)},n)},count:function(e){var t=0;return z(e,function(){t++}),t},toArray:function(e){return z(e,function(t){return t})||[]},only:function(e){if(!re(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};c.Activity=rt;c.Children=lt;c.Component=R;c.Fragment=Ge;c.Profiler=Ze;c.PureComponent=J;c.StrictMode=We;c.Suspense=et;c.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=g;c.__COMPILER_RUNTIME={__proto__:null,c:function(e){return g.H.useMemoCache(e)}};c.cache=function(e){return function(){return e.apply(null,arguments)}};c.cacheSignal=function(){return null};c.cloneElement=function(e,t,n){if(e==null)throw Error("The argument must be a React element, but you passed "+e+".");var a=we({},e.props),l=e.key;if(t!=null)for(o in t.key!==void 0&&(l=""+t.key),t)!Ce.call(t,o)||o==="key"||o==="__self"||o==="__source"||o==="ref"&&t.ref===void 0||(a[o]=t[o]);var o=arguments.length-2;if(o===1)a.children=n;else if(1<o){for(var f=Array(o),m=0;m<o;m++)f[m]=arguments[m+2];a.children=f}return te(e.type,l,a)};c.createContext=function(e){return e={$$typeof:Xe,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null},e.Provider=e,e.Consumer={$$typeof:Ve,_context:e},e};c.createElement=function(e,t,n){var a,l={},o=null;if(t!=null)for(a in t.key!==void 0&&(o=""+t.key),t)Ce.call(t,a)&&a!=="key"&&a!=="__self"&&a!=="__source"&&(l[a]=t[a]);var f=arguments.length-2;if(f===1)l.children=n;else if(1<f){for(var m=Array(f),y=0;y<f;y++)m[y]=arguments[y+2];l.children=m}if(e&&e.defaultProps)for(a in f=e.defaultProps,f)l[a]===void 0&&(l[a]=f[a]);return te(e,o,l)};c.createRef=function(){return{current:null}};c.forwardRef=function(e){return{$$typeof:Je,render:e}};c.isValidElement=re;c.lazy=function(e){return{$$typeof:ve,_payload:{_status:-1,_result:e},_init:it}};c.memo=function(e,t){return{$$typeof:tt,type:e,compare:t===void 0?null:t}};c.startTransition=function(e){var t=g.T,n={};g.T=n;try{var a=e(),l=g.S;l!==null&&l(n,a),typeof a=="object"&&a!==null&&typeof a.then=="function"&&a.then(V,he)}catch(o){he(o)}finally{t!==null&&n.types!==null&&(t.types=n.types),g.T=t}};c.unstable_useCacheRefresh=function(){return g.H.useCacheRefresh()};c.use=function(e){return g.H.use(e)};c.useActionState=function(e,t,n){return g.H.useActionState(e,t,n)};c.useCallback=function(e,t){return g.H.useCallback(e,t)};c.useContext=function(e){return g.H.useContext(e)};c.useDebugValue=function(){};c.useDeferredValue=function(e,t){return g.H.useDeferredValue(e,t)};c.useEffect=function(e,t){return g.H.useEffect(e,t)};c.useEffectEvent=function(e){return g.H.useEffectEvent(e)};c.useId=function(){return g.H.useId()};c.useImperativeHandle=function(e,t,n){return g.H.useImperativeHandle(e,t,n)};c.useInsertionEffect=function(e,t){return g.H.useInsertionEffect(e,t)};c.useLayoutEffect=function(e,t){return g.H.useLayoutEffect(e,t)};c.useMemo=function(e,t){return g.H.useMemo(e,t)};c.useOptimistic=function(e,t){return g.H.useOptimistic(e,t)};c.useReducer=function(e,t,n){return g.H.useReducer(e,t,n)};c.useRef=function(e){return g.H.useRef(e)};c.useState=function(e){return g.H.useState(e)};c.useSyncExternalStore=function(e,t,n){return g.H.useSyncExternalStore(e,t,n)};c.useTransition=function(){return g.H.useTransition()};c.version="19.2.0";be.exports=c;var q=be.exports;/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ct=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),ut=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,n,a)=>a?a.toUpperCase():n.toLowerCase()),xe=e=>{const t=ut(e);return t.charAt(0).toUpperCase()+t.slice(1)},Ae=(...e)=>e.filter((t,n,a)=>!!t&&t.trim()!==""&&a.indexOf(t)===n).join(" ").trim(),mt=e=>{for(const t in e)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var ft={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dt=q.forwardRef(({color:e="currentColor",size:t=24,strokeWidth:n=2,absoluteStrokeWidth:a,className:l="",children:o,iconNode:f,...m},y)=>q.createElement("svg",{ref:y,...ft,width:t,height:t,stroke:e,strokeWidth:a?Number(n)*24/Number(t):n,className:Ae("lucide",l),...!o&&!mt(m)&&{"aria-hidden":"true"},...m},[...f.map(([h,O])=>q.createElement(h,O)),...Array.isArray(o)?o:[o]]));/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j=(e,t)=>{const n=q.forwardRef(({className:a,...l},o)=>q.createElement(dt,{ref:o,iconNode:t,className:Ae(`lucide-${ct(xe(e))}`,`lucide-${e}`,a),...l}));return n.displayName=xe(e),n};/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]],gt=j("bookmark",pt);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yt=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],ht=j("message-square",yt);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=[["path",{d:"m2 9 3-3 3 3",key:"1ltn5i"}],["path",{d:"M13 18H7a2 2 0 0 1-2-2V6",key:"1r6tfw"}],["path",{d:"m22 15-3 3-3-3",key:"4rnwn2"}],["path",{d:"M11 6h6a2 2 0 0 1 2 2v10",key:"2f72bc"}]],Et=j("repeat-2",xt);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],vt=j("send",bt);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _t=[["path",{d:"M12 2v13",key:"1km8f5"}],["path",{d:"m16 6-4-4-4 4",key:"13yo43"}],["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}]],wt=j("share",_t),kt={pageBg:"#FFFFFF",text:"#0F172A",sub:"#64748B",primary:"#111827",pink:"#FF6B8A",red:"#FF7A70"},Nt=(e="")=>String(e).toLowerCase().trim().replace(/[\s_-]+/g,"_"),Se=(e={})=>{const t=e.postType||e.type||e.mode||(e.lookingFor?"seeking":"question")||"",n=String(t).toLowerCase();return n==="looking_for"||n==="seeking"||n==="lf"?"seeking":"question"},Ct=(e={})=>{const t=Nt(e.kind||"");if(t)return t;const n=[e.kind,...Array.isArray(e.tags)?e.tags:[],e.title,e.content].filter(Boolean).join(" ").toLowerCase();return/(course\s*materials?|syllabus|notes?|exam|midterm|final|assignment|hw|homework)/.test(n)?"course_materials":/(study\s*(mate|group)|\bstudy\b|team\s*up)/.test(n)?"study_mate":/(coffee\s*chat|coffee\s*time|\bchat\b)/.test(n)?"coffee_chat":""};function At(e){const t=new Date(e),a=new Date-t,l=Math.floor(a/6e4),o=Math.floor(l/60),f=Math.floor(o/24);return l<60?`${l} mins ago`:o<24?`${o} hs ago`:f===1?"yesterday":`${f} days ago`}function St(){return r.createElement("svg",{viewBox:"0 0 24 24",width:"24",height:"24","aria-hidden":!0},r.createElement("circle",{cx:"12",cy:"8",r:"4",fill:"#cbd5e1"}),r.createElement("path",{d:"M4 20c0-4 4-6 8-6s8 2 8 6",fill:"#cbd5e1"}))}function Tt({children:e}){return r.createElement("div",{className:"rounded-2xl bg-white shadow-lg overflow-hidden"},e)}function Mt({post:e,onOpenDetail:t,showBadge:n,showActionsBar:a=!1,commentCount:l=0}){var T;const o=e.raw||{},f=Se(o),m=Ct(o),y=f==="seeking"?m==="course_materials"?"📝":m==="study_mate"?"👥":m==="coffee_chat"?"☕️":"📌":"",h={lecture_notes:"Lecture Notes",syllabus:"Syllabus",past_exams:"Past Exams",quiz_prep:"Quiz Prep"},C=(Array.isArray(o.materials)&&m==="course_materials"?o.materials:[]).map(w=>h[w]||w);return r.createElement("button",{type:"button",onClick:t,className:"w-full text-left py-4 px-3 hover:bg-slate-50 transition"},r.createElement("div",{className:"flex items-start gap-3"},n?r.createElement("span",{className:"text-[18px] w-6 text-center mt-[2px]"},y):r.createElement("span",{className:"w-6"}),r.createElement("div",{className:"h-8 w-8 rounded-full bg-slate-200 flex items-center justify-center mt-[2px]"},r.createElement(St,null)),r.createElement("div",{className:"min-w-0 flex-1"},r.createElement("div",{className:"flex items-start justify-between gap-3"},r.createElement("div",{className:"truncate font-semibold text-slate-900"},e.title),r.createElement("div",{className:"text-xs text-slate-500 whitespace-nowrap"},At(e.createdAt))),((T=e.raw)==null?void 0:T.content)&&r.createElement("p",{className:"mt-1 text-[13.5px] text-slate-600 line-clamp-1"},e.raw.content),C.length>0&&r.createElement("div",{className:"mt-3 flex flex-wrap gap-2"},C.map(w=>r.createElement("span",{key:w,className:"inline-flex items-center rounded-full border border-slate-700 bg-slate-50 px-2.5 py-[3px] text-[11px] text-slate-700"},w))),a&&r.createElement("div",{className:"flex items-center justify-between mt-2 pr-1 pl-[0px] text-slate-500 text-[13px]"},r.createElement("div",{className:"flex items-center gap-6"},r.createElement(gt,{size:18,className:"hover:text-slate-800 cursor-pointer"}),r.createElement(Et,{size:18,className:"hover:text-slate-800 cursor-pointer"}),r.createElement(wt,{size:18,className:"hover:text-slate-800 cursor-pointer"}),r.createElement("div",{className:"flex items-center gap-1"},r.createElement(vt,{size:17,className:"hover:text-slate-800 cursor-pointer"}),r.createElement("span",{className:"text-xs font-medium"},"DM"))),r.createElement("div",{className:"flex items-center gap-1 text-sm"},r.createElement(ht,{size:17,className:"hover:text-slate-800 cursor-pointer"}),r.createElement("span",null,l??0))))))}const Rt=e=>e?Array.isArray(e)?e:Array.isArray(e.items)?e.items:Array.isArray(e.data)?e.data:e.data&&Array.isArray(e.data.items)?e.data.items:[]:[],Ee=e=>Rt(e).map(t=>({_id:t._id||t.id,title:t.title||(typeof t.content=="string"?t.content.slice(0,80):"Untitled"),createdAt:t.createdAt||t.updatedAt||new Date().toISOString(),raw:t}));function jt(){const e=Ie(),t=He(),{school:n}=De(),{user:a}=ze(),l=Ye(),o=typeof n=="string"&&n?n.toLowerCase():"nyu",f=()=>{const s=new URLSearchParams(t.search),u=s.get("tab")==="free"?"general":"academic",d={q:s.get("q")||""},i={q:s.get("q")||"",type:s.get("type")||"all",kind:s.get("kind")||""};return{active:u,freeQuery:d,acadQuery:i}},[{active:m,freeQuery:y,acadQuery:h},O]=p.useState(f());p.useEffect(()=>O(f()),[t.search]);const[C,T]=p.useState({loading:!0,items:[],error:""}),[w,Te]=p.useState(12),Y=p.useMemo(()=>{const{q:s}=y;let u=C.items;if(s){const d=s.toLowerCase();u=u.filter(i=>{var E;return i.title.toLowerCase().includes(d)||(((E=i.raw)==null?void 0:E.content)||"").toLowerCase().includes(d)})}return u},[C.items,y]),I={loading:C.loading,error:C.error,items:Y.slice(0,w),hasMore:Y.length>w},[x,A]=p.useState({items:[],page:1,limit:20,total:0,loading:!0,loadingMore:!1,hasMore:!0,error:""}),P=p.useCallback(async()=>{try{const s=await Ue({school:o,limit:200,sort:"new"});T({loading:!1,items:Ee(s),error:""})}catch(s){T({loading:!1,items:[],error:(s==null?void 0:s.message)||"Failed to load posts."})}},[o]),k=p.useCallback(async(s=1,u=!1)=>{var fe,de;if(!o||o==="undefined"){A(Oe=>({...Oe,loading:!1,loadingMore:!1}));return}const d={school:o,page:s,limit:x.limit,q:h.q||"",sort:"new"};h.type&&h.type!=="all"&&(d.type=h.type),h.type==="seeking"&&h.kind&&(d.kind=h.kind);const i=await Be(d),E=Ee(i),N=typeof(i==null?void 0:i.total)=="number"?i.total:typeof((fe=i==null?void 0:i.paging)==null?void 0:fe.total)=="number"?i.paging.total:u?x.total:E.length,je=typeof(i==null?void 0:i.limit)=="number"?i.limit:typeof((de=i==null?void 0:i.paging)==null?void 0:de.limit)=="number"?i.paging.limit:x.limit,me=u?[...x.items,...E]:E;A({items:me,page:s,limit:je,total:N,loading:!1,loadingMore:!1,hasMore:me.length<N&&E.length>0,error:""})},[o,h]);p.useEffect(()=>((async()=>await P())(),()=>{}),[o,P]),p.useEffect(()=>{A(s=>({...s,loading:!0,error:"",page:1})),k(1,!1).catch(s=>A(u=>({...u,loading:!1,error:(s==null?void 0:s.message)||"Failed to load posts."})))},[o,h.q,h.type,h.kind,k]),p.useEffect(()=>{m==="general"?P():k(1,!1)},[t.pathname]),p.useEffect(()=>{const s=()=>{m==="general"?P():k(1,!1)};return window.addEventListener("focus",s),()=>window.removeEventListener("focus",s)},[m,P,k]);const F=p.useRef(null),U=p.useRef(null);p.useEffect(()=>{if(!F.current)return;const s=new IntersectionObserver(u=>{u[0].isIntersecting&&Te(i=>i+10)},{rootMargin:"400px 0px 400px 0px"});return s.observe(F.current),()=>s.disconnect()},[Y.length]),p.useEffect(()=>{if(!U.current)return;const s=new IntersectionObserver(u=>{u[0].isIntersecting&&x.hasMore&&!x.loading&&!x.loadingMore&&(A(i=>({...i,loadingMore:!0})),k(x.page+1,!0).catch(i=>A(E=>({...E,loadingMore:!1,error:(i==null?void 0:i.message)||"Failed to load more."}))))},{rootMargin:"600px 0px 600px 0px"});return s.observe(U.current),()=>s.disconnect()},[x.hasMore,x.loading,x.loadingMore,x.page,k]);const Me=(s,u)=>{var E,N;const d=((E=s.raw)==null?void 0:E._id)||s._id||((N=s.raw)==null?void 0:N.id)||s.id;if(!d)return;const i=u==="general"?`/freeboard/${d}`:`/academic/${d}`;e(l(i))},[b,se]=p.useState(""),[S,ne]=p.useState(""),[B,Re]=p.useState([]),[v,K]=p.useState("question"),[_,ae]=p.useState("course_materials"),[oe,ie]=p.useState(""),[H,le]=p.useState([]),Pe=[{key:"lecture_notes",label:"Lecture Notes"},{key:"syllabus",label:"Syllabus"},{key:"past_exams",label:"Past Exams"},{key:"quiz_prep",label:"Quiz Prep"}],Le=s=>le(u=>u.includes(s)?u.filter(d=>d!==s):[...u,s]),[D,ce]=p.useState(!1),[Q,L]=p.useState({type:"",text:""}),ue=!!a&&b.trim()&&(S.trim()||B.length),G=!!a&&(v==="question"?b.trim()&&S.trim():_==="course_materials"?b.trim()&&H.length>0:b.trim()),$e=async s=>{const u=[];for(const d of s)try{const i=await Fe(d);(i!=null&&i.secure_url||i!=null&&i.url)&&u.push(i.secure_url||i.url)}catch{}return u},qe=async s=>{if(s.preventDefault(),L({type:"",text:""}),!a){L({type:"error",text:"Login required to post."});return}ce(!0);try{if(m==="general"){if(!ue)throw new Error("Missing fields");let u=[];B.length&&(u=await $e(B)),await Ke({school:o,title:b.trim(),content:S.trim(),images:u}),T(d=>({...d,items:[{_id:Math.random().toString(36).slice(2),title:b.trim(),createdAt:new Date().toISOString(),raw:{title:b.trim(),content:S.trim()}},...d.items]}))}else{if(!G)throw new Error("Missing fields");const u={school:o};v==="question"?await W({...u,title:b.trim(),content:S.trim(),postType:"question"}):_==="course_materials"?await W({...u,title:b.trim(),content:"",postType:"seeking",kind:"course_materials",courseName:b.trim(),professor:oe.trim(),materials:H,tags:["seeking","course_materials"]}):await W({...u,title:b.trim(),content:S.trim(),postType:"seeking",kind:_,tags:["seeking",_]}),A(d=>({...d,loading:!0})),await k(1,!1)}se(""),ne(""),Re([]),K("question"),ae("course_materials"),ie(""),le([]),L({type:"success",text:"Posted!"}),setTimeout(()=>L({type:"",text:""}),1200)}catch(u){L({type:"error",text:(u==null?void 0:u.message)||"Failed to post."})}finally{ce(!1)}},$=m==="general"?{loading:I.loading,items:I.items,hasMore:I.hasMore,error:I.error}:{loading:x.loading,items:x.items,hasMore:x.hasMore,error:x.error,loadingMore:x.loadingMore};return r.createElement("div",{className:"min-h-screen",style:{background:kt.pageBg}},r.createElement("main",{className:"mx-auto max-w-6xl px-4 py-6 grid grid-cols-1 md:grid-cols-[minmax(620px,700px)_380px] gap-10"},r.createElement("section",{className:"md:col-start-1"},$.loading?r.createElement("ul",{className:"mt-4 space-y-3"},Array.from({length:10}).map((s,u)=>r.createElement("li",{key:u,className:"h-16 rounded-xl bg-white/70 border border-slate-200 animate-pulse"}))):$.items.length?r.createElement(r.Fragment,null,r.createElement("ul",{className:"mt-5 mx-auto max-w-[700px] px-2 space-y-4"},$.items.map(s=>{var i,E,N;const u=m==="general"||m==="academic"&&Se(s.raw||{})==="question",d=((i=s.raw)==null?void 0:i.commentCount)??((E=s.raw)==null?void 0:E.commentsCount)??(Array.isArray((N=s.raw)==null?void 0:N.comments)?s.raw.comments.length:0);return r.createElement("li",{key:s._id||Math.random()},r.createElement("div",{className:"mx-6 border-b border-slate-300/80 py-3"},r.createElement(Mt,{post:s,onOpenDetail:()=>Me(s,m),showBadge:m==="academic",showActionsBar:u,commentCount:d})))})),r.createElement("div",{className:"flex justify-center py-6"},r.createElement("div",{ref:m==="general"?F:U,className:"h-6 w-6 rounded-full border-2 border-dashed border-slate-300","aria-hidden":!0})),m==="academic"&&$.loadingMore&&r.createElement("div",{className:"text-center pb-8 text-slate-500 text-sm"},"Loading more…")):r.createElement("div",{className:"mx-auto max-w-[700px] text-center py-16"},r.createElement("p",{className:"text-[15px] text-slate-600"},$.error||"No posts yet."))),r.createElement("aside",{className:"md:col-start-2 md:sticky md:top-[24px] self-start"},r.createElement(Tt,null,r.createElement("form",{onSubmit:qe},r.createElement("div",{className:"flex items-center gap-3 p-4 border-b border-slate-200"},r.createElement("div",{className:"shrink-0 h-10 w-10 rounded-full bg-slate-200 flex items-center justify-center"},r.createElement("svg",{viewBox:"0 0 24 24",width:"24",height:"24","aria-hidden":!0},r.createElement("circle",{cx:"12",cy:"8",r:"4",fill:"#cbd5e1"}),r.createElement("path",{d:"M4 20c0-4 4-6 8-6s8 2 8 6",fill:"#cbd5e1"}))),r.createElement("div",{className:"flex-1"},r.createElement("input",{value:b,onChange:s=>se(s.target.value),placeholder:m==="general"?"Write a catchy title for your post…":v==="question"?"Ask an academic/career question…":_==="course_materials"?"Course name (e.g., STAT101)":"Seeking… (short title)",className:"w-full rounded-xl border border-slate-300 px-3 py-2 text-[15px] font-semibold text-slate-900 focus:outline-none focus:ring-2 focus:ring-slate-900/10 focus:border-slate-900"}),r.createElement("p",{className:"mt-1 text-xs text-slate-500"},"Posting as ",r.createElement("span",{className:"font-medium"},"anonymous")))),r.createElement("div",{className:"p-4 space-y-4"},m==="academic"&&r.createElement("div",{className:"flex items-center gap-2"},r.createElement("button",{type:"button",onClick:()=>K("question"),className:`px-3 py-1.5 rounded-full text-sm border ${v==="question"?"bg-slate-900 text-white border-slate-900":"bg-white text-slate-700 border-slate-300 hover:bg-slate-50"}`,"aria-pressed":v==="question"},"General question"),r.createElement("button",{type:"button",onClick:()=>K("seeking"),className:`px-3 py-1.5 rounded-full text-sm border ${v==="seeking"?"bg-slate-900 text-white border-slate-900":"bg-white text-slate-700 border-slate-300 hover:bg-slate-50"}`,"aria-pressed":v==="seeking"},"Seeking 📥"),v==="seeking"&&r.createElement("select",{value:_,onChange:s=>ae(s.target.value),className:"ml-2 rounded-full border border-slate-300 px-3 py-1.5 text-sm"},r.createElement("option",{value:"course_materials"},"Course Materials"),r.createElement("option",{value:"study_mate"},"Study Mate"),r.createElement("option",{value:"coffee_chat"},"Coffee Chat"))),m==="academic"&&v==="seeking"&&_==="course_materials"?r.createElement("div",{className:"space-y-4"},r.createElement("div",null,r.createElement("label",{className:"block text-sm font-medium text-slate-700"},"Professor (optional)"),r.createElement("input",{type:"text",value:oe,onChange:s=>ie(s.target.value),placeholder:"Professor name (optional)",className:"w-full rounded-xl border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-slate-900/10 focus:border-slate-900"})),r.createElement("div",null,r.createElement("label",{className:"block text-sm font-medium text-slate-700 mb-2"},"Personal Materials (choose one or more)"),r.createElement("div",{className:"grid grid-cols-2 gap-2"},Pe.map(s=>r.createElement("label",{key:s.key,className:`flex items-center gap-2 rounded-xl border px-3 py-2 text-sm cursor-pointer ${H.includes(s.key)?"border-slate-900 bg-slate-900/5":"border-slate-300 hover:bg-slate-50"}`},r.createElement("input",{type:"checkbox",checked:H.includes(s.key),onChange:()=>Le(s.key),className:"accent-black"}),r.createElement("span",null,s.label)))),r.createElement("p",{className:"mt-2 text-xs text-slate-500"},"You can select multiple. Title will be used as course name."))):r.createElement("textarea",{value:S,onChange:s=>ne(s.target.value),placeholder:m==="general"?"Write your content here…":v==="question"?"Describe your academic/career question…":_==="study_mate"?"Describe schedule, level, topic…":"Say hello and what you'd like to chat about…",className:"w-full min-h-[120px] rounded-xl border border-slate-300 px-3 py-2 text-[14px] text-slate-800 focus:outline-none focus:ring-2 focus:ring-slate-900/10 focus:border-slate-900"}),r.createElement("div",{className:"flex items-center justify-between pt-2"},r.createElement("p",{className:"text-[12px] text-slate-500"},"Posting to"," ",r.createElement("strong",null,m==="general"?"Freeboard":v==="question"?"Academic":`Seeking: ${_==="course_materials"?"Course Materials":_==="study_mate"?"Study Mate":"Coffee Chat"}`),"."),m==="academic"&&v==="seeking"?r.createElement("div",{className:"flex flex-col items-end"},r.createElement("button",{type:"submit",disabled:!G||D,className:"rounded-xl bg-[#3044f0] px-4 py-2 text-sm font-semibold text-white hover:bg-[#2433c4] active:scale-[0.98] transition-all shadow-md hover:shadow-lg disabled:opacity-60"},D?"Posting…":r.createElement(r.Fragment,null,"Post"," ",r.createElement("span",{className:"line-through text-[11px] text-gray-400 ml-1"},"6 C point"))),r.createElement("span",{className:"text-[10px] text-gray-400 mt-[2px]"},"0 point during beta season")):r.createElement("button",{type:"submit",disabled:D||(m==="general"?!ue:!G),className:"rounded-xl bg-[#3044f0] px-4 py-2 text-sm font-semibold text-white hover:bg-[#2433c4] active:scale-[0.98] transition-all shadow-md hover:shadow-lg disabled:opacity-60"},D?"Posting…":"Post")),!!Q.text&&r.createElement("div",{className:`text-sm rounded-lg px-3 py-2 ${Q.type==="success"?"bg-green-50 text-green-700 border border-green-200":"bg-red-50 text-red-700 border-red-200"}`},Q.text)))))))}export{jt as default};
