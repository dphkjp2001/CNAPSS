import{u as A,a as I,c as _,b as j,d as B,r as l,R as t,P as F}from"./index-bd2128fc.js";import{u as U}from"./useLoginGate-9dd6b9d9.js";import{d as g,r as G}from"./relativeTime-fc220960.js";import"./en-6c37823e.js";import{l as M,g as O}from"./posts-1c93e0cc.js";g.extend(G);g.locale("en");const d=20;function Q(){return t.createElement("li",{className:"animate-pulse"},t.createElement("div",{className:"h-5 w-2/3 rounded bg-gray-100"}),t.createElement("div",{className:"mt-2 h-3 w-1/3 rounded bg-gray-100"}),t.createElement("div",{className:"mt-3 h-px w-full bg-gray-100"}))}function W(){return t.createElement("div",{className:"rounded-2xl border border-gray-200 bg-white p-10 text-center"},t.createElement("p",{className:"text-sm text-gray-500"},"No posts yet."))}function J(){const{token:f}=A(),{school:n,schoolTheme:r}=I(),x=_(),p=j(),{ensureAuth:y}=U(),[s,i]=B(),o=Math.max(1,parseInt(s.get("page")||"1",10)),c=s.get("q")||"",m=s.get("sort")||"new",N=a=>{const e=new URLSearchParams(s.toString());e.set("page",String(a)),i(e,{replace:!0})},v=a=>{const e=new URLSearchParams(s.toString());a?e.set("q",a):e.delete("q"),e.set("page","1"),i(e,{replace:!0})},S=a=>{const e=new URLSearchParams(s.toString());e.set("sort",a),e.set("page","1"),i(e,{replace:!0})},[u,P]=l.useState([]),[k,C]=l.useState(0),[L,b]=l.useState(!0),[h,w]=l.useState("");l.useEffect(()=>{let a=!0;if(n)return(async()=>{b(!0),w("");try{let e;f?e=await M({school:n,page:o,limit:d,q:c,sort:m}):e=await O({school:n,page:o,limit:d,q:c,sort:m});const E=(e==null?void 0:e.items)||e||[];if(!a)return;P(E),C(Number((e==null?void 0:e.total)??E.length??0))}catch(e){if(!a)return;w((e==null?void 0:e.message)||"Failed to load posts.")}finally{if(!a)return;b(!1)}})(),()=>{a=!1}},[f,n,o,c,m]);const R={color:(r==null?void 0:r.text)||"#111827"},q={backgroundColor:(r==null?void 0:r.primary)||"#111827"};return t.createElement("div",{className:"min-h-screen px-4 py-6 sm:px-6",style:{backgroundColor:(r==null?void 0:r.bg)||"#f6f3ff"}},t.createElement("div",{className:"mx-auto max-w-3xl"},t.createElement("div",{className:"mb-5 flex flex-col justify-between gap-3 sm:flex-row sm:items-center"},t.createElement("h2",{className:"text-2xl font-bold tracking-tight",style:R},"Free Board"),t.createElement("div",{className:"flex w-full flex-col gap-2 sm:w-auto sm:flex-row sm:items-center"},t.createElement("div",{className:"relative sm:w-80"},t.createElement("input",{type:"search",value:c,onChange:a=>v(a.target.value),placeholder:"Search posts",className:"w-full rounded-xl border border-gray-300 bg-white px-3 py-2 text-sm text-gray-800 placeholder:text-gray-400 shadow-sm focus:border-gray-900 focus:outline-none focus:ring-2 focus:ring-gray-900/10","aria-label":"search posts"})),t.createElement("select",{value:m,onChange:a=>S(a.target.value),className:"rounded-xl border border-gray-300 bg-white px-3 py-2 text-sm text-gray-800 shadow-sm focus:border-gray-900 focus:outline-none focus:ring-2 focus:ring-gray-900/10","aria-label":"sort posts"},t.createElement("option",{value:"new"},"Newest"),t.createElement("option",{value:"old"},"Oldest")),t.createElement("button",{onClick:()=>y(()=>p(x("/freeboard/write"))),className:"inline-flex items-center justify-center rounded-xl px-4 py-2 text-sm font-semibold text-white shadow focus:outline-none focus:ring-2 focus:ring-offset-0",style:q},"+ Write Post"))),L?t.createElement("ul",{className:"space-y-4 rounded-2xl border border-gray-200 bg-white p-4 shadow-sm"},Array.from({length:6}).map((a,e)=>t.createElement(Q,{key:e}))):h?t.createElement("div",{className:"rounded-xl border border-red-200 bg-red-50 p-3 text-sm text-red-700"},h):u.length===0?t.createElement(W,null):t.createElement("ul",{className:"rounded-2xl border border-gray-200 bg-white shadow-sm"},u.map((a,e)=>t.createElement("li",{key:a._id,className:"px-4 py-4 sm:px-6"},t.createElement("button",{onClick:()=>y(()=>p(x(`/freeboard/${a._id}`))),className:"block w-full text-left"},t.createElement("h3",{className:"line-clamp-2 text-base font-semibold text-gray-900 hover:underline"},a.title),t.createElement("p",{className:"mt-1 text-xs text-gray-500"},"Posted by anonymous • ",g(a.createdAt).fromNow()," · 💬 ",a.commentsCount??"-"," · 👍 ",a.likesCount??"-")),e!==u.length-1&&t.createElement("div",{className:"mt-4 h-px w-full bg-gray-100"})))),t.createElement(F,{page:o,total:k,limit:d,onPageChange:N,className:"mb-8"})))}export{J as default};
