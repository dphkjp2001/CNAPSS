import{r as s,b as P,R as e,L as f}from"./index-c0efd8a8.js";import{u as j}from"./schoolPath-4b46817e.js";import{a as A}from"./axios-b5ee139b.js";const w=12,I=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0});function _(){return e.createElement("div",{className:"animate-pulse rounded-2xl border border-gray-200/60 bg-white shadow-sm"},e.createElement("div",{className:"aspect-[4/3] w-full rounded-t-2xl bg-gray-100"}),e.createElement("div",{className:"p-4 space-y-3"},e.createElement("div",{className:"h-4 w-3/5 rounded bg-gray-100"}),e.createElement("div",{className:"h-4 w-2/5 rounded bg-gray-100"}),e.createElement("div",{className:"h-3 w-1/2 rounded bg-gray-100"})))}function F({schoolPath:r}){return e.createElement("div",{className:"rounded-2xl border border-dashed border-gray-300 bg-white/60 p-10 text-center"},e.createElement("div",{className:"mx-auto mb-3 flex h-14 w-14 items-center justify-center rounded-full bg-gray-100 text-2xl"},"ðŸ›’"),e.createElement("h3",{className:"text-lg font-semibold text-gray-800"},"No listings yet"),e.createElement("p",{className:"mt-1 text-sm text-gray-500"},"Be the first to create a listing. Items with photos and prices get more attention!"),e.createElement(f,{to:r("/market/write"),className:"mt-6 inline-flex items-center rounded-xl bg-gray-900 px-4 py-2 text-sm font-medium text-white shadow hover:bg-black/90 focus:outline-none focus:ring-2 focus:ring-gray-900/30"},"+ Create Listing"))}function R({item:r,schoolPath:p}){var n;const m=(n=r==null?void 0:r.images)==null?void 0:n[0];return e.createElement(f,{to:p(`/market/${r._id}`),className:"group block overflow-hidden rounded-2xl border border-gray-200/60 bg-white shadow-sm transition hover:shadow-md focus:outline-none focus:ring-2 focus:ring-gray-900/20","aria-label":`${r.title} detail`},e.createElement("div",{className:"relative aspect-[4/3] w-full overflow-hidden bg-gray-50"},m?e.createElement("img",{src:m,alt:r.title,className:"h-full w-full object-cover transition duration-300 group-hover:scale-[1.02]",loading:"lazy"}):e.createElement("div",{className:"flex h-full w-full items-center justify-center text-4xl"},"ðŸ–¼ï¸")),e.createElement("div",{className:"p-4"},e.createElement("h3",{className:"line-clamp-1 text-base font-semibold text-gray-900"},r.title),e.createElement("p",{className:"mt-1 text-sm font-medium text-gray-800"},I.format(Number(r.price)||0)),e.createElement("p",{className:"mt-1 line-clamp-1 text-xs text-gray-500"},r.seller),r.location&&e.createElement("div",{className:"mt-2 inline-flex items-center rounded-md bg-gray-100 px-2 py-0.5 text-[11px] text-gray-600"},r.location)))}const D=()=>{const[r,p]=s.useState([]),[m,n]=s.useState(!0),[E,k]=s.useState(null),[d,S]=s.useState(""),[c,C]=s.useState("new"),[i,y]=s.useState(1),{school:N,schoolTheme:h}=P(),u=j(),v="https://api.cnapss.com/api";s.useEffect(()=>{let t=!0;return(async()=>{try{n(!0);const a=await A.get(`${v}/market`,{params:{school:N}});t&&p(Array.isArray(a.data)?a.data:[])}catch(a){k("Failed to load listings."),console.error("âŒ Failed to load listings",a)}finally{t&&n(!1)}})(),()=>{t=!1}},[v,N]);const b=s.useMemo(()=>{const t=d.trim().toLowerCase();let o=r.filter(a=>{var l,x;return t?((l=a.title)==null?void 0:l.toLowerCase().includes(t))||((x=a.seller)==null?void 0:x.toLowerCase().includes(t)):!0});return o=o.sort((a,l)=>{if(c==="price-asc")return(a.price??0)-(l.price??0);if(c==="price-desc")return(l.price??0)-(a.price??0);const x=a.createdAt??a._id??"",M=l.createdAt??l._id??"";return String(M).localeCompare(String(x))}),o},[r,d,c]),g=Math.max(1,Math.ceil(b.length/w)),L=b.slice((i-1)*w,i*w);return s.useEffect(()=>{y(1)},[d,c]),e.createElement("div",{className:"min-h-screen px-4 py-6 sm:px-6",style:{backgroundColor:h.bg}},e.createElement("div",{className:"mx-auto max-w-6xl"},e.createElement("div",{className:"mb-5 flex flex-col justify-between gap-3 sm:flex-row sm:items-center"},e.createElement("h2",{className:"text-2xl font-bold tracking-tight",style:{color:h.text}},"Marketplace"),e.createElement("div",{className:"flex w-full flex-col gap-2 sm:w-auto sm:flex-row sm:items-center"},e.createElement("div",{className:"relative sm:w-72"},e.createElement("input",{type:"search",value:d,onChange:t=>S(t.target.value),placeholder:"Search: title, seller",className:"w-full rounded-xl border border-gray-300 bg-white px-3 py-2 text-sm text-gray-800 placeholder:text-gray-400 shadow-sm focus:border-gray-900 focus:outline-none focus:ring-2 focus:ring-gray-900/10","aria-label":"search items"})),e.createElement("select",{value:c,onChange:t=>C(t.target.value),className:"rounded-xl border border-gray-300 bg-white px-3 py-2 text-sm text-gray-800 shadow-sm focus:border-gray-900 focus:outline-none focus:ring-2 focus:ring-gray-900/10","aria-label":"sort items"},e.createElement("option",{value:"new"},"Newest"),e.createElement("option",{value:"price-asc"},"Lowest Price"),e.createElement("option",{value:"price-desc"},"Highest Price")),e.createElement(f,{to:u("/messages"),className:"inline-flex items-center justify-center rounded-xl border border-gray-300 bg-white px-3 py-2 text-sm font-medium text-gray-800 shadow-sm transition hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-900/10"},"ðŸ’¬ My Chats"),e.createElement(f,{to:u("/market/write"),className:"inline-flex items-center justify-center rounded-xl px-4 py-2 text-sm font-semibold text-white shadow transition focus:outline-none focus:ring-2 focus:ring-offset-0",style:{backgroundColor:h.primary}},"+ Create Listing"))),E&&e.createElement("div",{className:"mb-4 rounded-xl border border-red-200 bg-red-50 p-3 text-sm text-red-700"},E),m?e.createElement("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 md:grid-cols-3"},Array.from({length:9}).map((t,o)=>e.createElement(_,{key:o}))):b.length===0?e.createElement(F,{schoolPath:u}):e.createElement(e.Fragment,null,e.createElement("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 md:grid-cols-3"},L.map(t=>e.createElement(R,{key:t._id,item:t,schoolPath:u}))),g>1&&e.createElement("div",{className:"mt-6 flex items-center justify-center gap-2"},e.createElement("button",{onClick:()=>y(t=>Math.max(1,t-1)),disabled:i===1,className:"rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-700 shadow-sm disabled:cursor-not-allowed disabled:opacity-50"},"Previous"),e.createElement("span",{className:"text-sm text-gray-600"},i," / ",g),e.createElement("button",{onClick:()=>y(t=>Math.min(g,t+1)),disabled:i===g,className:"rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-700 shadow-sm disabled:cursor-not-allowed disabled:opacity-50"},"Next")))))};export{D as default};
