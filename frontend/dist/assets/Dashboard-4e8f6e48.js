import{a as P,u as N,b as v,c as h,d as w,r as d,R as e,e as E,f as A}from"./index-fd1f797d.js";import"./en-b7e8add8.js";import{u as k}from"./useLoginGate-5c6a72b7.js";import{l as S,g as L}from"./posts-128cab5c.js";async function U({school:a,token:o,limit:n=5}){const t=new URLSearchParams({limit:String(Math.max(1,Math.min(20,n)))});return P(`https://api.cnapss.com/api/api/${a}/materials/recent?${t.toString()}`,{headers:{Authorization:`Bearer ${o}`}})}const $=a=>a==="personalNote"?"personal note":"personal material";function H(){const{token:a}=N(),{school:o,schoolTheme:n}=v(),t=h(),{ensureAuth:u}=k(),r=w(),[s,g]=d.useState([]),[f,y]=d.useState(!0),[p,b]=d.useState("");return d.useEffect(()=>{let l=!0;if(!(!a||!o))return(async()=>{try{y(!0),b("");const i=await U({school:o,token:a,limit:5});if(!l)return;g(Array.isArray(i==null?void 0:i.items)?i.items:[])}catch{if(!l)return;b("Failed to load recent materials."),g([])}finally{l&&y(!1)}})(),()=>{l=!1}},[a,o]),e.createElement("div",{className:"rounded-2xl bg-white p-6 shadow-sm"},e.createElement("h2",{className:"mb-4 text-xl font-semibold",style:{color:(n==null?void 0:n.text)||"#4f46e5"}},"CourseHub"),f?e.createElement("ul",{className:"space-y-3"},Array.from({length:4}).map((l,i)=>e.createElement("li",{key:i,className:"animate-pulse"},e.createElement("div",{className:"h-5 w-3/4 rounded bg-gray-100"}),e.createElement("div",{className:"mt-2 h-3 w-1/3 rounded bg-gray-100"})))):p?e.createElement("div",{className:"rounded-lg bg-red-50 p-3 text-sm text-red-700"},p):s.length===0?e.createElement("div",{className:"rounded-lg border border-dashed p-4 text-sm text-gray-600"},"No posts yet."):e.createElement("ul",{className:"divide-y"},s.map(l=>e.createElement("li",{key:l.id,className:"py-3"},e.createElement("button",{type:"button",className:"block w-full text-left hover:bg-gray-50",onClick:()=>u(()=>r(t(`/courses/materials/${l.id}?course=${encodeURIComponent(l.courseCode||"")}&sem=${encodeURIComponent(l.semester||"")}`)))},e.createElement("div",{className:"flex items-center justify-between gap-3"},e.createElement("div",{className:"min-w-0"},e.createElement("div",{className:"truncate text-sm font-medium text-gray-900"},l.courseTitle||l.courseCode||"Unknown course",e.createElement("span",{className:"mx-2 text-gray-400"},"‚Äî"),e.createElement("span",{className:"text-gray-700"},"N/A"),e.createElement("span",{className:"mx-2 text-gray-400"},"‚Äî"),e.createElement("span",{className:"text-gray-600"},$(l.materialType))),e.createElement("div",{className:"mt-1 truncate text-xs text-gray-500"},l.title)),e.createElement("span",{className:"shrink-0 text-xs text-blue-600 underline"},"open")))))),e.createElement("div",{className:"mt-4 flex justify-end gap-2"},e.createElement("button",{onClick:()=>u(()=>r(t("/courses/write"))),className:"rounded-xl border px-4 py-2 text-sm font-semibold text-gray-700 hover:bg-gray-50"},"Upload note"),e.createElement("button",{onClick:()=>u(()=>r(t("/courses"))),className:"rounded-xl bg-indigo-600 px-4 py-2 text-sm font-semibold text-white"},"Open Course Hub")))}E.extend(A);E.locale("en");const M=a=>({background:a||"linear-gradient(135deg, rgba(124,58,237,0.12), rgba(99,102,241,0.12))"});function O(){const{user:a,token:o}=N(),{school:n,schoolTheme:t}=v(),{ensureAuth:u}=k(),r=w(),s=h(),[g,f]=d.useState([]),[y,p]=d.useState(!0),[b,l]=d.useState("");d.useEffect(()=>{let c=!0;if(n)return(async()=>{p(!0),l("");try{let m;o?m=await S({school:n,token:o}):m=await L({school:n,page:1,limit:10});const C=Array.isArray(m)?m:Array.isArray(m==null?void 0:m.items)?m.items:[];c&&f(C.slice(0,5))}catch{c&&l("Failed to load posts.")}finally{c&&p(!1)}})(),()=>{c=!1}},[n,o]);const i=d.useMemo(()=>((a==null?void 0:a.nickname)||(a!=null&&a.email?a.email.split("@")[0]:"Guest")).slice(0,2).toUpperCase(),[a]);return e.createElement("div",{className:"min-h-screen px-4 py-6 sm:px-6",style:{backgroundColor:(t==null?void 0:t.bg)||"#f6f3ff"}},e.createElement("div",{className:"mx-auto max-w-7xl"},e.createElement("div",{className:"grid grid-cols-1 gap-5 lg:grid-cols-12"},e.createElement("aside",{className:"lg:col-span-3"},e.createElement("div",{className:"rounded-2xl border border-gray-200 bg-white p-6 shadow-sm"},e.createElement("div",{className:"mx-auto mb-4 flex h-24 w-24 items-center justify-center rounded-full text-2xl font-bold text-gray-900",style:M(t==null?void 0:t.bg)},i),e.createElement("div",{className:"text-center"},e.createElement("div",{className:"text-lg font-bold text-gray-900"},(a==null?void 0:a.nickname)||"Guest"),e.createElement("div",{className:"mt-0.5 text-xs uppercase tracking-wide text-gray-500"},(n==null?void 0:n.toUpperCase())||"SCHOOL")),e.createElement("nav",{className:"mt-6 space-y-2 text-sm"},e.createElement(x,{onClick:()=>r(s("/myposts"))},"My Posts"),e.createElement(x,{onClick:()=>r(s("/liked"))},"Liked"),e.createElement(x,{onClick:()=>r(s("/commented"))},"Commented"),e.createElement(x,{onClick:()=>r(s("/personal-schedule"))},"Schedule"),e.createElement(x,{onClick:()=>r(s("/market"))},"Marketplace"),e.createElement(x,{onClick:()=>r(s("/foodmap"))},"Food Map")))),e.createElement("main",{className:"lg:col-span-6"},e.createElement("section",{className:"rounded-2xl border border-gray-200 bg-white p-5 shadow-sm"},e.createElement("div",{className:"mb-3 flex items-center justify-between"},e.createElement("h2",{onClick:()=>r(s("/freeboard")),className:"cursor-pointer text-2xl font-extrabold hover:underline",style:{color:(t==null?void 0:t.text)||"#4c1d95"}},"Free Board")),y?e.createElement("ul",{className:"space-y-4"},Array.from({length:3}).map((c,m)=>e.createElement("li",{key:m},e.createElement("div",{className:"h-5 w-2/3 animate-pulse rounded bg-gray-100"}),e.createElement("div",{className:"mt-2 h-3 w-1/3 animate-pulse rounded bg-gray-100"})))):b?e.createElement("div",{className:"rounded-lg bg-red-50 p-3 text-sm text-red-700"},b):g.length===0?e.createElement("div",{className:"rounded-lg border border-dashed border-gray-300 p-6 text-center text-sm text-gray-600"},"No posts yet. Be the first to write!"):e.createElement("ul",{className:"divide-y divide-gray-100"},g.map(c=>e.createElement("li",{key:c._id,className:"py-4"},e.createElement("button",{onClick:()=>u(()=>r(s(`/freeboard/${c._id}`))),className:"block w-full text-left"},e.createElement("h3",{className:"line-clamp-1 text-base font-semibold text-gray-900 hover:underline"},c.title),e.createElement("p",{className:"mt-1 text-xs text-gray-500"},E(c.createdAt).fromNow()))))),e.createElement("div",{className:"mt-4 text-right"},e.createElement("button",{onClick:()=>u(()=>r(s("/freeboard/write"))),className:"rounded-xl px-4 py-2 text-sm font-semibold text-white shadow",style:{backgroundColor:(t==null?void 0:t.primary)||"#6b46c1"}},"+ Write Post"))),e.createElement("section",{className:"mt-5 rounded-2xl border border-gray-200 bg-white p-5 shadow-sm"},e.createElement("div",{className:"mb-3 flex items-center justify-between"},e.createElement("h2",{onClick:()=>r(s("/courses")),className:"cursor-pointer text-2xl font-extrabold hover:underline",style:{color:(t==null?void 0:t.text)||"#4c1d95"}},"CourseHub")),e.createElement(H,null))),e.createElement("aside",{className:"space-y-5 lg:col-span-3"},e.createElement("div",{className:"rounded-2xl border border-gray-200 bg-white p-5 shadow-sm"},e.createElement("h3",{onClick:()=>r(s("/courses")),className:"mb-3 cursor-pointer text-lg font-bold text-gray-900 hover:underline"},"Course Hub"),e.createElement("div",{className:"flex gap-2"},e.createElement("button",{onClick:()=>r(s("/courses/write")),className:"flex-1 rounded-xl border border-gray-300 bg-white px-3 py-2 text-sm text-gray-800 shadow-sm hover:bg-gray-50"},"Upload note"),e.createElement("button",{onClick:()=>r(s("/courses")),className:"flex-1 rounded-xl px-3 py-2 text-sm font-semibold text-white shadow",style:{backgroundColor:(t==null?void 0:t.primary)||"#6b46c1"}},"Open Course Hub"))),e.createElement("div",{className:"rounded-2xl border border-gray-200 bg-white p-5 shadow-sm"},e.createElement("div",{onClick:()=>r(s("/foodmap")),className:"mb-2 cursor-pointer text-sm font-semibold text-gray-900 hover:underline"},"üç± Explore Nearby Food"),e.createElement("p",{className:"text-xs text-gray-600"},"Discover top-rated restaurants and cafes near campus."),e.createElement("div",{className:"mt-3 h-28 w-full overflow-hidden rounded-lg bg-gray-100"},e.createElement("div",{className:"h-full w-full animate-pulse"})))))))}function x({children:a,onClick:o}){return e.createElement("button",{onClick:o,className:"w-full rounded-xl border border-transparent px-3 py-2 text-left text-gray-700 hover:border-gray-200 hover:bg-gray-50"},a)}export{O as default};
