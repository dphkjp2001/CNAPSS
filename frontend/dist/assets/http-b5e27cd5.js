const r="https://api.cnapss.com/api".replace(/\/$/,""),h=["token","jwt","accessToken","authToken","CNAPSS_TOKEN","CNAPSS_AUTH"];function p(){for(const t of h){const e=localStorage.getItem(t)||sessionStorage.getItem(t);if(e)return e}return null}function d(){for(const t of h){try{localStorage.removeItem(t)}catch{}try{sessionStorage.removeItem(t)}catch{}}}function l(){try{window.dispatchEvent(new CustomEvent("CNAPSS_TOKEN_EXPIRED"))}catch{}}async function f(t,e={}){const a=p(),n=new Headers(e.headers||{});!n.has("Content-Type")&&!(e.body instanceof FormData)&&n.set("Content-Type","application/json"),a&&n.set("Authorization",`Bearer ${a}`);const s=await fetch(t,{...e,headers:n,credentials:"include"});if(s.status===401){let i={};try{i=await s.clone().json()}catch{}if(s.headers.get("x-token-expired")==="1"||(i==null?void 0:i.code)==="TOKEN_EXPIRED")throw d(),l(),new Error("TOKEN_EXPIRED")}const o=await(async()=>(s.headers.get("Content-Type")||"").includes("application/json")?s.json():s.text())();if(!s.ok){const i=typeof o=="object"&&(o!=null&&o.message)?o.message:String(o),c=new Error(i||`HTTP ${s.status}`);throw c.status=s.status,c.data=o,c}return o}function g(t){const e=t.toString().startsWith("http")?t:`${r}${t}`;return f(e,{method:"GET"})}function E(t,e){const a=t.toString().startsWith("http")?t:`${r}${t}`,n={method:"POST"};return e instanceof FormData?n.body=e:n.body=JSON.stringify(e||{}),f(a,n)}function m(t,e){const a=t.toString().startsWith("http")?t:`${r}${t}`,n={method:"PUT"};return e instanceof FormData?n.body=e:n.body=JSON.stringify(e||{}),f(a,n)}function S(t){const e=t.toString().startsWith("http")?t:`${r}${t}`;return f(e,{method:"DELETE"})}function T(t,e={}){const{method:a="GET",body:n=null,headers:s={},useApiBase:o=!0}=e,c=typeof t=="string"&&/^https?:\/\//i.test(t)||o===!1?t:`${r}${t}`;let u={method:a,headers:s};return n instanceof FormData?u.body=n:n!=null&&(u.body=JSON.stringify(n)),f(c,u)}export{T as a,m as b,S as d,g,E as p};
