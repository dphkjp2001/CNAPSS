import{r as d,R as t,b as P,a as T,c as Y}from"./index-f155d1ba.js";import{g as I,S as D,s as H}from"./schedule-0f0cd710.js";function O({data:a,onSelect:n}){const[c,f]=d.useState(""),o=s=>s.toLowerCase().replace(/[\s\-]/g,""),m=d.useMemo(()=>!c||!Array.isArray(a)?[]:a.flatMap(s=>Array.isArray(s.sections)?s.sections.map(b=>({course_code:s.course_code,course_title:s.course_title,section_number:b.section_number,class_number:b.class_number,meets:b.meets})):[]).filter(s=>o(s.course_code).includes(o(c))||o(s.course_title).includes(o(c))).slice(0,100),[c,a]);return t.createElement("div",{className:"mb-4"},t.createElement("input",{type:"text",className:"w-full p-2 border rounded text-sm",placeholder:"Search courses by code or title...",value:c,onChange:s=>f(s.target.value),autoComplete:"off"}),t.createElement("div",{className:"space-y-2 max-h-72 overflow-y-auto mt-2"},m.length>0?m.map(s=>t.createElement("div",{key:s.class_number,onClick:()=>n(s),className:"border p-2 rounded bg-white shadow-sm cursor-pointer hover:bg-blue-50 transition"},t.createElement("div",{className:"text-sm font-medium"},s.course_code," - ",s.course_title),t.createElement("div",{className:"text-xs ml-2 text-gray-700"},"Section ",s.section_number,": ",s.meets))):c&&t.createElement("div",{className:"text-sm text-gray-500 p-4"},"No matching courses found.")))}function W(a,n,c){if(!a)return[];const f=/([MTWRF]+)\s(\d{1,2})(?::(\d{2}))?(a|p)?-(\d{1,2})(?::(\d{2}))?(a|p)/i,o=a.match(f);if(!o)return[];const m=o[1],s=parseInt(o[2]),b=parseInt(o[3]||"0"),x=o[4],E=parseInt(o[5]),N=parseInt(o[6]||"0"),h=o[7].toLowerCase(),g=(x||h).toLowerCase(),w=s%12+(g==="p"?12:0),v=E%12+(h==="p"?12:0),y=`${w.toString().padStart(2,"0")}:${b.toString().padStart(2,"0")}`,M=`${v.toString().padStart(2,"0")}:${N.toString().padStart(2,"0")}`,i={M:"MON",T:"TUE",W:"WED",R:"THU",F:"FRI"};return m.split("").map(C=>({day:i[C],start:y,end:M,label:n,class_number:c}))}const $=a=>`${a.day}-${a.start}-${a.end}`,j=a=>a>=8?"fall":a>=5?"summer":"spring";function B(){const a=new Date,n=a.getFullYear(),c=j(a.getMonth()+1);return`${n}-${c}`}function q(){const n=new Date().getFullYear(),c=[],f=[`${n-1}-fall`,`${n}-spring`,`${n}-summer`,`${n}-fall`,`${n+1}-spring`];for(const o of f)c.includes(o)||c.push(o);return c}function Q(){const{school:a}=P(),{token:n}=T(),c=Y(),[f,o]=d.useState([]),[m,s]=d.useState([]),[b,x]=d.useState(!1),[E,N]=d.useState(!1),[h,g]=d.useState(""),[w,v]=d.useState(""),y=(a||"").toLowerCase()==="nyu",M=d.useMemo(q,[]),[i,C]=d.useState(B());d.useEffect(()=>{let e=!0;if(!(!a||!n||!i))return(async()=>{try{v("");const r=await I({school:a,token:n,semester:i}),_=(Array.isArray(r==null?void 0:r.slots)?r.slots:[]).map(u=>({day:u.day,start:u.start,end:u.end,label:"Saved",class_number:`saved-${$(u)}`}));e&&s(_)}catch(r){console.warn("Load schedule failed:",r),e&&s([])}})(),()=>{e=!1}},[a,n,i]),d.useEffect(()=>{let e=!0;return y?(x(!0),fetch("/NYU_course_DATA.json").then(r=>r.json()).then(r=>{e&&o(Array.isArray(r)?r:[])}).catch(r=>console.error("Failed to load course data:",r)).finally(()=>{e&&x(!1)}),()=>{e=!1}):(o([]),()=>{})},[y]);const k=e=>{if(m.some(l=>l.label===e.course_code&&l.class_number===e.class_number))s(l=>l.filter(_=>_.class_number!==e.class_number));else{const l=W(e.meets,e.course_code,e.class_number);if(l.some(u=>m.some(S=>S.day===u.day&&!(u.end<=S.start||u.start>=S.end)))){if(!window.confirm("This course conflicts with an existing one. Replace conflicting blocks with this course?"))return;const S=l.flatMap(p=>m.filter(A=>A.day===p.day&&!(p.end<=A.start||p.start>=A.end))).map(p=>p.class_number),F=m.filter(p=>!S.includes(p.class_number));s([...F,...l]);return}s(u=>[...u,...l])}},R=e=>{s(r=>r.filter(l=>l.class_number!==e))},L=()=>{const e=new Map;for(const r of m){const l=$(r);e.set(l,{day:r.day,start:r.start,end:r.end})}return Array.from(e.values())},U=async()=>{if(!(!n||!a||!i))try{N(!0),g(""),v("");const e=L();await H({school:a,token:n,semester:i,slots:e}),g("Saved your schedule for this semester.")}catch(e){console.error("Save failed:",e),v("Failed to save schedule. Please try again.")}finally{N(!1),setTimeout(()=>g(""),3e3)}};return t.createElement("div",{className:"p-6"},t.createElement("div",{className:"mb-4 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},t.createElement("h1",{className:"text-xl font-semibold"},"Personal Schedule Builder"),t.createElement("div",{className:"flex items-center gap-3"},t.createElement("label",{className:"text-sm text-gray-600"},"Semester"),t.createElement("select",{value:i,onChange:e=>C(e.target.value),className:"rounded-lg border px-3 py-1.5 text-sm"},M.map(e=>t.createElement("option",{key:e,value:e},e))),t.createElement("button",{onClick:U,disabled:E||!n,className:"rounded-xl bg-blue-600 px-4 py-2 text-sm font-semibold text-white disabled:opacity-60"},E?"Saving…":"Save"))),!y&&t.createElement("div",{className:"mb-4 rounded-xl border border-amber-200 bg-amber-50 p-5 text-sm text-amber-900"},t.createElement("div",{className:"mb-1 font-semibold"},"Course search is NYU-only (MVP) for now."),t.createElement("p",null,"We don’t have course data for ",t.createElement("b",null,(a||"").toUpperCase())," yet. You can still save a schedule by adding blocks manually once we add that UI; for now, only NYU course search can auto-add blocks."),t.createElement("a",{href:c("/dashboard"),className:"mt-2 inline-block text-blue-600 underline"},"← Back to Dashboard")),h&&t.createElement("div",{className:"mb-3 rounded-lg border border-emerald-200 bg-emerald-50 px-3 py-2 text-sm text-emerald-700"},h),w&&t.createElement("div",{className:"mb-3 rounded-lg border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700"},w),t.createElement("div",{className:"mt-4 flex gap-6"},t.createElement("div",{className:"w-3/12"},y?b?t.createElement("div",{className:"text-sm text-gray-500"},"Loading course list…"):t.createElement(O,{data:f,onSelect:k}):t.createElement("div",{className:"rounded-lg border border-gray-200 bg-white p-3 text-sm text-gray-500"},"Course search is unavailable for this school.")),t.createElement("div",{className:"w-9/12"},t.createElement(D,{schedules:m,onRemove:R}))))}export{Q as default};
