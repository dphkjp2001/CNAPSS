import{r as s,b as L,R as e,L as x}from"./index-1baf5031.js";import{a as M}from"./axios-b5ee139b.js";const b=12,j=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0});function A(){return e.createElement("div",{className:"animate-pulse rounded-2xl border border-gray-200/60 bg-white shadow-sm"},e.createElement("div",{className:"aspect-[4/3] w-full rounded-t-2xl bg-gray-100"}),e.createElement("div",{className:"p-4 space-y-3"},e.createElement("div",{className:"h-4 w-3/5 rounded bg-gray-100"}),e.createElement("div",{className:"h-4 w-2/5 rounded bg-gray-100"}),e.createElement("div",{className:"h-3 w-1/2 rounded bg-gray-100"})))}function I(){return e.createElement("div",{className:"rounded-2xl border border-dashed border-gray-300 bg-white/60 p-10 text-center"},e.createElement("div",{className:"mx-auto mb-3 flex h-14 w-14 items-center justify-center rounded-full bg-gray-100 text-2xl"},"🛒"),e.createElement("h3",{className:"text-lg font-semibold text-gray-800"},"No listings yet"),e.createElement("p",{className:"mt-1 text-sm text-gray-500"},"Be the first to create a listing. Items with photos and prices get more attention!"),e.createElement(x,{to:"/market/write",className:"mt-6 inline-flex items-center rounded-xl bg-gray-900 px-4 py-2 text-sm font-medium text-white shadow hover:bg-black/90 focus:outline-none focus:ring-2 focus:ring-gray-900/30"},"+ Create Listing"))}function P({item:r}){var m;const i=(m=r==null?void 0:r.images)==null?void 0:m[0];return e.createElement(x,{to:`/market/${r._id}`,className:"group block overflow-hidden rounded-2xl border border-gray-200/60 bg-white shadow-sm transition hover:shadow-md focus:outline-none focus:ring-2 focus:ring-gray-900/20","aria-label":`${r.title} detail`},e.createElement("div",{className:"relative aspect-[4/3] w-full overflow-hidden bg-gray-50"},i?e.createElement("img",{src:i,alt:r.title,className:"h-full w-full object-cover transition duration-300 group-hover:scale-[1.02]",loading:"lazy"}):e.createElement("div",{className:"flex h-full w-full items-center justify-center text-4xl"},"🖼️")),e.createElement("div",{className:"p-4"},e.createElement("h3",{className:"line-clamp-1 text-base font-semibold text-gray-900"},r.title),e.createElement("p",{className:"mt-1 text-sm font-medium text-gray-800"},j.format(Number(r.price)||0)),e.createElement("p",{className:"mt-1 line-clamp-1 text-xs text-gray-500"},r.seller),r.location&&e.createElement("div",{className:"mt-2 inline-flex items-center rounded-md bg-gray-100 px-2 py-0.5 text-[11px] text-gray-600"},r.location)))}const R=()=>{const[r,i]=s.useState([]),[m,h]=s.useState(!0),[w,N]=s.useState(null),[d,v]=s.useState(""),[o,k]=s.useState("new"),[c,f]=s.useState(1),{schoolTheme:p}=L(),E="https://api.cnapss.com/api";s.useEffect(()=>{let t=!0;return(async()=>{try{h(!0);const a=await M.get(`${E}/market`);t&&i(Array.isArray(a.data)?a.data:[])}catch(a){N("Failed to load listings."),console.error("❌ Failed to load listings",a)}finally{t&&h(!1)}})(),()=>{t=!1}},[E]);const y=s.useMemo(()=>{const t=d.trim().toLowerCase();let n=r.filter(a=>{var l,g;return t?((l=a.title)==null?void 0:l.toLowerCase().includes(t))||((g=a.seller)==null?void 0:g.toLowerCase().includes(t)):!0});return n=n.sort((a,l)=>{if(o==="price-asc")return(a.price??0)-(l.price??0);if(o==="price-desc")return(l.price??0)-(a.price??0);const g=a.createdAt??a._id??"",C=l.createdAt??l._id??"";return String(C).localeCompare(String(g))}),n},[r,d,o]),u=Math.max(1,Math.ceil(y.length/b)),S=y.slice((c-1)*b,c*b);return s.useEffect(()=>{f(1)},[d,o]),e.createElement("div",{className:"min-h-screen px-4 py-6 sm:px-6",style:{backgroundColor:p.bg}},e.createElement("div",{className:"mx-auto max-w-6xl"},e.createElement("div",{className:"mb-5 flex flex-col justify-between gap-3 sm:flex-row sm:items-center"},e.createElement("h2",{className:"text-2xl font-bold tracking-tight",style:{color:p.text}},"Marketplace"),e.createElement("div",{className:"flex w-full flex-col gap-2 sm:w-auto sm:flex-row sm:items-center"},e.createElement("div",{className:"relative sm:w-72"},e.createElement("input",{type:"search",value:d,onChange:t=>v(t.target.value),placeholder:"Search: title, seller",className:"w-full rounded-xl border border-gray-300 bg-white px-3 py-2 text-sm text-gray-800 placeholder:text-gray-400 shadow-sm focus:border-gray-900 focus:outline-none focus:ring-2 focus:ring-gray-900/10","aria-label":"search items"}),e.createElement("span",{className:"pointer-events-none absolute right-3 top-2.5 text-gray-400"})),e.createElement("select",{value:o,onChange:t=>k(t.target.value),className:"rounded-xl border border-gray-300 bg-white px-3 py-2 text-sm text-gray-800 shadow-sm focus:border-gray-900 focus:outline-none focus:ring-2 focus:ring-gray-900/10","aria-label":"sort items"},e.createElement("option",{value:"new"},"Newest"),e.createElement("option",{value:"price-asc"},"Lowest Price"),e.createElement("option",{value:"price-desc"},"Highest Price")),e.createElement(x,{to:"/messages",className:"inline-flex items-center justify-center rounded-xl border border-gray-300 bg-white px-3 py-2 text-sm font-medium text-gray-800 shadow-sm transition hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-900/10"},"💬 My Chats"),e.createElement(x,{to:"/market/write",className:"inline-flex items-center justify-center rounded-xl px-4 py-2 text-sm font-semibold text-white shadow transition focus:outline-none focus:ring-2 focus:ring-offset-0",style:{backgroundColor:p.primary}},"+ Create Listing"))),w&&e.createElement("div",{className:"mb-4 rounded-xl border border-red-200 bg-red-50 p-3 text-sm text-red-700"},w),m?e.createElement("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 md:grid-cols-3"},Array.from({length:9}).map((t,n)=>e.createElement(A,{key:n}))):y.length===0?e.createElement(I,null):e.createElement(e.Fragment,null,e.createElement("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 md:grid-cols-3"},S.map(t=>e.createElement(P,{key:t._id,item:t}))),u>1&&e.createElement("div",{className:"mt-6 flex items-center justify-center gap-2"},e.createElement("button",{onClick:()=>f(t=>Math.max(1,t-1)),disabled:c===1,className:"rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-700 shadow-sm disabled:cursor-not-allowed disabled:opacity-50"},"Previous"),e.createElement("span",{className:"text-sm text-gray-600"},c," / ",u),e.createElement("button",{onClick:()=>f(t=>Math.min(u,t+1)),disabled:c===u,className:"rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-700 shadow-sm disabled:cursor-not-allowed disabled:opacity-50"},"Next")))))};export{R as default};
