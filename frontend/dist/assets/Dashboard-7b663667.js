import{r as n,u as xe,a as he,b as ye,c as be,d as Ee,R as e,e as ve}from"./index-c9998775.js";import{u as we}from"./uploadToCloudinary-dc971086.js";import{g as ke,c as Ne}from"./posts-11cdb806.js";import{g as _e,c as U}from"./academicPosts-c1692ec7.js";import"./http-a6fe908c.js";/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Ce=t=>t.replace(/^([A-Z])|[\s-_]+(\w)/g,(s,o,i)=>i?i.toUpperCase():o.toLowerCase()),oe=t=>{const s=Ce(t);return s.charAt(0).toUpperCase()+s.slice(1)},ie=(...t)=>t.filter((s,o,i)=>!!s&&s.trim()!==""&&i.indexOf(s)===o).join(" ").trim(),Me=t=>{for(const s in t)if(s.startsWith("aria-")||s==="role"||s==="title")return!0};/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ae={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=n.forwardRef(({color:t="currentColor",size:s=24,strokeWidth:o=2,absoluteStrokeWidth:i,className:p="",children:c,iconNode:f,...m},x)=>n.createElement("svg",{ref:x,...Ae,width:s,height:s,stroke:t,strokeWidth:i?Number(o)*24/Number(s):o,className:ie("lucide",p),...!c&&!Me(m)&&{"aria-hidden":"true"},...m},[...f.map(([y,E])=>n.createElement(y,E)),...Array.isArray(c)?c:[c]]));/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=(t,s)=>{const o=n.forwardRef(({className:i,...p},c)=>n.createElement(qe,{ref:c,iconNode:s,className:ie(`lucide-${Se(oe(t))}`,`lucide-${t}`,i),...p}));return o.displayName=oe(t),o};/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]],Pe=z("bookmark",Le);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],Fe=z("message-square",Re);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=[["path",{d:"m2 9 3-3 3 3",key:"1ltn5i"}],["path",{d:"M13 18H7a2 2 0 0 1-2-2V6",key:"1r6tfw"}],["path",{d:"m22 15-3 3-3-3",key:"4rnwn2"}],["path",{d:"M11 6h6a2 2 0 0 1 2 2v10",key:"2f72bc"}]],Te=z("repeat-2",$e);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],ze=z("send",Be);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["path",{d:"M12 2v13",key:"1km8f5"}],["path",{d:"m16 6-4-4-4 4",key:"13yo43"}],["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}]],De=z("share",je),V={pageBg:"#FFFFFF",text:"#0F172A",sub:"#64748B",primary:"#111827",pink:"#FF6B8A",red:"#FF7A70"},Ie=[{key:"lecture_notes",label:"Lecture Notes"},{key:"syllabus",label:"Syllabus"},{key:"past_exams",label:"Past Exams"},{key:"quiz_prep",label:"Quiz Prep"}],We=(t="")=>String(t).toLowerCase().trim().replace(/[\s_-]+/g,"_"),me=(t={})=>{const s=t.postType||t.type||t.mode||(t.lookingFor?"seeking":"question")||"",o=String(s).toLowerCase();return o==="looking_for"||o==="seeking"||o==="lf"?"seeking":"question"},Oe=(t={})=>{const s=We(t.kind||"");if(s)return s;const o=[t.kind,...Array.isArray(t.tags)?t.tags:[],t.title,t.content].filter(Boolean).join(" ").toLowerCase();return/(course\s*materials?|syllabus|notes?|exam|midterm|final|assignment|hw|homework)/.test(o)?"course_materials":/(study\s*(mate|group)|\bstudy\b|team\s*up)/.test(o)?"study_mate":/(coffee\s*chat|coffee\s*time|\bchat\b)/.test(o)?"coffee_chat":""};function Ke(t){const s=new Date(t),i=new Date-s,p=Math.floor(i/6e4),c=Math.floor(p/60),f=Math.floor(c/24);return p<60?`${p} mins ago`:c<24?`${c} hs ago`:f===1?"yesterday":`${f} days ago`}function Ge(){return e.createElement("svg",{viewBox:"0 0 24 24",width:"24",height:"24","aria-hidden":!0},e.createElement("circle",{cx:"12",cy:"8",r:"4",fill:"#cbd5e1"}),e.createElement("path",{d:"M4 20c0-4 4-6 8-6s8 2 8 6",fill:"#cbd5e1"}))}function Qe({children:t}){return e.createElement("div",{className:"rounded-2xl bg-white shadow-lg overflow-hidden"},t)}function Ye({value:t,onChange:s}){const o=t==="general",i=n.useRef(null),p=n.useRef(null),[c,f]=n.useState({w:0,x:0}),m=()=>{const x=i.current,y=p.current;if(!x||!y)return;const E=o?x:y;f({w:E.offsetWidth,x:E.offsetLeft-x.offsetLeft})};return n.useLayoutEffect(()=>{var y;m();const x=new ResizeObserver(m);return(y=i.current)!=null&&y.parentElement&&x.observe(i.current.parentElement),()=>x.disconnect()},[o]),e.createElement(e.Fragment,null,e.createElement("style",null,`
        @keyframes wiggleScale {
          0% { transform: translateY(0) scale(1); }
          25% { transform: translateY(-2px) scale(1.03); }
          50% { transform: translateY(0.5px) scale(1.01); }
          75% { transform: translateY(-1px) scale(1.02); }
          100% { transform: translateY(0) scale(1); }
        }
      `),e.createElement("div",{className:"w-full flex justify-center"},e.createElement("div",{className:"relative inline-flex items-center gap-8"},e.createElement("span",{"aria-hidden":!0,className:"absolute -bottom-2 h-[3px] rounded-full transition-transform duration-300 ease-out",style:{width:c.w||0,transform:`translateX(${c.x||0}px)`,background:`linear-gradient(90deg, ${V.pink}, ${V.red})`}}),e.createElement("button",{ref:i,type:"button",onClick:()=>s("general"),className:`text-[22px] font-bold flex items-center gap-2 transition-all ${o?"text-slate-900":"text-slate-400 hover:text-slate-600"} ${o?"animate-[wiggleScale_360ms_ease-in-out]":""}`,"aria-pressed":o},e.createElement("span",{"aria-hidden":!0},"ðŸ’¬"),e.createElement("span",null,"General")),e.createElement("button",{ref:p,type:"button",onClick:()=>s("academic"),className:`text-[22px] font-bold flex items-center gap-2 transition-all ${o?"text-slate-400 hover:text-slate-600":"text-slate-900 animate-[wiggleScale_360ms_ease-in-out]"}`,"aria-pressed":!o},e.createElement("span",{"aria-hidden":!0},"ðŸŽ“"),e.createElement("span",null,"Academic")))))}function Ue({post:t,onOpenDetail:s,showBadge:o,showActionsBar:i=!1,commentCount:p=0}){var A;const c=t.raw||{},f=me(c),m=Oe(c),x=f==="seeking"?m==="course_materials"?"ðŸ“":m==="study_mate"?"ðŸ‘¥":m==="coffee_chat"?"â˜•ï¸":"ðŸ“Œ":"",y={lecture_notes:"Lecture Notes",syllabus:"Syllabus",past_exams:"Past Exams",quiz_prep:"Quiz Prep"},q=(Array.isArray(c.materials)&&m==="course_materials"?c.materials:[]).map(S=>y[S]||S);return e.createElement("button",{type:"button",onClick:s,className:"w-full text-left py-4 px-3 hover:bg-slate-50 transition"},e.createElement("div",{className:"flex items-start gap-3"},o?e.createElement("span",{className:"text-[18px] w-6 text-center mt-[2px]"},x):e.createElement("span",{className:"w-6"}),e.createElement("div",{className:"h-8 w-8 rounded-full bg-slate-200 flex items-center justify-center mt-[2px]"},e.createElement(Ge,null)),e.createElement("div",{className:"min-w-0 flex-1"},e.createElement("div",{className:"flex items-start justify-between gap-3"},e.createElement("div",{className:"truncate font-semibold text-slate-900"},t.title),e.createElement("div",{className:"text-xs text-slate-500 whitespace-nowrap"},Ke(t.createdAt))),((A=t.raw)==null?void 0:A.content)&&e.createElement("p",{className:"mt-1 text-[13.5px] text-slate-600 line-clamp-1"},t.raw.content),q.length>0&&e.createElement("div",{className:"mt-3 flex flex-wrap gap-2"},q.map(S=>e.createElement("span",{key:S,className:"inline-flex items-center rounded-full border border-slate-700 bg-slate-50 px-2.5 py-[3px] text-[11px] text-slate-700"},S))),i&&e.createElement("div",{className:"flex items-center justify-between mt-2 pr-1 pl-[0px] text-slate-500 text-[13px]"},e.createElement("div",{className:"flex items-center gap-6"},e.createElement(Pe,{size:18,className:"hover:text-slate-800 cursor-pointer"}),e.createElement(Te,{size:18,className:"hover:text-slate-800 cursor-pointer"}),e.createElement(De,{size:18,className:"hover:text-slate-800 cursor-pointer"}),e.createElement("div",{className:"flex items-center gap-1"},e.createElement(ze,{size:17,className:"hover:text-slate-800 cursor-pointer"}),e.createElement("span",{className:"text-xs font-medium"},"DM"))),e.createElement("div",{className:"flex items-center gap-1 text-sm"},e.createElement(Fe,{size:17,className:"hover:text-slate-800 cursor-pointer"}),e.createElement("span",null,p??0))))))}const Ve=t=>t?Array.isArray(t)?t:Array.isArray(t.items)?t.items:Array.isArray(t.data)?t.data:t.data&&Array.isArray(t.data.items)?t.data.items:[]:[],ce=t=>Ve(t).map(s=>({_id:s._id||s.id,title:s.title||(typeof s.content=="string"?s.content.slice(0,80):"Untitled"),createdAt:s.createdAt||s.updatedAt||new Date().toISOString(),raw:s}));function He({value:t,onSubmit:s,onReset:o}){const[i,p]=n.useState(t);n.useEffect(()=>p(t),[t]);const c=f=>{f.preventDefault(),s(i)};return e.createElement("form",{onSubmit:c,className:"mx-auto mt-5 w-full max-w-[700px] rounded-full shadow-[0_6px_24px_rgba(0,0,0,0.06)] bg-white border border-slate-200 overflow-hidden"},e.createElement("div",{className:"grid grid-cols-[1fr_auto] items-stretch"},e.createElement("div",{className:"px-5 py-3"},e.createElement("div",{className:"text-[11px] font-semibold text-slate-500"},"Keyword"),e.createElement("input",{value:i.q||"",onChange:f=>p({q:f.target.value}),placeholder:"Search postsâ€¦",className:"w-full bg-transparent text-[14px] focus:outline-none"})),e.createElement("div",{className:"flex items-center gap-2 px-3"},e.createElement("button",{type:"button",onClick:()=>o(),className:"px-3 py-2 rounded-full text-sm text-slate-700 hover:bg-slate-100"},"Reset"),e.createElement("button",{type:"submit",className:"px-4 py-2 rounded-full bg-black text-white text-sm font-semibold"},"Search"))))}function Ze({value:t,onSubmit:s,onReset:o}){const[i,p]=n.useState(t),[c,f]=n.useState(!1),[m,x]=n.useState("type"),y=n.useRef(null),[E,q]=n.useState({left:0,top:0,width:0,bottom:0});n.useEffect(()=>p(t),[t]);const A=()=>{const l=y.current;if(!l)return;const b=l.getBoundingClientRect();q({left:b.left,top:b.top,width:b.width,bottom:b.bottom})};n.useLayoutEffect(()=>{A();const l=()=>A();return window.addEventListener("resize",l),window.addEventListener("scroll",l,!0),()=>{window.removeEventListener("resize",l),window.removeEventListener("scroll",l,!0)}},[]),n.useEffect(()=>{const l=w=>{var _,C;c&&(y.current&&y.current.contains(w.target)||(C=(_=w.target).closest)!=null&&C.call(_,"[data-acad-popover]")||(f(!1),x("type")))},b=w=>w.key==="Escape"&&f(!1);return document.addEventListener("click",l),document.addEventListener("keydown",b),()=>{document.removeEventListener("click",l),document.removeEventListener("keydown",b)}},[c]);const S=l=>p(b=>({...b,...l})),F=[{key:"question",title:"General question",desc:"Ask about courses, careers, visa, housingâ€¦",icon:e.createElement("svg",{viewBox:"0 0 24 24",width:"20",height:"20",className:"text-slate-700"},e.createElement("circle",{cx:"12",cy:"12",r:"10",fill:"currentColor",opacity:".08"}),e.createElement("path",{d:"M9.5 9.5a2.5 2.5 0 1 1 3.9 2l-.8.5a1.6 1.6 0 0 0-.6 1.2v.3",stroke:"currentColor",strokeWidth:"1.6",fill:"none",strokeLinecap:"round"}),e.createElement("circle",{cx:"12",cy:"16.5",r:"1",fill:"currentColor"}))},{key:"seeking",title:"Seeking",desc:"Find materials, study mates, or coffee chats",icon:e.createElement("svg",{viewBox:"0 0 24 24",width:"20",height:"20",className:"text-slate-700"},e.createElement("rect",{x:"4",y:"5",width:"16",height:"12",rx:"2",fill:"currentColor",opacity:".08"}),e.createElement("path",{d:"M5.5 8h13M7 12h10M9 16h6",stroke:"currentColor",strokeWidth:"1.6",strokeLinecap:"round"}))}],$=[{key:"course_materials",title:"Course Materials",desc:"Syllabus, notes, examsâ€¦",emoji:"ðŸ“"},{key:"study_mate",title:"Study Mate",desc:"Find peers to study together",emoji:"ðŸ‘¥"},{key:"coffee_chat",title:"Coffee Chat",desc:"Casual chat / mentoring",emoji:"â˜•ï¸"}],P=({leading:l,title:b,desc:w,selected:_,onClick:C})=>e.createElement("button",{type:"button",onClick:C,className:`w-full flex items-center gap-3 px-3 py-3 rounded-2xl transition text-left
        ${_?"bg-slate-50 border border-slate-300 shadow-[inset_0_0_0_1px_rgba(15,23,42,0.06)]":"hover:bg-slate-50 border border-transparent"}`},e.createElement("div",{className:"h-9 w-9 rounded-xl bg-slate-100 flex items-center justify-center shrink-0"},l),e.createElement("div",{className:"min-w-0"},e.createElement("div",{className:"font-medium text-[14.5px] text-slate-900 truncate"},b),e.createElement("div",{className:"text-[12.5px] text-slate-500 truncate"},w))),v=()=>{const _=Math.min(520,Math.max(300,E.width-32,0),window.innerWidth-32),C=Math.round(E.left+(E.width-_)/2),O=Math.round(E.bottom+8);return ve.createPortal(e.createElement("div",{"data-acad-popover":!0,className:"z-50 fixed",style:{left:C,top:O,width:_}},e.createElement("div",{className:"rounded-[24px] bg-white shadow-2xl border border-slate-200 overflow-hidden"},e.createElement("div",{className:"max-h-[70vh] overflow-auto p-3"},e.createElement("div",{className:"px-1 pb-2 text-[11.5px] font-semibold text-slate-500"},m==="type"?"Type":"Seeking Â· choose kind"),m==="type"&&e.createElement("div",{className:"space-y-2"},F.map(d=>e.createElement(P,{key:d.key,leading:d.icon,title:d.title,desc:d.desc,selected:(i.type||"question")===d.key,onClick:()=>{if(d.key==="question"){const L={...i,type:"question",kind:""};p(L),s(L),f(!1),x("type");return}x("kind")}}))),m==="kind"&&e.createElement("div",{className:"space-y-2"},$.map(d=>e.createElement(P,{key:d.key,leading:e.createElement("span",{className:"text-base"},d.emoji),title:d.title,desc:d.desc,selected:i.type==="seeking"&&i.kind===d.key,onClick:()=>{const L={...i,type:"seeking",kind:d.key};p(L),s(L),f(!1),x("type")}})))))),document.body)},j=l=>{l.preventDefault(),s(i),f(!1),x("type")};return e.createElement("div",{className:"mx-auto mt-5 w-full max-w-[860px]",ref:y},e.createElement("form",{onSubmit:j,className:"rounded-full shadow-[0_6px_24px_rgba(0,0,0,0.06)] bg-white border border-slate-200 overflow-hidden"},e.createElement("div",{className:"grid grid-cols-[1.2fr_0.9fr_auto] items-stretch"},e.createElement("div",{className:"px-5 py-3 border-r"},e.createElement("div",{className:"text-[11px] font-semibold text-slate-500"},"Keyword"),e.createElement("input",{value:i.q||"",onChange:l=>S({q:l.target.value}),placeholder:"Search academic postsâ€¦",className:"w-full bg-transparent text-[14px] focus:outline-none"})),e.createElement("button",{type:"button",onClick:()=>{A(),f(!0),x("type")},className:"px-5 text-left py-3 border-r hover:bg-slate-50"},e.createElement("div",{className:"text-[11px] font-semibold text-slate-500"},"Type"),e.createElement("div",{className:"text-[14px]"},i.type==="seeking"?"Seeking":"General Question")),e.createElement("div",{className:"flex items-center gap-2 px-3"},e.createElement("button",{type:"button",onClick:()=>{p({q:"",type:"question",kind:""}),o==null||o()},className:"px-3 py-2 rounded-full text-sm text-slate-700 hover:bg-slate-100"},"Reset"),e.createElement("button",{type:"submit",className:"px-4 py-2 rounded-full bg-black text-white text-sm font-semibold"},"Search")))),c&&e.createElement(v,null))}function Xe({title:t,setTitle:s,active:o,mode:i,lookingKind:p}){return e.createElement("div",{className:"flex items-center gap-3 p-4 border-b border-slate-200"},e.createElement("div",{className:"shrink-0 h-10 w-10 rounded-full bg-slate-200 flex items-center justify-center"},e.createElement("svg",{viewBox:"0 0 24 24",width:"24",height:"24","aria-hidden":!0},e.createElement("circle",{cx:"12",cy:"8",r:"4",fill:"#cbd5e1"}),e.createElement("path",{d:"M4 20c0-4 4-6 8-6s8 2 8 6",fill:"#cbd5e1"}))),e.createElement("div",{className:"flex-1"},e.createElement("input",{value:t,onChange:c=>s(c.target.value),placeholder:o==="general"?"Write a catchy title for your postâ€¦":i==="question"?"Ask an academic/career questionâ€¦":p==="course_materials"?"Course name (e.g., STAT101)":"Seekingâ€¦ (short title)",className:"w-full rounded-xl border border-slate-300 px-3 py-2 text-[15px] font-semibold text-slate-900 focus:outline-none focus:ring-2 focus:ring-slate-900/10 focus:border-slate-900"}),e.createElement("p",{className:"mt-1 text-xs text-slate-500"},"Posting as ",e.createElement("span",{className:"font-medium"},"anonymous"))))}function rt(){const t=xe(),s=he(),{school:o}=ye(),{user:i}=be(),p=Ee(),c=o||"nyu",f=!!i,[m,x]=n.useState("academic");n.useEffect(()=>{const r=(new URLSearchParams(s.search).get("tab")||"").toLowerCase();r==="free"?x("general"):r==="academic"&&x("academic")},[s.search]);const[y,E]=n.useState({loading:!0,items:[],error:""}),[q,A]=n.useState({q:""}),[S,F]=n.useState(12),$=n.useMemo(()=>{const{q:a}=q;let r=y.items;if(a){const h=a.toLowerCase();r=r.filter(u=>{var N;return u.title.toLowerCase().includes(h)||(((N=u.raw)==null?void 0:N.content)||"").toLowerCase().includes(h)})}return r},[y.items,q]),P={loading:y.loading,error:y.error,items:$.slice(0,S),hasMore:$.length>S},[v,j]=n.useState({q:"",type:"all",kind:""}),[l,b]=n.useState({items:[],page:1,limit:20,total:0,loading:!0,loadingMore:!1,hasMore:!0,error:""}),w=n.useCallback(async(a=1,r=!1)=>{var ne,le;const h=v.q||"",u=v.type==="all"?"":v.type,N=v.type==="seeking"?v.kind:"",g=await _e({school:c,page:a,limit:l.limit,q:h,sort:"new",type:u,kind:N}),W=ce(g),se=typeof(g==null?void 0:g.total)=="number"?g.total:typeof((ne=g==null?void 0:g.paging)==null?void 0:ne.total)=="number"?g.paging.total:r?l.total:W.length,ge=typeof(g==null?void 0:g.limit)=="number"?g.limit:typeof((le=g==null?void 0:g.paging)==null?void 0:le.limit)=="number"?g.paging.limit:l.limit,re=r?[...l.items,...W]:W;b({items:re,page:a,limit:ge,total:se,loading:!1,loadingMore:!1,hasMore:re.length<se&&W.length>0,error:""})},[c,v,l.items,l.limit,l.total]);n.useEffect(()=>{let a=!0;return(async()=>{try{const r=await ke({school:c,limit:200,sort:"new"});if(!a)return;E({loading:!1,items:ce(r),error:""})}catch(r){if(!a)return;E({loading:!1,items:[],error:(r==null?void 0:r.message)||"Failed to load posts."})}})(),()=>{a=!1}},[c]),n.useEffect(()=>{b(a=>({...a,loading:!0,error:"",page:1})),w(1,!1).catch(a=>b(r=>({...r,loading:!1,error:(a==null?void 0:a.message)||"Failed to load posts."})))},[c,v.q,v.type,v.kind]);const _=n.useRef(null),C=n.useRef(null);n.useEffect(()=>{if(!_.current)return;const a=new IntersectionObserver(r=>{r[0].isIntersecting&&F(u=>u+10)},{rootMargin:"400px 0px 400px 0px"});return a.observe(_.current),()=>a.disconnect()},[$.length]),n.useEffect(()=>{if(!C.current)return;const a=new IntersectionObserver(r=>{r[0].isIntersecting&&l.hasMore&&!l.loading&&!l.loadingMore&&(b(u=>({...u,loadingMore:!0})),w(l.page+1,!0).catch(u=>b(N=>({...N,loadingMore:!1,error:(u==null?void 0:u.message)||"Failed to load more."}))))},{rootMargin:"600px 0px 600px 0px"});return a.observe(C.current),()=>a.disconnect()},[l.hasMore,l.loading,l.loadingMore,l.page,w]);const O=(a,r)=>{var N,g;const h=((N=a.raw)==null?void 0:N._id)||a._id||((g=a.raw)==null?void 0:g.id)||a.id;if(!h)return;const u=r==="general"?`/freeboard/${h}`:`/academic/${h}`;t(p(u))},[d,L]=n.useState(""),[R,H]=n.useState(""),[K,de]=n.useState([]),[k,G]=n.useState("question"),[M,Z]=n.useState("course_materials"),[X,J]=n.useState(""),[D,ee]=n.useState([]),ue=a=>ee(r=>r.includes(a)?r.filter(h=>h!==a):[...r,a]),[I,te]=n.useState(!1),[Q,T]=n.useState({type:"",text:""}),ae=f&&d.trim()&&(R.trim()||K.length),Y=f&&(k==="question"?d.trim()&&R.trim():M==="course_materials"?d.trim()&&D.length>0:d.trim()),pe=async a=>{const r=[];for(const h of a)try{const u=await we(h);(u!=null&&u.secure_url||u!=null&&u.url)&&r.push(u.secure_url||u.url)}catch{}return r},fe=async a=>{if(a.preventDefault(),T({type:"",text:""}),!f){T({type:"error",text:"Login required to post."});return}te(!0);try{if(m==="general"){if(!ae)throw new Error("Missing fields");let r=[];K.length&&(r=await pe(K)),await Ne({school:c,title:d.trim(),content:R.trim(),images:r}),E(h=>({...h,items:[{_id:Math.random().toString(36).slice(2),title:d.trim(),createdAt:new Date().toISOString(),raw:{title:d.trim(),content:R.trim()}},...h.items]}))}else{if(!Y)throw new Error("Missing fields");const r={school:c};k==="question"?await U({...r,title:d.trim(),content:R.trim(),postType:"question"}):M==="course_materials"?await U({...r,title:d.trim(),content:"",postType:"seeking",kind:"course_materials",courseName:d.trim(),professor:X.trim(),materials:D,tags:["seeking","course_materials"]}):await U({...r,title:d.trim(),content:R.trim(),postType:"seeking",kind:M,tags:["seeking",M]}),b(h=>({...h,loading:!0})),await w(1,!1)}L(""),H(""),de([]),G("question"),Z("course_materials"),J(""),ee([]),T({type:"success",text:"Posted!"}),setTimeout(()=>T({type:"",text:""}),1200)}catch(r){T({type:"error",text:(r==null?void 0:r.message)||"Failed to post."})}finally{te(!1)}},B=m==="general"?{loading:P.loading,items:P.items,hasMore:P.hasMore,error:P.error}:{loading:l.loading,items:l.items,hasMore:l.hasMore,error:l.error,loadingMore:l.loadingMore};return e.createElement("div",{className:"min-h-screen",style:{background:V.pageBg}},e.createElement("main",{className:"mx-auto max-w-6xl px-4 py-6 grid grid-cols-1 md:grid-cols-[minmax(620px,700px)_380px] gap-10"},e.createElement("section",{className:"md:col-start-1"},e.createElement("div",{className:"-mt-10 md:-mt-12 lg:-mt-14 transition-all"}),e.createElement(Ye,{value:m,onChange:x}),m==="general"?e.createElement(He,{value:q,onSubmit:a=>{A(a),F(12)},onReset:()=>{A({q:""}),F(12)}}):e.createElement(Ze,{value:{q:v.q,type:v.type,kind:v.kind},onSubmit:a=>j(a),onReset:()=>j({q:"",type:"all",kind:""})}),B.loading?e.createElement("ul",{className:"mt-4 space-y-3"},Array.from({length:10}).map((a,r)=>e.createElement("li",{key:r,className:"h-16 rounded-xl bg-white/70 border border-slate-200 animate-pulse"}))):B.items.length?e.createElement(e.Fragment,null,e.createElement("ul",{className:"mt-5 mx-auto max-w-[700px] px-2 space-y-4"},B.items.map(a=>{var u,N,g;const r=m==="general"||m==="academic"&&me(a.raw||{})==="question",h=((u=a.raw)==null?void 0:u.commentCount)??((N=a.raw)==null?void 0:N.commentsCount)??(Array.isArray((g=a.raw)==null?void 0:g.comments)?a.raw.comments.length:0);return e.createElement("li",{key:a._id||Math.random()},e.createElement("div",{className:"mx-6 border-b border-slate-300/80 py-3"},e.createElement(Ue,{post:a,onOpenDetail:()=>O(a,m),showBadge:m==="academic",showActionsBar:r,commentCount:h})))})),e.createElement("div",{className:"flex justify-center py-6"},e.createElement("div",{ref:m==="general"?_:C,className:"h-6 w-6 rounded-full border-2 border-dashed border-slate-300","aria-hidden":!0})),m==="academic"&&B.loadingMore&&e.createElement("div",{className:"text-center pb-8 text-slate-500 text-sm"},"Loading moreâ€¦")):e.createElement("div",{className:"mx-auto max-w-[700px] text-center py-16"},e.createElement("p",{className:"text-[15px] text-slate-600"},B.error||"No posts yet."))),e.createElement("aside",{className:"md:col-start-2 md:sticky md:top-[24px] self-start"},e.createElement(Qe,null,e.createElement("form",{onSubmit:fe},e.createElement(Xe,{title:d,setTitle:L,active:m,mode:k,lookingKind:M}),e.createElement("div",{className:"p-4 space-y-4"},m==="academic"&&e.createElement("div",{className:"flex items-center gap-2"},e.createElement("button",{type:"button",onClick:()=>G("question"),className:`px-3 py-1.5 rounded-full text-sm border ${k==="question"?"bg-slate-900 text-white border-slate-900":"bg-white text-slate-700 border-slate-300 hover:bg-slate-50"}`,"aria-pressed":k==="question"},"General question"),e.createElement("button",{type:"button",onClick:()=>G("seeking"),className:`px-3 py-1.5 rounded-full text-sm border ${k==="seeking"?"bg-slate-900 text-white border-slate-900":"bg-white text-slate-700 border-slate-300 hover:bg-slate-50"}`,"aria-pressed":k==="seeking"},"Seeking ðŸ“¥"),k==="seeking"&&e.createElement("select",{value:M,onChange:a=>Z(a.target.value),className:"ml-2 rounded-full border border-slate-300 px-3 py-1.5 text-sm"},e.createElement("option",{value:"course_materials"},"Course Materials"),e.createElement("option",{value:"study_mate"},"Study Mate"),e.createElement("option",{value:"coffee_chat"},"Coffee Chat"))),m==="academic"&&k==="seeking"&&M==="course_materials"?e.createElement("div",{className:"space-y-4"},e.createElement("div",null,e.createElement("label",{className:"block text-sm font-medium text-slate-700"},"Professor (optional)"),e.createElement("input",{type:"text",value:X,onChange:a=>J(a.target.value),placeholder:"Professor name (optional)",className:"w-full rounded-xl border border-slate-300 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-slate-900/10 focus:border-slate-900"})),e.createElement("div",null,e.createElement("label",{className:"block text-sm font-medium text-slate-700 mb-2"},"Personal Materials (choose one or more)"),e.createElement("div",{className:"grid grid-cols-2 gap-2"},Ie.map(a=>e.createElement("label",{key:a.key,className:`flex items-center gap-2 rounded-xl border px-3 py-2 text-sm cursor-pointer ${D.includes(a.key)?"border-slate-900 bg-slate-900/5":"border-slate-300 hover:bg-slate-50"}`},e.createElement("input",{type:"checkbox",checked:D.includes(a.key),onChange:()=>ue(a.key),className:"accent-black"}),e.createElement("span",null,a.label)))),e.createElement("p",{className:"mt-2 text-xs text-slate-500"},"You can select multiple. Title will be used as course name."))):e.createElement("textarea",{value:R,onChange:a=>H(a.target.value),placeholder:m==="general"?"Write your content hereâ€¦":k==="question"?"Describe your academic/career questionâ€¦":M==="study_mate"?"Describe schedule, level, topicâ€¦":"Say hello and what you'd like to chat aboutâ€¦",className:"w-full min-h-[120px] rounded-xl border border-slate-300 px-3 py-2 text-[14px] text-slate-800 focus:outline-none focus:ring-2 focus:ring-slate-900/10 focus:border-slate-900"}),e.createElement("div",{className:"flex items-center justify-between pt-2"},e.createElement("p",{className:"text-[12px] text-slate-500"},"Posting to"," ",e.createElement("strong",null,m==="general"?"Freeboard":k==="question"?"Academic":`Seeking: ${M==="course_materials"?"Course Materials":M==="study_mate"?"Study Mate":"Coffee Chat"}`),"."),m==="academic"&&k==="seeking"?e.createElement("div",{className:"flex flex-col items-end"},e.createElement("button",{type:"submit",disabled:!Y||I,className:"rounded-xl bg-[#3044f0] px-4 py-2 text-sm font-semibold text-white hover:bg-[#2433c4] active:scale-[0.98] transition-all shadow-md hover:shadow-lg disabled:opacity-60"},I?"Postingâ€¦":e.createElement(e.Fragment,null,"Post"," ",e.createElement("span",{className:"line-through text-[11px] text-gray-400 ml-1"},"6 C point"))),e.createElement("span",{className:"text-[10px] text-gray-400 mt-[2px]"},"0 point during beta season")):e.createElement("button",{type:"submit",disabled:I||(m==="general"?!ae:!Y),className:"rounded-xl bg-[#3044f0] px-4 py-2 text-sm font-semibold text-white hover:bg-[#2433c4] active:scale-[0.98] transition-all shadow-md hover:shadow-lg disabled:opacity-60"},I?"Postingâ€¦":"Post")),!!Q.text&&e.createElement("div",{className:`text-sm rounded-lg px-3 py-2 ${Q.type==="success"?"bg-green-50 text-green-700 border border-green-200":"bg-red-50 text-red-700 border-red-200"}`},Q.text)))))))}export{rt as default};
