import{u as j,a as L,b as M,c as F,r as c,l as U,R as e}from"./index-6651a588.js";import{d as u,r as _}from"./relativeTime-c5b48b32.js";import"./en-bad45d86.js";import{u as H}from"./useLoginGate-ba4e11f5.js";import{l as O,g as W}from"./posts-14195ecc.js";u.extend(_);u.locale("en");const B=r=>({background:r||"linear-gradient(135deg, rgba(124,58,237,0.12), rgba(99,102,241,0.12))"}),D=r=>{switch(r){case"personalMaterial":return"personal material";case"personalClassNote":return"personal class note";default:return r||"material"}};function I(){const{user:r,token:m}=j(),{school:o,schoolTheme:s}=L(),{ensureAuth:x}=H(),l=M(),n=F(),[p,k]=c.useState([]),[h,f]=c.useState(!0),[g,y]=c.useState("");c.useEffect(()=>{let t=!0;if(o)return(async()=>{f(!0),y("");try{let a;m?a=await O({school:o,token:m}):a=await W({school:o,page:1,limit:10});const d=Array.isArray(a)?a:Array.isArray(a==null?void 0:a.items)?a.items:[];t&&k(d.slice(0,5))}catch{t&&y("Failed to load posts.")}finally{t&&f(!1)}})(),()=>{t=!1}},[o,m]);const[b,C]=c.useState([]),[A,E]=c.useState(!0),[N,w]=c.useState("");c.useEffect(()=>{let t=!0;if(o)return(async()=>{E(!0),w("");try{const a=await U({school:o,token:m,limit:5}),d=Array.isArray(a==null?void 0:a.items)?a.items:Array.isArray(a)?a:[];t&&C(d)}catch{t&&w("Failed to load CourseHub items.")}finally{t&&E(!1)}})(),()=>{t=!1}},[o,m]);const P=c.useMemo(()=>((r==null?void 0:r.nickname)||(r!=null&&r.email?r.email.split("@")[0]:"Guest")).slice(0,2).toUpperCase(),[r]);return e.createElement("div",{className:"min-h-screen px-4 py-6 sm:px-6 lg:px-8",style:{backgroundColor:(s==null?void 0:s.bg)||"#f6f3ff"}},e.createElement("div",{className:"mx-auto w-full max-w-6xl"},e.createElement("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-[260px,1fr]"},e.createElement("aside",{className:"rounded-2xl border border-gray-200 bg-white p-5 shadow-sm md:h-fit"},e.createElement("div",{className:"mx-auto mb-3 flex h-20 w-20 items-center justify-center rounded-full text-xl font-bold text-gray-900",style:B(s==null?void 0:s.bg)},P),e.createElement("div",{className:"text-center"},e.createElement("div",{className:"text-base font-bold text-gray-900"},(r==null?void 0:r.nickname)||"Guest"),e.createElement("div",{className:"mt-0.5 text-[11px] uppercase tracking-wide text-gray-500"},(o==null?void 0:o.toUpperCase())||"SCHOOL")),e.createElement("nav",{className:"mt-5 grid grid-cols-2 gap-2 text-sm md:grid-cols-1"},e.createElement(i,{onClick:()=>l(n("/myposts"))},"My Posts"),e.createElement(i,{onClick:()=>l(n("/liked"))},"Liked"),e.createElement(i,{onClick:()=>l(n("/commented"))},"Commented"),e.createElement(i,{onClick:()=>l(n("/personal-schedule"))},"My Schedule"),e.createElement(i,{onClick:()=>l(n("/market"))},"Marketplace"),e.createElement(i,{onClick:()=>l(n("/foodmap"))},"Food Map"))),e.createElement("main",{className:"space-y-6"},e.createElement("section",{className:"rounded-2xl border border-gray-200 bg-white p-4 sm:p-6 shadow-sm"},e.createElement("div",{className:"mb-4 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},e.createElement("h2",{onClick:()=>l(n("/freeboard")),className:"cursor-pointer text-lg font-semibold sm:text-xl hover:underline",style:{color:(s==null?void 0:s.text)||"#4c1d95"}},"Free Board"),e.createElement("button",{onClick:()=>x(()=>l(n("/freeboard/write"))),className:"w-full rounded-xl px-4 py-2 text-sm font-semibold text-white shadow sm:w-auto",style:{backgroundColor:(s==null?void 0:s.primary)||"#6b46c1"}},"+ Write Post")),h?e.createElement("ul",{className:"space-y-3"},Array.from({length:5}).map((t,a)=>e.createElement("li",{key:a},e.createElement("div",{className:"h-5 w-3/4 animate-pulse rounded bg-gray-100"}),e.createElement("div",{className:"mt-2 h-3 w-1/3 animate-pulse rounded bg-gray-100"})))):g?e.createElement("div",{className:"rounded-lg bg-red-50 p-3 text-sm text-red-700"},g):p.length===0?e.createElement("div",{className:"rounded-lg border border-dashed border-gray-300 p-6 text-center text-sm text-gray-600"},"No posts yet. Be the first to write!"):e.createElement("ul",{className:"divide-y divide-gray-100"},p.map(t=>e.createElement("li",{key:t._id,className:"py-3"},e.createElement("button",{onClick:()=>x(()=>l(n(`/freeboard/${t._id}`))),className:"flex w-full items-center justify-between text-left"},e.createElement("h3",{className:"min-w-0 truncate text-sm font-semibold text-gray-900 sm:text-base hover:underline"},t.title),e.createElement("span",{className:"ml-3 shrink-0 text-xs text-gray-500"},u(t.createdAt).fromNow())))))),e.createElement("section",{className:"rounded-2xl border border-gray-200 bg-white p-4 sm:p-6 shadow-sm"},e.createElement("div",{className:"mb-4 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},e.createElement("h2",{onClick:()=>l(n("/courses")),className:"cursor-pointer text-lg font-semibold sm:text-xl hover:underline",style:{color:(s==null?void 0:s.text)||"#4c1d95"}},"CourseHub"),e.createElement("div",{className:"flex w-full gap-2 sm:w-auto"},e.createElement("button",{onClick:()=>x(()=>l(n("/courses/write"))),className:"flex-1 rounded-xl border px-4 py-2 text-sm font-medium hover:bg-gray-50 sm:flex-none"},"Upload note"),e.createElement("button",{onClick:()=>l(n("/courses")),className:"flex-1 rounded-xl px-4 py-2 text-sm font-semibold text-white shadow sm:flex-none",style:{backgroundColor:(s==null?void 0:s.primary)||"#6b46c1"}},"Open Course Hub"))),A?e.createElement("ul",{className:"space-y-3"},Array.from({length:5}).map((t,a)=>e.createElement("li",{key:a,className:"flex items-center justify-between py-2"},e.createElement("div",{className:"h-4 w-2/3 animate-pulse rounded bg-gray-100"}),e.createElement("div",{className:"h-3 w-16 animate-pulse rounded bg-gray-100"})))):N?e.createElement("div",{className:"rounded-lg bg-red-50 p-3 text-sm text-red-700"},N):b.length===0?e.createElement("div",{className:"rounded-lg border border-dashed border-gray-300 p-6 text-center text-sm text-gray-600"},"No postings yet."):e.createElement("ul",{className:"space-y-2"},b.map(t=>{const a=t._id||t.id,d=(t.courseCode||t.course||"").toUpperCase(),S=t.professor||"Unknown",R=D(t.materialType),v=(t.listingType||"sale")==="wanted";return e.createElement("li",{key:a,className:"rounded-xl border p-3 hover:bg-gray-50"},e.createElement("button",{onClick:()=>l(n(`/courses/materials/${a}`)),className:"flex w-full items-center justify-between text-left"},e.createElement("div",{className:"min-w-0"},e.createElement("div",{className:"flex flex-wrap items-center gap-2"},e.createElement("span",{className:"inline-flex items-center rounded-full px-2 py-0.5 text-[11px] font-semibold "+(v?"bg-rose-100 text-rose-700":"bg-emerald-100 text-emerald-700")},v?"Wanted":"For Sale"),e.createElement("span",{className:"truncate text-sm font-semibold text-gray-900 sm:text-base"},d||"UNKNOWN"),e.createElement("span",{className:"truncate text-xs font-medium text-gray-700 sm:text-sm"},S),e.createElement("span",{className:"truncate text-[11px] text-gray-500 sm:text-xs"},R))),e.createElement("span",{className:"ml-3 shrink-0 text-xs text-gray-400"},t.createdAt?u(t.createdAt).fromNow():"")))}))),e.createElement("section",{className:"rounded-2xl border border-gray-200 bg-white p-5 shadow-sm"},e.createElement("div",{onClick:()=>l(n("/foodmap")),className:"mb-2 cursor-pointer text-sm font-semibold text-gray-900 hover:underline"},"üç± Explore Nearby Food"),e.createElement("p",{className:"text-xs text-gray-600"},"Discover top-rated restaurants and cafes near campus."),e.createElement("div",{className:"mt-3 h-48 w-full overflow-hidden rounded-lg bg-gray-100"},e.createElement("div",{className:"h-full w-full animate-pulse"})))))))}function i({children:r,onClick:m}){return e.createElement("button",{onClick:m,className:"w-full rounded-xl border border-transparent px-3 py-2 text-left text-gray-700 hover:border-gray-200 hover:bg-gray-50"},r)}export{I as default};
