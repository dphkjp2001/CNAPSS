import{e as B,u as D,b as T,c as R,f as U,r as u,R as e}from"./index-3d55c829.js";import{h as V,i as q,j as F}from"./academicPosts-3f24bdec.js";import{U as z,V as G,C as y}from"./CommentSection-94d6546e.js";import"./http-e19067b4.js";import"./relativeTime-05e49612.js";import"./useLoginGate-74be7bbe.js";const M={lecture_notes:"Lecture Notes",syllabus:"Syllabus",past_exams:"Past Exams",quiz_prep:"Quiz Prep"};function Q(d=""){const t=String(d||"").toLowerCase().replace(/[\s-]+/g,"_");return t.includes("course_material")?"📝":t.includes("study")?"👥":t.includes("coffee")?"☕️":"📌"}function X(){var w;const{school:d,id:t}=B(),N=D(),{school:v}=T(),n=d||v||"nyu",{user:l}=R(),{emit:p,on:x}=U(),[i,m]=u.useState({loading:!0,error:"",post:null});if(u.useEffect(()=>{let a=!0;return(async()=>{try{const r=await V({school:n,id:t});if(!a)return;m({loading:!1,error:"",post:r})}catch(r){if(!a)return;m({loading:!1,error:(r==null?void 0:r.message)||"Failed to load post.",post:null})}})(),()=>{a=!1}},[n,t]),u.useEffect(()=>{if(!l)return;let a=!0;return(async()=>{try{const r=await q({school:n,id:t});if(!a)return;m(o=>({...o,post:r||o.post}))}catch{}})(),()=>{a=!1}},[l,n,t]),u.useEffect(()=>{if(!t)return;p("post:join",{postId:t});const a=x("post:voteUpdated",r=>{!r||r.postId!==t||m(o=>{if(!o.post)return o;const j={...o.post,upCount:r.upCount??0,downCount:r.downCount??0};return{...o,post:j}})});return()=>{a==null||a(),p("post:leave",{postId:t})}},[t,p,x]),i.loading)return e.createElement("div",{className:"max-w-3xl mx-auto px-4 py-6 text-sm text-slate-600"},"Loading…");if(i.error)return e.createElement("div",{className:"max-w-3xl mx-auto px-4 py-6 text-sm text-red-600"},i.error);if(!i.post)return null;const s=i.post,f=(s.mode||s.postType||s.type||(s.lookingFor?"looking_for":"general")).toString().toLowerCase(),c=f==="general"||f==="question",g=l&&[String(((w=s.author)==null?void 0:w._id)||s.author),String(s.userId),String(s.authorId)].filter(Boolean).some(a=>String(a)===String(l._id||l.id)),{title:S,content:C,createdAt:E,kind:A,professor:b,materials:h=[],upCount:k=0,downCount:I=0,myVote:L}=s,P=(Array.isArray(h)?h:[]).map(a=>M[a]).filter(Boolean),_=async()=>{window.confirm("Delete this post?")&&(await F({school:n,id:t}),N(`/${encodeURIComponent(n)}/dashboard?tab=academic`))};return e.createElement("div",{className:"max-w-3xl mx-auto px-4 py-6"},e.createElement("article",{className:"bg-white rounded-2xl shadow border border-slate-200 overflow-hidden"},e.createElement("header",{className:"px-5 py-4 border-b border-slate-200"},e.createElement("div",{className:"flex items-center justify-between text-sm text-slate-500"},e.createElement("div",{className:"inline-flex items-center gap-2"},e.createElement("span",null,c?"💬":Q(A)),e.createElement("span",{className:"font-medium"},c?"General question":"Seeking")),e.createElement("div",{className:"flex items-center gap-3"},e.createElement("time",{dateTime:E},new Date(E).toLocaleString()),g&&e.createElement("button",{onClick:_,className:"ml-2 rounded-xl bg-red-500 px-3 py-1.5 text-xs font-semibold text-white hover:bg-red-600"},"Delete"))),e.createElement("h1",{className:"mt-2 text-2xl font-semibold text-slate-900"},S),e.createElement("div",{className:"mt-3 flex items-center justify-between"},e.createElement(z,{username:s.authorNickname||s.nickname||"anonymous",tier:s.authorTier,className:"text-sm"}),e.createElement(G,{targetType:"academic",targetId:t,initialCounts:{up:k,down:I},initialVote:L??null,disabled:!c||!!g,className:"scale-90"})),!c&&e.createElement("div",{className:"mt-3 flex flex-wrap items-center gap-2"},P.map(a=>e.createElement("span",{key:a,className:"inline-flex items-center rounded-full border border-slate-300 bg-slate-50 px-3 py-1 text-xs text-slate-700"},a)),b&&e.createElement("span",{className:"inline-flex items-center rounded-full border border-slate-300 bg-slate-50 px-3 py-1 text-xs text-slate-700"},"Professor: ",b))),e.createElement("div",{className:"px-5 py-5 whitespace-pre-wrap text-[15px] leading-7 text-slate-800"},C),e.createElement("div",{className:"px-5 py-5 border-t border-slate-200 bg-white"},c?e.createElement(y,{postId:t}):e.createElement(y,{postId:t,disabled:!0}))))}export{X as default};
