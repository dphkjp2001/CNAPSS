<<<<<<<< HEAD:frontend/dist/assets/FreeBoardDetail-c996c721.js
import{e as z,u as H,a as O,c as T,b as W,d as q,r as n,R as t,L as G}from"./index-39757e52.js";import{V as J,C as K}from"./CommentSection-a9daa3ed.js";import{d as b,r as Q}from"./relativeTime-1889a160.js";import{u as X,a as Y,b as Z,d as ee}from"./posts-ff58ac93.js";import{a as te}from"./http-a6fe908c.js";import"./useLoginGate-6a37cb65.js";b.extend(Q);b.locale("en");function ie(){const{id:d}=z(),U=H(),c=O(),{user:o,token:p}=T(),{school:l,schoolTheme:i}=W(),w=q(),[a,h]=n.useState(null),[E,v]=n.useState(""),[m,x]=n.useState(!1),[C,u]=n.useState(""),[N,f]=n.useState(""),[S,k]=n.useState(!1),P=!!(o!=null&&o.email||p&&String(p).length>0),[V,I]=n.useState(0),[B,L]=n.useState(0),[F,R]=n.useState(null),j=async()=>{v("");try{const e=await Y({school:l,id:d});h(e),u((e==null?void 0:e.title)||""),f((e==null?void 0:e.content)||""),I((e==null?void 0:e.upCount)||0),L((e==null?void 0:e.downCount)||0)}catch(e){if((e==null?void 0:e.status)!==404){v((e==null?void 0:e.message)||"Failed to load the post.");return}}if(P)try{const e=await Z({school:l,id:d});h(e),u((e==null?void 0:e.title)||""),f((e==null?void 0:e.content)||""),I((e==null?void 0:e.upCount)||0),L((e==null?void 0:e.downCount)||0),R((e==null?void 0:e.myVote)??null)}catch{}};n.useEffect(()=>{!l||!d||j()},[d,l,P]),n.useEffect(()=>{const r=new URLSearchParams(c.search).get("nid");async function s(){if(!(!r||!(o!=null&&o.email)||!l))try{const g="https://api.cnapss.com/api".replace(/\/+$/,"");await te(`${g}/${l}/notification/mark-read`,{method:"POST",headers:{"Content-Type":"application/json"},body:{commentId:r,email:o.email}})}catch{}}s()},[c.search,o==null?void 0:o.email,l]);const A=n.useMemo(()=>{const e=c.hash||"",r=e.startsWith("#comment-")?e.slice(9):null,s=new URLSearchParams(c.search).get("nid");return r||s||null},[c.hash,c.search]),y=n.useMemo(()=>{var _,D;const e=a,r=o;if(!e||!r)return!1;const s=[r.id,r._id].filter(Boolean).map(String);return[e.userId,e.authorId,(_=e.author)==null?void 0:_._id,(D=e.author)==null?void 0:D.id].filter(Boolean).map(String).some($=>s.includes($))},[o,a]),M=async()=>{if(window.confirm("Delete this post?"))try{await ee({school:l,id:a._id}),alert("Post deleted."),U(w("/dashboard?tab=free"))}catch(e){alert("Delete failed: "+((e==null?void 0:e.message)||"Unknown error"))}};return E?t.createElement("div",{className:"flex min-h-screen items-center justify-center text-sm text-red-700",style:{backgroundColor:(i==null?void 0:i.bg)||"#f6f3ff"}},E):a?t.createElement("div",{className:"min-h-screen px-4 py-6 sm:px-6",style:{backgroundColor:(i==null?void 0:i.bg)||"#f6f3ff"}},t.createElement("div",{className:"mx-auto max-w-3xl"},t.createElement("div",{className:"overflow-hidden rounded-2xl border border-gray-200 bg-white shadow-sm"},t.createElement("div",{className:"border-b border-gray-100 p-5 sm:p-6"},t.createElement("div",{className:"flex items-start gap-4"},t.createElement("div",{className:"flex-1"},m?t.createElement("input",{value:C,onChange:e=>u(e.target.value),placeholder:"Title",className:"w-full rounded-xl border border-gray-300 px-3 py-2 text-lg font-semibold text-gray-900 focus:border-gray-900 focus:ring-2 focus:ring-gray-900/10"}):t.createElement("h1",{className:"text-2xl font-bold text-gray-900"},a.title),t.createElement("p",{className:"mt-1 text-sm text-gray-500"},"Posted by ",t.createElement("span",{className:"font-medium"},"anonymous")," • ",b(a.createdAt).fromNow())),t.createElement(J,{school:l,postId:a._id||d,initialCounts:{up:V,down:B},initialVote:F,disabled:!!y,className:"shrink-0"}))),t.createElement("div",{className:"p-5 sm:p-6"},m?t.createElement("textarea",{value:N,onChange:e=>f(e.target.value),placeholder:"Content",className:"h-56 w-full resize-y rounded-xl border border-gray-300 px-3 py-2 text-sm text-gray-800 focus:border-gray-900 focus:ring-2 focus:ring-gray-900/10"}):t.createElement("div",{className:"prose prose-sm max-w-none text-gray-800"},t.createElement("p",{className:"whitespace-pre-wrap leading-relaxed"},a.content)),t.createElement("div",{className:"mt-6 flex flex-wrap items-center gap-3"},y&&!m&&t.createElement(t.Fragment,null,t.createElement("button",{onClick:()=>x(!0),className:"rounded-xl px-4 py-2 text-sm font-semibold text-white shadow",style:{backgroundColor:"#6b46c1"}},"Edit"),t.createElement("button",{onClick:M,className:"rounded-xl bg-red-500 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-red-600"},"Delete")),y&&m&&t.createElement(t.Fragment,null,t.createElement("button",{onClick:async()=>{const e=C.trim(),r=N.trim();if(!(!e||!r)){k(!0);try{const s=await X({school:l,id:a._id,title:e,content:r}),g=(s==null?void 0:s.post)||s;h(g),x(!1)}catch(s){alert("Update failed: "+((s==null?void 0:s.message)||"Unknown error"))}finally{k(!1)}}},disabled:S,className:"rounded-xl bg-gray-900 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-black disabled:opacity-60"},S?"Saving…":"Save"),t.createElement("button",{onClick:()=>{u((a==null?void 0:a.title)||""),f((a==null?void 0:a.content)||""),x(!1)},className:"rounded-xl border border-gray-300 bg-white px-4 py-2 text-sm font-semibold text-gray-800 shadow-sm hover:bg-gray-50"},"Cancel")),t.createElement(G,{to:w("/dashboard?tab=free"),className:"ml-auto text-sm font-medium text-blue-600 underline underline-offset-2"},"← Back to List"))),(a==null?void 0:a._id)&&t.createElement("div",{className:"mt-0 rounded-2xl border-t border-gray-200 bg-white p-5 shadow-sm sm:p-6"},t.createElement(K,{postId:a._id,authorEmail:a.email,highlightId:A,anonymousMode:!0}))))):t.createElement("div",{className:"flex min-h-screen items-center justify-center text-sm text-gray-600",style:{backgroundColor:(i==null?void 0:i.bg)||"#f6f3ff"}},"Loading…")}export{ie as default};
========
import{e as z,u as H,a as O,c as T,b as W,d as q,r as n,R as t,L as G}from"./index-f4753343.js";import{V as J,C as K}from"./CommentSection-2dc539cd.js";import{d as b,r as Q}from"./relativeTime-15aeeae5.js";import{u as X,a as Y,b as Z,d as ee}from"./posts-ff58ac93.js";import{a as te}from"./http-a6fe908c.js";import"./useLoginGate-848e0aba.js";b.extend(Q);b.locale("en");function ie(){const{id:d}=z(),U=H(),c=O(),{user:o,token:p}=T(),{school:l,schoolTheme:i}=W(),w=q(),[a,h]=n.useState(null),[E,v]=n.useState(""),[m,x]=n.useState(!1),[C,u]=n.useState(""),[N,f]=n.useState(""),[S,k]=n.useState(!1),P=!!(o!=null&&o.email||p&&String(p).length>0),[V,I]=n.useState(0),[B,L]=n.useState(0),[F,R]=n.useState(null),j=async()=>{v("");try{const e=await Y({school:l,id:d});h(e),u((e==null?void 0:e.title)||""),f((e==null?void 0:e.content)||""),I((e==null?void 0:e.upCount)||0),L((e==null?void 0:e.downCount)||0)}catch(e){if((e==null?void 0:e.status)!==404){v((e==null?void 0:e.message)||"Failed to load the post.");return}}if(P)try{const e=await Z({school:l,id:d});h(e),u((e==null?void 0:e.title)||""),f((e==null?void 0:e.content)||""),I((e==null?void 0:e.upCount)||0),L((e==null?void 0:e.downCount)||0),R((e==null?void 0:e.myVote)??null)}catch{}};n.useEffect(()=>{!l||!d||j()},[d,l,P]),n.useEffect(()=>{const r=new URLSearchParams(c.search).get("nid");async function s(){if(!(!r||!(o!=null&&o.email)||!l))try{const g="https://api.cnapss.com/api".replace(/\/+$/,"");await te(`${g}/${l}/notification/mark-read`,{method:"POST",headers:{"Content-Type":"application/json"},body:{commentId:r,email:o.email}})}catch{}}s()},[c.search,o==null?void 0:o.email,l]);const A=n.useMemo(()=>{const e=c.hash||"",r=e.startsWith("#comment-")?e.slice(9):null,s=new URLSearchParams(c.search).get("nid");return r||s||null},[c.hash,c.search]),y=n.useMemo(()=>{var _,D;const e=a,r=o;if(!e||!r)return!1;const s=[r.id,r._id].filter(Boolean).map(String);return[e.userId,e.authorId,(_=e.author)==null?void 0:_._id,(D=e.author)==null?void 0:D.id].filter(Boolean).map(String).some($=>s.includes($))},[o,a]),M=async()=>{if(window.confirm("Delete this post?"))try{await ee({school:l,id:a._id}),alert("Post deleted."),U(w("/dashboard?tab=free"))}catch(e){alert("Delete failed: "+((e==null?void 0:e.message)||"Unknown error"))}};return E?t.createElement("div",{className:"flex min-h-screen items-center justify-center text-sm text-red-700",style:{backgroundColor:(i==null?void 0:i.bg)||"#f6f3ff"}},E):a?t.createElement("div",{className:"min-h-screen px-4 py-6 sm:px-6",style:{backgroundColor:(i==null?void 0:i.bg)||"#f6f3ff"}},t.createElement("div",{className:"mx-auto max-w-3xl"},t.createElement("div",{className:"overflow-hidden rounded-2xl border border-gray-200 bg-white shadow-sm"},t.createElement("div",{className:"border-b border-gray-100 p-5 sm:p-6"},t.createElement("div",{className:"flex items-start gap-4"},t.createElement("div",{className:"flex-1"},m?t.createElement("input",{value:C,onChange:e=>u(e.target.value),placeholder:"Title",className:"w-full rounded-xl border border-gray-300 px-3 py-2 text-lg font-semibold text-gray-900 focus:border-gray-900 focus:ring-2 focus:ring-gray-900/10"}):t.createElement("h1",{className:"text-2xl font-bold text-gray-900"},a.title),t.createElement("p",{className:"mt-1 text-sm text-gray-500"},"Posted by ",t.createElement("span",{className:"font-medium"},"anonymous")," • ",b(a.createdAt).fromNow())),t.createElement(J,{school:l,postId:a._id||d,initialCounts:{up:V,down:B},initialVote:F,disabled:!!y,className:"shrink-0"}))),t.createElement("div",{className:"p-5 sm:p-6"},m?t.createElement("textarea",{value:N,onChange:e=>f(e.target.value),placeholder:"Content",className:"h-56 w-full resize-y rounded-xl border border-gray-300 px-3 py-2 text-sm text-gray-800 focus:border-gray-900 focus:ring-2 focus:ring-gray-900/10"}):t.createElement("div",{className:"prose prose-sm max-w-none text-gray-800"},t.createElement("p",{className:"whitespace-pre-wrap leading-relaxed"},a.content)),t.createElement("div",{className:"mt-6 flex flex-wrap items-center gap-3"},y&&!m&&t.createElement(t.Fragment,null,t.createElement("button",{onClick:()=>x(!0),className:"rounded-xl px-4 py-2 text-sm font-semibold text-white shadow",style:{backgroundColor:"#6b46c1"}},"Edit"),t.createElement("button",{onClick:M,className:"rounded-xl bg-red-500 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-red-600"},"Delete")),y&&m&&t.createElement(t.Fragment,null,t.createElement("button",{onClick:async()=>{const e=C.trim(),r=N.trim();if(!(!e||!r)){k(!0);try{const s=await X({school:l,id:a._id,title:e,content:r}),g=(s==null?void 0:s.post)||s;h(g),x(!1)}catch(s){alert("Update failed: "+((s==null?void 0:s.message)||"Unknown error"))}finally{k(!1)}}},disabled:S,className:"rounded-xl bg-gray-900 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-black disabled:opacity-60"},S?"Saving…":"Save"),t.createElement("button",{onClick:()=>{u((a==null?void 0:a.title)||""),f((a==null?void 0:a.content)||""),x(!1)},className:"rounded-xl border border-gray-300 bg-white px-4 py-2 text-sm font-semibold text-gray-800 shadow-sm hover:bg-gray-50"},"Cancel")),t.createElement(G,{to:w("/dashboard?tab=free"),className:"ml-auto text-sm font-medium text-blue-600 underline underline-offset-2"},"← Back to List"))),(a==null?void 0:a._id)&&t.createElement("div",{className:"mt-0 rounded-2xl border-t border-gray-200 bg-white p-5 shadow-sm sm:p-6"},t.createElement(K,{postId:a._id,authorEmail:a.email,highlightId:A,anonymousMode:!0}))))):t.createElement("div",{className:"flex min-h-screen items-center justify-center text-sm text-gray-600",style:{backgroundColor:(i==null?void 0:i.bg)||"#f6f3ff"}},"Loading…")}export{ie as default};
>>>>>>>> bf619fd0e454c17359bd3db07c55e7f359b8b5ef:frontend/dist/assets/FreeBoardDetail-d14b0b13.js
