import{e as $,u as C,a as q,b as A,r as l,R as e,L as u}from"./index-1baf5031.js";import{a as i}from"./axios-b5ee139b.js";const D=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0});function F(){const{id:o}=$(),x=C(),{user:r}=q(),{schoolTheme:c}=A(),m="https://api.cnapss.com/api",[a,y]=l.useState(null),[n,d]=l.useState(null),[f,b]=l.useState(!1),[g,h]=l.useState(""),[N,E]=l.useState("idle"),[p,v]=l.useState("");l.useEffect(()=>{(async()=>{try{const s=(await i.get(`${m}/market/${o}`)).data;y(s),Array.isArray(s.images)&&s.images.length>0?d(s.images[0]):d(null)}catch(t){console.error("load item failed",t),v("Failed to load the listing.")}})(),r&&(async()=>{try{(await i.get(`${m}/market/request/${o}/${r.email}`)).data.alreadySent&&E("already")}catch(t){console.error("request-check failed",t)}})()},[o,m,r]);const w=l.useMemo(()=>!!(r!=null&&r.email&&(a!=null&&a.seller)&&r.email===a.seller),[r,a]),k=async()=>{if(window.confirm("Delete this listing?"))try{await i.delete(`${m}/market/${o}`),x("/market")}catch(t){console.error(t),alert("Failed to delete.")}},S=async()=>{if(g.trim())try{const t=await i.post(`${m}/market/request`,{itemId:o,buyer:r.email,message:g}),{conversationId:s}=t.data;s?x(`/messages?conversation=${s}`):alert("Unexpected server response.")}catch(t){console.error("send request failed",t),alert("Failed to send the message.")}};return a?e.createElement("div",{className:"min-h-screen px-4 py-6 sm:px-6",style:{backgroundColor:c.bg}},e.createElement("div",{className:"mx-auto max-w-4xl"},e.createElement("div",{className:"rounded-2xl border border-gray-200 bg-white shadow-sm overflow-hidden"},e.createElement("div",{className:"border-b border-gray-100 p-5 sm:p-6"},e.createElement("h1",{className:"text-2xl font-bold text-gray-900"},a.title),e.createElement("div",{className:"mt-1 flex flex-wrap items-center gap-3 text-sm"},e.createElement("span",{className:"font-semibold text-gray-900"},D.format(Number(a.price)||0)),a.sellerNickname&&e.createElement("span",{className:"text-gray-500"},"Seller: ",a.sellerNickname))),e.createElement("div",{className:"grid grid-cols-1 gap-6 p-5 sm:grid-cols-5 sm:p-6"},e.createElement("div",{className:"sm:col-span-3"},e.createElement("button",{type:"button",disabled:!n,onClick:()=>n&&b(!0),className:"block w-full overflow-hidden rounded-xl border border-gray-200 bg-gray-50","aria-label":"open image in lightbox"},n?e.createElement("img",{src:n,alt:"main",className:"aspect-[4/3] w-full object-cover"}):e.createElement("div",{className:"aspect-[4/3] w-full"})),Array.isArray(a.images)&&a.images.length>1&&e.createElement("div",{className:"mt-3 grid grid-cols-4 gap-2"},a.images.map((t,s)=>e.createElement("button",{key:s,type:"button",onClick:()=>d(t),className:`overflow-hidden rounded-lg border ${n===t?"border-gray-900":"border-gray-200"} bg-white focus:outline-none focus:ring-2 focus:ring-gray-900/15`,"aria-label":`thumbnail ${s+1}`},e.createElement("img",{src:t,alt:`thumbnail ${s+1}`,className:"aspect-square w-full object-cover"}))))),e.createElement("div",{className:"sm:col-span-2 flex flex-col"},e.createElement("div",{className:"prose prose-sm max-w-none text-gray-800"},e.createElement("p",{className:"whitespace-pre-wrap leading-relaxed"},a.description)),w?e.createElement("div",{className:"mt-6 flex gap-2"},e.createElement(u,{to:`/market/${o}/edit`,className:"inline-flex items-center justify-center rounded-xl px-4 py-2 text-sm font-semibold text-white shadow",style:{backgroundColor:c.primary}},"Edit"),e.createElement("button",{onClick:k,className:"rounded-xl bg-red-500 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-red-600"},"Delete")):r?e.createElement("div",{className:"mt-6"},N==="already"?e.createElement("div",{className:"rounded-xl border border-gray-200 bg-gray-50 p-3 text-sm text-gray-700"},"Youâ€™ve already sent a request.",e.createElement(u,{to:"/messages",className:"ml-2 font-medium text-blue-600 underline"},"Go to Chat ðŸ’¬")):e.createElement("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center"},e.createElement("input",{type:"text",value:g,onChange:t=>h(t.target.value),placeholder:"Ask about pickup, availability, condition, etc.",className:"flex-1 rounded-xl border border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 placeholder:text-gray-400 shadow-sm focus:border-gray-900 focus:outline-none focus:ring-2 focus:ring-gray-900/10"}),e.createElement("button",{onClick:S,className:"rounded-xl px-4 py-2 text-sm font-semibold text-white shadow",style:{backgroundColor:c.primary}},"Send"))):e.createElement("div",{className:"mt-6 rounded-xl border border-gray-200 bg-gray-50 p-3 text-sm text-gray-700"},"Please ",e.createElement(u,{className:"text-blue-600 underline",to:"/login"},"log in")," to contact the seller."))),p&&e.createElement("div",{className:"border-t border-gray-100 px-5 py-4 text-sm text-red-700 sm:px-6"},p))),f&&n&&e.createElement("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70",onClick:()=>b(!1)},e.createElement("img",{src:n,alt:"zoomed",className:"max-h-[90vh] max-w-[90vw] rounded shadow-lg"}))):e.createElement("div",{className:"min-h-screen flex items-center justify-center text-sm text-gray-600",style:{backgroundColor:(c==null?void 0:c.bg)||"#f6f3ff"}},"Loadingâ€¦")}export{F as default};
