import{k as A,u as I,c as P,r as g,R as e,f as D,b as R}from"./index-1b4f2925.js";import{a as $,b as U,d as j}from"./academicPosts-0c95531b.js";import{V as q,C as F}from"./CommentSection-9c87f34e.js";import{d as C,r as L}from"./relativeTime-70ba4cdc.js";import"./useLoginGate-70abf879.js";async function M({school:n,targetId:a,message:i}){const u="https://api.cnapss.com/api".replace(/\/$/,"");return A(`${u}/${n}/request`,{method:"POST",headers:{"Content-Type":"application/json"},body:{targetId:a,initialMessage:i}})}function S({label:n,value:a,selected:i,onChange:u}){return e.createElement("label",{className:"flex items-center gap-3 cursor-pointer select-none"},e.createElement("input",{type:"radio",className:"h-4 w-4 accent-red-500",checked:i===a,onChange:()=>u(a)}),e.createElement("span",{className:"text-sm text-slate-700"},n))}function T({school:n,postId:a,kind:i}){const u=I(),{user:m}=P(),r=i==="course_materials",l=i==="coffee_chat",d=i==="study_mate"||i==="study_group",t=`Hi,
I would love to study with you!
Let me know what days you are thinking of :)`,[c,f]=g.useState("lunch"),[h,v]=g.useState(""),x=g.useMemo(()=>d?t:r?`Hi,
I have the class materials you're looking for. You can get it for ${c==="lunch"?"lunch/dinner":c==="small"?"a small cost":"anything is fine"}.`:l?`Hi,
I can have a coffee chat with you for ${c==="lunch"?"lunch/dinner":c==="small"?"a small cost":"anything is fine"}.`:h||"",[r,l,d,h,c]),[b,y]=g.useState(!1),N=!!a&&!!n&&x.trim().length>0,E=async()=>{if(!m){alert("Please log in to send a message.");return}try{y(!0);const s=await M({school:n,targetId:a,message:d?t:x}),w=s==null?void 0:s.conversationId;u(w?`/${encodeURIComponent(n)}/messages?c=${encodeURIComponent(w)}`:`/${encodeURIComponent(n)}/messages`)}catch(s){alert((s==null?void 0:s.message)||"Failed to send.")}finally{y(!1)}};return e.createElement("aside",{className:"bg-white rounded-2xl shadow border border-slate-200 p-4 h-max"},e.createElement("div",{className:"text-sm text-slate-900 font-semibold mb-1"},"Hi,"),e.createElement("div",{className:"text-sm text-slate-700 mb-3"},r&&"I have the class materials you're looking for. You can get it for",l&&"I can have a coffee chat with you for",d&&"Send a request message:"),(r||l)&&e.createElement("div",{className:"space-y-3 mb-4"},e.createElement(S,{label:"lunch/dinner",value:"lunch",selected:c,onChange:f}),e.createElement(S,{label:"small cost",value:"small",selected:c,onChange:f}),e.createElement(S,{label:"Anything is fine",value:"free",selected:c,onChange:f})),!d&&!(r||l)&&e.createElement("textarea",{value:h,onChange:s=>v(s.target.value),rows:5,className:"w-full rounded-xl border border-slate-300 px-3 py-2 text-sm mb-4",placeholder:"Write a short message…"}),e.createElement("div",{className:"mb-3 rounded-lg bg-slate-50 border border-slate-200 p-3 text-xs whitespace-pre-wrap text-slate-700"},x),e.createElement("button",{onClick:E,disabled:b||!N,className:"w-full rounded-xl bg-red-500 text-white font-semibold py-2 shadow hover:bg-red-600 disabled:opacity-60"},d?b?"Sending…":"Send a request":b?"Sending…":"Send an offer"))}C.extend(L);C.locale("en");function V(n=""){const a=String(n||"").toLowerCase().replace(/[\s-]+/g,"_");return a.includes("course_material")?"📝":a.includes("study")?"👥":a.includes("coffee")?"☕️":"📌"}function W(){var E,s,w,k;console.log("🔵 AcademicList.jsx mounted");const{school:n,id:a}=D(),i=I(),{school:u}=R(),m=n||u||"nyu",{user:r}=P(),[l,d]=g.useState({loading:!0,error:"",post:null});if(g.useEffect(()=>{let o=!0;return(async()=>{try{const p=await $({school:m,id:a});if(!o)return;d({loading:!1,error:"",post:p})}catch(p){if(!o)return;d({loading:!1,error:(p==null?void 0:p.message)||"Failed to load post.",post:null})}})(),()=>{o=!1}},[m,a]),g.useEffect(()=>{if(!r)return;let o=!0;return(async()=>{try{const p=await U({school:m,id:a});if(!o)return;d(_=>({..._,post:p||_.post}))}catch{}})(),()=>{o=!1}},[r,m,a]),l.loading)return e.createElement("div",{className:"max-w-5xl mx-auto px-4 py-6 text-sm text-slate-600"},"Loading…");if(l.error)return e.createElement("div",{className:"max-w-5xl mx-auto px-4 py-6 text-sm text-red-600"},l.error);if(!l.post)return e.createElement("div",{className:"max-w-5xl mx-auto px-4 py-6 text-sm text-slate-600"},"Post not found.");const t=l.post,c=(t.mode||t.postType||t.type||(t.lookingFor?"looking_for":"general")).toString().toLowerCase(),f=c==="seeking"||c==="looking_for",h=!f,v=Number(t.upCount||((E=t.counts)==null?void 0:E.up)||0),x=Number(t.downCount||((s=t.counts)==null?void 0:s.down)||0),b=t.myVote??null,y=r&&[(w=t.author)==null?void 0:w._id,(k=t.author)==null?void 0:k.id,t.userId,t.authorId].filter(Boolean).map(String).some(o=>String(o)===String(r._id||r.id)),N=async()=>{if(window.confirm("Delete this post?"))try{await j({school:m,id:a}),alert("Post deleted."),i(`/${encodeURIComponent(m)}/dashboard?tab=academic`)}catch(o){alert("Delete failed: "+((o==null?void 0:o.message)||"Unknown error"))}};return e.createElement("div",{className:"max-w-5xl mx-auto px-4 py-6"},e.createElement("div",{className:"grid gap-6 md:grid-cols-[1fr,360px]"},e.createElement("article",{className:"bg-white rounded-2xl shadow border border-slate-200 overflow-hidden"},e.createElement("header",{className:"px-5 py-4 border-b border-slate-200"},e.createElement("div",{className:"flex items-start justify-between gap-4"},e.createElement("div",{className:"flex-1"},e.createElement("div",{className:"flex items-center justify-between text-sm text-slate-500"},e.createElement("div",{className:"inline-flex items-center gap-2"},e.createElement("span",null,f?V(t.kind):"💬"),e.createElement("span",{className:"font-medium"},f?"Seeking":"General question"),t.kind&&e.createElement("span",{className:"text-slate-400"},"• ",String(t.kind).replace(/_/g," "))),e.createElement("div",{className:"flex items-center gap-3"},e.createElement("time",{dateTime:t.createdAt},C(t.createdAt).fromNow()),y&&e.createElement("button",{onClick:N,className:"ml-2 rounded-xl bg-red-500 px-3 py-1.5 text-xs font-semibold text-white hover:bg-red-600",title:"Delete this post"},"Delete"))),e.createElement("h1",{className:"mt-2 text-2xl font-semibold text-slate-900"},t.title)),h&&e.createElement(q,{school:m,postId:t._id||a,initialCounts:{up:v,down:x},initialVote:b,disabled:!!y,className:"shrink-0"}))),e.createElement("div",{className:"px-5 py-5 whitespace-pre-wrap text-[15px] leading-7 text-slate-800"},t.content),h&&e.createElement("div",{className:"px-5 py-5 border-t border-slate-200 bg-white"},e.createElement(F,{postId:t._id||a}))),f?e.createElement(T,{school:m,postId:t._id||a,kind:String(t.kind||"").toLowerCase().replace(/[\s-]+/g,"_")}):null))}export{W as default};
