import{r as w,R as e,a as F,c as B,u as G,m as T,L as R}from"./index-9bd58617.js";import{l as D}from"./market-4bdeb851.js";function I(t,d){const m=[];for(let c=t;c<=d;c++)m.push(c);return m}function z({page:t=1,total:d=0,limit:m=20,onPageChange:c,siblingCount:g=1,boundaryCount:a=1,className:E="",scrollToTopOnChange:N=!0,showStatus:y=!0}){const s=Math.max(1,Math.ceil((Number(d)||0)/Math.max(1,Number(m)))),u=w.useMemo(()=>{const l=I(1,Math.min(a,s)),S=I(Math.max(s-a+1,a+1),s),U=Math.max(Math.min(t-g,s-a-g*2-1),a+2),M=Math.min(Math.max(t+g,a+g*2+2),Math.max(s-a-1,a+1)),r=s<=a*2+g*2+3?I(a+1,Math.max(a,s-a)):I(U,M),n=r[0]>a+2,P=r[r.length-1]<s-a-1,o=[];return l.forEach(f=>o.push({type:"page",page:f})),n&&o.push({type:"ellipsis",key:"left"}),r.forEach(f=>o.push({type:"page",page:f})),P&&o.push({type:"ellipsis",key:"right"}),S.forEach(f=>{l.includes(f)||o.push({type:"page",page:f})}),o},[t,s,g,a]),v="min-w-9 h-9 px-3 rounded-lg border border-gray-300 bg-white text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-900/10",b="min-w-9 h-9 px-3 rounded-lg border border-gray-900 bg-gray-900 text-white text-sm font-semibold shadow-sm hover:bg-black focus:outline-none focus:ring-2 focus:ring-gray-900/10",p="min-w-9 h-9 px-3 rounded-lg border border-gray-300 bg-white text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-900/10",i="opacity-50 cursor-not-allowed hover:bg-white focus:ring-0 focus:outline-none",k=l=>{if(c&&l!==t&&(c(l),N))try{window.scrollTo({top:0,behavior:"smooth"})}catch{}};return e.createElement("nav",{className:`mt-6 flex flex-wrap items-center justify-center gap-2 ${E}`,"aria-label":"Pagination"},e.createElement("button",{type:"button",className:`${p} ${t<=1?i:""}`,onClick:()=>k(Math.max(1,t-1)),"aria-label":"Previous page",disabled:t<=1},"â€¹"),u.map((l,S)=>l.type==="ellipsis"?e.createElement("span",{key:`ellipsis-${l.key}-${S}`,className:"min-w-9 h-9 px-2 inline-flex items-center justify-center text-sm text-gray-400 select-none","aria-hidden":"true"},"â€¦"):e.createElement("button",{key:`page-${l.page}`,type:"button",className:l.page===t?b:v,"aria-current":l.page===t?"page":void 0,"aria-label":`Go to page ${l.page}`,onClick:()=>k(l.page)},l.page)),e.createElement("button",{type:"button",className:`${p} ${t>=s?i:""}`,onClick:()=>k(Math.min(s,t+1)),"aria-label":"Next page",disabled:t>=s},"â€º"),y&&e.createElement("span",{className:"ml-2 inline-flex h-9 items-center text-sm text-gray-500"},"Page ",e.createElement("strong",{className:"mx-1 text-gray-900"},t)," of"," ",e.createElement("strong",{className:"ml-1 text-gray-900"},s)))}const _=20,H=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0});function Q(){return e.createElement("div",{className:"animate-pulse rounded-2xl border border-gray-200/60 bg-white shadow-sm"},e.createElement("div",{className:"aspect-[4/3] w-full rounded-t-2xl bg-gray-100"}),e.createElement("div",{className:"p-4 space-y-3"},e.createElement("div",{className:"h-4 w-3/5 rounded bg-gray-100"}),e.createElement("div",{className:"h-4 w-2/5 rounded bg-gray-100"}),e.createElement("div",{className:"h-3 w-1/2 rounded bg-gray-100"})))}function Z({schoolPath:t}){return e.createElement("div",{className:"rounded-2xl border border-dashed border-gray-300 bg-white/60 p-10 text-center"},e.createElement("div",{className:"mx-auto mb-3 flex h-14 w-14 items-center justify-center rounded-full bg-gray-100 text-2xl"},"ðŸ›’"),e.createElement("h3",{className:"text-lg font-semibold text-gray-800"},"No listings yet"),e.createElement("p",{className:"mt-1 text-sm text-gray-500"},"Be the first to create a listing. Items with photos and prices get more attention!"),e.createElement(R,{to:t("/market/write"),className:"mt-6 inline-flex items-center rounded-xl bg-gray-900 px-4 py-2 text-sm font-medium text-white shadow hover:bg-black/90 focus:outline-none focus:ring-2 focus:ring-gray-900/30"},"+ Create Listing"))}function C({item:t,schoolPath:d}){var c;const m=(c=t==null?void 0:t.images)==null?void 0:c[0];return e.createElement(R,{to:d(`/market/${t._id}`),className:"group block overflow-hidden rounded-2xl border border-gray-200/60 bg-white shadow-sm transition hover:shadow-md focus:outline-none focus:ring-2 focus:ring-gray-900/20","aria-label":`${t.title} detail`},e.createElement("div",{className:"relative aspect-[4/3] w-full overflow-hidden bg-gray-50"},m?e.createElement("img",{src:m,alt:t.title,className:"h-full w-full object-cover transition duration-300 group-hover:scale-[1.02]",loading:"lazy"}):e.createElement("div",{className:"flex h-full w-full items-center justify-center text-4xl"},"ðŸ–¼ï¸")),e.createElement("div",{className:"p-4"},e.createElement("h3",{className:"line-clamp-1 text-base font-semibold text-gray-900"},t.title),e.createElement("p",{className:"mt-1 text-sm font-medium text-gray-800"},H.format(Number(t.price)||0)),e.createElement("p",{className:"mt-1 line-clamp-1 text-xs text-gray-500"},t.sellerNickname||"Unknown"),t.location&&e.createElement("div",{className:"mt-2 inline-flex items-center rounded-md bg-gray-100 px-2 py-0.5 text-[11px] text-gray-600"},t.location)))}const O=()=>{const[t,d]=w.useState([]),[m,c]=w.useState(!0),[g,a]=w.useState(null),{school:E,schoolTheme:N}=F(),y=B(),{token:s}=G(),[u,v]=T(),b=Math.max(1,parseInt(u.get("page")||"1",10)),p=u.get("q")||"",i=u.get("sort")||"new",k=r=>{const n=new URLSearchParams(u.toString());n.set("page",String(r)),v(n,{replace:!0})},l=r=>{const n=new URLSearchParams(u.toString());r?n.set("q",r):n.delete("q"),n.set("page","1"),v(n,{replace:!0})},S=r=>{const n=new URLSearchParams(u.toString());n.set("sort",r),n.set("page","1"),v(n,{replace:!0})},[U,M]=w.useState(0);return w.useEffect(()=>{let r=!0;return E&&s&&(async()=>{try{c(!0),a(null);const o=await D({school:E,token:s,page:b,limit:_,q:p,sort:i==="new"?"latest":i==="price-asc"?"price_asc":i==="price-desc"?"price_desc":"latest"});if(!r)return;if(o&&typeof o=="object"&&Array.isArray(o.items)){d(o.items),M(Number(o.total||0));return}const f=Array.isArray(o)?o:[],L=(p||"").trim().toLowerCase();let $=f.filter(h=>{var x,j,A;return L?((x=h.title)==null?void 0:x.toLowerCase().includes(L))||((j=h.description)==null?void 0:j.toLowerCase().includes(L))||((A=h.seller)==null?void 0:A.toLowerCase().includes(L)):!0});$=$.sort((h,x)=>{if(i==="price-asc")return(h.price??0)-(x.price??0);if(i==="price-desc")return(x.price??0)-(h.price??0);const j=h.createdAt??h._id??"",A=x.createdAt??x._id??"";return String(A).localeCompare(String(j))}),M($.length);const q=(b-1)*_;d($.slice(q,q+_))}catch(P){console.error("âŒ Failed to load listings",P),a("Failed to load listings.")}finally{r&&c(!1)}})(),()=>{r=!1}},[E,s,b,p,i]),e.createElement("div",{className:"min-h-screen px-4 py-6 sm:px-6",style:{backgroundColor:N.bg}},e.createElement("div",{className:"mx-auto max-w-6xl"},e.createElement("div",{className:"mb-5 flex flex-col justify-between gap-3 sm:flex-row sm:items-center"},e.createElement("h2",{className:"text-2xl font-bold tracking-tight",style:{color:N.text}},"Marketplace"),e.createElement("div",{className:"flex w-full flex-col gap-2 sm:w-auto sm:flex-row sm:items-center"},e.createElement("div",{className:"relative sm:w-72"},e.createElement("input",{type:"search",value:p,onChange:r=>l(r.target.value),placeholder:"Search: title, seller",className:"w-full rounded-xl border border-gray-300 bg-white px-3 py-2 text-sm text-gray-800 placeholder:text-gray-400 shadow-sm focus:border-gray-900 focus:outline-none focus:ring-2 focus:ring-gray-900/10","aria-label":"search items"})),e.createElement("select",{value:i,onChange:r=>S(r.target.value),className:"rounded-xl border border-gray-300 bg-white px-3 py-2 text-sm text-gray-800 shadow-sm focus:border-gray-900 focus:outline-none focus:ring-2 focus:ring-gray-900/10","aria-label":"sort items"},e.createElement("option",{value:"new"},"Newest"),e.createElement("option",{value:"price-asc"},"Lowest Price"),e.createElement("option",{value:"price-desc"},"Highest Price")),e.createElement(R,{to:y("/messages"),className:"inline-flex items-center justify-center rounded-xl border border-gray-300 bg-white px-3 py-2 text-sm font-medium text-gray-800 shadow-sm transition hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-900/10"},"ðŸ’¬ My Chats"),e.createElement(R,{to:y("/market/write"),className:"inline-flex items-center justify-center rounded-xl px-4 py-2 text-sm font-semibold text-white shadow transition focus:outline-none focus:ring-2 focus:ring-offset-0",style:{backgroundColor:N.primary}},"+ Create Listing"))),g&&e.createElement("div",{className:"mb-4 rounded-xl border border-red-200 bg-red-50 p-3 text-sm text-red-700"},g),m?e.createElement("div",{className:"grid grid-cols-2 gap-4 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5"},Array.from({length:10}).map((r,n)=>e.createElement(Q,{key:n}))):t.length===0?e.createElement(Z,{schoolPath:y}):e.createElement(e.Fragment,null,e.createElement("div",{className:"grid grid-cols-2 gap-4 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5"},t.map(r=>e.createElement(C,{key:r._id,item:r,schoolPath:y}))),e.createElement(z,{page:b,total:U,limit:_,onPageChange:k,siblingCount:1,boundaryCount:1,className:"mb-2",showStatus:!0}))))};export{O as default};
