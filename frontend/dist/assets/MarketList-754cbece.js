import{r as N,R as e,b as F,d as B,c as G,h as T,L as q}from"./index-68265940.js";import{l as z,g as D}from"./market-e619ef15.js";import"./http-a6fe908c.js";function _(t,d){const u=[];for(let c=t;c<=d;c++)u.push(c);return u}function H({page:t=1,total:d=0,limit:u=20,onPageChange:c,siblingCount:i=1,boundaryCount:a=1,className:w="",scrollToTopOnChange:v=!0,showStatus:E=!0}){const s=Math.max(1,Math.ceil((Number(d)||0)/Math.max(1,Number(u)))),f=N.useMemo(()=>{const l=_(1,Math.min(a,s)),M=_(Math.max(s-a+1,a+1),s),R=Math.max(Math.min(t-i,s-a-i*2-1),a+2),P=Math.min(Math.max(t+i,a+i*2+2),Math.max(s-a-1,a+1)),r=s<=a*2+i*2+3?_(a+1,Math.max(a,s-a)):_(R,P),n=r[0]>a+2,m=r[r.length-1]<s-a-1,o=[];return l.forEach(p=>o.push({type:"page",page:p})),n&&o.push({type:"ellipsis",key:"left"}),r.forEach(p=>o.push({type:"page",page:p})),m&&o.push({type:"ellipsis",key:"right"}),M.forEach(p=>{l.includes(p)||o.push({type:"page",page:p})}),o},[t,s,i,a]),k="min-w-9 h-9 px-3 rounded-lg border border-gray-300 bg-white text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-900/10",y="min-w-9 h-9 px-3 rounded-lg border border-gray-900 bg-gray-900 text-white text-sm font-semibold shadow-sm hover:bg-black focus:outline-none focus:ring-2 focus:ring-gray-900/10",h="min-w-9 h-9 px-3 rounded-lg border border-gray-300 bg-white text-sm font-medium text-gray-700 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-900/10",g="opacity-50 cursor-not-allowed hover:bg-white focus:ring-0 focus:outline-none",S=l=>{if(c&&l!==t&&(c(l),v))try{window.scrollTo({top:0,behavior:"smooth"})}catch{}};return e.createElement("nav",{className:`mt-6 flex flex-wrap items-center justify-center gap-2 ${w}`,"aria-label":"Pagination"},e.createElement("button",{type:"button",className:`${h} ${t<=1?g:""}`,onClick:()=>S(Math.max(1,t-1)),"aria-label":"Previous page",disabled:t<=1},"â€¹"),f.map((l,M)=>l.type==="ellipsis"?e.createElement("span",{key:`ellipsis-${l.key}-${M}`,className:"min-w-9 h-9 px-2 inline-flex items-center justify-center text-sm text-gray-400 select-none","aria-hidden":"true"},"â€¦"):e.createElement("button",{key:`page-${l.page}`,type:"button",className:l.page===t?y:k,"aria-current":l.page===t?"page":void 0,"aria-label":`Go to page ${l.page}`,onClick:()=>S(l.page)},l.page)),e.createElement("button",{type:"button",className:`${h} ${t>=s?g:""}`,onClick:()=>S(Math.min(s,t+1)),"aria-label":"Next page",disabled:t>=s},"â€º"),E&&e.createElement("span",{className:"ml-2 inline-flex h-9 items-center text-sm text-gray-500"},"Page ",e.createElement("strong",{className:"mx-1 text-gray-900"},t)," of"," ",e.createElement("strong",{className:"ml-1 text-gray-900"},s)))}const L=20,Q=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0});function Z(){return e.createElement("div",{className:"animate-pulse rounded-2xl border border-gray-200/60 bg-white shadow-sm"},e.createElement("div",{className:"aspect-[4/3] w-full rounded-t-2xl bg-gray-100"}),e.createElement("div",{className:"p-4 space-y-3"},e.createElement("div",{className:"h-4 w-3/5 rounded bg-gray-100"}),e.createElement("div",{className:"h-4 w-2/5 rounded bg-gray-100"}),e.createElement("div",{className:"h-3 w-1/2 rounded bg-gray-100"})))}function C({schoolPath:t}){return e.createElement("div",{className:"rounded-2xl border border-dashed border-gray-300 bg-white/60 p-10 text-center"},e.createElement("div",{className:"mx-auto mb-3 flex h-14 w-14 items-center justify-center rounded-full bg-gray-100 text-2xl"},"ðŸ›’"),e.createElement("h3",{className:"text-lg font-semibold text-gray-800"},"No listings yet"),e.createElement("p",{className:"mt-1 text-sm text-gray-500"},"Be the first to create a listing. Items with photos and prices get more attention!"),e.createElement(q,{to:t("/market/write"),className:"mt-6 inline-flex items-center rounded-xl bg-gray-900 px-4 py-2 text-sm font-medium text-white shadow hover:bg-black/90 focus:outline-none focus:ring-2 focus:ring-gray-900/30"},"+ Create Listing"))}function J({item:t,schoolPath:d}){var i;const u=t._id||t.id,c=((i=t==null?void 0:t.images)==null?void 0:i[0])||(t==null?void 0:t.image);return e.createElement(q,{to:d(`/market/${u}`),className:"group block overflow-hidden rounded-2xl border border-gray-200/60 bg-white shadow-sm transition hover:shadow-md focus:outline-none focus:ring-2 focus:ring-gray-900/20","aria-label":`${t.title} detail`},e.createElement("div",{className:"relative aspect-[4/3] w-full overflow-hidden bg-gray-50"},c?e.createElement("img",{src:c,alt:t.title,className:"h-full w-full object-cover transition duration-300 group-hover:scale-[1.02]",loading:"lazy"}):e.createElement("div",{className:"flex h-full w-full items-center justify-center text-4xl"},"ðŸ–¼ï¸")),e.createElement("div",{className:"p-4"},e.createElement("h3",{className:"line-clamp-1 text-base font-semibold text-gray-900"},t.title),e.createElement("p",{className:"mt-1 text-sm font-medium text-gray-800"},Q.format(Number(t.price)||0)),e.createElement("p",{className:"mt-1 line-clamp-1 text-xs text-gray-500"},t.sellerNickname||"Unknown"),t.location&&e.createElement("div",{className:"mt-2 inline-flex items-center rounded-md bg-gray-100 px-2 py-0.5 text-[11px] text-gray-600"},t.location)))}const W=()=>{const[t,d]=N.useState([]),[u,c]=N.useState(!0),[i,a]=N.useState(null),{school:w,schoolTheme:v}=F(),E=B(),{token:s}=G(),[f,k]=T(),y=Math.max(1,parseInt(f.get("page")||"1",10)),h=f.get("q")||"",g=f.get("sort")||"new",S=r=>{const n=new URLSearchParams(f.toString());n.set("page",String(r)),k(n,{replace:!0})},l=r=>{const n=new URLSearchParams(f.toString());r?n.set("q",r):n.delete("q"),n.set("page","1"),k(n,{replace:!0})},M=r=>{const n=new URLSearchParams(f.toString());n.set("sort",r),n.set("page","1"),k(n,{replace:!0})},[R,P]=N.useState(0);return N.useEffect(()=>{let r=!0;return w&&(async()=>{try{if(c(!0),a(null),s){const o=await z({school:w,token:s,page:y,limit:L,q:h,sort:g==="new"?"latest":g==="price-asc"?"price_asc":g==="price-desc"?"price_desc":"latest"});if(!r)return;if(o&&typeof o=="object"&&Array.isArray(o.items))d(o.items),P(Number(o.total||0));else{const p=Array.isArray(o)?o:[],A=(h||"").trim().toLowerCase();let $=p.filter(x=>{var b,j,I;return A?((b=x.title)==null?void 0:b.toLowerCase().includes(A))||((j=x.description)==null?void 0:j.toLowerCase().includes(A))||((I=x.seller)==null?void 0:I.toLowerCase().includes(A)):!0});$=$.sort((x,b)=>{if(g==="price-asc")return(x.price??0)-(b.price??0);if(g==="price-desc")return(b.price??0)-(x.price??0);const j=x.createdAt??x._id??"",I=b.createdAt??b._id??"";return String(I).localeCompare(String(j))}),P($.length);const U=(y-1)*L;d($.slice(U,U+L))}}else{const m=await D({school:w,page:y,pageSize:L,q:h,sort:g});if(!r)return;d(Array.isArray(m==null?void 0:m.items)?m.items:[]),P(Number((m==null?void 0:m.total)||0))}}catch(m){console.error("âŒ Failed to load listings",m),a("Failed to load listings.")}finally{r&&c(!1)}})(),()=>{r=!1}},[w,s,y,h,g]),e.createElement("div",{className:"min-h-screen px-4 py-6 sm:px-6",style:{backgroundColor:v.bg}},e.createElement("div",{className:"mx-auto max-w-6xl"},e.createElement("div",{className:"mb-5 flex flex-col justify-between gap-3 sm:flex-row sm:items-center"},e.createElement("h2",{className:"text-2xl font-bold tracking-tight",style:{color:v.text}},"Marketplace"),e.createElement("div",{className:"flex w-full flex-col gap-2 sm:w-auto sm:flex-row sm:items-center"},e.createElement("div",{className:"relative sm:w-72"},e.createElement("input",{type:"search",value:h,onChange:r=>l(r.target.value),placeholder:"Search: title, seller",className:"w-full rounded-xl border border-gray-300 bg-white px-3 py-2 text-sm text-gray-800 placeholder:text-gray-400 shadow-sm focus:border-gray-900 focus:outline-none focus:ring-2 focus:ring-gray-900/10","aria-label":"search items"})),e.createElement("select",{value:g,onChange:r=>M(r.target.value),className:"rounded-xl border border-gray-300 bg-white px-3 py-2 text-sm text-gray-800 shadow-sm focus:border-gray-900 focus:outline-none focus:ring-2 focus:ring-gray-900/10","aria-label":"sort items"},e.createElement("option",{value:"new"},"Newest"),e.createElement("option",{value:"price-asc"},"Lowest Price"),e.createElement("option",{value:"price-desc"},"Highest Price")),e.createElement(q,{to:E("/messages"),className:"inline-flex items-center justify-center rounded-xl border border-gray-300 bg-white px-3 py-2 text-sm font-medium text-gray-800 shadow-sm transition hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-900/10"},"ðŸ’¬ My Chats"),e.createElement(q,{to:E("/market/write"),className:"inline-flex items-center justify-center rounded-xl px-4 py-2 text-sm font-semibold text-white shadow transition focus:outline-none focus:ring-2 focus:ring-offset-0",style:{backgroundColor:v.primary}},"+ Create Listing"))),i&&e.createElement("div",{className:"mb-4 rounded-xl border border-red-200 bg-red-50 p-3 text-sm text-red-700"},i),u?e.createElement("div",{className:"grid grid-cols-2 gap-4 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5"},Array.from({length:10}).map((r,n)=>e.createElement(Z,{key:n}))):t.length===0?e.createElement(C,{schoolPath:E}):e.createElement(e.Fragment,null,e.createElement("div",{className:"grid grid-cols-2 gap-4 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5"},t.map(r=>e.createElement(J,{key:r._id||r.id,item:r,schoolPath:E}))),e.createElement(H,{page:y,total:R,limit:L,onPageChange:S,siblingCount:1,boundaryCount:1,className:"mb-2",showStatus:!0}))))};export{W as default};
