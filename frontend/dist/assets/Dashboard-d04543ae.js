import{u as k,a as C,b as P,c as A,r as i,R as e,N as L,L as s,d as x,e as M}from"./index-295dfd07.js";import{l as S,g as O}from"./posts-7a288c92.js";import{u as _}from"./useLoginGate-c49bc67f.js";import{M as j,T as F,a as R,P as z}from"./leaflet-2077696a.js";import"./en-0a76414d.js";x.extend(M);x.locale("en");const c=3;function B(){const d=k(),{user:u,token:p}=C(),{school:r,schoolTheme:l,loading:h}=P(),a=A(),{ensureAuth:E}=_(),[g,N]=i.useState([]),[w,b]=i.useState(!0),m=i.useMemo(()=>({lat:40.7291,lon:-73.9965}),[]);if(h)return null;if(!r)return e.createElement(L,{to:"/select-school",replace:!0});i.useEffect(()=>{let t=!0;if(r)return(async()=>{b(!0);try{let o=[];if(p){const n=await S({school:r,token:p,page:1,limit:c});o=Array.isArray(n)?n.slice(0,c):[]}else{const n=await O({school:r,page:1,limit:c,sort:"new"});o=Array.isArray(n==null?void 0:n.items)?n.items.slice(0,c):[]}t&&N(o)}catch{t&&N([])}finally{t&&b(!1)}})(),()=>{t=!1}},[r,p]);const v=(l==null?void 0:l.bg)||"#f6f3ff",y=(l==null?void 0:l.primary)||"#6b46c1",f=(l==null?void 0:l.text)||"#111827";return e.createElement("div",{className:"min-h-screen",style:{backgroundColor:v}},e.createElement("div",{className:"mx-auto flex w-full max-w-screen-xl flex-col gap-8 px-6 py-12 lg:flex-row"},e.createElement("aside",{className:"w-full shrink-0 rounded-2xl border border-sand bg-white/80 p-6 shadow-md backdrop-blur-md lg:w-72"},e.createElement("div",{className:"text-center"},e.createElement("div",{className:"mx-auto h-20 w-20 rounded-full",style:{backgroundColor:y}}),e.createElement("p",{className:"mt-4 text-xl font-bold",style:{color:f}},(u==null?void 0:u.nickname)||r.toUpperCase()),e.createElement("p",{className:"text-sm text-gray-500"},r.toUpperCase())),e.createElement("ul",{className:"mt-6 space-y-3 text-sm text-gray-700"},e.createElement("li",null,e.createElement(s,{to:a("/myposts"),className:"transition hover:text-indigo-600"},"My Posts")),e.createElement("li",null,e.createElement(s,{to:a("/liked"),className:"transition hover:text-indigo-600"},"Liked")),e.createElement("li",null,e.createElement(s,{to:a("/commented"),className:"transition hover:text-indigo-600"},"Commented")),e.createElement("li",null,e.createElement(s,{to:a("/personal-schedule"),className:"transition hover:text-indigo-600"},"Schedule")),e.createElement("li",null,e.createElement(s,{to:a("/market"),className:"transition hover:text-indigo-600"},"Marketplace")),e.createElement("li",null,e.createElement(s,{to:a("/foodmap"),className:"transition hover:text-indigo-600"},"Food Map")))),e.createElement("main",{className:"flex w-full flex-1 flex-col gap-6"},e.createElement("section",{className:"w-full rounded-2xl border border-sand bg-white p-6 shadow-md"},e.createElement("div",{className:"mb-4 flex items-center justify-between"},e.createElement(s,{to:a("/freeboard")},e.createElement("h2",{className:"cursor-pointer text-2xl font-bold hover:underline",style:{color:f}},"Free Board")),e.createElement(s,{to:a("/freeboard"),className:"text-sm text-blue-600 hover:underline"},"View All")),w?e.createElement("ul",{className:"space-y-3"},Array.from({length:c}).map((t,o)=>e.createElement("li",{key:o,className:"animate-pulse"},e.createElement("div",{className:"h-5 w-2/3 rounded bg-gray-100"}),e.createElement("div",{className:"mt-2 h-3 w-1/3 rounded bg-gray-100"})))):g.length===0?e.createElement("p",{className:"text-sm text-gray-500"},"Latest posts will appear here."):e.createElement("ul",{className:"divide-y"},g.map(t=>e.createElement("li",{key:t._id||t.id,className:"py-3"},e.createElement("button",{className:"block w-full text-left",onClick:()=>E(()=>d(a(`/freeboard/${t._id||t.id}`)))},e.createElement("div",{className:"flex items-center justify-between"},e.createElement("div",{className:"font-medium text-gray-900 line-clamp-2"},t.title),e.createElement("div",{className:"ml-3 shrink-0 text-xs text-gray-500"},x(t.createdAt).fromNow())))))),e.createElement("div",{className:"mt-4 flex justify-end"},e.createElement("button",{onClick:()=>E(()=>d(a("/freeboard/write"))),className:"rounded-xl px-4 py-2 text-sm font-semibold text-white shadow",style:{backgroundColor:y}},"+ Write Post"))),e.createElement("section",{onClick:()=>d(a("/foodmap")),className:"cursor-pointer overflow-hidden rounded-2xl border border-sand bg-white p-0 shadow-inner transition hover:shadow-lg",title:"Go to Food Map"},e.createElement("div",{className:"p-6"},e.createElement("h2",{className:"mb-1 flex items-center gap-2 text-lg font-semibold",style:{color:f}},"üçΩÔ∏è Explore Nearby Food",e.createElement("span",{className:"ml-2 text-xs text-blue-600 underline"},"Open map")),e.createElement("p",{className:"text-sm text-gray-700"},"Discover top-rated restaurants and cafes near campus. Click to open the full map.")),e.createElement("div",{className:"h-56 select-none"},e.createElement(j,{center:[m.lat,m.lon],zoom:15,style:{height:"100%",width:"100%"},attributionControl:!1,zoomControl:!1},e.createElement(F,{attribution:"¬© OpenStreetMap contributors",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.createElement(R,{position:[m.lat,m.lon]},e.createElement(z,null,"Campus Center"))))))))}export{B as default};
