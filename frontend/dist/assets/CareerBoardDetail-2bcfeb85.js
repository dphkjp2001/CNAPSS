import{e as R,b as _,f as A,u as I,a as T,c as $,r as n,R as e,g as B}from"./index-4845e13d.js";import{C as z}from"./CommentSection-48eeb24f.js";import{d as x,r as M}from"./relativeTime-df273c8c.js";import"./en-0752e6bc.js";import{a as O,d as Y,t as q,u as G}from"./careerPosts-c240b790.js";import"./useLoginGate-66f2af50.js";x.extend(M);x.locale("en");function X(){var U;const{id:y}=R(),b=_(),h=A(),{user:a}=I(),{school:o,schoolTheme:s}=T(),E=$(),[r,d]=n.useState(null),[w,P]=n.useState(""),[i,u]=n.useState(!1),[C,g]=n.useState(""),[v,f]=n.useState(""),[N,k]=n.useState(!1),S=async()=>{try{const t=await O({school:o,id:y});d(t),g((t==null?void 0:t.title)||""),f((t==null?void 0:t.content)||"")}catch(t){P(t.message||"Failed to load the post.")}};n.useEffect(()=>{S()},[y,o]),n.useEffect(()=>{const c=new URLSearchParams(h.search).get("nid");async function l(){if(!(!c||!(a!=null&&a.email)||!o))try{const p="https://api.cnapss.com/api".replace(/\/+$/,"");await B(`${p}/${o}/notification/mark-read`,{method:"POST",headers:{"Content-Type":"application/json"},body:{commentId:c,email:a.email}})}catch{}}l()},[h.search,a==null?void 0:a.email,o]);const m=n.useMemo(()=>((a==null?void 0:a.email)||"").toLowerCase()===((r==null?void 0:r.email)||"").toLowerCase(),[a,r]),L=async()=>{if(window.confirm("Delete this post?"))try{await Y({school:o,id:r._id}),alert("Post deleted."),b(E("/career"))}catch(t){alert("Delete failed: "+(t.message||"Unknown error"))}},j=async()=>{try{await q({school:o,id:r._id}),d(t=>t&&{...t,thumbsUpUsers:(t.thumbsUpUsers||[]).includes(((a==null?void 0:a.email)||"").toLowerCase())?t.thumbsUpUsers.filter(c=>c.toLowerCase()!==((a==null?void 0:a.email)||"").toLowerCase()):[...t.thumbsUpUsers||[],((a==null?void 0:a.email)||"").toLowerCase()]}),await S()}catch(t){alert("Failed to like: "+(t.message||"Unknown error"))}},D=async()=>{const t=C.trim(),c=v.trim();if(!(!t||!c)){k(!0);try{const l=await G({school:o,id:r._id,title:t,content:c}),p=(l==null?void 0:l.post)||l;d(p),u(!1)}catch(l){alert("Update failed: "+(l.message||"Unknown error"))}finally{k(!1)}}},F=()=>{g((r==null?void 0:r.title)||""),f((r==null?void 0:r.content)||""),u(!1)};return w?e.createElement("div",{className:"flex min-h-screen items-center justify-center text-sm text-red-700",style:{backgroundColor:(s==null?void 0:s.bg)||"#f6f3ff"}},w):r?e.createElement("div",{className:"min-h-screen px-4 py-6 sm:px-6",style:{backgroundColor:(s==null?void 0:s.bg)||"#f6f3ff"}},e.createElement("div",{className:"mx-auto max-w-3xl"},e.createElement("div",{className:"overflow-hidden rounded-2xl border border-gray-200 bg-white shadow-sm"},e.createElement("div",{className:"border-b border-gray-100 p-5 sm:p-6"},i?e.createElement("input",{value:C,onChange:t=>g(t.target.value),placeholder:"Title",className:"w-full rounded-xl border border-gray-300 px-3 py-2 text-lg font-semibold text-gray-900 focus:border-gray-900 focus:ring-2 focus:ring-gray-900/10"}):e.createElement("h1",{className:"text-2xl font-bold text-gray-900"},r.title),e.createElement("p",{className:"mt-1 text-sm text-gray-500"},"Posted by ",e.createElement("span",{className:"font-medium"},"anonymous")," ‚Ä¢"," ",x(r.createdAt).fromNow())),e.createElement("div",{className:"p-5 sm:p-6"},i?e.createElement("textarea",{value:v,onChange:t=>f(t.target.value),placeholder:"Content",className:"h-56 w-full resize-y rounded-xl border border-gray-300 px-3 py-2 text-sm text-gray-800 focus:border-gray-900 focus:ring-2 focus:ring-gray-900/10"}):e.createElement("div",{className:"prose max-w-none whitespace-pre-wrap text-sm text-gray-900"},r.content)),e.createElement("div",{className:"flex items-center justify-between border-t border-gray-100 px-5 py-3 sm:px-6"},e.createElement("div",{className:"flex items-center gap-2"},e.createElement("button",{onClick:j,disabled:m,className:"rounded-lg border px-3 py-1 text-sm hover:bg-gray-50 disabled:opacity-60",title:m?"You can‚Äôt like your own post.":"Like post"},"üëç Like"),e.createElement("span",{className:"text-xs text-gray-500"},((U=r.thumbsUpUsers)==null?void 0:U.length)||0," likes")),e.createElement("div",{className:"flex items-center gap-2"},m&&!i&&e.createElement(e.Fragment,null,e.createElement("button",{onClick:()=>u(!0),className:"rounded-lg border px-3 py-1 text-sm hover:bg-gray-50"},"‚úèÔ∏è Edit"),e.createElement("button",{onClick:L,className:"rounded-lg border px-3 py-1 text-sm text-red-600 hover:bg-red-50"},"üóëÔ∏è Delete")),m&&i&&e.createElement(e.Fragment,null,e.createElement("button",{onClick:D,disabled:N,className:"rounded-lg border px-3 py-1 text-sm text-white",style:{backgroundColor:"#111827"}},N?"Saving...":"Save"),e.createElement("button",{onClick:F,className:"rounded-lg border px-3 py-1 text-sm"},"Cancel")))),e.createElement("div",{className:"border-t border-gray-100 p-5 sm:p-6"},e.createElement(z,{postId:r._id,authorEmail:r.email}))),e.createElement("div",{className:"mt-6"},e.createElement("button",{onClick:()=>b(E("/career")),className:"text-sm text-gray-600 hover:underline"},"‚Üê Back to list")))):e.createElement("div",{className:"flex min-h-screen items-center justify-center text-sm text-gray-600",style:{backgroundColor:(s==null?void 0:s.bg)||"#f6f3ff"}},"Loading‚Ä¶")}export{X as default};
