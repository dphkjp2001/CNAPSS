import{a as M,b as D,c as F,u as _,r as s,R as e,d as w,e as B}from"./index-338302ab.js";import{u as R}from"./useLoginGate-3eafa77e.js";import"./en-6ee45bb4.js";import{l as W,g as q}from"./posts-7a288c92.js";w.extend(B);w.locale("en");const p=10;function G(){return e.createElement("li",{className:"animate-pulse"},e.createElement("div",{className:"h-5 w-2/3 rounded bg-gray-100"}),e.createElement("div",{className:"mt-2 h-3 w-1/3 rounded bg-gray-100"}),e.createElement("div",{className:"mt-3 h-px w-full bg-gray-100"}))}function I({onWrite:h,primary:o}){return e.createElement("div",{className:"rounded-2xl border border-dashed border-gray-300 bg-white p-10 text-center"},e.createElement("div",{className:"mx-auto mb-3 flex h-14 w-14 items-center justify-center rounded-full bg-gray-100 text-2xl"},"📝"),e.createElement("h3",{className:"text-lg font-semibold text-gray-800"},"No posts yet"),e.createElement("p",{className:"mt-1 text-sm text-gray-500"},"Be the first to start a discussion."),e.createElement("button",{onClick:h,className:"mt-6 inline-flex items-center rounded-xl px-4 py-2 text-sm font-medium text-white shadow focus:outline-none focus:ring-2 focus:ring-offset-0",style:{backgroundColor:o}},"+ Write Post"))}function z(){const{user:h,token:o}=M(),{school:i,schoolTheme:r}=D(),g=F(),f=_(),{ensureAuth:x}=R(),[E,P]=s.useState([]),[S,N]=s.useState(!0),[v,k]=s.useState(""),[m,L]=s.useState(""),[d,j]=s.useState("new"),[n,y]=s.useState(1);s.useEffect(()=>{let t=!0;if(i)return(async()=>{N(!0),k("");try{let a;o?a=await W({school:i,token:o}):a=await q({school:i,page:1,limit:20});const l=Array.isArray(a)?a:Array.isArray(a==null?void 0:a.items)?a.items:[];t&&P(l)}catch{t&&k("Failed to load posts.")}finally{t&&N(!1)}})(),()=>{t=!1}},[i,o]);const b=s.useMemo(()=>{const t=m.trim().toLowerCase();let a=E.filter(l=>{var c,C;return t?((c=l.title)==null?void 0:c.toLowerCase().includes(t))||((C=l.content)==null?void 0:C.toLowerCase().includes(t)):!0});return a=a.sort((l,c)=>d==="old"?new Date(l.createdAt)-new Date(c.createdAt):new Date(c.createdAt)-new Date(l.createdAt)),a},[E,m,d]),u=Math.max(1,Math.ceil(b.length/p)),A=b.slice((n-1)*p,n*p);return s.useEffect(()=>{y(1)},[m,d]),e.createElement("div",{className:"min-h-screen px-4 py-6 sm:px-6",style:{backgroundColor:(r==null?void 0:r.bg)||"#f6f3ff"}},e.createElement("div",{className:"mx-auto max-w-3xl"},e.createElement("div",{className:"mb-5 flex flex-col justify-between gap-3 sm:flex-row sm:items-center"},e.createElement("h2",{className:"text-2xl font-bold tracking-tight text-gray-900"},"Free Board"),e.createElement("div",{className:"flex w-full flex-col gap-2 sm:w-auto sm:flex-row sm:items-center"},e.createElement("div",{className:"relative sm:w-80"},e.createElement("input",{type:"search",value:m,onChange:t=>L(t.target.value),placeholder:"Search posts",className:"w-full rounded-xl border border-gray-300 bg-white px-3 py-2 text-sm text-gray-800 placeholder:text-gray-400 shadow-sm focus:border-gray-900 focus:outline-none focus:ring-2 focus:ring-gray-900/10","aria-label":"search posts"})),e.createElement("select",{value:d,onChange:t=>j(t.target.value),className:"rounded-xl border border-gray-300 bg-white px-3 py-2 text-sm text-gray-800 shadow-sm focus:border-gray-900 focus:outline-none focus:ring-2 focus:ring-gray-900/10","aria-label":"sort posts"},e.createElement("option",{value:"new"},"Newest"),e.createElement("option",{value:"old"},"Oldest")),e.createElement("button",{onClick:()=>x(()=>f(g("/freeboard/write"))),className:"inline-flex items-center justify-center rounded-xl px-4 py-2 text-sm font-semibold text-white shadow focus:outline-none focus:ring-2 focus:ring-offset-0",style:{backgroundColor:(r==null?void 0:r.primary)||"#6b46c1"}},"+ Write Post"))),S?e.createElement("ul",{className:"space-y-4 rounded-2xl border border-gray-200 bg-white p-4 shadow-sm"},Array.from({length:6}).map((t,a)=>e.createElement(G,{key:a}))):v?e.createElement("div",{className:"rounded-xl border border-red-200 bg-red-50 p-3 text-sm text-red-700"},v):b.length===0?e.createElement(I,{onWrite:()=>x(()=>f(g("/freeboard/write"))),primary:(r==null?void 0:r.primary)||"#6b46c1"}):e.createElement(e.Fragment,null,e.createElement("ul",{className:"rounded-2xl border border-gray-200 bg-white shadow-sm"},A.map((t,a)=>e.createElement("li",{key:t._id,className:"px-4 py-4 sm:px-6"},e.createElement("button",{onClick:()=>x(()=>f(g(`/freeboard/${t._id}`))),className:"block w-full text-left"},e.createElement("h3",{className:"line-clamp-2 text-base font-semibold text-gray-900 hover:underline"},t.title),e.createElement("p",{className:"mt-1 text-xs text-gray-500"},"Posted by anonymous • ",w(t.createdAt).fromNow())),a!==A.length-1&&e.createElement("div",{className:"mt-4 h-px w-full bg-gray-100"})))),u>1&&e.createElement("div",{className:"mt-6 flex items-center justify-center gap-2"},e.createElement("button",{onClick:()=>y(t=>Math.max(1,t-1)),disabled:n===1,className:"rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-700 shadow-sm disabled:cursor-not-allowed disabled:opacity-50"},"Previous"),e.createElement("span",{className:"text-sm text-gray-600"},n," / ",u),e.createElement("button",{onClick:()=>y(t=>Math.min(u,t+1)),disabled:n===u,className:"rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-700 shadow-sm disabled:cursor-not-allowed disabled:opacity-50"},"Next")))))}export{z as default};
