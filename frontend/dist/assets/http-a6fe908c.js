const c="https://api.cnapss.com/api".replace(/\/$/,""),h=["token","jwt","accessToken","authToken","CNAPSS_TOKEN","CNAPSS_AUTH"];function d(){for(const t of h){const e=localStorage.getItem(t)||sessionStorage.getItem(t);if(e)return e}return null}function u(){for(const t of h){try{localStorage.removeItem(t)}catch{}try{sessionStorage.removeItem(t)}catch{}}}function p(){try{window.dispatchEvent(new CustomEvent("CNAPSS_TOKEN_EXPIRED"))}catch{}}async function l(t,e={}){console.log("http.request called with:",{url:t,options:e});const a=d(),n=new Headers(e.headers||{});console.log("http.request headers before setting Content-Type and Authorization:",n),!n.has("Content-Type")&&!(e.body instanceof FormData)&&(console.log("Setting Content-Type to application/json"),n.set("Content-Type","application/json")),a&&n.set("Authorization",`Bearer ${a}`),console.log("Final headers for fetch:",n);const o=await fetch(t,{...e,headers:n,credentials:"include"});if(o.status===401){console.log("Received 401 Unauthorized response");let i={};try{i=await o.clone().json()}catch{}if(o.headers.get("x-token-expired")==="1"||(i==null?void 0:i.code)==="TOKEN_EXPIRED")throw u(),p(),new Error("TOKEN_EXPIRED")}const s=await(async()=>(console.log("Response headers:",o.headers),(o.headers.get("Content-Type")||"").includes("application/json")?o.json():o.text()))();if(!o.ok){console.log("Response not OK:",o.status,s);const i=typeof s=="object"&&(s!=null&&s.message)?s.message:String(s),r=new Error(i||`HTTP ${o.status}`);throw r.status=o.status,r.data=s,r}return s}function g(t){const e=t.toString().startsWith("http")?t:`${c}${t}`;return l(e,{method:"GET"})}function T(t,e){const a=t.toString().startsWith("http")?t:`${c}${t}`,n=localStorage.getItem("token"),o={method:"POST",headers:{},credentials:"include"};return e instanceof FormData?o.body=e:(o.headers["Content-Type"]="application/json",o.body=JSON.stringify(e||{})),n&&(o.headers.Authorization=`Bearer ${n}`),l(a,o)}function E(t,e){const a=t.toString().startsWith("http")?t:`${c}${t}`,n={method:"PUT"};return e instanceof FormData?n.body=e:n.body=JSON.stringify(e||{}),l(a,n)}function S(t){const e=t.toString().startsWith("http")?t:`${c}${t}`;return l(e,{method:"DELETE"})}function m(t,e={}){const{method:a="GET",body:n=null,headers:o={},useApiBase:s=!0}=e,r=typeof t=="string"&&/^https?:\/\//i.test(t)||s===!1?t:`${c}${t}`;let f={method:a,headers:o};return n instanceof FormData?f.body=n:n!=null&&(f.body=JSON.stringify(n)),l(r,f)}export{m as a,E as b,S as d,g,T as p};
