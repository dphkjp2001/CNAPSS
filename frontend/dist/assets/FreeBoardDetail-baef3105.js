import{e as j,b as I,f as A,u as $,a as B,c as M,r as o,R as t,L as z,g as H}from"./index-467f6660.js";import{C as O}from"./CommentSection-3d3cef2d.js";import{d as p,r as T}from"./relativeTime-4b382bcf.js";import"./en-a38582df.js";import{d as W,e as Y,t as q,u as G}from"./posts-49c46580.js";p.extend(T);p.locale("en");function Z(){var S;const{id:x}=j(),U=I(),c=A(),{user:s}=$(),{school:i,schoolTheme:r}=B(),y=M(),[a,u]=o.useState(null),[w,L]=o.useState(""),[m,g]=o.useState(!1),[E,f]=o.useState(""),[v,b]=o.useState(""),[C,N]=o.useState(!1),k=async()=>{try{const e=await W({school:i,id:x});u(e),f((e==null?void 0:e.title)||""),b((e==null?void 0:e.content)||"")}catch(e){L(e.message||"Failed to load the post.")}};o.useEffect(()=>{k()},[x,i]),o.useEffect(()=>{const l=new URLSearchParams(c.search).get("nid");async function n(){if(!(!l||!(s!=null&&s.email)||!i))try{const h="https://api.cnapss.com/api".replace(/\/+$/,"");await H(`${h}/${i}/notification/mark-read`,{method:"POST",headers:{"Content-Type":"application/json"},body:{commentId:l,email:s.email}})}catch{}}n()},[c.search,s==null?void 0:s.email,i]);const P=o.useMemo(()=>{const e=c.hash||"",l=e.startsWith("#comment-")?e.slice(9):null,n=new URLSearchParams(c.search).get("nid");return l||n||null},[c.hash,c.search]),d=o.useMemo(()=>((s==null?void 0:s.email)||"").toLowerCase()===((a==null?void 0:a.email)||"").toLowerCase(),[s,a]),F=async()=>{if(window.confirm("Delete this post?"))try{await Y({school:i,id:a._id}),alert("Post deleted."),U(y("/freeboard"))}catch(e){alert("Delete failed: "+(e.message||"Unknown error"))}},D=async()=>{try{await q({school:i,id:a._id}),u(e=>e&&{...e,thumbsUpUsers:(e.thumbsUpUsers||[]).includes(((s==null?void 0:s.email)||"").toLowerCase())?e.thumbsUpUsers.filter(l=>l.toLowerCase()!==((s==null?void 0:s.email)||"").toLowerCase()):[...e.thumbsUpUsers||[],((s==null?void 0:s.email)||"").toLowerCase()]}),await k()}catch(e){alert("Failed to like: "+(e.message||"Unknown error"))}},R=async()=>{const e=E.trim(),l=v.trim();if(!(!e||!l)){N(!0);try{const n=await G({school:i,id:a._id,title:e,content:l}),h=(n==null?void 0:n.post)||n;u(h),g(!1)}catch(n){alert("Update failed: "+(n.message||"Unknown error"))}finally{N(!1)}}},_=()=>{f((a==null?void 0:a.title)||""),b((a==null?void 0:a.content)||""),g(!1)};return w?t.createElement("div",{className:"flex min-h-screen items-center justify-center text-sm text-red-700",style:{backgroundColor:(r==null?void 0:r.bg)||"#f6f3ff"}},w):a?t.createElement("div",{className:"min-h-screen px-4 py-6 sm:px-6",style:{backgroundColor:(r==null?void 0:r.bg)||"#f6f3ff"}},t.createElement("div",{className:"mx-auto max-w-3xl"},t.createElement("div",{className:"overflow-hidden rounded-2xl border border-gray-200 bg-white shadow-sm"},t.createElement("div",{className:"border-b border-gray-100 p-5 sm:p-6"},m?t.createElement("input",{value:E,onChange:e=>f(e.target.value),placeholder:"Title",className:"w-full rounded-xl border border-gray-300 px-3 py-2 text-lg font-semibold text-gray-900 focus:border-gray-900 focus:ring-2 focus:ring-gray-900/10"}):t.createElement("h1",{className:"text-2xl font-bold text-gray-900"},a.title),t.createElement("p",{className:"mt-1 text-sm text-gray-500"},"Posted by ",t.createElement("span",{className:"font-medium"},"anonymous")," ‚Ä¢"," ",p(a.createdAt).fromNow())),t.createElement("div",{className:"p-5 sm:p-6"},m?t.createElement("textarea",{value:v,onChange:e=>b(e.target.value),placeholder:"Content",className:"h-56 w-full resize-y rounded-xl border border-gray-300 px-3 py-2 text-sm text-gray-800 focus:border-gray-900 focus:ring-2 focus:ring-gray-900/10"}):t.createElement("div",{className:"prose prose-sm max-w-none text-gray-800"},t.createElement("p",{className:"whitespace-pre-wrap leading-relaxed"},a.content)),t.createElement("div",{className:"mt-6 flex flex-wrap items-center gap-3"},t.createElement("button",{onClick:D,disabled:d,className:"rounded-xl border border-gray-300 bg-white px-3 py-1.5 text-sm text-gray-800 shadow-sm hover:bg-gray-50 disabled:opacity-60","aria-label":"like post",title:d?"You can‚Äôt like your own post.":"Like post"},"üëç ",((S=a.thumbsUpUsers)==null?void 0:S.length)||0),d&&!m&&t.createElement(t.Fragment,null,t.createElement("button",{onClick:()=>g(!0),className:"rounded-xl px-4 py-2 text-sm font-semibold text-white shadow",style:{backgroundColor:(r==null?void 0:r.primary)||"#6b46c1"}},"Edit"),t.createElement("button",{onClick:F,className:"rounded-xl bg-red-500 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-red-600"},"Delete")),d&&m&&t.createElement(t.Fragment,null,t.createElement("button",{onClick:R,disabled:C,className:"rounded-xl bg-gray-900 px-4 py-2 text-sm font-semibold text-white shadow hover:bg-black disabled:opacity-60"},C?"Saving‚Ä¶":"Save"),t.createElement("button",{onClick:_,className:"rounded-xl border border-gray-300 bg-white px-4 py-2 text-sm font-semibold text-gray-800 shadow-sm hover:bg-gray-50"},"Cancel")),t.createElement(z,{to:y("/freeboard"),className:"ml-auto text-sm font-medium text-blue-600 underline underline-offset-2"},"‚Üê Back to List")))),(a==null?void 0:a._id)&&t.createElement("div",{className:"mt-6 rounded-2xl border border-gray-200 bg-white p-5 shadow-sm sm:p-6"},t.createElement(O,{postId:a._id,authorEmail:a.email,highlightId:P})))):t.createElement("div",{className:"flex min-h-screen items-center justify-center text-sm text-gray-600",style:{backgroundColor:(r==null?void 0:r.bg)||"#f6f3ff"}},"Loading‚Ä¶")}export{Z as default};
