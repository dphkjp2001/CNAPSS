import{u as L,c as q,r as N,R as e,e as O,b as V}from"./index-f4753343.js";import{a as H,b as Y,d as z}from"./academicPosts-01d2e02d.js";import{V as K,C as Q}from"./CommentSection-2dc539cd.js";import{a as W}from"./http-a6fe908c.js";import{d as D,r as X}from"./relativeTime-15aeeae5.js";import"./posts-ff58ac93.js";import"./useLoginGate-848e0aba.js";async function J({school:t,targetId:s,message:n}){const p="https://api.cnapss.com/api".replace(/\/$/,"");return W(`${p}/${t}/request`,{method:"POST",headers:{"Content-Type":"application/json"},body:{targetId:s,initialMessage:n}})}function A({label:t,value:s,selected:n,onChange:p}){return e.createElement("label",{className:"flex items-center gap-3 cursor-pointer select-none"},e.createElement("input",{type:"radio",className:"h-4 w-4 accent-red-500",checked:n===s,onChange:()=>p(s)}),e.createElement("span",{className:"text-sm text-slate-700"},t))}function Z({school:t,postId:s,kind:n}){const p=L(),{user:c}=q(),l=n==="course_materials",i=n==="coffee_chat",d=n==="study_mate"||n==="study_group",a=`Hi,
I would love to study with!
Let me know what days are you thinking of :)`,[f,m]=N.useState("lunch"),[b,h]=N.useState(""),E=N.useMemo(()=>d?a:l?`Hi,
I have the class materials you're looking for. You can get it by ${f==="lunch"?"lunch/dinner":f==="small"?"a small cost":"anything is fine"}.`:i?`Hi,
I can have a coffee chat with you by ${f==="lunch"?"lunch/dinner":f==="small"?"a small cost":"anything is fine"}.`:b||"",[l,i,d,b,f]),[y,C]=N.useState(!1),k=!!s&&!!t&&E.trim().length>0,I=async()=>{if(!c){alert("Please log in to send a message.");return}try{C(!0);const o=await J({school:t,targetId:s,message:d?a:E}),S=o==null?void 0:o.conversationId;p(S?`/${encodeURIComponent(t)}/messages?c=${encodeURIComponent(S)}`:`/${encodeURIComponent(t)}/messages`)}catch(o){alert((o==null?void 0:o.message)||"Failed to send.")}finally{C(!1)}};return e.createElement("aside",{className:"bg-white rounded-2xl shadow border border-slate-200 p-4 h-max"},e.createElement("div",{className:"text-sm text-slate-900 font-semibold mb-1"},"Hi,"),e.createElement("div",{className:"text-sm text-slate-700 mb-3"},l&&"I have the class materials you're looking for. You can get it by",i&&"I can have a coffee chat with you by",d&&"Send a request message:"),(l||i)&&e.createElement("div",{className:"space-y-3 mb-4"},e.createElement(A,{label:"lunch/dinner",value:"lunch",selected:f,onChange:m}),e.createElement(A,{label:"small cost",value:"small",selected:f,onChange:m}),e.createElement(A,{label:"Anything is fine",value:"free",selected:f,onChange:m})),!d&&!(l||i)&&e.createElement("textarea",{value:b,onChange:o=>h(o.target.value),rows:5,className:"w-full rounded-xl border border-slate-300 px-3 py-2 text-sm mb-4",placeholder:"Write a short messageâ€¦"}),e.createElement("div",{className:"mb-3 rounded-lg bg-slate-50 border border-slate-200 p-3 text-xs whitespace-pre-wrap text-slate-700"},E),e.createElement("button",{onClick:I,disabled:y||!k,className:"w-full rounded-xl bg-red-500 text-white font-semibold py-2 shadow hover:bg-red-600 disabled:opacity-60"},d?y?"Sendingâ€¦":"Send a request":y?"Sendingâ€¦":"Send an offer"))}D.extend(X);D.locale("en");const F={lecture_notes:"Lecture Notes",syllabus:"Syllabus",past_exams:"Past Exams",quiz_prep:"Quiz Prep",projects:"Projects",other:"Other"},_=(t="")=>String(t||"").trim().toLowerCase().replace(/[\s-]+/g,"_"),v=(...t)=>t.find(s=>typeof s=="string"&&s.trim().length)||"",P=t=>Array.isArray(t)?t:t?[t]:[];function ee(t=""){const s=_(t);return s.includes("course_material")?"ðŸ“":s.includes("study")?"ðŸ‘¥":s.includes("coffee")?"â˜•ï¸":"ðŸ“Œ"}function te(t={}){return v(t.content,t.body,t.description,t.text,t.details,t.rawContent)||""}function ae(t={}){const s=v(t.courseName,t.course,t.course_code,t.courseCode,t.subject,t.title),n=v(t.professor,t.prof,t.instructor,t.teacher),c=[P(t.materials),P(t.materialTypes),P(t.types)].flat().map(a=>typeof a=="string"?_(a):"").filter(Boolean),l=Object.keys(F).filter(a=>t[a]===!0),d=Array.from(new Set([...c,...l])).map(a=>F[a]||a.replace(/_/g," ")).filter(Boolean);return{course:s,professor:n,chips:d}}function se(t={}){const s=v(t.title,t.groupTitle,t.heading),n=v(t.relatedCourse,t.course,t.courseName,t.course_code,t.courseCode),p=v(t.topic,t.description,t.content,t.body,t.details);return{title:s,relatedCourse:n,topic:p}}function me(){var R,M,j,T,$;const{school:t,id:s}=O(),n=L(),{school:p}=V(),c=t||p||"nyu",{user:l}=q(),[i,d]=N.useState({loading:!0,error:"",post:null});if(N.useEffect(()=>{let r=!0;return(async()=>{try{const w=await H({school:c,id:s});if(!r)return;d({loading:!1,error:"",post:w})}catch(w){if(!r)return;d({loading:!1,error:(w==null?void 0:w.message)||"Failed to load post.",post:null})}})(),()=>{r=!1}},[c,s]),N.useEffect(()=>{if(!l)return;let r=!0;return(async()=>{try{const w=await Y({school:c,id:s});if(!r)return;d(U=>({...U,post:w||U.post}))}catch{}})(),()=>{r=!1}},[l,c,s]),i.loading)return e.createElement("div",{className:"max-w-5xl mx-auto px-4 py-6 text-sm text-slate-600"},"Loadingâ€¦");if(i.error)return e.createElement("div",{className:"max-w-5xl mx-auto px-4 py-6 text-sm text-red-600"},i.error);if(!i.post)return e.createElement("div",{className:"max-w-5xl mx-auto px-4 py-6 text-sm text-slate-600"},"Post not found.");const a=i.post,f=_(a.mode||a.postType||a.type||(a.lookingFor?"looking_for":"general")),m=f==="seeking"||f==="looking_for",b=!m,h=_(a.kind||a.category||""),E=m&&(h.includes("material")||h.includes("course_material")||!!a.courseName||Array.isArray(a.materials)),y=m&&(h.includes("group")||h==="study"||h.includes("mate")),C=m&&(h.includes("coffee")||h.includes("chat")),k=Number(a.upCount??((R=a.counts)==null?void 0:R.up)??0),I=Number(a.downCount??((M=a.counts)==null?void 0:M.down)??0),o=a.myVote??null,S=l&&[(j=a.author)==null?void 0:j._id,(T=a.author)==null?void 0:T.id,a.userId,a.authorId].filter(Boolean).map(String).some(r=>String(r)===String(l._id||l.id)),B=async()=>{if(window.confirm("Delete this post?"))try{await z({school:c,id:s}),alert("Post deleted."),n(`/${encodeURIComponent(c)}/dashboard?tab=academic`)}catch(r){alert("Delete failed: "+((r==null?void 0:r.message)||"Unknown error"))}},g=te(a),u=E?ae(a):null,x=y?se(a):null,G=m&&!E&&!y&&!C;return e.createElement("div",{className:"max-w-5xl mx-auto px-4 py-6"},e.createElement("div",{className:"grid gap-6 md:grid-cols-[1fr,360px]"},e.createElement("article",{className:"bg-white rounded-2xl shadow border border-slate-200 overflow-hidden"},e.createElement("header",{className:"px-5 py-4 border-b border-slate-200"},e.createElement("div",{className:"flex items-start justify-between gap-4"},e.createElement("div",{className:"flex-1"},e.createElement("div",{className:"flex items-center justify-between text-sm text-slate-500"},e.createElement("div",{className:"inline-flex items-center gap-2"},e.createElement("span",null,m?ee(a.kind):"ðŸ’¬"),e.createElement("span",{className:"font-medium"},m?"Seeking":"General Question"),a.kind&&e.createElement("span",{className:"text-slate-400"},"â€¢ ",String(a.kind).replace(/_/g," "))),e.createElement("div",{className:"flex items-center gap-3"},e.createElement("time",{dateTime:a.createdAt},D(a.createdAt).fromNow()),S&&e.createElement("button",{onClick:B,className:"ml-2 rounded-xl bg-red-500 px-3 py-1.5 text-xs font-semibold text-white hover:bg-red-600",title:"Delete this post"},"Delete"))),e.createElement("h1",{className:"mt-2 text-2xl font-semibold text-slate-900"},a.title||(y?(x==null?void 0:x.title)||"Study Group":"Untitled"))),b&&e.createElement(K,{school:c,postId:a._id||s,initialCounts:{up:k,down:I},initialVote:o,disabled:!!S,className:"shrink-0"}))),e.createElement("div",{className:"px-5 py-5 space-y-4 text-[15px] leading-7 text-slate-800"},E&&e.createElement("div",{className:"space-y-3"},e.createElement("div",{className:"flex flex-wrap gap-2"},(u==null?void 0:u.course)&&e.createElement("span",{className:"inline-flex items-center rounded-full border border-slate-300 bg-slate-50 px-3 py-1 text-xs text-slate-700"},"Course: ",u.course),(u==null?void 0:u.professor)&&e.createElement("span",{className:"inline-flex items-center rounded-full border border-slate-300 bg-slate-50 px-3 py-1 text-xs text-slate-700"},"Professor: ",u.professor)),((($=u==null?void 0:u.chips)==null?void 0:$.length)??0)>0&&e.createElement("div",{className:"flex flex-wrap gap-2"},u.chips.map(r=>e.createElement("span",{key:r,className:"inline-flex items-center rounded-full border border-slate-300 bg-white px-3 py-1 text-xs text-slate-700"},r))),g?e.createElement("p",{className:"whitespace-pre-wrap"},g):e.createElement("p",{className:"text-slate-400 italic"},"No additional details were provided.")),y&&e.createElement("div",{className:"space-y-3"},(x==null?void 0:x.relatedCourse)&&e.createElement("span",{className:"inline-flex items-center rounded-full border border-slate-300 bg-slate-50 px-3 py-1 text-xs text-slate-700"},"Related Course: ",x.relatedCourse),x!=null&&x.topic?e.createElement("p",{className:"whitespace-pre-wrap"},x.topic):g?e.createElement("p",{className:"whitespace-pre-wrap"},g):e.createElement("p",{className:"text-slate-400 italic"},"No additional details were provided.")),C&&e.createElement("div",null,g?e.createElement("p",{className:"whitespace-pre-wrap"},g):e.createElement("p",{className:"text-slate-400 italic"},"No additional details were provided.")),G&&e.createElement("div",null,g?e.createElement("p",{className:"whitespace-pre-wrap"},g):e.createElement("p",{className:"text-slate-400 italic"},"No additional details were provided.")),b&&e.createElement("div",null,g?e.createElement("p",{className:"whitespace-pre-wrap"},g):e.createElement("p",{className:"text-slate-400 italic"},"No additional details were provided."))),b&&e.createElement("div",{className:"px-5 py-5 border-t border-slate-200 bg-white"},e.createElement(Q,{postId:a._id||s}))),m&&e.createElement(Z,{school:c,postId:a._id||s,kind:h})))}export{me as default};
