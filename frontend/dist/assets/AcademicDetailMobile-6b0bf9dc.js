import{i as I,u as L,b as B,c as D,r as d,o as S,p as O,R as e,q as T}from"./index-f622bc5c.js";import{A as U,U as z,C as A}from"./CommentSection-ae63b3f9.js";import{G as E,B as i,C as G,a as q,E as V,R as M}from"./RequestOfferPanel-7c4ee8ab.js";import{d as y,r as Q}from"./relativeTime-5158df36.js";import"./createLucideIcon-abe1b2ad.js";import"./useLoginGate-2a6b7d10.js";y.extend(Q);y.locale("en");const $={accent:"#FF7A70",accentHover:"#FF6B61"};function H(o=""){const l=String(o||"").toLowerCase().replace(/[\s-]+/g,"_");return l.includes("course_material")?"ðŸ“":l.includes("study")?"ðŸ‘¥":l.includes("coffee")?"â˜•ï¸":"ðŸ“Œ"}const n=o=>o&&String(o).trim()!==""?String(o):"Not specified";function ee(){var w,k,F,C;const{school:o,id:l}=I(),N=L(),{school:_}=B(),r=o||_||"nyu",{user:u}=D(),[f,p]=d.useState({loading:!0,error:"",post:null}),[b,x]=d.useState(!1);if(d.useEffect(()=>{let a=!0;return(async()=>{try{const s=await S({school:r,id:l});if(!a)return;console.log("âœ… Public post loaded:",s),p({loading:!1,error:"",post:s})}catch(s){if(!a)return;console.error("âŒ Failed public load:",s),p({loading:!1,error:(s==null?void 0:s.message)||"Failed to load post.",post:null})}})(),()=>{a=!1}},[r,l]),d.useEffect(()=>{let a=!0;return(async()=>{try{const s=await S({school:r,id:l});if(!a)return;p({loading:!1,error:"",post:s})}catch(s){if(!a)return;p({loading:!1,error:(s==null?void 0:s.message)||"Failed to load post.",post:null})}})(),()=>{a=!1}},[r,l]),d.useEffect(()=>{if(!u)return;let a=!0;return(async()=>{try{const s=await O({school:r,id:l});if(!a)return;p(g=>({...g,post:s||g.post}))}catch{}})(),()=>{a=!1}},[u,r,l]),d.useEffect(()=>{if(b){const a=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=a}}},[b]),f.loading)return e.createElement("div",{className:"min-h-screen bg-[#F8F9FA] flex items-center justify-center"},e.createElement("div",{className:"text-gray-600"},"Loadingâ€¦"));if(f.error)return e.createElement("div",{className:"min-h-screen bg-[#F8F9FA] flex items-center justify-center"},e.createElement("div",{className:"text-red-600"},f.error));if(!f.post)return e.createElement("div",{className:"min-h-screen bg-[#F8F9FA] flex items-center justify-center"},e.createElement("div",{className:"text-gray-600"},"Post not found."));const t=f.post,v=(t.mode||t.postType||t.type||"").toString().toLowerCase(),c=v==="seeking"||v==="looking_for",P=!c,h=u&&[(w=t.author)==null?void 0:w._id,(k=t.author)==null?void 0:k.id,t.userId,t.authorId].filter(Boolean).map(String).some(a=>String(a)===String(u._id||u.id)),j=async()=>{if(window.confirm("Delete this post?"))try{await T({school:r,id:l}),alert("Post deleted."),N(`/${encodeURIComponent(r)}/dashboard?tab=academic`)}catch(a){alert("Delete failed: "+((a==null?void 0:a.message)||"Unknown error"))}};let m=[];if(P)m=[{label:"Related Course",value:n(t.courseName),icon:E},{label:"Question Details",value:n(t.content),icon:i}];else{const a=String(t.kind||"").toLowerCase().replace(/[\s-]+/g,"_");a==="course_materials"?m=[{label:"Course Name",value:n(t.title||t.courseName),icon:i},{label:"Professor",value:n(t.professor),icon:E},{label:"Semester",value:n(t.semester),icon:G},{label:"Looking for Materials",value:Array.isArray(t.materials)&&t.materials.length?t.materials.map(s=>s.replace(/_/g," ")).join(", "):"Not specified",icon:i}]:a==="coffee_chat"?m=[{label:"Title",value:n(t.title),icon:q},{label:"Topic",value:n(t.content),icon:i}]:a==="study_mate"?m=[{label:"Class",value:n(t.courseName),icon:E},{label:"Topic",value:n(t.content),icon:i}]:m=[{label:"Content",value:n(t.content),icon:i}]}const R=((F=t.author)==null?void 0:F.name)||((C=t.author)==null?void 0:C.username)||"Anonymous";return e.createElement("div",{className:"min-h-screen bg-[#F8F9FA]"},e.createElement("div",{className:"sticky top-0 z-30 bg-[#F8F9FA]/95 backdrop-blur border-b border-gray-200"},e.createElement("div",{className:"px-4 py-3 flex items-center justify-between"},e.createElement("button",{onClick:()=>N(`/${encodeURIComponent(r)}/dashboard?tab=academic`),className:"inline-flex items-center gap-2 text-gray-700"},e.createElement(U,{className:"w-5 h-5"}),e.createElement("span",{className:"text-sm font-medium"},"Back")),h&&e.createElement("button",{className:"text-gray-500"},e.createElement(V,{className:"w-5 h-5"})))),e.createElement("div",{className:"px-4 pb-24"},e.createElement("div",{className:"mt-4 bg-white rounded-2xl border border-gray-200 shadow-sm"},e.createElement("div",{className:"px-4 py-4"},e.createElement("div",{className:"flex items-start gap-3"},e.createElement("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center shrink-0"},e.createElement(z,{className:"w-5 h-5 text-gray-600"})),e.createElement("div",{className:"flex-1 min-w-0"},e.createElement("div",{className:"flex items-center flex-wrap gap-2"},e.createElement("span",{className:"font-semibold text-gray-900"},R),e.createElement("span",{className:"text-gray-400"},"â€¢"),e.createElement("span",{className:"text-sm text-gray-500"},y(t.createdAt).fromNow())),e.createElement("div",{className:"mt-1 flex items-center gap-2"},e.createElement("span",{className:"text-xs text-gray-500"},"Academic Board"),c&&e.createElement(e.Fragment,null,e.createElement("span",{className:"text-gray-300"},"â€¢"),e.createElement("span",{className:"inline-flex items-center gap-1.5 px-2 py-0.5 rounded-full text-[11px] font-medium text-white",style:{backgroundColor:$.accent}},e.createElement("span",null,H(t.kind)),e.createElement("span",null,"Seeking")))))),e.createElement("h1",{className:"mt-3 text-xl font-bold text-gray-900 leading-snug"},t.title||"Untitled"),!c&&e.createElement("div",{className:"mt-2 inline-flex items-center gap-2 px-2.5 py-1 bg-blue-50 border border-blue-200 rounded-lg"},e.createElement("span",{className:"text-sm font-medium text-blue-700"},"General Question"))),e.createElement("div",{className:"px-4 pb-4"},e.createElement("ul",{className:"divide-y divide-gray-100"},m.map((a,s)=>{const g=a.icon||i;return e.createElement("li",{key:s,className:"py-3"},e.createElement("div",{className:"flex items-start gap-3"},e.createElement("div",{className:"w-9 h-9 rounded-lg bg-gray-100 flex items-center justify-center shrink-0"},e.createElement(g,{className:"w-5 h-5 text-gray-600"})),e.createElement("div",{className:"flex-1 min-w-0"},e.createElement("p",{className:"text-xs font-medium text-gray-500"},a.label),e.createElement("p",{className:"mt-0.5 text-[15px] text-gray-900 whitespace-pre-wrap leading-relaxed"},a.value))))})),h&&e.createElement("div",{className:"pt-4"},e.createElement("button",{onClick:j,className:"w-full px-4 py-2.5 bg-red-500 text-white font-medium rounded-lg hover:bg-red-600 active:scale-[0.98] transition-all shadow-sm"},"Delete Post")))),!c&&e.createElement("div",{className:"mt-6"},e.createElement(A,{postId:t._id||l})),c&&e.createElement("div",{className:"mt-6"},e.createElement(A,{postId:t._id||l}))),c&&e.createElement("div",{className:"fixed bottom-0 inset-x-0 z-40 border-t border-gray-200 bg-white/95 backdrop-blur"},e.createElement("div",{className:"px-4 py-3"},e.createElement("button",{onClick:()=>x(!0),className:"w-full rounded-xl bg-gray-900 text-white font-semibold py-3 hover:bg-black"},"View Request / Offer"))),c&&b&&e.createElement(e.Fragment,null,e.createElement("div",{className:"fixed inset-0 z-40 bg-black/30",onClick:()=>x(!1)}),e.createElement("div",{className:"fixed inset-x-0 bottom-0 z-50 rounded-t-2xl bg-white shadow-2xl border-t border-gray-200",role:"dialog","aria-modal":"true"},e.createElement("div",{className:"px-4 pt-3 pb-2"},e.createElement("div",{className:"mx-auto h-1.5 w-12 rounded-full bg-gray-300 mb-3"}),e.createElement("div",{className:"flex items-center justify-between"},e.createElement("h2",{className:"text-base font-semibold text-gray-900"},"Respond to this post"),e.createElement("button",{onClick:()=>x(!1),className:"text-sm text-gray-600 underline"},"Close"))),e.createElement("div",{className:"px-4 pb-6"},e.createElement(M,{school:r,postId:t._id||l,kind:String(t.kind||"").toLowerCase().replace(/[\s-]+/g,"_")})))))}export{ee as default};
