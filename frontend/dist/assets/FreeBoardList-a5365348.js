import{u as L,a as A,d as I,c as _,e as j,r as l,R as t,P as B}from"./index-d75a1783.js";import{d as g,r as F}from"./relativeTime-1ef84672.js";import"./en-39ed5bd9.js";import{l as U,g as G}from"./posts-bc418477.js";g.extend(F);g.locale("en");const d=20;function M(){return t.createElement("li",{className:"animate-pulse"},t.createElement("div",{className:"h-5 w-2/3 rounded bg-gray-100"}),t.createElement("div",{className:"mt-2 h-3 w-1/3 rounded bg-gray-100"}),t.createElement("div",{className:"mt-3 h-px w-full bg-gray-100"}))}function O(){return t.createElement("div",{className:"rounded-2xl border border-gray-200 bg-white p-10 text-center"},t.createElement("p",{className:"text-sm text-gray-500"},"No posts yet."))}function z(){const{token:f}=L(),{school:n,schoolTheme:r}=A(),x=I(),p=_(),[s,i]=j(),o=Math.max(1,parseInt(s.get("page")||"1",10)),c=s.get("q")||"",m=s.get("sort")||"new",E=a=>{const e=new URLSearchParams(s.toString());e.set("page",String(a)),i(e,{replace:!0})},N=a=>{const e=new URLSearchParams(s.toString());a?e.set("q",a):e.delete("q"),e.set("page","1"),i(e,{replace:!0})},v=a=>{const e=new URLSearchParams(s.toString());e.set("sort",a),e.set("page","1"),i(e,{replace:!0})},[u,S]=l.useState([]),[P,k]=l.useState(0),[C,y]=l.useState(!0),[b,h]=l.useState("");l.useEffect(()=>{let a=!0;if(n)return(async()=>{y(!0),h("");try{let e;f?e=await U({school:n,page:o,limit:d,q:c,sort:m}):e=await G({school:n,page:o,limit:d,q:c,sort:m});const w=(e==null?void 0:e.items)||e||[];if(!a)return;S(w),k(Number((e==null?void 0:e.total)??w.length??0))}catch(e){if(!a)return;h((e==null?void 0:e.message)||"Failed to load posts.")}finally{if(!a)return;y(!1)}})(),()=>{a=!1}},[f,n,o,c,m]);const R={color:(r==null?void 0:r.text)||"#111827"},q={backgroundColor:(r==null?void 0:r.primary)||"#111827"};return t.createElement("div",{className:"min-h-screen px-4 py-6 sm:px-6",style:{backgroundColor:(r==null?void 0:r.bg)||"#f6f3ff"}},t.createElement("div",{className:"mx-auto max-w-3xl"},t.createElement("div",{className:"mb-5 flex flex-col justify-between gap-3 sm:flex-row sm:items-center"},t.createElement("h2",{className:"text-2xl font-bold tracking-tight",style:R},"Free Board"),t.createElement("div",{className:"flex w-full flex-col gap-2 sm:w-auto sm:flex-row sm:items-center"},t.createElement("div",{className:"relative sm:w-80"},t.createElement("input",{type:"search",value:c,onChange:a=>N(a.target.value),placeholder:"Search posts",className:"w-full rounded-xl border border-gray-300 bg-white px-3 py-2 text-sm text-gray-800 placeholder:text-gray-400 shadow-sm focus:border-gray-900 focus:outline-none focus:ring-2 focus:ring-gray-900/10","aria-label":"search posts"})),t.createElement("select",{value:m,onChange:a=>v(a.target.value),className:"rounded-xl border border-gray-300 bg-white px-3 py-2 text-sm text-gray-800 shadow-sm focus:border-gray-900 focus:outline-none focus:ring-2 focus:ring-gray-900/10","aria-label":"sort posts"},t.createElement("option",{value:"new"},"Newest"),t.createElement("option",{value:"old"},"Oldest")),t.createElement("button",{onClick:()=>p(x("/freeboard/write")),className:"inline-flex items-center justify-center rounded-xl px-4 py-2 text-sm font-semibold text-white shadow focus:outline-none focus:ring-2 focus:ring-offset-0",style:q},"+ Write Post"))),C?t.createElement("ul",{className:"space-y-4 rounded-2xl border border-gray-200 bg-white p-4 shadow-sm"},Array.from({length:6}).map((a,e)=>t.createElement(M,{key:e}))):b?t.createElement("div",{className:"rounded-xl border border-red-200 bg-red-50 p-3 text-sm text-red-700"},b):u.length===0?t.createElement(O,null):t.createElement("ul",{className:"rounded-2xl border border-gray-200 bg-white shadow-sm"},u.map((a,e)=>t.createElement("li",{key:a._id,className:"px-4 py-4 sm:px-6"},t.createElement("button",{onClick:()=>p(x(`/freeboard/${a._id}`)),className:"block w-full text-left"},t.createElement("h3",{className:"line-clamp-2 text-base font-semibold text-gray-900 hover:underline"},a.title),t.createElement("p",{className:"mt-1 text-xs text-gray-500"},"Posted by anonymous â€¢ ",g(a.createdAt).fromNow()," Â· ğŸ’¬"," ",a.commentsCount??"-"," Â· ğŸ‘ ",a.likesCount??"-")),e!==u.length-1&&t.createElement("div",{className:"mt-4 h-px w-full bg-gray-100"})))),t.createElement(B,{page:o,total:P,limit:d,onPageChange:E,className:"mb-8"})))}export{z as default};
