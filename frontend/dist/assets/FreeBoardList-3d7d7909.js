import{a as A,b as P,u as L,r,R as e,L as j,d as f,c as M}from"./index-1baf5031.js";import"./en-27c7a75d.js";import{f as D}from"./posts-ea4b05b3.js";f.extend(M);f.locale("en");const x=10;function F(){return e.createElement("li",{className:"animate-pulse"},e.createElement("div",{className:"h-5 w-2/3 rounded bg-gray-100"}),e.createElement("div",{className:"mt-2 h-3 w-1/3 rounded bg-gray-100"}),e.createElement("div",{className:"mt-3 h-px w-full bg-gray-100"}))}function _({onWrite:i,primary:a}){return e.createElement("div",{className:"rounded-2xl border border-dashed border-gray-300 bg-white p-10 text-center"},e.createElement("div",{className:"mx-auto mb-3 flex h-14 w-14 items-center justify-center rounded-full bg-gray-100 text-2xl"},"📝"),e.createElement("h3",{className:"text-lg font-semibold text-gray-800"},"No posts yet"),e.createElement("p",{className:"mt-1 text-sm text-gray-500"},"Be the first to start a discussion."),e.createElement("button",{onClick:i,className:"mt-6 inline-flex items-center rounded-xl px-4 py-2 text-sm font-medium text-white shadow focus:outline-none focus:ring-2 focus:ring-offset-0",style:{backgroundColor:a}},"+ Write Post"))}function q(){const{user:i}=A(),{schoolTheme:a}=P(),y=L(),[b,N]=r.useState([]),[v,p]=r.useState(!0),[w,k]=r.useState(null),[c,C]=r.useState(""),[m,S]=r.useState("new"),[l,u]=r.useState(1);r.useEffect(()=>{(async()=>{try{p(!0);const t=await D();N(Array.isArray(t)?t:[])}catch(t){console.error("❌ fetchPosts error:",t),k("Failed to load posts.")}finally{p(!1)}})()},[]);const g=r.useMemo(()=>{const t=c.trim().toLowerCase();let s=b.filter(o=>{var n,h;return t?((n=o.title)==null?void 0:n.toLowerCase().includes(t))||((h=o.content)==null?void 0:h.toLowerCase().includes(t)):!0});return s=s.sort((o,n)=>m==="old"?new Date(o.createdAt)-new Date(n.createdAt):new Date(n.createdAt)-new Date(o.createdAt)),s},[b,c,m]),d=Math.max(1,Math.ceil(g.length/x)),E=g.slice((l-1)*x,l*x);return r.useEffect(()=>{u(1)},[c,m]),e.createElement("div",{className:"min-h-screen px-4 py-6 sm:px-6",style:{backgroundColor:(a==null?void 0:a.bg)||"#f6f3ff"}},e.createElement("div",{className:"mx-auto max-w-3xl"},e.createElement("div",{className:"mb-5 flex flex-col justify-between gap-3 sm:flex-row sm:items-center"},e.createElement("h2",{className:"text-2xl font-bold tracking-tight text-gray-900"},"Free Board"),e.createElement("div",{className:"flex w-full flex-col gap-2 sm:w-auto sm:flex-row sm:items-center"},e.createElement("div",{className:"relative sm:w-80"},e.createElement("input",{type:"search",value:c,onChange:t=>C(t.target.value),placeholder:"Search posts",className:"w-full rounded-xl border border-gray-300 bg-white px-3 py-2 text-sm text-gray-800 placeholder:text-gray-400 shadow-sm focus:border-gray-900 focus:outline-none focus:ring-2 focus:ring-gray-900/10","aria-label":"search posts"}),e.createElement("span",{className:"pointer-events-none absolute right-3 top-2.5 text-gray-400"})),e.createElement("select",{value:m,onChange:t=>S(t.target.value),className:"rounded-xl border border-gray-300 bg-white px-3 py-2 text-sm text-gray-800 shadow-sm focus:border-gray-900 focus:outline-none focus:ring-2 focus:ring-gray-900/10","aria-label":"sort posts"},e.createElement("option",{value:"new"},"Newest"),e.createElement("option",{value:"old"},"Oldest")),i&&e.createElement("button",{onClick:()=>y("/freeboard/write"),className:"inline-flex items-center justify-center rounded-xl px-4 py-2 text-sm font-semibold text-white shadow focus:outline-none focus:ring-2 focus:ring-offset-0",style:{backgroundColor:(a==null?void 0:a.primary)||"#6b46c1"}},"+ Write Post"))),v?e.createElement("ul",{className:"space-y-4 rounded-2xl border border-gray-200 bg-white p-4 shadow-sm"},Array.from({length:6}).map((t,s)=>e.createElement(F,{key:s}))):w?e.createElement("div",{className:"rounded-xl border border-red-200 bg-red-50 p-3 text-sm text-red-700"},w):g.length===0?e.createElement(_,{onWrite:()=>y("/freeboard/write"),primary:(a==null?void 0:a.primary)||"#6b46c1"}):e.createElement(e.Fragment,null,e.createElement("ul",{className:"rounded-2xl border border-gray-200 bg-white shadow-sm"},E.map((t,s)=>e.createElement("li",{key:t._id,className:"px-4 py-4 sm:px-6"},e.createElement(j,{to:`/freeboard/${t._id}`,className:"block"},e.createElement("h3",{className:"line-clamp-2 text-base font-semibold text-gray-900 hover:underline"},t.title),e.createElement("p",{className:"mt-1 text-xs text-gray-500"},"Posted by anonymous • ",f(t.createdAt).fromNow())),s!==E.length-1&&e.createElement("div",{className:"mt-4 h-px w-full bg-gray-100"})))),d>1&&e.createElement("div",{className:"mt-6 flex items-center justify-center gap-2"},e.createElement("button",{onClick:()=>u(t=>Math.max(1,t-1)),disabled:l===1,className:"rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-700 shadow-sm disabled:cursor-not-allowed disabled:opacity-50"},"Previous"),e.createElement("span",{className:"text-sm text-gray-600"},l," / ",d),e.createElement("button",{onClick:()=>u(t=>Math.min(d,t+1)),disabled:l===d,className:"rounded-lg border border-gray-300 bg-white px-3 py-2 text-sm text-gray-700 shadow-sm disabled:cursor-not-allowed disabled:opacity-50"},"Next")))))}export{q as default};
