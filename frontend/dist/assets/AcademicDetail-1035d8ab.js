import{u as I,c as P,r as g,R as e,e as D,b as A}from"./index-68265940.js";import{a as R,b as $,d as U}from"./academicPosts-01d2e02d.js";import{V as q,C as F}from"./CommentSection-366acfcc.js";import{a as M}from"./http-a6fe908c.js";import{d as C,r as T}from"./relativeTime-e35e79cd.js";import"./posts-ff58ac93.js";import"./useLoginGate-2f222e34.js";async function j({school:n,targetId:a,message:i}){const u="https://api.cnapss.com/api".replace(/\/$/,"");return M(`${u}/${n}/request`,{method:"POST",headers:{"Content-Type":"application/json"},body:{targetId:a,initialMessage:i}})}function S({label:n,value:a,selected:i,onChange:u}){return e.createElement("label",{className:"flex items-center gap-3 cursor-pointer select-none"},e.createElement("input",{type:"radio",className:"h-4 w-4 accent-red-500",checked:i===a,onChange:()=>u(a)}),e.createElement("span",{className:"text-sm text-slate-700"},n))}function L({school:n,postId:a,kind:i}){const u=I(),{user:m}=P(),r=i==="course_materials",l=i==="coffee_chat",d=i==="study_mate"||i==="study_group",t=`Hi,
I would love to study with!
Let me know what days are you thinking of :)`,[c,p]=g.useState("lunch"),[h,v]=g.useState(""),x=g.useMemo(()=>d?t:r?`Hi,
I have the class materials you're looking for. You can get it by ${c==="lunch"?"lunch/dinner":c==="small"?"a small cost":"anything is fine"}.`:l?`Hi,
I can have a coffee chat with you by ${c==="lunch"?"lunch/dinner":c==="small"?"a small cost":"anything is fine"}.`:h||"",[r,l,d,h,c]),[b,y]=g.useState(!1),N=!!a&&!!n&&x.trim().length>0,E=async()=>{if(!m){alert("Please log in to send a message.");return}try{y(!0);const s=await j({school:n,targetId:a,message:d?t:x}),w=s==null?void 0:s.conversationId;u(w?`/${encodeURIComponent(n)}/messages?c=${encodeURIComponent(w)}`:`/${encodeURIComponent(n)}/messages`)}catch(s){alert((s==null?void 0:s.message)||"Failed to send.")}finally{y(!1)}};return e.createElement("aside",{className:"bg-white rounded-2xl shadow border border-slate-200 p-4 h-max"},e.createElement("div",{className:"text-sm text-slate-900 font-semibold mb-1"},"Hi,"),e.createElement("div",{className:"text-sm text-slate-700 mb-3"},r&&"I have the class materials you're looking for. You can get it by",l&&"I can have a coffee chat with you by",d&&"Send a request message:"),(r||l)&&e.createElement("div",{className:"space-y-3 mb-4"},e.createElement(S,{label:"lunch/dinner",value:"lunch",selected:c,onChange:p}),e.createElement(S,{label:"small cost",value:"small",selected:c,onChange:p}),e.createElement(S,{label:"Anything is fine",value:"free",selected:c,onChange:p})),!d&&!(r||l)&&e.createElement("textarea",{value:h,onChange:s=>v(s.target.value),rows:5,className:"w-full rounded-xl border border-slate-300 px-3 py-2 text-sm mb-4",placeholder:"Write a short messageâ€¦"}),e.createElement("div",{className:"mb-3 rounded-lg bg-slate-50 border border-slate-200 p-3 text-xs whitespace-pre-wrap text-slate-700"},x),e.createElement("button",{onClick:E,disabled:b||!N,className:"w-full rounded-xl bg-red-500 text-white font-semibold py-2 shadow hover:bg-red-600 disabled:opacity-60"},d?b?"Sendingâ€¦":"Send a request":b?"Sendingâ€¦":"Send an offer"))}C.extend(T);C.locale("en");function V(n=""){const a=String(n||"").toLowerCase().replace(/[\s-]+/g,"_");return a.includes("course_material")?"ðŸ“":a.includes("study")?"ðŸ‘¥":a.includes("coffee")?"â˜•ï¸":"ðŸ“Œ"}function z(){var E,s,w,k;const{school:n,id:a}=D(),i=I(),{school:u}=A(),m=n||u||"nyu",{user:r}=P(),[l,d]=g.useState({loading:!0,error:"",post:null});if(g.useEffect(()=>{let o=!0;return(async()=>{try{const f=await R({school:m,id:a});if(!o)return;d({loading:!1,error:"",post:f})}catch(f){if(!o)return;d({loading:!1,error:(f==null?void 0:f.message)||"Failed to load post.",post:null})}})(),()=>{o=!1}},[m,a]),g.useEffect(()=>{if(!r)return;let o=!0;return(async()=>{try{const f=await $({school:m,id:a});if(!o)return;d(_=>({..._,post:f||_.post}))}catch{}})(),()=>{o=!1}},[r,m,a]),l.loading)return e.createElement("div",{className:"max-w-5xl mx-auto px-4 py-6 text-sm text-slate-600"},"Loadingâ€¦");if(l.error)return e.createElement("div",{className:"max-w-5xl mx-auto px-4 py-6 text-sm text-red-600"},l.error);if(!l.post)return e.createElement("div",{className:"max-w-5xl mx-auto px-4 py-6 text-sm text-slate-600"},"Post not found.");const t=l.post,c=(t.mode||t.postType||t.type||(t.lookingFor?"looking_for":"general")).toString().toLowerCase(),p=c==="seeking"||c==="looking_for",h=!p,v=Number(t.upCount||((E=t.counts)==null?void 0:E.up)||0),x=Number(t.downCount||((s=t.counts)==null?void 0:s.down)||0),b=t.myVote??null,y=r&&[(w=t.author)==null?void 0:w._id,(k=t.author)==null?void 0:k.id,t.userId,t.authorId].filter(Boolean).map(String).some(o=>String(o)===String(r._id||r.id)),N=async()=>{if(window.confirm("Delete this post?"))try{await U({school:m,id:a}),alert("Post deleted."),i(`/${encodeURIComponent(m)}/dashboard?tab=academic`)}catch(o){alert("Delete failed: "+((o==null?void 0:o.message)||"Unknown error"))}};return e.createElement("div",{className:"max-w-5xl mx-auto px-4 py-6"},e.createElement("div",{className:"grid gap-6 md:grid-cols-[1fr,360px]"},e.createElement("article",{className:"bg-white rounded-2xl shadow border border-slate-200 overflow-hidden"},e.createElement("header",{className:"px-5 py-4 border-b border-slate-200"},e.createElement("div",{className:"flex items-start justify-between gap-4"},e.createElement("div",{className:"flex-1"},e.createElement("div",{className:"flex items-center justify-between text-sm text-slate-500"},e.createElement("div",{className:"inline-flex items-center gap-2"},e.createElement("span",null,p?V(t.kind):"ðŸ’¬"),e.createElement("span",{className:"font-medium"},p?"Seeking":"General question"),t.kind&&e.createElement("span",{className:"text-slate-400"},"â€¢ ",String(t.kind).replace(/_/g," "))),e.createElement("div",{className:"flex items-center gap-3"},e.createElement("time",{dateTime:t.createdAt},C(t.createdAt).fromNow()),y&&e.createElement("button",{onClick:N,className:"ml-2 rounded-xl bg-red-500 px-3 py-1.5 text-xs font-semibold text-white hover:bg-red-600",title:"Delete this post"},"Delete"))),e.createElement("h1",{className:"mt-2 text-2xl font-semibold text-slate-900"},t.title)),h&&e.createElement(q,{school:m,postId:t._id||a,initialCounts:{up:v,down:x},initialVote:b,disabled:!!y,className:"shrink-0"}))),e.createElement("div",{className:"px-5 py-5 whitespace-pre-wrap text-[15px] leading-7 text-slate-800"},t.content),h&&e.createElement("div",{className:"px-5 py-5 border-t border-slate-200 bg-white"},e.createElement(F,{postId:t._id||a}))),p?e.createElement(L,{school:m,postId:t._id||a,kind:String(t.kind||"").toLowerCase().replace(/[\s-]+/g,"_")}):null))}export{z as default};
