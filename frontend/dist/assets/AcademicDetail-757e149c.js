import{f as C,b as L,c as T,r as l,R as e}from"./index-98759306.js";import{a as _}from"./academicPosts-a9b22bc6.js";import{a as k}from"./http-3230a7f7.js";import{U as M,V as $,C as F}from"./CommentSection-2d26baa3.js";import"./relativeTime-ac77d3ad.js";import"./useLoginGate-18d2c4a6.js";async function I({school:o,targetId:a,message:i}){const n="https://api.cnapss.com/api".replace(/\/$/,"");return k(`${n}/${o}/request`,{method:"POST",headers:{"Content-Type":"application/json"},body:{targetId:a,initialMessage:i}})}async function j({school:o,targetId:a}){const i="https://api.cnapss.com/api".replace(/\/$/,""),n=new URL(`${i}/${o}/request/exists`);return n.searchParams.set("targetId",a),k(n.toString(),{method:"GET"})}const B={lecture_notes:"Lecture Notes",syllabus:"Syllabus",past_exams:"Past Exams",quiz_prep:"Quiz Prep"};function V(o=""){const a=String(o||"").toLowerCase().replace(/[\s-]+/g,"_");return a.includes("course_material")?"📝":a.includes("study")?"👥":a.includes("coffee")?"☕️":"📌"}function W(){const{school:o,id:a}=C(),{school:i}=L(),n=o||i||"nyu",{user:d}=T(),[r,b]=l.useState({loading:!0,error:"",post:null}),[m,h]=l.useState(""),[y,E]=l.useState(!1),[u,c]=l.useState(""),[p,N]=l.useState(!1);l.useEffect(()=>{let t=!0;return(async()=>{try{const s=await _({school:n,id:a});if(!t)return;b({loading:!1,error:"",post:s})}catch(s){if(!t)return;b({loading:!1,error:(s==null?void 0:s.message)||"Failed to load post.",post:null})}})(),()=>{t=!1}},[n,a]),l.useEffect(()=>{let t=!0;return(async()=>{try{if(!d)return;const s=await j({school:n,targetId:a});if(!t)return;N(!!(s!=null&&s.exists))}catch{}})(),()=>{t=!1}},[n,a,d]);const g=l.useMemo(()=>{const t=r.post||{},s=(t.mode||t.postType||t.type||(t.lookingFor?"looking_for":"general")||"general").toString().toLowerCase();return{isSeeking:s==="looking_for"||s==="seeking",mode:s,kind:t.kind||""}},[r.post]),P=async t=>{if(t.preventDefault(),!d)return c("Please log in to send a request.");if(!m.trim())return c("Please write a short message.");E(!0),c("");try{await I({school:n,targetId:a,message:m.trim()}),h(""),N(!0),c("Request sent! Check Messages.")}catch(s){c((s==null?void 0:s.message)||"Failed to send request.")}finally{E(!1)}};if(r.loading)return e.createElement("div",{className:"p-6 text-gray-500"},"Loading…");if(r.error)return e.createElement("div",{className:"p-6 text-red-600"},r.error);if(!r.post)return e.createElement("div",{className:"p-6 text-gray-500"},"Post not found.");const{title:R,content:A,createdAt:S,kind:f,professor:x,materials:w=[]}=r.post,v=String(f||"").toLowerCase().replace(/[\s-]+/g,"_")==="course_materials",q=(Array.isArray(w)?w:[]).map(t=>B[t]||t).filter(Boolean);return e.createElement("div",{className:"max-w-3xl mx-auto px-4 py-6"},e.createElement("article",{className:"bg-white rounded-2xl shadow border border-slate-200 overflow-hidden"},e.createElement("header",{className:"px-5 py-4 border-b border-slate-200"},e.createElement("div",{className:"flex items-center justify-between text-sm text-slate-500"},e.createElement("div",{className:"inline-flex items-center gap-2"},e.createElement("span",null,g.isSeeking?V(f):"💬"),e.createElement("span",{className:"font-medium"},g.isSeeking?"Seeking":"General question"),v&&e.createElement("span",{className:"text-slate-400"},"• Course Materials")),e.createElement("time",{dateTime:S},new Date(S).toLocaleString())),e.createElement("h1",{className:"mt-2 text-2xl font-semibold text-slate-900"},R),e.createElement("div",{className:"mt-3 flex items-center justify-between"},e.createElement(M,{username:r.post.nickname,tier:r.post.authorTier,className:"text-sm"}),e.createElement($,{targetType:"Post",targetId:a,initialCounts:r.post.counts,initialVote:r.post.myVote,className:"scale-90"})),v&&(q.length||x)?e.createElement("div",{className:"mt-3 flex flex-wrap items-center gap-2"},q.map(t=>e.createElement("span",{key:t,className:"inline-flex items-center rounded-full border border-slate-300 bg-slate-50 px-3 py-1 text-xs text-slate-700"},t)),x&&e.createElement("span",{className:"inline-flex items-center rounded-full border border-slate-300 bg-slate-50 px-3 py-1 text-xs text-slate-700"},"Professor: ",x)):null),e.createElement("div",{className:"px-5 py-5 whitespace-pre-wrap text-[15px] leading-7 text-slate-800"},A),g.isSeeking?e.createElement("div",{className:"px-5 py-5 border-t border-slate-200 bg-slate-50"},e.createElement("h2",{className:"text-lg font-semibold mb-2"},"Send a Request"),e.createElement("p",{className:"text-sm text-slate-600 mb-3"},"This post doesn’t have comments. Send a private request to the author instead."),e.createElement("form",{onSubmit:P,className:"space-y-3"},e.createElement("textarea",{value:m,onChange:t=>h(t.target.value),placeholder:"Write a short message (who you are / what you need)…",rows:4,className:"w-full rounded-xl border border-slate-300 px-3 py-2 text-[14px] focus:outline-none focus:ring-2 focus:ring-slate-900/10",disabled:p}),e.createElement("div",{className:"flex items-center justify-between"},e.createElement("p",{className:"text-xs text-slate-500"},"Target: ",e.createElement("strong",null,"Academic · ",f||"general")),e.createElement("button",{type:"submit",disabled:y||p||!m.trim(),className:"rounded-xl bg-black px-4 py-2 text-sm font-semibold text-white disabled:opacity-60"},p?"Already requested":y?"Sending…":"Send request")),!!u&&e.createElement("div",{className:`text-sm px-3 py-2 rounded-lg border ${u.includes("sent")?"border-green-200 bg-green-50 text-green-700":"border-red-200 bg-red-50 text-red-700"}`},u))):e.createElement("div",{className:"px-5 py-5 border-t border-slate-200 bg-white"},e.createElement(F,{postId:a}))))}export{W as default};
