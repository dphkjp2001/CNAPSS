import{r as m,a as M,c as R,u as D,d as T,R as e,L as E,P as $}from"./index-1bb73cb9.js";import{l as z}from"./market-2e90e434.js";const w=20,B=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0});function G(){return e.createElement("div",{className:"animate-pulse rounded-2xl border border-gray-200/60 bg-white shadow-sm"},e.createElement("div",{className:"aspect-[4/3] w-full rounded-t-2xl bg-gray-100"}),e.createElement("div",{className:"p-4 space-y-3"},e.createElement("div",{className:"h-4 w-3/5 rounded bg-gray-100"}),e.createElement("div",{className:"h-4 w-2/5 rounded bg-gray-100"}),e.createElement("div",{className:"h-3 w-1/2 rounded bg-gray-100"})))}function H({schoolPath:r}){return e.createElement("div",{className:"rounded-2xl border border-dashed border-gray-300 bg-white/60 p-10 text-center"},e.createElement("div",{className:"mx-auto mb-3 flex h-14 w-14 items-center justify-center rounded-full bg-gray-100 text-2xl"},"🛒"),e.createElement("h3",{className:"text-lg font-semibold text-gray-800"},"No listings yet"),e.createElement("p",{className:"mt-1 text-sm text-gray-500"},"Be the first to create a listing. Items with photos and prices get more attention!"),e.createElement(E,{to:r("/market/write"),className:"mt-6 inline-flex items-center rounded-xl bg-gray-900 px-4 py-2 text-sm font-medium text-white shadow hover:bg-black/90 focus:outline-none focus:ring-2 focus:ring-gray-900/30"},"+ Create Listing"))}function Q({item:r,schoolPath:d}){var i;const u=(i=r==null?void 0:r.images)==null?void 0:i[0];return e.createElement(E,{to:d(`/market/${r._id}`),className:"group block overflow-hidden rounded-2xl border border-gray-200/60 bg-white shadow-sm transition hover:shadow-md focus:outline-none focus:ring-2 focus:ring-gray-900/20","aria-label":`${r.title} detail`},e.createElement("div",{className:"relative aspect-[4/3] w-full overflow-hidden bg-gray-50"},u?e.createElement("img",{src:u,alt:r.title,className:"h-full w-full object-cover transition duration-300 group-hover:scale-[1.02]",loading:"lazy"}):e.createElement("div",{className:"flex h-full w-full items-center justify-center text-4xl"},"🖼️")),e.createElement("div",{className:"p-4"},e.createElement("h3",{className:"line-clamp-1 text-base font-semibold text-gray-900"},r.title),e.createElement("p",{className:"mt-1 text-sm font-medium text-gray-800"},B.format(Number(r.price)||0)),e.createElement("p",{className:"mt-1 line-clamp-1 text-xs text-gray-500"},r.sellerNickname||"Unknown"),r.location&&e.createElement("div",{className:"mt-2 inline-flex items-center rounded-md bg-gray-100 px-2 py-0.5 text-[11px] text-gray-600"},r.location)))}const K=()=>{const[r,d]=m.useState([]),[u,i]=m.useState(!0),[C,L]=m.useState(null),{school:N,schoolTheme:v}=M(),g=R(),{token:S}=D(),[c,k]=T(),f=Math.max(1,parseInt(c.get("page")||"1",10)),p=c.get("q")||"",l=c.get("sort")||"new",_=t=>{const a=new URLSearchParams(c.toString());a.set("page",String(t)),k(a,{replace:!0})},j=t=>{const a=new URLSearchParams(c.toString());t?a.set("q",t):a.delete("q"),a.set("page","1"),k(a,{replace:!0})},U=t=>{const a=new URLSearchParams(c.toString());a.set("sort",t),a.set("page","1"),k(a,{replace:!0})},[q,P]=m.useState(0);return m.useEffect(()=>{let t=!0;return N&&S&&(async()=>{try{i(!0),L(null);const n=await z({school:N,token:S,page:f,limit:w,q:p,sort:l==="new"?"latest":l==="price-asc"?"price_asc":l==="price-desc"?"price_desc":"latest"});if(!t)return;if(n&&typeof n=="object"&&Array.isArray(n.items)){d(n.items),P(Number(n.total||0));return}const F=Array.isArray(n)?n:[],x=(p||"").trim().toLowerCase();let y=F.filter(s=>{var o,h,b;return x?((o=s.title)==null?void 0:o.toLowerCase().includes(x))||((h=s.description)==null?void 0:h.toLowerCase().includes(x))||((b=s.seller)==null?void 0:b.toLowerCase().includes(x)):!0});y=y.sort((s,o)=>{if(l==="price-asc")return(s.price??0)-(o.price??0);if(l==="price-desc")return(o.price??0)-(s.price??0);const h=s.createdAt??s._id??"",b=o.createdAt??o._id??"";return String(b).localeCompare(String(h))}),P(y.length);const I=(f-1)*w;d(y.slice(I,I+w))}catch(A){console.error("❌ Failed to load listings",A),L("Failed to load listings.")}finally{t&&i(!1)}})(),()=>{t=!1}},[N,S,f,p,l]),e.createElement("div",{className:"min-h-screen px-4 py-6 sm:px-6",style:{backgroundColor:v.bg}},e.createElement("div",{className:"mx-auto max-w-6xl"},e.createElement("div",{className:"mb-5 flex flex-col justify-between gap-3 sm:flex-row sm:items-center"},e.createElement("h2",{className:"text-2xl font-bold tracking-tight",style:{color:v.text}},"Marketplace"),e.createElement("div",{className:"flex w-full flex-col gap-2 sm:w-auto sm:flex-row sm:items-center"},e.createElement("div",{className:"relative sm:w-72"},e.createElement("input",{type:"search",value:p,onChange:t=>j(t.target.value),placeholder:"Search: title, seller",className:"w-full rounded-xl border border-gray-300 bg-white px-3 py-2 text-sm text-gray-800 placeholder:text-gray-400 shadow-sm focus:border-gray-900 focus:outline-none focus:ring-2 focus:ring-gray-900/10","aria-label":"search items"})),e.createElement("select",{value:l,onChange:t=>U(t.target.value),className:"rounded-xl border border-gray-300 bg-white px-3 py-2 text-sm text-gray-800 shadow-sm focus:border-gray-900 focus:outline-none focus:ring-2 focus:ring-gray-900/10","aria-label":"sort items"},e.createElement("option",{value:"new"},"Newest"),e.createElement("option",{value:"price-asc"},"Lowest Price"),e.createElement("option",{value:"price-desc"},"Highest Price")),e.createElement(E,{to:g("/messages"),className:"inline-flex items-center justify-center rounded-xl border border-gray-300 bg-white px-3 py-2 text-sm font-medium text-gray-800 shadow-sm transition hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-900/10"},"💬 My Chats"),e.createElement(E,{to:g("/market/write"),className:"inline-flex items-center justify-center rounded-xl px-4 py-2 text-sm font-semibold text-white shadow transition focus:outline-none focus:ring-2 focus:ring-offset-0",style:{backgroundColor:v.primary}},"+ Create Listing"))),C&&e.createElement("div",{className:"mb-4 rounded-xl border border-red-200 bg-red-50 p-3 text-sm text-red-700"},C),u?e.createElement("div",{className:"grid grid-cols-2 gap-4 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5"},Array.from({length:10}).map((t,a)=>e.createElement(G,{key:a}))):r.length===0?e.createElement(H,{schoolPath:g}):e.createElement(e.Fragment,null,e.createElement("div",{className:"grid grid-cols-2 gap-4 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5"},r.map(t=>e.createElement(Q,{key:t._id,item:t,schoolPath:g}))),e.createElement($,{page:f,total:q,limit:w,onPageChange:_,siblingCount:1,boundaryCount:1,className:"mb-2",showStatus:!0}))))};export{K as default};
