import{b as q,c as B,u as $,a as O,r as c,R as e}from"./index-26abdf74.js";import{c as z}from"./market-fdbf22cb.js";import{u as J}from"./uploadToCloudinary-dc971086.js";const N=3,T=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0}),H=()=>{const E=q(),D=B(),{user:p,token:j}=$(),{school:A,schoolTheme:r}=O(),[f,I]=c.useState(""),[v,F]=c.useState(""),[n,M]=c.useState(""),[o,d]=c.useState([]),[w,C]=c.useState(!1),[k,b]=c.useState(""),S=c.useMemo(()=>!(!f.trim()||!n||Number.isNaN(Number(n))||Number(n)<0),[f,n]),L=t=>{const a=t.target.value.replace(/[^\d.]/g,"");M(a)},P=async t=>{const a=Math.max(0,N-o.length),s=Array.from(t||[]).slice(0,a);if(!s.length)return;const u=s.map((l,i)=>({url:URL.createObjectURL(l),uploading:!0,isCover:o.length===0&&i===0}));d(l=>[...l,...u]);for(let l=0;l<s.length;l++)try{const i=await J(s[l]),y=i.secure_url,g=i.public_id;d(x=>{const m=[...x],h=m.findIndex(G=>G.uploading);return h!==-1&&(m[h]={...m[h],url:y,public_id:g,uploading:!1}),m})}catch(i){console.error("image upload failed",i),d(y=>{const g=[...y],x=g.findIndex(m=>m.uploading);return x!==-1&&g.splice(x,1),g}),b("Failed to upload one or more images.")}},U=t=>{d(a=>a.filter((s,u)=>u!==t))},R=t=>{d(a=>{const s=a.map((l,i)=>({...l,isCover:i===t})),[u]=s.splice(t,1);return s.unshift(u),s})},_=async t=>{if(t.preventDefault(),!!S){if(o.some(a=>a.uploading)){alert("Please wait until all images finish uploading.");return}try{C(!0),b(""),await z({school:A,token:j,payload:{title:f.trim(),description:v.trim(),price:parseFloat(n),seller:p==null?void 0:p.email,images:o.map(a=>a.url)}}),E(D("/market"))}catch(a){console.error(a),b("Failed to create the listing. Please try again.")}finally{C(!1)}}};return p?e.createElement("div",{className:"min-h-screen px-4 py-6 sm:px-6",style:{backgroundColor:(r==null?void 0:r.bg)||"#f6f3ff"}},e.createElement("div",{className:"mx-auto max-w-3xl"},e.createElement("div",{className:"rounded-2xl border border-gray-200 bg-white shadow-sm"},e.createElement("div",{className:"border-b border-gray-100 p-5 sm:p-6"},e.createElement("h1",{className:"text-xl font-bold text-gray-900"},"Create Listing"),e.createElement("p",{className:"mt-1 text-sm text-gray-500"},"Add photos, price, and details. The first photo is used as the cover.")),e.createElement("form",{onSubmit:_,className:"p-5 sm:p-6 space-y-6"},e.createElement("section",null,e.createElement("label",{className:"block text-sm font-medium text-gray-900"},"Photos ",e.createElement("span",{className:"font-normal text-gray-400"},"(up to ",N,")")),e.createElement("div",{className:"mt-2 flex flex-col items-center justify-center rounded-xl border-2 border-dashed border-gray-300 bg-gray-50/60 p-6 text-center transition hover:bg-gray-50",onDragOver:t=>t.preventDefault(),onDrop:t=>{t.preventDefault(),!(o.length>=N)&&P(t.dataTransfer.files)}},e.createElement("input",{id:"file-input",type:"file",accept:"image/*",multiple:!0,onChange:t=>P(t.target.files),className:"hidden"}),e.createElement("div",{className:"text-3xl"},"ðŸ–¼ï¸"),e.createElement("p",{className:"mt-2 text-sm text-gray-700"},"Drag & drop images here, or"," ",e.createElement("label",{htmlFor:"file-input",className:"cursor-pointer font-medium text-gray-900 underline underline-offset-2"},"browse")),e.createElement("p",{className:"text-xs text-gray-500 mt-1"},"PNG/JPG, up to ~5MB each")),o.length>0&&e.createElement("div",{className:"mt-4 grid grid-cols-2 gap-3 sm:grid-cols-3"},o.map((t,a)=>e.createElement("div",{key:a,className:"group relative overflow-hidden rounded-xl border border-gray-200 bg-white shadow-sm"},e.createElement("div",{className:"aspect-[4/3] bg-gray-50"},e.createElement("img",{src:t.url,alt:`photo ${a+1}`,className:`h-full w-full object-cover ${t.uploading?"opacity-60":""}`})),e.createElement("div",{className:"absolute inset-x-0 bottom-0 flex items-center justify-between gap-2 p-2"},e.createElement("button",{type:"button",onClick:()=>R(a),className:"rounded-md bg-white/90 px-2 py-1 text-xs font-medium text-gray-800 shadow hover:bg-white"},a===0?"Cover":"Set as cover"),e.createElement("button",{type:"button",onClick:()=>U(a),className:"rounded-md bg-white/90 px-2 py-1 text-xs font-medium text-red-600 shadow hover:bg-white"},"Remove")),t.uploading&&e.createElement("div",{className:"absolute inset-0 flex items-center justify-center bg-white/60 text-xs text-gray-700"},"Uploadingâ€¦"))))),e.createElement("section",{className:"grid grid-cols-1 gap-4 sm:grid-cols-3"},e.createElement("div",{className:"sm:col-span-2"},e.createElement("label",{className:"block text-sm font-medium text-gray-900"},"Title"),e.createElement("input",{type:"text",className:"mt-2 w-full rounded-xl border border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 placeholder:text-gray-400 shadow-sm focus:border-gray-900 focus:outline-none focus:ring-2 focus:ring-gray-900/10",value:f,onChange:t=>I(t.target.value),placeholder:"e.g., iPad Air 64GB (Blue)",required:!0})),e.createElement("div",null,e.createElement("label",{className:"block text-sm font-medium text-gray-900"},"Price"),e.createElement("div",{className:"mt-2 flex items-center rounded-xl border border-gray-300 bg-white px-3 py-2 shadow-sm focus-within:ring-2 focus-within:ring-gray-900/10"},e.createElement("span",{className:"mr-2 text-gray-500"},"$"),e.createElement("input",{type:"text",inputMode:"decimal",className:"w-full text-sm text-gray-900 placeholder:text-gray-400 focus:outline-none",value:n,onChange:L,placeholder:"0",required:!0})),n&&e.createElement("p",{className:"mt-1 text-xs text-gray-500"},T.format(Number(n)||0)))),e.createElement("section",null,e.createElement("label",{className:"block text-sm font-medium text-gray-900"},"Description"),e.createElement("textarea",{className:"mt-2 h-32 w-full resize-none rounded-xl border border-gray-300 bg-white px-3 py-2 text-sm text-gray-900 placeholder:text-gray-400 shadow-sm focus:border-gray-900 focus:outline-none focus:ring-2 focus:ring-gray-900/10",value:v,onChange:t=>F(t.target.value),placeholder:"Add key details, usage, defects, pickup options, etc.",required:!0}),e.createElement("p",{className:"mt-1 text-xs text-gray-500"},"Tip: Clear titles and photos sell faster.")),k&&e.createElement("div",{className:"rounded-xl border border-red-200 bg-red-50 p-3 text-sm text-red-700"},k),e.createElement("div",{className:"flex items-center justify-end gap-2 border-t border-gray-100 pt-4"},e.createElement("button",{type:"button",onClick:()=>E(-1),className:"rounded-xl border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-800 shadow-sm hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-900/10"},"Cancel"),e.createElement("button",{type:"submit",disabled:!S||w||o.some(t=>t.uploading),className:"inline-flex items-center justify-center rounded-xl px-4 py-2 text-sm font-semibold text-white shadow transition disabled:cursor-not-allowed disabled:opacity-60",style:{backgroundColor:(r==null?void 0:r.primary)||"#6b46c1"}},w?"Publishingâ€¦":"Publish Listing")))))):e.createElement("div",{className:"min-h-screen flex items-center justify-center text-sm text-gray-600",style:{backgroundColor:(r==null?void 0:r.bg)||"#f6f3ff"}},"Loadingâ€¦")};export{H as default};
