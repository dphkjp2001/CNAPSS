import{e as S,u as k,b as A,c as P,r as d,R as e}from"./index-39757e52.js";import{a as _,b as D,d as I}from"./academicPosts-01d2e02d.js";import{V,C as E}from"./CommentSection-a9daa3ed.js";import{d as u,r as j}from"./relativeTime-1889a160.js";import"./http-a6fe908c.js";import"./posts-ff58ac93.js";import"./useLoginGate-6a37cb65.js";u.extend(j);u.locale("en");function F(c=""){const a=String(c||"").toLowerCase().replace(/[\s-]+/g,"_");return a.includes("course_material")?"📝":a.includes("study")?"👥":a.includes("coffee")?"☕️":"📌"}function $(){var f,g;const{school:c,id:a}=S(),b=k(),{school:w}=A(),o=c||w||"nyu",{user:n}=P(),[l,m]=d.useState({loading:!0,error:"",post:null});if(d.useEffect(()=>{let s=!0;return(async()=>{try{const r=await _({school:o,id:a});if(!s)return;m({loading:!1,error:"",post:r})}catch(r){if(!s)return;m({loading:!1,error:(r==null?void 0:r.message)||"Failed to load post.",post:null})}})(),()=>{s=!1}},[o,a]),d.useEffect(()=>{if(!n)return;let s=!0;return(async()=>{try{const r=await D({school:o,id:a});if(!s)return;m(h=>({...h,post:r||h.post}))}catch{}})(),()=>{s=!1}},[n,o,a]),l.loading)return e.createElement("div",{className:"max-w-3xl mx-auto px-4 py-6 text-sm text-slate-600"},"Loading…");if(l.error)return e.createElement("div",{className:"max-w-3xl mx-auto px-4 py-6 text-sm text-red-600"},l.error);if(!l.post)return e.createElement("div",{className:"max-w-3xl mx-auto px-4 py-6 text-sm text-slate-600"},"Post not found.");const t=l.post,p=(t.mode||t.postType||t.type||(t.lookingFor?"looking_for":"general")).toString().toLowerCase(),i=p==="general"||p==="question",x=n&&[(f=t.author)==null?void 0:f._id,(g=t.author)==null?void 0:g.id,t.userId,t.authorId].filter(Boolean).map(String).some(s=>String(s)===String(n._id||n.id)),y=Number(t.upCount||0),N=Number(t.downCount||0),v=t.myVote??null,C=async()=>{if(window.confirm("Delete this post?"))try{await I({school:o,id:a}),alert("Post deleted."),b(`/${encodeURIComponent(o)}/dashboard?tab=academic`)}catch(s){alert("Delete failed: "+((s==null?void 0:s.message)||"Unknown error"))}};return e.createElement("div",{className:"max-w-3xl mx-auto px-4 py-6"},e.createElement("article",{className:"bg-white rounded-2xl shadow border border-slate-200 overflow-hidden"},e.createElement("header",{className:"px-5 py-4 border-b border-slate-200"},e.createElement("div",{className:"flex items-start gap-4"},e.createElement("div",{className:"flex-1"},e.createElement("div",{className:"flex items-center justify-between text-sm text-slate-500"},e.createElement("div",{className:"inline-flex items-center gap-2"},e.createElement("span",null,i?"💬":F(t.kind)),e.createElement("span",{className:"font-medium"},i?"General question":"Seeking")),e.createElement("div",{className:"flex items-center gap-3"},e.createElement("time",{dateTime:t.createdAt},u(t.createdAt).fromNow()),x&&e.createElement("button",{onClick:C,className:"ml-2 rounded-xl bg-red-500 px-3 py-1.5 text-xs font-semibold text-white hover:bg-red-600",title:"Delete this post"},"Delete"))),e.createElement("h1",{className:"mt-2 text-2xl font-semibold text-slate-900"},t.title)),i&&e.createElement(V,{school:o,postId:t._id||a,initialCounts:{up:y,down:N},initialVote:v,disabled:!!x,className:"shrink-0"}))),e.createElement("div",{className:"px-5 py-5 whitespace-pre-wrap text-[15px] leading-7 text-slate-800"},t.content),e.createElement("div",{className:"px-5 py-5 border-t border-slate-200 bg-white"},i?e.createElement(E,{postId:t._id||a}):e.createElement(E,{postId:t._id||a,disabled:!0}))))}export{$ as default};
