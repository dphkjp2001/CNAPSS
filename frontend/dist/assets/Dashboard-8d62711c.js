import{u as J,a as Q,b as T,c as V,r as c,l as _,R as e}from"./index-bd2128fc.js";import{d as x,r as X}from"./relativeTime-fc220960.js";import"./en-6c37823e.js";import{u as Y}from"./useLoginGate-9dd6b9d9.js";import{l as Z,g as ee}from"./posts-1c93e0cc.js";import{l as te,g as re}from"./market-22bf1df2.js";import{l as ae,g as se}from"./careerPosts-880391a2.js";x.extend(X);x.locale("en");const le=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0});function fe(){const{token:o}=J(),{school:s,schoolTheme:i}=Q(),{ensureAuth:m}=Y(),a=T(),l=V(),[y,p]=c.useState([]),[R,b]=c.useState(!0),[W,w]=c.useState("");c.useEffect(()=>{let t=!0;if(s)return(async()=>{b(!0),w("");try{let r;o?r=await Z({school:s,token:o}):r=await ee({school:s,page:1,limit:10});const n=Array.isArray(r)?r:Array.isArray(r==null?void 0:r.items)?r.items:[];t&&p(n.slice(0,5))}catch{t&&w("Failed to load posts.")}finally{t&&b(!1)}})(),()=>{t=!1}},[s,o]);const[L,U]=c.useState([]),[$,E]=c.useState(!0),[O,N]=c.useState("");c.useEffect(()=>{let t=!0;if(s)return(async()=>{E(!0),N("");try{let r;o?r=await ae({school:s,token:o}):r=await se({school:s,page:1,limit:10});const n=Array.isArray(r)?r:Array.isArray(r==null?void 0:r.items)?r.items:[];t&&U(n.slice(0,5))}catch{t&&N("Failed to load career posts.")}finally{t&&E(!1)}})(),()=>{t=!1}},[s,o]);const[B,I]=c.useState([]),[D,z]=c.useState([]),[G,h]=c.useState(!0),[v,k]=c.useState("");c.useEffect(()=>{let t=!0;if(s)return(async()=>{h(!0),k("");try{const r=await _({school:s,token:o,limit:5,type:"sale"}),n=Array.isArray(r==null?void 0:r.items)?r.items:Array.isArray(r)?r:[],d=await _({school:s,token:o,limit:5,type:"wanted"}),g=Array.isArray(d==null?void 0:d.items)?d.items:Array.isArray(d)?d:[];if(!t)return;I(n),z(g)}catch{t&&k("Failed to load CourseHub items.")}finally{t&&h(!1)}})(),()=>{t=!1}},[s,o]);const[C,K]=c.useState([]),[q,A]=c.useState(!0),[S,P]=c.useState("");c.useEffect(()=>{let t=!0;if(s)return(async()=>{try{A(!0),P("");let r=[];if(o){const n=await te({school:s,token:o,page:1,limit:4,sort:"latest"});n&&typeof n=="object"&&Array.isArray(n.items)?r=n.items:Array.isArray(n)&&(r=[...n].sort((g,j)=>String(j.createdAt??j._id??"").localeCompare(String(g.createdAt??g._id??""))).slice(0,4))}else{const n=await re({school:s,limit:4});r=(n==null?void 0:n.items)||[]}if(!t)return;K(r.slice(0,4))}catch{t&&P("Failed to load marketplace items.")}finally{t&&A(!1)}})(),()=>{t=!1}},[s,o]);const u={color:(i==null?void 0:i.text)||"#4c1d95"},f={backgroundColor:(i==null?void 0:i.primary)||"#6b46c1"};return e.createElement("div",{className:"min-h-screen px-4 py-6 sm:px-6 lg:px-8",style:{backgroundColor:(i==null?void 0:i.bg)||"#f6f3ff"}},e.createElement("div",{className:"mx-auto w-full max-w-5xl space-y-5"},e.createElement("div",{className:"grid grid-cols-1 gap-5 md:grid-cols-2"},e.createElement("section",{className:"rounded-2xl border border-gray-200 bg-white p-4 sm:p-5 shadow-sm"},e.createElement(F,{title:"Free Board",onTitleClick:()=>a(l("/freeboard")),onWrite:()=>m(()=>a(l("/freeboard/write"))),headerColor:u,primaryBtn:f,writeText:"+ Write Post"}),e.createElement(H,{loading:R,error:W,rows:y,onOpen:t=>m(()=>a(l(`/freeboard/${t}`)))})),e.createElement("section",{className:"rounded-2xl border border-gray-200 bg-white p-4 sm:p-5 shadow-sm"},e.createElement(F,{title:"Career Board",onTitleClick:()=>a(l("/career")),onWrite:()=>m(()=>a(l("/career/write"))),headerColor:u,primaryBtn:f,writeText:"+ Write Post"}),e.createElement(H,{loading:$,error:O,rows:L,onOpen:t=>m(()=>a(l(`/career/${t}`)))}))),e.createElement("section",{className:"rounded-2xl border border-gray-200 bg-white p-4 sm:p-5 shadow-sm"},e.createElement("div",{className:"mb-3 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},e.createElement("h2",{onClick:()=>a(l("/courses")),className:"cursor-pointer text-lg font-semibold sm:text-xl hover:underline",style:u},"CourseHub"),e.createElement("div",{className:"flex w-full justify-end sm:w-auto"},e.createElement("button",{onClick:()=>m(()=>a(l("/courses/write"))),className:"rounded-xl px-4 py-2 text-sm font-semibold text-white shadow",style:f},"+ Upload Post"))),G?e.createElement("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2"},Array.from({length:2}).map((t,r)=>e.createElement("div",{key:r,className:"rounded-xl border p-4"},e.createElement("div",{className:"mb-2 h-5 w-24 animate-pulse rounded bg-gray-100"}),e.createElement("ul",{className:"divide-y divide-gray-100"},Array.from({length:5}).map((n,d)=>e.createElement("li",{key:d,className:"py-2"},e.createElement("div",{className:"flex items-center justify-between"},e.createElement("div",{className:"h-4 w-2/3 animate-pulse rounded bg-gray-100"}),e.createElement("div",{className:"h-3 w-16 animate-pulse rounded bg-gray-100"})))))))):v?e.createElement("div",{className:"rounded-lg bg-red-50 p-3 text-sm text-red-700"},v):e.createElement("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2"},e.createElement(M,{title:"For Sale",items:B,badgeClass:"bg-emerald-100 text-emerald-700",onOpen:t=>a(l(`/courses/materials/${t}`))}),e.createElement(M,{title:"Wanted",items:D,badgeClass:"bg-rose-100 text-rose-700",onOpen:t=>a(l(`/courses/materials/${t}`))}))),e.createElement("section",{className:"rounded-2xl border border-gray-200 bg-white p-4 sm:p-5 shadow-sm"},e.createElement("div",{className:"mb-3 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},e.createElement("h2",{onClick:()=>a(l("/market")),className:"cursor-pointer text-lg font-semibold sm:text-xl hover:underline",style:u},"Marketplace"),e.createElement("div",{className:"flex w-full justify-end sm:w-auto"},e.createElement("button",{onClick:()=>m(()=>a(l("/market/write"))),className:"w-full rounded-xl px-4 py-2 text-sm font-semibold text-white shadow sm:w-auto",style:f},"+ Post an item"))),q?e.createElement("div",{className:"grid grid-cols-2 gap-4 md:grid-cols-4"},Array.from({length:4}).map((t,r)=>e.createElement("div",{key:r,className:"animate-pulse rounded-2xl border border-gray-200/60 bg-white shadow-sm"},e.createElement("div",{className:"aspect-[4/3] w-full rounded-t-2xl bg-gray-100"}),e.createElement("div",{className:"p-4 space-y-3"},e.createElement("div",{className:"h-4 w-3/5 rounded bg-gray-100"}),e.createElement("div",{className:"h-4 w-2/5 rounded bg-gray-100"}),e.createElement("div",{className:"h-3 w-1/2 rounded bg-gray-100"}))))):S?e.createElement("div",{className:"rounded-lg bg-red-50 p-3 text-sm text-red-700"},S):C.length===0?e.createElement("div",{className:"rounded-lg border border-dashed border-gray-300 p-6 text-center text-sm text-gray-600"},"No listings yet."):e.createElement("div",{className:"grid grid-cols-2 gap-4 md:grid-cols-4"},C.slice(0,4).map(t=>{var d;const r=t._id||t.id,n=((d=t.images)==null?void 0:d[0])||t.image||"";return e.createElement("button",{key:r,onClick:()=>a(l(`/market/${r}`)),className:"group block overflow-hidden rounded-2xl border border-gray-200/60 bg-white text-left shadow-sm transition hover:shadow-md focus:outline-none focus:ring-2 focus:ring-gray-900/20"},e.createElement("div",{className:"relative aspect-[4/3] w-full overflow-hidden bg-gray-50"},n?e.createElement("img",{src:n,alt:t.title,className:"h-full w-full object-cover transition duration-300 group-hover:scale-[1.02]",loading:"lazy"}):e.createElement("div",{className:"flex h-full w-full items-center justify-center text-4xl"},"🖼️")),e.createElement("div",{className:"p-4"},e.createElement("h3",{className:"line-clamp-1 text-base font-semibold text-gray-900"},t.title),e.createElement("p",{className:"mt-1 text-sm font-medium text-gray-800"},le.format(Number(t.price)||0)),e.createElement("p",{className:"mt-1 line-clamp-1 text-xs text-gray-500"},t.sellerNickname||"Unknown")))})))))}function F({title:o,onTitleClick:s,onWrite:i,headerColor:m,primaryBtn:a,writeText:l}){return e.createElement("div",{className:"mb-3 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},e.createElement("h2",{onClick:s,className:"cursor-pointer text-lg font-semibold sm:text-xl hover:underline",style:m},o),e.createElement("button",{onClick:i,className:"w-full rounded-xl px-4 py-2 text-sm font-semibold text-white shadow sm:w-auto",style:a},l))}function H({loading:o,error:s,rows:i,onOpen:m}){return o?e.createElement("ul",{className:"space-y-2"},Array.from({length:5}).map((a,l)=>e.createElement("li",{key:l},e.createElement("div",{className:"h-4 w-3/4 animate-pulse rounded bg-gray-100"})))):s?e.createElement("div",{className:"rounded-lg bg-red-50 p-3 text-sm text-red-700"},s):!i||i.length===0?e.createElement("div",{className:"rounded-lg border border-dashed border-gray-300 p-6 text-center text-sm text-gray-600"},"No posts yet. Be the first to write!"):e.createElement("ul",{className:"divide-y divide-gray-100"},i.map(a=>e.createElement("li",{key:a._id,className:"py-2"},e.createElement("button",{onClick:()=>m(a._id),className:"flex w-full items-center justify-between text-left"},e.createElement("h3",{className:"min-w-0 truncate text-sm font-semibold text-gray-900 hover:underline"},a.title),e.createElement("span",{className:"ml-3 shrink-0 text-[11px] text-gray-500"},a.createdAt?x(a.createdAt).fromNow():"")))))}function M({title:o,items:s,badgeClass:i,onOpen:m}){return e.createElement("div",{className:"rounded-xl border p-4 bg-white"},e.createElement("div",{className:"mb-2 text-sm font-semibold text-gray-900"},o),!s||s.length===0?e.createElement("div",{className:"rounded-lg border border-dashed border-gray-300 p-6 text-center text-sm text-gray-600"},"No postings yet."):e.createElement("ul",{className:"divide-y divide-gray-100"},s.map(a=>{const l=a._id||a.id,y=(a.courseCode||a.course||"").toUpperCase(),p=a.professor||"Unknown";return e.createElement("li",{key:l,className:"py-2"},e.createElement("button",{onClick:()=>m(l),className:"flex w-full items-center justify-between text.left hover:opacity-95"},e.createElement("div",{className:"min-w-0"},e.createElement("div",{className:"flex flex-wrap items-center gap-2"},e.createElement("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-[11px] font-semibold ${i}`},o),e.createElement("span",{className:"truncate text-sm font-semibold text-gray-900"},y||"UNKNOWN"),e.createElement("span",{className:"truncate text-xs font-medium text-gray-700"},p)))))})))}export{fe as default};
