import{g as u}from"./index-00f1b752.js";const h="https://api.cnapss.com/api".replace(/\/+$/,"");async function I(e,s={}){let n,o;if(typeof e=="string")n=e,o=s||{};else{const{school:g,...m}=e||{};n=g,o=m}if(!n)throw new Error("school is required");const{token:t,page:r,limit:c,q:i,mine:l,sold:d,cursor:f,...p}=o,a=new URLSearchParams;r!=null&&a.set("page",String(r)),c!=null&&a.set("limit",String(c)),i&&a.set("q",String(i)),l!=null&&a.set("mine",l?"1":"0"),d!=null&&a.set("sold",d?"1":"0"),f&&a.set("cursor",String(f)),Object.entries(p).forEach(([g,m])=>{m!=null&&a.set(g,String(m))});const $=`${h}/${encodeURIComponent(n)}/market`+(a.toString()?`?${a.toString()}`:""),y=t?{Authorization:`Bearer ${t}`}:{},w=await u($,{headers:y});if(!w.ok)throw new Error("failed to load list");return w.json()}async function S({school:e,token:s,id:n}){const o=await u(`${h}/${encodeURIComponent(e)}/market/${encodeURIComponent(n)}`,{headers:s?{Authorization:`Bearer ${s}`}:{}});if(!o.ok)throw new Error("failed to load item");return o.json()}async function R(e,s,n){let o,t,r;if(typeof e=="string")o=e,t=s||{},r=n;else{const{school:l,token:d,data:f,payload:p,...a}=e||{};o=l,r=d,t=f??p??a}if(!o)throw new Error("school is required");const c=await u(`${h}/${encodeURIComponent(o)}/market`,{method:"POST",headers:{"Content-Type":"application/json",...r?{Authorization:`Bearer ${r}`}:{}},body:JSON.stringify(t||{})}),i=await c.json().catch(()=>({}));if(!c.ok)throw new Error((i==null?void 0:i.error)||"failed to create");return i}async function C(e,s,n,o){let t,r,c,i;if(typeof e=="string")t=e,r=s,c=n||{},i=o;else{const{school:f,id:p,token:a,data:$,payload:y,...w}=e||{};t=f,r=p,i=a,c=$??y??w}if(!t||!r)throw new Error("school and id are required");const l=await u(`${h}/${encodeURIComponent(t)}/market/${encodeURIComponent(r)}`,{method:"PUT",headers:{"Content-Type":"application/json",...i?{Authorization:`Bearer ${i}`}:{}},body:JSON.stringify(c||{})}),d=await l.json().catch(()=>({}));if(!l.ok)throw new Error((d==null?void 0:d.error)||"failed to update");return d}async function E({school:e,token:s,id:n}){if(!(await u(`${h}/${encodeURIComponent(e)}/market/${encodeURIComponent(n)}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`}})).ok)throw new Error("failed to delete");return!0}async function U({school:e,token:s,itemId:n}){const o=new URLSearchParams({type:"market",targetId:n}).toString(),t=await u(`${h}/${encodeURIComponent(e)}/request/status?${o}`,{headers:{Authorization:`Bearer ${s}`}});return t.ok?t.json():{alreadySent:!1}}async function q({school:e,token:s,itemId:n,message:o}){const t=await u(`${h}/${encodeURIComponent(e)}/request`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({type:"market",targetId:n,message:String(o||"").trim()})}),r=await t.json().catch(()=>({}));if(t.status===201||t.status===200)return r;if(t.status===409)return{alreadySent:!0,...r};throw new Error((r==null?void 0:r.error)||"request failed")}export{U as a,R as c,E as d,S as g,I as l,q as s,C as u};
