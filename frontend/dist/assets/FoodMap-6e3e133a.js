import{r as m,R as t}from"./index-0f5aaadd.js";import{c as v,l as g,b,e as w,d as N,M as C,T,a as p,P as h,L as E}from"./leaflet-c262d1de.js";function z(a,n,s){n.center!==s.center&&a.setLatLng(n.center),n.radius!=null&&n.radius!==s.radius&&a.setRadius(n.radius)}const x=v(function({center:n,children:s,...l},r){const o=new g.Circle(n,l);return b(o,w(r,{overlayContainer:o}))},z),L=N(function(n,s){const l=new g.Tooltip(n,s.overlayContainer);return b(l,s)},function(n,s,{position:l},r){m.useEffect(function(){const c=s.overlayContainer;if(c==null)return;const{instance:i}=n,d=e=>{e.tooltip===i&&(l!=null&&i.setLatLng(l),i.update(),r(!0))},f=e=>{e.tooltip===i&&r(!1)};return c.on({tooltipopen:d,tooltipclose:f}),c.bindTooltip(i),function(){c.off({tooltipopen:d,tooltipclose:f}),c._map!=null&&c.unbindTooltip()}},[n,s,r,l])});async function S({lat:a,lon:n,radius:s=1500,types:l=["restaurant","cafe","fast food"]}){const r=new URLSearchParams({lat:a,lon:n,radius:s,types:l.join(",")}),o=await fetch(`/api/places/nearby?${r.toString()}`);if(!o.ok)throw new Error("Failed to load places");return o.json()}function M(a){const l=`
    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24">
      <path d="M12 2C8.14 2 5 5.14 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.86-3.14-7-7-7z" fill="hsl(${Math.round(120*a)},80%,45%)"/>
      <circle cx="12" cy="9" r="3.2" fill="white"/>
    </svg>`;return E.divIcon({html:l,iconSize:[28,28],className:""})}const k=E.divIcon({html:`
    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24">
      <path d="M12 2C8.14 2 5 5.14 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.86-3.14-7-7-7z" fill="#6b21a8"/>
      <path d="M7.5 8.2c0-.66.54-1.2 1.2-1.2h6.8c.66 0 1.2.54 1.2 1.2v5.2c0 .66-.54 1.2-1.2 1.2H8.7c-.66 0-1.2-.54-1.2-1.2V8.2zm2 .8h5v.8h-5V9z" fill="white"/>
    </svg>
  `,iconSize:[30,30],className:""});function _(){var f;const a=m.useMemo(()=>({lat:40.729513,lon:-73.997649}),[]),[n,s]=m.useState(null),[l,r]=m.useState(["restaurant","cafe","fast food"]),[o,c]=m.useState(1200),[i,d]=m.useState(!1);return m.useEffect(()=>{d(!0),S({lat:a.lat,lon:a.lon,radius:o,types:l}).then(s).catch(console.error).finally(()=>d(!1))},[a,o,l]),t.createElement("div",{className:"w-full h-[calc(100vh-80px)] flex flex-col"},t.createElement("div",{className:"p-2 flex flex-wrap items-center gap-3 border-b"},t.createElement("div",{className:"text-sm font-semibold"},"Food Map (NYU · Bobst Library)"),t.createElement("label",{className:"text-sm"},"Radius (m):"),t.createElement("input",{className:"border rounded px-2 py-1 w-24",type:"number",min:200,max:3e3,value:o,onChange:e=>c(Number(e.target.value))}),t.createElement("div",{className:"flex gap-3 text-sm"},["restaurant","cafe","fast food"].map(e=>t.createElement("label",{key:e,className:"flex items-center gap-1"},t.createElement("input",{type:"checkbox",checked:l.includes(e),onChange:()=>r(u=>u.includes(e)?u.filter(y=>y!==e):[...u,e])}),e))),i&&t.createElement("span",{className:"text-xs text-gray-500"},"Loading…"),n&&t.createElement("span",{className:"text-xs text-gray-500"},n.count," spots")),t.createElement("div",{className:"flex-1"},t.createElement(C,{center:[a.lat,a.lon],zoom:16,style:{height:"100%",width:"100%"}},t.createElement(T,{attribution:"© OpenStreetMap contributors",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),t.createElement(p,{position:[a.lat,a.lon],icon:k},t.createElement(h,null,"Elmer Holmes Bobst Library (NYU)"),t.createElement(L,{direction:"top",offset:[0,-18],opacity:1,permanent:!0},"Bobst Library")),t.createElement(x,{center:[a.lat,a.lon],radius:80,color:"#6b21a8",fillColor:"#c4b5fd",fillOpacity:.25,weight:2}),t.createElement(x,{center:[a.lat,a.lon],radius:o,color:"#6b21a8",fillOpacity:0,weight:1.5,dashArray:"6 6"}),(f=n==null?void 0:n.items)==null?void 0:f.map(e=>{var u;return t.createElement(p,{key:e.id,position:[e.lat,e.lon],icon:M(e.score)},t.createElement(h,null,t.createElement("div",{className:"space-y-1 text-sm"},t.createElement("div",{className:"font-semibold"},e.name),(u=e.categories)!=null&&u.length?t.createElement("div",{className:"text-xs"},e.categories.join(", ")):null,e.address&&t.createElement("div",{className:"text-xs"},e.address),t.createElement("div",{className:"text-xs"},"Score: ",e.score*100|0,"/100"),typeof e.rating=="number"&&t.createElement("div",{className:"text-xs"},"FSQ Rating: ",e.rating.toFixed(1),"/10"),typeof e.price=="number"&&t.createElement("div",{className:"text-xs"},"Price: ","$".repeat(e.price)),e.opening_hours&&t.createElement("div",{className:"text-xs"},"Hours:"," ",Array.isArray(e.opening_hours)?e.opening_hours.join(" · "):e.opening_hours),t.createElement("div",{className:"flex gap-2 pt-1"},e.website&&t.createElement("a",{className:"text-blue-600 underline text-xs",href:e.website,target:"_blank",rel:"noreferrer"},"Website"),e.phone&&t.createElement("a",{className:"text-blue-600 underline text-xs",href:`tel:${e.phone}`},"Call")))))}))))}export{_ as default};
