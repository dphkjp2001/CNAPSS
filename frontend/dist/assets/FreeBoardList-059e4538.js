import{a as I,u as U,c as W,b as G,d as M,r as d,R as e,P as O}from"./index-5df2c32d.js";import{u as Q}from"./useLoginGate-55750d12.js";import{d as N,r as Z}from"./relativeTime-856d6eb7.js";import"./en-281b3983.js";import{l as $,g as z}from"./posts-9db2ee67.js";N.extend(Z);N.locale("en");const g=20;function H(){return e.createElement("li",{className:"animate-pulse"},e.createElement("div",{className:"h-5 w-2/3 rounded bg-gray-100"}),e.createElement("div",{className:"mt-2 h-3 w-1/3 rounded bg-gray-100"}),e.createElement("div",{className:"mt-3 h-px w-full bg-gray-100"}))}function J({onWrite:f,primary:o}){return e.createElement("div",{className:"rounded-2xl border border-dashed border-gray-300 bg-white p-10 text-center"},e.createElement("div",{className:"mx-auto mb-3 flex h-14 w-14 items-center justify-center rounded-full bg-gray-100 text-2xl"},"ðŸ“"),e.createElement("h3",{className:"text-lg font-semibold text-gray-800"},"No posts yet"),e.createElement("p",{className:"mt-1 text-sm text-gray-500"},"Be the first to start a discussion."),e.createElement("button",{onClick:f,className:"mt-6 inline-flex items-center rounded-xl px-4 py-2 text-sm font-medium text-white shadow focus:outline-none focus:ring-2 focus:ring-offset-0",style:{backgroundColor:o}},"+ Write Post"))}function ee(){const{token:f}=I(),{school:o,schoolTheme:r}=U(),p=W(),y=G(),{ensureAuth:b}=Q(),[n,w]=M(),l=Math.max(1,parseInt(n.get("page")||"1",10)),c=n.get("q")||"",i=n.get("sort")||"new",k=a=>{const t=new URLSearchParams(n.toString());t.set("page",String(a)),w(t,{replace:!0})},L=a=>{const t=new URLSearchParams(n.toString());a?t.set("q",a):t.delete("q"),t.set("page","1"),w(t,{replace:!0})},q=a=>{const t=new URLSearchParams(n.toString());t.set("sort",a),t.set("page","1"),w(t,{replace:!0})},[x,R]=d.useState([]),[j,B]=d.useState(0),[D,v]=d.useState(!0),[S,P]=d.useState("");d.useEffect(()=>{let a=!0;if(o)return(async()=>{v(!0),P("");try{let t;f?t=await $({school:o,page:l,limit:g,q:c,sort:i}):t=await z({school:o,page:l,limit:g,q:c,sort:i});let s=[],h=0;if(t&&typeof t=="object"&&Array.isArray(t.items))s=t.items,h=Number(t.total||0);else if(Array.isArray(t)){const E=(c||"").trim().toLowerCase();s=t.filter(m=>{var u,A;return E?((u=m.title)==null?void 0:u.toLowerCase().includes(E))||((A=m.content)==null?void 0:A.toLowerCase().includes(E)):!0}),s=s.sort((m,u)=>i==="old"?new Date(m.createdAt)-new Date(u.createdAt):new Date(u.createdAt)-new Date(m.createdAt)),h=s.length;const C=(l-1)*g;s=s.slice(C,C+g)}if(!a)return;R(s),B(h)}catch{a&&P("Failed to load posts.")}finally{a&&v(!1)}})(),()=>{a=!1}},[o,f,l,c,i]);const F={color:(r==null?void 0:r.text)||"#111827"},_={backgroundColor:(r==null?void 0:r.primary)||"#111827"};return e.createElement("div",{className:"min-h-screen px-4 py-6 sm:px-6",style:{backgroundColor:(r==null?void 0:r.bg)||"#f6f3ff"}},e.createElement("div",{className:"mx-auto max-w-3xl"},e.createElement("div",{className:"mb-5 flex flex-col justify-between gap-3 sm:flex-row sm:items-center"},e.createElement("h2",{className:"text-2xl font-bold tracking-tight",style:F},"Free Board"),e.createElement("div",{className:"flex w-full flex-col gap-2 sm:w-auto sm:flex-row sm:items-center"},e.createElement("div",{className:"relative sm:w-80"},e.createElement("input",{type:"search",value:c,onChange:a=>L(a.target.value),placeholder:"Search posts",className:"w-full rounded-xl border border-gray-300 bg-white px-3 py-2 text-sm text-gray-800 placeholder:text-gray-400 shadow-sm focus:border-gray-900 focus:outline-none focus:ring-2 focus:ring-gray-900/10","aria-label":"search posts"})),e.createElement("select",{value:i,onChange:a=>q(a.target.value),className:"rounded-xl border border-gray-300 bg-white px-3 py-2 text-sm text-gray-800 shadow-sm focus:border-gray-900 focus:outline-none focus:ring-2 focus:ring-gray-900/10","aria-label":"sort posts"},e.createElement("option",{value:"new"},"Newest"),e.createElement("option",{value:"old"},"Oldest")),e.createElement("button",{onClick:()=>b(()=>y(p("/freeboard/write"))),className:"inline-flex items-center justify-center rounded-xl px-4 py-2 text-sm font-semibold text-white shadow focus:outline-none focus:ring-2 focus:ring-offset-0",style:_},"+ Write Post"))),D?e.createElement("ul",{className:"space-y-4 rounded-2xl border border-gray-200 bg-white p-4 shadow-sm"},Array.from({length:6}).map((a,t)=>e.createElement(H,{key:t}))):S?e.createElement("div",{className:"rounded-xl border border-red-200 bg-red-50 p-3 text-sm text-red-700"},S):x.length===0?e.createElement(J,{onWrite:()=>b(()=>y(p("/freeboard/write"))),primary:(r==null?void 0:r.primary)||"#6b46c1"}):e.createElement(e.Fragment,null,e.createElement("ul",{className:"rounded-2xl border border-gray-200 bg-white shadow-sm"},x.map((a,t)=>e.createElement("li",{key:a._id,className:"px-4 py-4 sm:px-6"},e.createElement("button",{onClick:()=>b(()=>y(p(`/freeboard/${a._id}`))),className:"block w-full text-left"},e.createElement("h3",{className:"line-clamp-2 text-base font-semibold text-gray-900 hover:underline"},a.title),e.createElement("p",{className:"mt-1 text-xs text-gray-500"},"Posted by anonymous â€¢ ",N(a.createdAt).fromNow())),t!==x.length-1&&e.createElement("div",{className:"mt-4 h-px w-full bg-gray-100"})))),e.createElement(O,{page:l,total:Math.max(j,x.length),limit:g,onPageChange:k,siblingCount:1,boundaryCount:1,className:"mb-2",showStatus:!0}))))}export{ee as default};
