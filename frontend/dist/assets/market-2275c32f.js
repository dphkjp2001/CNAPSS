import{h as d}from"./index-ff0a1258.js";const l="https://api.cnapss.com/api".replace(/\/+$/,"");async function I({school:e,limit:s=5}={}){if(!e)throw new Error("school is required");const o=`${l}/public/${encodeURIComponent(e)}/market/recent?limit=${s}`,t=await d(o);if(!t.ok)throw new Error("failed to load public recent");return t.json()}async function S({school:e,page:s=1,pageSize:o=20,q:t="",sort:n="new"}={}){if(!e)throw new Error("school is required");const r=new URLSearchParams;r.set("page",String(s)),r.set("pageSize",String(o)),t&&r.set("q",t),n&&r.set("sort",n);const c=`${l}/public/${encodeURIComponent(e)}/market?${r.toString()}`,i=await d(c);if(!i.ok)throw new Error("failed to load public list");return i.json()}async function E({school:e,id:s}){if(!e)throw new Error("school is required");if(!s)throw new Error("id is required");const o=`${l}/public/${encodeURIComponent(e)}/market/${encodeURIComponent(s)}`,t=await d(o);if(!t.ok)throw new Error("failed to load public item");return t.json()}async function R(e,s={}){let o,t;if(typeof e=="string")o=e,t=s||{};else{const{school:k,...m}=e||{};o=k,t=m}if(!o)throw new Error("school is required");const{token:n,page:r,limit:c,q:i,mine:f,sold:u,cursor:h,...p}=t,a=new URLSearchParams;r!=null&&a.set("page",String(r)),c!=null&&a.set("limit",String(c)),i&&a.set("q",String(i)),f!=null&&a.set("mine",f?"1":"0"),u!=null&&a.set("sold",u?"1":"0"),h&&a.set("cursor",String(h)),Object.entries(p).forEach(([k,m])=>{m!=null&&a.set(k,String(m))});const $=`${l}/${encodeURIComponent(o)}/market`+(a.toString()?`?${a.toString()}`:""),g=n?{Authorization:`Bearer ${n}`}:{},w=await d($,{headers:g});if(!w.ok)throw new Error("failed to load list");return w.json()}async function U({school:e,token:s,id:o}){const t=await d(`${l}/${encodeURIComponent(e)}/market/${encodeURIComponent(o)}`,{headers:s?{Authorization:`Bearer ${s}`}:{}});if(!t.ok)throw new Error("failed to load item");return t.json()}async function q(e,s,o){let t,n,r;if(typeof e=="string")t=e,n=s||{},r=o;else{const{school:f,token:u,data:h,payload:p,...a}=e||{};t=f,r=u,n=h??p??a}if(!t)throw new Error("school is required");const c=await d(`${l}/${encodeURIComponent(t)}/market`,{method:"POST",headers:{"Content-Type":"application/json",...r?{Authorization:`Bearer ${r}`}:{}},body:JSON.stringify(n||{})}),i=await c.json().catch(()=>({}));if(!c.ok)throw new Error((i==null?void 0:i.error)||"failed to create");return i}async function C(e,s,o,t){let n,r,c,i;if(typeof e=="string")n=e,r=s,c=o||{},i=t;else{const{school:h,id:p,token:a,data:$,payload:g,...w}=e||{};n=h,r=p,i=a,c=$??g??w}if(!n||!r)throw new Error("school and id are required");const f=await d(`${l}/${encodeURIComponent(n)}/market/${encodeURIComponent(r)}`,{method:"PUT",headers:{"Content-Type":"application/json",...i?{Authorization:`Bearer ${i}`}:{}},body:JSON.stringify(c||{})}),u=await f.json().catch(()=>({}));if(!f.ok)throw new Error((u==null?void 0:u.error)||"failed to update");return u}async function j({school:e,token:s,id:o}){if(!(await d(`${l}/${encodeURIComponent(e)}/market/${encodeURIComponent(o)}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`}})).ok)throw new Error("failed to delete");return!0}async function b({school:e,token:s,itemId:o}){const t=new URLSearchParams({type:"market",targetId:o}).toString(),n=await d(`${l}/${encodeURIComponent(e)}/request/status?${t}`,{headers:{Authorization:`Bearer ${s}`}});return n.ok?n.json():{alreadySent:!1}}async function P({school:e,token:s,itemId:o,message:t}){const n=await d(`${l}/${encodeURIComponent(e)}/request`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({type:"market",targetId:o,message:String(t||"").trim()})}),r=await n.json().catch(()=>({}));if(n.status===201||n.status===200)return r;if(n.status===409)return{alreadySent:!0,...r};throw new Error((r==null?void 0:r.error)||"request failed")}export{S as a,U as b,q as c,E as d,b as e,j as f,I as g,R as l,P as s,C as u};
