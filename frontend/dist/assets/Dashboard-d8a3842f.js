import{u as B,a as D,b as O,c as z,r as o,l as M,R as e}from"./index-9bd58617.js";import{d as x,r as G}from"./relativeTime-7cce4942.js";import"./en-1e718d96.js";import{u as K}from"./useLoginGate-2fc141e9.js";import{l as q,g as J}from"./posts-e3e3c6e7.js";import{l as Q}from"./market-4bdeb851.js";x.extend(G);x.locale("en");const V=u=>{switch(u){case"personalMaterial":return"personal material";case"personalClassNote":return"personal class note";default:return u||"material"}},X=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0});function se(){const{user:u,token:s}=B(),{school:r,schoolTheme:m}=D(),{ensureAuth:l}=K(),n=O(),c=z(),[g,y]=o.useState([]),[p,w]=o.useState(!0),[h,v]=o.useState("");o.useEffect(()=>{let t=!0;if(r)return(async()=>{w(!0),v("");try{let a;s?a=await q({school:r,token:s}):a=await J({school:r,page:1,limit:10});const d=Array.isArray(a)?a:Array.isArray(a==null?void 0:a.items)?a.items:[];t&&y(d.slice(0,5))}catch{t&&v("Failed to load posts.")}finally{t&&w(!1)}})(),()=>{t=!1}},[r,s]);const[H,L]=o.useState([]),[R,U]=o.useState([]),[W,k]=o.useState(!0),[A,C]=o.useState("");o.useEffect(()=>{let t=!0;if(r)return(async()=>{k(!0),C("");try{const a=await M({school:r,token:s,limit:5,type:"sale"}),d=Array.isArray(a==null?void 0:a.items)?a.items:Array.isArray(a)?a:[],i=await M({school:r,token:s,limit:5,type:"wanted"}),f=Array.isArray(i==null?void 0:i.items)?i.items:Array.isArray(i)?i:[];if(!t)return;L(d),U(f)}catch{t&&C("Failed to load CourseHub items.")}finally{t&&k(!1)}})(),()=>{t=!1}},[r,s]);const[S,$]=o.useState([]),[I,b]=o.useState(!0),[P,j]=o.useState("");o.useEffect(()=>{let t=!0;if(!r||!s){b(!1);return}return(async()=>{b(!0),j("");try{const a=await Q({school:r,token:s,page:1,limit:5,sort:"latest"});let d=[];if(a&&typeof a=="object"&&Array.isArray(a.items)?d=a.items:Array.isArray(a)&&(d=[...a].sort((f,_)=>String(_.createdAt??_._id??"").localeCompare(String(f.createdAt??f._id??""))).slice(0,5)),!t)return;$(d)}catch{t&&j("Failed to load marketplace items.")}finally{t&&b(!1)}})(),()=>{t=!1}},[r,s]);const N={color:(m==null?void 0:m.text)||"#4c1d95"},E={backgroundColor:(m==null?void 0:m.primary)||"#6b46c1"};return e.createElement("div",{className:"min-h-screen px-4 py-6 sm:px-6 lg:px-8",style:{backgroundColor:(m==null?void 0:m.bg)||"#f6f3ff"}},e.createElement("div",{className:"mx-auto w-full max-w-6xl space-y-6"},e.createElement("section",{className:"rounded-2xl border border-gray-200 bg-white p-4 sm:p-6 shadow-sm"},e.createElement("div",{className:"mb-4 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},e.createElement("h2",{onClick:()=>n(c("/courses")),className:"cursor-pointer text-lg font-semibold sm:text-xl hover:underline",style:N},"CourseHub"),e.createElement("div",{className:"flex w-full justify-end sm:w-auto"},e.createElement("button",{onClick:()=>l(()=>n(c("/courses/write"))),className:"rounded-xl px-4 py-2 text-sm font-semibold text-white shadow",style:E},"+ Upload Post"))),W?e.createElement("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2"},Array.from({length:2}).map((t,a)=>e.createElement("div",{key:a,className:"rounded-xl border p-4"},e.createElement("div",{className:"mb-3 h-5 w-24 animate-pulse rounded bg-gray-100"}),e.createElement("ul",{className:"space-y-2"},Array.from({length:5}).map((d,i)=>e.createElement("li",{key:i,className:"flex items-center justify-between"},e.createElement("div",{className:"h-4 w-2/3 animate-pulse rounded bg-gray-100"}),e.createElement("div",{className:"h-3 w-16 animate-pulse rounded bg-gray-100"}))))))):A?e.createElement("div",{className:"rounded-lg bg-red-50 p-3 text-sm text-red-700"},A):e.createElement("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2"},e.createElement(F,{title:"For Sale",items:H,badgeClass:"bg-emerald-100 text-emerald-700",onOpen:t=>n(c(`/courses/materials/${t}`))}),e.createElement(F,{title:"Wanted",items:R,badgeClass:"bg-rose-100 text-rose-700",onOpen:t=>n(c(`/courses/materials/${t}`))}))),e.createElement("section",{className:"rounded-2xl border border-gray-200 bg-white p-4 sm:p-6 shadow-sm"},e.createElement("div",{className:"mb-4 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},e.createElement("h2",{onClick:()=>n(c("/market")),className:"cursor-pointer text-lg font-semibold sm:text-xl hover:underline",style:N},"Marketplace"),e.createElement("div",{className:"flex w-full justify-end sm:w-auto"},e.createElement("button",{onClick:()=>l(()=>n(c("/market/write"))),className:"w-full rounded-xl px-4 py-2 text-sm font-semibold text-white shadow sm:w-auto",style:E},"+ Post an item"))),s?I?e.createElement("div",{className:"grid grid-cols-2 gap-4 sm:grid-cols-3 md:grid-cols-4 xl:grid-cols-5"},Array.from({length:5}).map((t,a)=>e.createElement("div",{key:a,className:"animate-pulse rounded-2xl border border-gray-200/60 bg-white shadow-sm"},e.createElement("div",{className:"aspect-[4/3] w-full rounded-t-2xl bg-gray-100"}),e.createElement("div",{className:"p-4 space-y-3"},e.createElement("div",{className:"h-4 w-3/5 rounded bg-gray-100"}),e.createElement("div",{className:"h-4 w-2/5 rounded bg-gray-100"}),e.createElement("div",{className:"h-3 w-1/2 rounded bg-gray-100"}))))):P?e.createElement("div",{className:"rounded-lg bg-red-50 p-3 text-sm text-red-700"},P):S.length===0?e.createElement("div",{className:"rounded-lg border border-dashed border-gray-300 p-6 text-center text-sm text-gray-600"},"No listings yet."):e.createElement("div",{className:"grid grid-cols-2 gap-4 sm:grid-cols-3 md:grid-cols-4 xl:grid-cols-5"},S.map(t=>{var a;return e.createElement("button",{key:t._id,onClick:()=>n(c(`/market/${t._id}`)),className:"group block overflow-hidden rounded-2xl border border-gray-200/60 bg-white text-left shadow-sm transition hover:shadow-md focus:outline-none focus:ring-2 focus:ring-gray-900/20"},e.createElement("div",{className:"relative aspect-[4/3] w-full overflow-hidden bg-gray-50"},(a=t==null?void 0:t.images)!=null&&a[0]?e.createElement("img",{src:t.images[0],alt:t.title,className:"h-full w-full object-cover transition duration-300 group-hover:scale-[1.02]",loading:"lazy"}):e.createElement("div",{className:"flex h-full w-full items-center justify-center text-4xl"},"🖼️")),e.createElement("div",{className:"p-4"},e.createElement("h3",{className:"line-clamp-1 text-base font-semibold text-gray-900"},t.title),e.createElement("p",{className:"mt-1 text-sm font-medium text-gray-800"},X.format(Number(t.price)||0)),e.createElement("p",{className:"mt-1 line-clamp-1 text-xs text-gray-500"},t.sellerNickname||"Unknown")))})):e.createElement("div",{className:"rounded-lg border border-dashed border-gray-300 p-6 text-center text-sm text-gray-600"},"Log in to see the latest listings.")),e.createElement("section",{className:"rounded-2xl border border-gray-200 bg-white p-4 sm:p-6 shadow-sm"},e.createElement("div",{className:"mb-4 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},e.createElement("h2",{onClick:()=>n(c("/freeboard")),className:"cursor-pointer text-lg font-semibold sm:text-xl hover:underline",style:N},"Free Board"),e.createElement("button",{onClick:()=>l(()=>n(c("/freeboard/write"))),className:"w-full rounded-xl px-4 py-2 text-sm font-semibold text-white shadow sm:w-auto",style:E},"+ Write Post")),p?e.createElement("ul",{className:"space-y-3"},Array.from({length:5}).map((t,a)=>e.createElement("li",{key:a},e.createElement("div",{className:"h-5 w-3/4 animate-pulse rounded bg-gray-100"}),e.createElement("div",{className:"mt-2 h-3 w-1/3 animate-pulse rounded bg-gray-100"})))):h?e.createElement("div",{className:"rounded-lg bg-red-50 p-3 text-sm text-red-700"},h):g.length===0?e.createElement("div",{className:"rounded-lg border border-dashed border-gray-300 p-6 text-center text-sm text-gray-600"},"No posts yet. Be the first to write!"):e.createElement("ul",{className:"divide-y divide-gray-100"},g.map(t=>e.createElement("li",{key:t._id,className:"py-3"},e.createElement("button",{onClick:()=>l(()=>n(c(`/freeboard/${t._id}`))),className:"flex w-full items-center justify-between text-left"},e.createElement("h3",{className:"min-w-0 truncate text-sm font-semibold text-gray-900 sm:text-base hover:underline"},t.title),e.createElement("span",{className:"ml-3 shrink-0 text-xs text-gray-500"},x(t.createdAt).fromNow()))))))))}function F({title:u,items:s,badgeClass:r,onOpen:m}){return e.createElement("div",{className:"rounded-xl border p-4"},e.createElement("div",{className:"mb-2 text-sm font-semibold text-gray-900"},u),!s||s.length===0?e.createElement("div",{className:"rounded-lg border border-dashed border-gray-300 p-6 text-center text-sm text-gray-600"},"No postings yet."):e.createElement("ul",{className:"space-y-2"},s.map(l=>{const n=l._id||l.id,c=(l.courseCode||l.course||"").toUpperCase(),g=l.professor||"Unknown",y=V(l.materialType),p=l.createdAt?x(l.createdAt).fromNow():"";return e.createElement("li",{key:n,className:"rounded-xl border p-3 hover:bg-gray-50"},e.createElement("button",{onClick:()=>m(n),className:"flex w-full items-center justify-between text-left"},e.createElement("div",{className:"min-w-0"},e.createElement("div",{className:"flex flex-wrap items-center gap-2"},e.createElement("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-[11px] font-semibold ${r}`},u),e.createElement("span",{className:"truncate text-sm font-semibold text-gray-900 sm:text-base"},c||"UNKNOWN"),e.createElement("span",{className:"truncate text-xs font-medium text-gray-700 sm:text-sm"},g),e.createElement("span",{className:"truncate text-[11px] text-gray-500 sm:text-xs"},y))),e.createElement("span",{className:"ml-3 shrink-0 text-xs text-gray-400"},p)))})))}export{se as default};
