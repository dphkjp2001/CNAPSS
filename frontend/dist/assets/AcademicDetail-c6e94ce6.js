import{k as _,u as C,c as k,r as p,R as e,f as I,b as P}from"./index-92368696.js";import{a as A,b as D,d as R}from"./academicPosts-e663050b.js";import{C as $}from"./CommentSection-fdc51bb7.js";import{d as N,r as U}from"./relativeTime-24e7854e.js";import"./useLoginGate-6a3cc1ca.js";async function j({school:n,targetId:s,message:c}){const u="https://api.cnapss.com/api".replace(/\/$/,"");return _(`${u}/${n}/request`,{method:"POST",headers:{"Content-Type":"application/json"},body:{targetId:s,initialMessage:c}})}function v({label:n,value:s,selected:c,onChange:u}){return e.createElement("label",{className:"flex items-center gap-3 cursor-pointer select-none"},e.createElement("input",{type:"radio",className:"h-4 w-4 accent-red-500",checked:c===s,onChange:()=>u(s)}),e.createElement("span",{className:"text-sm text-slate-700"},n))}function q({school:n,postId:s,kind:c}){const u=C(),{user:d}=k(),o=c==="course_materials",r=c==="coffee_chat",i=c==="study_mate"||c==="study_group",t=`Hi,
I would love to study with you!
Let me know what days you are thinking of :)`,[l,f]=p.useState("lunch"),[x,E]=p.useState(""),h=p.useMemo(()=>i?t:o?`Hi,
I have the class materials you're looking for. You can get it for ${l==="lunch"?"lunch/dinner":l==="small"?"a small cost":"anything is fine"}.`:r?`Hi,
I can have a coffee chat with you for ${l==="lunch"?"lunch/dinner":l==="small"?"a small cost":"anything is fine"}.`:x||"",[o,r,i,x,l]),[g,b]=p.useState(!1),y=!!s&&!!n&&h.trim().length>0,w=async()=>{if(!d){alert("Please log in to send a message.");return}try{b(!0);const a=await j({school:n,targetId:s,message:i?t:h}),m=a==null?void 0:a.conversationId;u(m?`/${encodeURIComponent(n)}/messages?c=${encodeURIComponent(m)}`:`/${encodeURIComponent(n)}/messages`)}catch(a){alert((a==null?void 0:a.message)||"Failed to send.")}finally{b(!1)}};return e.createElement("aside",{className:"bg-white rounded-2xl shadow border border-slate-200 p-4 h-max"},e.createElement("div",{className:"text-sm text-slate-900 font-semibold mb-1"},"Hi,"),e.createElement("div",{className:"text-sm text-slate-700 mb-3"},o&&"I have the class materials you're looking for. You can get it for",r&&"I can have a coffee chat with you for",i&&"Send a request message:"),(o||r)&&e.createElement("div",{className:"space-y-3 mb-4"},e.createElement(v,{label:"lunch/dinner",value:"lunch",selected:l,onChange:f}),e.createElement(v,{label:"small cost",value:"small",selected:l,onChange:f}),e.createElement(v,{label:"Anything is fine",value:"free",selected:l,onChange:f})),!i&&!(o||r)&&e.createElement("textarea",{value:x,onChange:a=>E(a.target.value),rows:5,className:"w-full rounded-xl border border-slate-300 px-3 py-2 text-sm mb-4",placeholder:"Write a short messageâ€¦"}),e.createElement("div",{className:"mb-3 rounded-lg bg-slate-50 border border-slate-200 p-3 text-xs whitespace-pre-wrap text-slate-700"},h),e.createElement("button",{onClick:w,disabled:g||!y,className:"w-full rounded-xl bg-red-500 text-white font-semibold py-2 shadow hover:bg-red-600 disabled:opacity-60"},i?g?"Sendingâ€¦":"Send a request":g?"Sendingâ€¦":"Send an offer"))}N.extend(U);N.locale("en");function F(n=""){const s=String(n||"").toLowerCase().replace(/[\s-]+/g,"_");return s.includes("course_material")?"ðŸ“":s.includes("study")?"ðŸ‘¥":s.includes("coffee")?"â˜•ï¸":"ðŸ“Œ"}function G(){var g,b,y,w;console.log("ðŸ”µ AcademicList.jsx mounted");const{school:n,id:s}=I(),c=C(),{school:u}=P(),d=n||u||"nyu",{user:o}=k(),[r,i]=p.useState({loading:!0,error:"",post:null});if(p.useEffect(()=>{let a=!0;return(async()=>{try{const m=await A({school:d,id:s});if(!a)return;i({loading:!1,error:"",post:m})}catch(m){if(!a)return;i({loading:!1,error:(m==null?void 0:m.message)||"Failed to load post.",post:null})}})(),()=>{a=!1}},[d,s]),p.useEffect(()=>{if(!o)return;let a=!0;return(async()=>{try{const m=await D({school:d,id:s});if(!a)return;i(S=>({...S,post:m||S.post}))}catch{}})(),()=>{a=!1}},[o,d,s]),r.loading)return e.createElement("div",{className:"max-w-5xl mx-auto px-4 py-6 text-sm text-slate-600"},"Loadingâ€¦");if(r.error)return e.createElement("div",{className:"max-w-5xl mx-auto px-4 py-6 text-sm text-red-600"},r.error);if(!r.post)return e.createElement("div",{className:"max-w-5xl mx-auto px-4 py-6 text-sm text-slate-600"},"Post not found.");const t=r.post,l=(t.mode||t.postType||t.type||(t.lookingFor?"looking_for":"general")).toString().toLowerCase(),f=l==="seeking"||l==="looking_for",x=!f;Number(t.upCount||((g=t.counts)==null?void 0:g.up)||0),Number(t.downCount||((b=t.counts)==null?void 0:b.down)||0),t.myVote;const E=o&&[(y=t.author)==null?void 0:y._id,(w=t.author)==null?void 0:w.id,t.userId,t.authorId].filter(Boolean).map(String).some(a=>String(a)===String(o._id||o.id)),h=async()=>{if(window.confirm("Delete this post?"))try{await R({school:d,id:s}),alert("Post deleted."),c(`/${encodeURIComponent(d)}/dashboard?tab=academic`)}catch(a){alert("Delete failed: "+((a==null?void 0:a.message)||"Unknown error"))}};return e.createElement("div",{className:"max-w-5xl mx-auto px-4 py-6"},e.createElement("div",{className:"grid gap-6 md:grid-cols-[1fr,360px]"},e.createElement("article",{className:"bg-white rounded-2xl shadow border border-slate-200 overflow-hidden"},e.createElement("header",{className:"px-5 py-4 border-b border-slate-200"},e.createElement("div",{className:"flex items-start justify-between gap-4"},e.createElement("div",{className:"flex-1"},e.createElement("div",{className:"flex items-center justify-between text-sm text-slate-500"},e.createElement("div",{className:"inline-flex items-center gap-2"},e.createElement("span",null,f?F(t.kind):"ðŸ’¬"),e.createElement("span",{className:"font-medium"},f?"Seeking":"General question"),t.kind&&e.createElement("span",{className:"text-slate-400"},"â€¢ ",String(t.kind).replace(/_/g," "))),e.createElement("div",{className:"flex items-center gap-3"},e.createElement("time",{dateTime:t.createdAt},N(t.createdAt).fromNow()),E&&e.createElement("button",{onClick:h,className:"ml-2 rounded-xl bg-red-500 px-3 py-1.5 text-xs font-semibold text-white hover:bg-red-600",title:"Delete this post"},"Delete"))),e.createElement("h1",{className:"mt-2 text-2xl font-semibold text-slate-900"},t.title)))),e.createElement("div",{className:"px-5 py-5 whitespace-pre-wrap text-[15px] leading-7 text-slate-800"},t.content),x&&e.createElement("div",{className:"px-5 py-5 border-t border-slate-200 bg-white"},e.createElement($,{postId:t._id||s}))),f?e.createElement(q,{school:d,postId:t._id||s,kind:String(t.kind||"").toLowerCase().replace(/[\s-]+/g,"_")}):null))}export{G as default};
