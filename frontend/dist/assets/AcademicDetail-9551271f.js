import{i as N,p as k,c as E,b,l as w,r as i,R as t,A as _,f as S}from"./index-483aaf6b.js";import{g as q}from"./academic-21f2ae85.js";import{C as A}from"./CommentSection-bab60853.js";import"./relativeTime-acd80e93.js";const y="https://api.cnapss.com/api".replace(/\/$/,"");function C({school:r,targetId:o,initialMessage:e}){return k(`${y}/${r}/request`,{targetId:o,initialMessage:e})}function L({school:r,targetId:o}){const e=new URL(`${y}/${r}/request/exists`);return e.searchParams.set("targetId",o),N(e.toString())}function j({postId:r,authorEmail:o}){const{user:e}=E(),{school:m}=b(),{ensureAuth:u}=w(),[g,s]=i.useState("idle"),[d,x]=i.useState("");i.useEffect(()=>{let n=!0;return(async()=>{if(!(!r||!m||!e))try{s("checking");const a=await L({school:m,targetId:r});if(!n)return;s(a!=null&&a.exists?"already":"idle")}catch{n&&s("idle")}})(),()=>{n=!1}},[m,r,e]);const l=async()=>{if(!e){u();return}const n=d.trim();if(n)try{const a=await C({school:m,targetId:r,initialMessage:n});a!=null&&a.ok?s("sent"):s("error")}catch(a){(a==null?void 0:a.status)===409?s("already"):s("error")}};return e?g==="already"?t.createElement("div",{className:"rounded-xl border bg-green-50 p-4 text-green-800"},"âœ… Youâ€™ve already sent a request. Check your Messages."):g==="sent"?t.createElement("div",{className:"rounded-xl border bg-green-50 p-4 text-green-800"},"âœ… Request sent! The author will receive your message."):t.createElement("div",{className:"rounded-2xl border bg-white p-4 shadow-sm"},t.createElement("div",{className:"mb-2 text-sm font-semibold"},"Send a request to the author"),t.createElement("div",{className:"flex flex-col gap-2 sm:flex-row"},t.createElement("input",{value:d,onChange:n=>x(n.target.value),placeholder:"Introduce yourself (course, schedule, or goal)",className:"flex-1 rounded-lg border px-3 py-2 text-sm"}),t.createElement(_,{onClick:l,className:"rounded-lg bg-gray-900 px-3 py-2 text-sm font-medium text-white hover:bg-black",loadingText:"Sendingâ€¦",disabled:!d.trim()},"Send request")),t.createElement("div",{className:"mt-2 text-xs text-gray-500"},"Only available for Academic â€œLooking forâ€ posts. Comments are disabled.")):t.createElement("div",{className:"rounded-xl border bg-white p-4"},t.createElement("div",{className:"text-sm text-gray-700"},"Log in to send a message to the author."),t.createElement("div",{className:"mt-2 text-xs text-gray-500"},"Youâ€™ll be redirected back after signing in."))}const P={course_planning:"ðŸ“š",homework_help:"ðŸ§©",exam_prep:"ðŸ“",internships:"ðŸ’¼",job_search:"ðŸ’»",visa_opt_cpt:"ðŸªª",housing:"ðŸ ",scholarships:"ðŸŽ“"};function F(){var h,p;const{school:r}=b(),{id:o}=S();E();const[e,m]=i.useState(null),[u,g]=i.useState("");i.useEffect(()=>{let c=!0;return(async()=>{try{g("");const f=await q({school:r,id:o});if(!c)return;m(f)}catch(f){console.error("load academic post failed",f),c&&g("Failed to load post.")}})(),()=>{c=!1}},[r,o]);const s=i.useMemo(()=>String((e==null?void 0:e.mode)||(e==null?void 0:e.kind)||(e==null?void 0:e.type)||(e!=null&&e.lookingFor?"looking_for":"general")).toLowerCase()==="looking_for"?"looking_for":"general",[e]),d=s==="general",x=s==="looking_for",l=((e==null?void 0:e.kind)||(e==null?void 0:e.category)||((h=e==null?void 0:e.meta)==null?void 0:h.kind)||"").toLowerCase(),n=P[l]||"â“",v=d?n:l==="study_group"?"ðŸ‘¥":l==="coffee_chat"?"â˜•ï¸":"ðŸ“";return t.createElement("div",{className:"mx-auto max-w-3xl p-4"},!e&&!u&&t.createElement("div",{className:"text-sm text-gray-600"},"Loadingâ€¦"),u&&t.createElement("div",{className:"rounded-lg bg-red-50 p-3 text-sm text-red-700"},u),e&&t.createElement(t.Fragment,null,t.createElement("div",{className:"rounded-2xl border bg-white p-5 shadow-sm"},t.createElement("div",{className:"mb-2 flex items-center gap-2 text-sm"},t.createElement("span",{className:"inline-flex h-6 w-6 items-center justify-center rounded-full bg-gray-900 text-white font-bold"},v),t.createElement("span",{className:"rounded-full border px-2 py-0.5 text-xs"},"Academic â€¢ ",d?"General question":"Looking for"),l&&t.createElement("span",{className:"rounded-full border px-2 py-0.5 text-xs"},String(l).replace(/_/g," "))),t.createElement("h1",{className:"text-xl font-bold text-gray-900"},e.title),((p=e.images)==null?void 0:p.length)>0&&t.createElement("div",{className:"mt-3 grid grid-cols-2 gap-2"},e.images.map(c=>t.createElement("img",{key:c,src:c,alt:"",className:"rounded-lg border object-cover"}))),t.createElement("div",{className:"mt-4 whitespace-pre-wrap text-sm text-gray-800"},e.content)),x?t.createElement("div",{className:"mt-6"},t.createElement(j,{postId:e._id,authorEmail:e.email})):t.createElement(A,{postId:e._id,authorEmail:e.email})))}export{F as default};
