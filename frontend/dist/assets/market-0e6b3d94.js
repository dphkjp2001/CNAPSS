import{a as l}from"./http-08c7d507.js";const u="https://api.cnapss.com/api".replace(/\/+$/,"");async function S({school:e,limit:s=5}={}){if(!e)throw new Error("school is required");const n=`${u}/public/${encodeURIComponent(e)}/market/recent?limit=${s}`,t=await l(n);if(!t.ok)throw new Error("failed to load public recent");return t.json()}async function I({school:e,page:s=1,pageSize:n=20,q:t="",sort:o="new"}={}){if(!e)throw new Error("school is required");const r=new URLSearchParams;r.set("page",String(s)),r.set("pageSize",String(n)),t&&r.set("q",t),o&&r.set("sort",o);const c=`${u}/public/${encodeURIComponent(e)}/market?${r.toString()}`,a=await l(c);if(!a.ok)throw new Error("failed to load public list");return a.json()}async function R(e,s={}){let n,t;if(typeof e=="string")n=e,t=s||{};else{const{school:y,...m}=e||{};n=y,t=m}if(!n)throw new Error("school is required");const{token:o,page:r,limit:c,q:a,mine:f,sold:d,cursor:h,...p}=t,i=new URLSearchParams;r!=null&&i.set("page",String(r)),c!=null&&i.set("limit",String(c)),a&&i.set("q",String(a)),f!=null&&i.set("mine",f?"1":"0"),d!=null&&i.set("sold",d?"1":"0"),h&&i.set("cursor",String(h)),Object.entries(p).forEach(([y,m])=>{m!=null&&i.set(y,String(m))});const $=`${u}/${encodeURIComponent(n)}/market`+(i.toString()?`?${i.toString()}`:""),g=o?{Authorization:`Bearer ${o}`}:{},w=await l($,{headers:g});if(!w.ok)throw new Error("failed to load list");return w.json()}async function E({school:e,token:s,id:n}){const t=await l(`${u}/${encodeURIComponent(e)}/market/${encodeURIComponent(n)}`,{headers:s?{Authorization:`Bearer ${s}`}:{}});if(!t.ok)throw new Error("failed to load item");return t.json()}async function U(e,s,n){let t,o,r;if(typeof e=="string")t=e,o=s||{},r=n;else{const{school:f,token:d,data:h,payload:p,...i}=e||{};t=f,r=d,o=h??p??i}if(!t)throw new Error("school is required");const c=await l(`${u}/${encodeURIComponent(t)}/market`,{method:"POST",headers:{"Content-Type":"application/json",...r?{Authorization:`Bearer ${r}`}:{}},body:JSON.stringify(o||{})}),a=await c.json().catch(()=>({}));if(!c.ok)throw new Error((a==null?void 0:a.error)||"failed to create");return a}async function q(e,s,n,t){let o,r,c,a;if(typeof e=="string")o=e,r=s,c=n||{},a=t;else{const{school:h,id:p,token:i,data:$,payload:g,...w}=e||{};o=h,r=p,a=i,c=$??g??w}if(!o||!r)throw new Error("school and id are required");const f=await l(`${u}/${encodeURIComponent(o)}/market/${encodeURIComponent(r)}`,{method:"PUT",headers:{"Content-Type":"application/json",...a?{Authorization:`Bearer ${a}`}:{}},body:JSON.stringify(c||{})}),d=await f.json().catch(()=>({}));if(!f.ok)throw new Error((d==null?void 0:d.error)||"failed to update");return d}async function C({school:e,token:s,id:n}){if(!(await l(`${u}/${encodeURIComponent(e)}/market/${encodeURIComponent(n)}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`}})).ok)throw new Error("failed to delete");return!0}async function j({school:e,token:s,itemId:n}){const t=new URLSearchParams({type:"market",targetId:n}).toString(),o=await l(`${u}/${encodeURIComponent(e)}/request/status?${t}`,{headers:{Authorization:`Bearer ${s}`}});return o.ok?o.json():{alreadySent:!1}}async function b({school:e,token:s,itemId:n,message:t}){const o=await l(`${u}/${encodeURIComponent(e)}/request`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({type:"market",targetId:n,message:String(t||"").trim()})}),r=await o.json().catch(()=>({}));if(o.status===201||o.status===200)return r;if(o.status===409)return{alreadySent:!0,...r};throw new Error((r==null?void 0:r.error)||"request failed")}export{I as a,E as b,U as c,j as d,C as e,S as g,R as l,b as s,q as u};
