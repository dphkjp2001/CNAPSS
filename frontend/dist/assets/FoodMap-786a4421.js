import{r as i,R as t}from"./index-97226d42.js";import{c as C,l as E,b as y,e as M,d as T,L as v,M as L,T as S,a as h,P as g}from"./leaflet-231b45da.js";function R(s,n,a){n.center!==a.center&&s.setLatLng(n.center),n.radius!=null&&n.radius!==a.radius&&s.setRadius(n.radius)}const b=C(function({center:n,children:a,...l},o){const d=new E.Circle(n,l);return y(d,M(o,{overlayContainer:d}))},R),z=T(function(n,a){const l=new E.Tooltip(n,a.overlayContainer);return y(l,a)},function(n,a,{position:l},o){i.useEffect(function(){const r=a.overlayContainer;if(r==null)return;const{instance:m}=n,u=p=>{p.tooltip===m&&(l!=null&&m.setLatLng(l),m.update(),o(!0))},f=p=>{p.tooltip===m&&o(!1)};return r.on({tooltipopen:u,tooltipclose:f}),r.bindTooltip(m),function(){r.off({tooltipopen:u,tooltipclose:f}),r._map!=null&&r.unbindTooltip()}},[n,a,o,l])}),$="https://api.cnapss.com/api";async function k({lat:s,lon:n,radius:a=1500,types:l=["restaurant","cafe","fast food"],minRating:o=0,minReviews:d=0,sortBy:r="best_match"}){const m=new URLSearchParams({lat:s,lon:n,radius:a,types:l.join(","),minRating:o,minReviews:d,sortBy:r}),u=await fetch(`${$}/places/nearby?${m.toString()}`);if(!u.ok){const f=await u.text().catch(()=>"");throw new Error(`Failed to load places: ${u.status} ${f}`)}return u.json()}function B(s=0){const n=Number.isFinite(s)?s:0,a=28,l=Math.round(120*n),o=`
    <svg xmlns="http://www.w3.org/2000/svg" width="${a}" height="${a}" viewBox="0 0 24 24">
      <path d="M12 2C8.14 2 5 5.14 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.86-3.14-7-7-7z" fill="hsl(${l},80%,45%)"/>
      <circle cx="12" cy="9" r="3.2" fill="white"/>
    </svg>`;return v.divIcon({html:o,iconSize:[a,a],className:""})}function P(){const s=i.useMemo(()=>({lat:40.729513,lon:-73.997649}),[]),n=i.useMemo(()=>v.divIcon({html:`
        <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24">
          <path d="M12 2C8.14 2 5 5.14 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.86-3.14-7-7-7z" fill="#6b21a8"/>
          <path d="M7.5 8.2c0-.66.54-1.2 1.2-1.2h6.8c.66 0 1.2.54 1.2 1.2v5.2c0 .66-.54 1.2-1.2 1.2H8.7c-.66 0-1.2-.54-1.2-1.2V8.2zm2 .8h5v.8h-5V9z" fill="white"/>
        </svg>`,iconSize:[30,30],className:""}),[]),[a,l]=i.useState(null),[o,d]=i.useState(["restaurant","cafe","fast food"]),[r,m]=i.useState(1200),[u,f]=i.useState(!1),[p,x]=i.useState("");i.useEffect(()=>{let e=!1;return(async()=>{try{f(!0),x("");const c=await k({lat:s.lat,lon:s.lon,radius:r,types:o,minRating:4,minReviews:50,sortBy:"rating"});e||l(c)}catch(c){console.error(c),e||x("Failed to load places.")}finally{e||f(!1)}})(),()=>{e=!0}},[s,r,o]);const w=i.useMemo(()=>((a==null?void 0:a.items)||[]).filter(e=>Number.isFinite(e.lat)&&Number.isFinite(e.lon)),[a]);return t.createElement("div",{className:"w-full h-[calc(100vh-80px)] flex flex-col"},t.createElement("div",{className:"p-2 flex flex-wrap items-center gap-3 border-b"},t.createElement("div",{className:"text-sm font-semibold"},"Food Map (NYU · Bobst Library)"),t.createElement("label",{className:"text-sm"},"Radius (m):"),t.createElement("input",{className:"border rounded px-2 py-1 w-24",type:"number",min:200,max:3e3,value:r,onChange:e=>m(Number(e.target.value))}),t.createElement("div",{className:"flex gap-3 text-sm"},["restaurant","cafe","fast food"].map(e=>t.createElement("label",{key:e,className:"flex items-center gap-1"},t.createElement("input",{type:"checkbox",checked:o.includes(e),onChange:()=>d(c=>c.includes(e)?c.filter(N=>N!==e):[...c,e])}),e))),u&&t.createElement("span",{className:"text-xs text-gray-500"},"Loading…"),a&&t.createElement("span",{className:"text-xs text-gray-500"},a.count," spots"),p&&t.createElement("span",{className:"text-xs text-red-500"},p)),t.createElement("div",{className:"flex-1"},t.createElement(L,{center:[s.lat,s.lon],zoom:16,style:{height:"100%",width:"100%"}},t.createElement(S,{attribution:"© OpenStreetMap contributors",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),t.createElement(h,{position:[s.lat,s.lon],icon:n},t.createElement(g,null,"Elmer Holmes Bobst Library (NYU)"),t.createElement(z,{direction:"top",offset:[0,-18],opacity:1,permanent:!0},"Bobst Library")),t.createElement(b,{center:[s.lat,s.lon],radius:80,color:"#6b21a8",fillColor:"#c4b5fd",fillOpacity:.25,weight:2}),t.createElement(b,{center:[s.lat,s.lon],radius:r,color:"#6b21a8",fillOpacity:0,weight:1.5,dashArray:"6 6"}),w.map(e=>{var c;return t.createElement(h,{key:e.id,position:[e.lat,e.lon],icon:B(e.score)},t.createElement(g,null,t.createElement("div",{className:"space-y-1 text-sm"},t.createElement("div",{className:"font-semibold"},e.name),(c=e.categories)!=null&&c.length?t.createElement("div",{className:"text-xs"},e.categories.join(", ")):null,e.address&&t.createElement("div",{className:"text-xs"},e.address),t.createElement("div",{className:"text-xs"},"Score: ",Math.max(0,Math.floor((e.score||0)*100)),"/100"),typeof e.rating=="number"&&t.createElement("div",{className:"text-xs"},"Rating: ",e.rating.toFixed(1),"/5"),typeof e.price=="number"&&t.createElement("div",{className:"text-xs"},"Price: ","$".repeat(e.price)),e.opening_hours&&t.createElement("div",{className:"text-xs"},"Hours:"," ",Array.isArray(e.opening_hours)?e.opening_hours.join(" · "):e.opening_hours),t.createElement("div",{className:"flex gap-2 pt-1"},e.website&&t.createElement("a",{className:"text-blue-600 underline text-xs",href:e.website,target:"_blank",rel:"noreferrer"},"Yelp Page"),e.phone&&t.createElement("a",{className:"text-blue-600 underline text-xs",href:`tel:${e.phone}`},"Call")),t.createElement("div",{className:"text-[10px] text-gray-400 pt-1"},"Ratings & reviews data © Yelp"))))}))))}export{P as default};
