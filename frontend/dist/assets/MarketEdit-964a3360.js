import{e as N,u as v,a as x,b as k,r as i,R as t}from"./index-0f5aaadd.js";import{a as h}from"./axios-b5ee139b.js";import{u as C}from"./uploadToCloudinary-a2ae08d3.js";const R=()=>{const{id:n}=N(),o=v(),{user:c}=x(),{schoolTheme:m}=k(),u="https://api.cnapss.com/api",[s,d]=i.useState({title:"",description:"",price:"",images:[]}),[b,p]=i.useState(!0),[f,y]=i.useState([]);i.useEffect(()=>{(async()=>{try{const a=(await h.get(`${u}/market/${n}`)).data;a.seller!==(c==null?void 0:c.email)&&(alert("권한이 없습니다."),o("/market")),d({title:a.title,description:a.description,price:a.price,images:a.images||[]}),p(!1)}catch(e){console.error(e),alert("글을 불러오는 데 실패했습니다."),o("/market")}})()},[n,c,o,u]);const g=r=>{const{name:e,value:a}=r.target;d(l=>({...l,[e]:a}))},E=r=>{const e=Array.from(r.target.files).slice(0,3);y(e),d(a=>({...a,images:e.map(l=>URL.createObjectURL(l))}))},w=async r=>{r.preventDefault();try{p(!0);let e=s.images;if(f.length>0){e=[];for(const a of f){const l=await C(a);e.push(l)}}await h.put(`${u}/market/${n}`,{...s,price:parseFloat(s.price),images:e}),o(`/market/${n}`)}catch{alert("수정 실패")}finally{p(!1)}};return b?t.createElement("div",{className:"p-6"},"로딩 중..."):t.createElement("div",{className:"min-h-screen p-6",style:{backgroundColor:m.bg}},t.createElement("div",{className:"max-w-xl mx-auto bg-white p-6 rounded shadow"},t.createElement("h2",{className:"text-xl font-bold mb-4",style:{color:m.text}},"판매 글 수정"),t.createElement("form",{onSubmit:w,className:"space-y-4"},t.createElement("input",{name:"title",value:s.title,onChange:g,className:"w-full border p-2 rounded",required:!0}),t.createElement("textarea",{name:"description",value:s.description,onChange:g,className:"w-full border p-2 rounded",required:!0}),t.createElement("input",{name:"price",type:"number",value:s.price,onChange:g,className:"w-full border p-2 rounded",required:!0}),t.createElement("div",null,t.createElement("label",{className:"block font-semibold"},"이미지 (최대 3장)"),t.createElement("input",{type:"file",accept:"image/*",multiple:!0,onChange:E}),t.createElement("div",{className:"flex gap-2 mt-2"},s.images.map((r,e)=>t.createElement("img",{key:e,src:r,alt:`미리보기-${e}`,className:"w-24 h-24 object-cover rounded border"})))),t.createElement("button",{type:"submit",className:"w-full text-white py-2 rounded",style:{backgroundColor:m.primary}},"저장하기"))))};export{R as default};
