import{l}from"./index-d9a6069a.js";const u="https://api.cnapss.com/api".replace(/\/+$/,"");async function S({school:e,page:s=1,pageSize:n=20,q:t="",sort:o="new"}={}){if(!e)throw new Error("school is required");const r=new URLSearchParams;r.set("page",String(s)),r.set("pageSize",String(n)),t&&r.set("q",t),o&&r.set("sort",o);const c=`${u}/public/${encodeURIComponent(e)}/market?${r.toString()}`,i=await l(c);if(!i.ok)throw new Error("failed to load public list");return i.json()}async function I({school:e,id:s}){if(!e)throw new Error("school is required");if(!s)throw new Error("id is required");const n=`${u}/public/${encodeURIComponent(e)}/market/${encodeURIComponent(s)}`,t=await l(n);if(!t.ok)throw new Error("failed to load public item");return t.json()}async function E(e,s={}){let n,t;if(typeof e=="string")n=e,t=s||{};else{const{school:y,...m}=e||{};n=y,t=m}if(!n)throw new Error("school is required");const{token:o,page:r,limit:c,q:i,mine:f,sold:d,cursor:h,...p}=t,a=new URLSearchParams;r!=null&&a.set("page",String(r)),c!=null&&a.set("limit",String(c)),i&&a.set("q",String(i)),f!=null&&a.set("mine",f?"1":"0"),d!=null&&a.set("sold",d?"1":"0"),h&&a.set("cursor",String(h)),Object.entries(p).forEach(([y,m])=>{m!=null&&a.set(y,String(m))});const $=`${u}/${encodeURIComponent(n)}/market`+(a.toString()?`?${a.toString()}`:""),g=o?{Authorization:`Bearer ${o}`}:{},w=await l($,{headers:g});if(!w.ok)throw new Error("failed to load list");return w.json()}async function R({school:e,token:s,id:n}){const t=await l(`${u}/${encodeURIComponent(e)}/market/${encodeURIComponent(n)}`,{headers:s?{Authorization:`Bearer ${s}`}:{}});if(!t.ok)throw new Error("failed to load item");return t.json()}async function U(e,s,n){let t,o,r;if(typeof e=="string")t=e,o=s||{},r=n;else{const{school:f,token:d,data:h,payload:p,...a}=e||{};t=f,r=d,o=h??p??a}if(!t)throw new Error("school is required");const c=await l(`${u}/${encodeURIComponent(t)}/market`,{method:"POST",headers:{"Content-Type":"application/json",...r?{Authorization:`Bearer ${r}`}:{}},body:JSON.stringify(o||{})}),i=await c.json().catch(()=>({}));if(!c.ok)throw new Error((i==null?void 0:i.error)||"failed to create");return i}async function q(e,s,n,t){let o,r,c,i;if(typeof e=="string")o=e,r=s,c=n||{},i=t;else{const{school:h,id:p,token:a,data:$,payload:g,...w}=e||{};o=h,r=p,i=a,c=$??g??w}if(!o||!r)throw new Error("school and id are required");const f=await l(`${u}/${encodeURIComponent(o)}/market/${encodeURIComponent(r)}`,{method:"PUT",headers:{"Content-Type":"application/json",...i?{Authorization:`Bearer ${i}`}:{}},body:JSON.stringify(c||{})}),d=await f.json().catch(()=>({}));if(!f.ok)throw new Error((d==null?void 0:d.error)||"failed to update");return d}async function C({school:e,token:s,id:n}){if(!(await l(`${u}/${encodeURIComponent(e)}/market/${encodeURIComponent(n)}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`}})).ok)throw new Error("failed to delete");return!0}async function j({school:e,token:s,itemId:n}){const t=new URLSearchParams({type:"market",targetId:n}).toString(),o=await l(`${u}/${encodeURIComponent(e)}/request/status?${t}`,{headers:{Authorization:`Bearer ${s}`}});return o.ok?o.json():{alreadySent:!1}}async function b({school:e,token:s,itemId:n,message:t}){const o=await l(`${u}/${encodeURIComponent(e)}/request`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({type:"market",targetId:n,message:String(t||"").trim()})}),r=await o.json().catch(()=>({}));if(o.status===201||o.status===200)return r;if(o.status===409)return{alreadySent:!0,...r};throw new Error((r==null?void 0:r.error)||"request failed")}export{R as a,I as b,U as c,j as d,C as e,S as g,E as l,b as s,q as u};
