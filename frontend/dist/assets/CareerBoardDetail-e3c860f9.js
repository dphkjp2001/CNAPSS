import{f as _,a as I,g as T,c as $,e as B,u as z,b as G,r as o,R as e,h as M}from"./index-17793bbb.js";import{C as O}from"./CommentSection-4a8bbe72.js";import{d as x,r as Y}from"./relativeTime-5347d2c1.js";import"./en-7cb5942d.js";import{a as q,b as H,d as J,t as K,u as Q}from"./careerPosts-ec3514b7.js";x.extend(Y);x.locale("en");function te(){var L;const{id:d}=_(),h=I(),E=T(),{user:a,token:w}=$(),{ensureAuth:u}=B(),{school:s,schoolTheme:n}=z(),C=G(),[r,g]=o.useState(null),[v,j]=o.useState(""),[i,f]=o.useState(!1),[N,p]=o.useState(""),[k,y]=o.useState(""),[S,U]=o.useState(!1),P=async()=>{try{const t=w?await q({school:s,id:d}):await H({school:s,id:d});g(t),p((t==null?void 0:t.title)||""),y((t==null?void 0:t.content)||"")}catch(t){j(t.message||"Failed to load the post.")}};o.useEffect(()=>{P()},[d,s,w]),o.useEffect(()=>{const c=new URLSearchParams(E.search).get("nid");async function l(){if(!(!c||!(a!=null&&a.email)||!s))try{const b="https://api.cnapss.com/api".replace(/\/+$/,"");await M(`${b}/${s}/notification/mark-read`,{method:"POST",headers:{"Content-Type":"application/json"},body:{commentId:c,email:a.email}})}catch{}}l()},[E.search,a==null?void 0:a.email,s]);const m=o.useMemo(()=>((a==null?void 0:a.email)||"").toLowerCase()===((r==null?void 0:r.email)||"").toLowerCase(),[a,r]),D=async()=>{u(async()=>{if(window.confirm("Delete this post?"))try{await J({school:s,id:r._id}),alert("Post deleted."),h(C("/career"))}catch(t){alert("Delete failed: "+(t.message||"Unknown error"))}})},F=async()=>{u(async()=>{try{await K({school:s,id:r._id}),g(t=>t&&{...t,thumbsUpUsers:(t.thumbsUpUsers||[]).includes(((a==null?void 0:a.email)||"").toLowerCase())?t.thumbsUpUsers.filter(c=>c.toLowerCase()!==((a==null?void 0:a.email)||"").toLowerCase()):[...t.thumbsUpUsers||[],((a==null?void 0:a.email)||"").toLowerCase()]}),await P()}catch(t){alert("Failed to like: "+(t.message||"Unknown error"))}})},A=async()=>{u(async()=>{const t=N.trim(),c=k.trim();if(!(!t||!c)){U(!0);try{const l=await Q({school:s,id:r._id,title:t,content:c}),b=(l==null?void 0:l.post)||l;g(b),f(!1)}catch(l){alert("Update failed: "+(l.message||"Unknown error"))}finally{U(!1)}}})},R=()=>{p((r==null?void 0:r.title)||""),y((r==null?void 0:r.content)||""),f(!1)};return v?e.createElement("div",{className:"flex min-h-screen items-center justify-center text-sm text-red-700",style:{backgroundColor:(n==null?void 0:n.bg)||"#f6f3ff"}},v):r?e.createElement("div",{className:"min-h-screen px-4 py-6 sm:px-6",style:{backgroundColor:(n==null?void 0:n.bg)||"#f6f3ff"}},e.createElement("div",{className:"mx-auto max-w-3xl"},e.createElement("div",{className:"overflow-hidden rounded-2xl border border-gray-200 bg-white shadow-sm"},e.createElement("div",{className:"border-b border-gray-100 p-5 sm:p-6"},i?e.createElement("input",{value:N,onChange:t=>p(t.target.value),placeholder:"Title",className:"w-full rounded-xl border border-gray-300 px-3 py-2 text-lg font-semibold text-gray-900 focus:border-gray-900 focus:ring-2 focus:ring-gray-900/10"}):e.createElement("h1",{className:"text-2xl font-bold text-gray-900"},r.title),e.createElement("p",{className:"mt-1 text-sm text-gray-500"},"Posted by ",e.createElement("span",{className:"font-medium"},"anonymous")," ‚Ä¢ ",x(r.createdAt).fromNow())),e.createElement("div",{className:"p-5 sm:p-6"},i?e.createElement("textarea",{value:k,onChange:t=>y(t.target.value),placeholder:"Content",className:"h-56 w-full resize-y rounded-xl border border-gray-300 px-3 py-2 text-sm text-gray-800 focus:border-gray-900 focus:ring-2 focus:ring-gray-900/10"}):e.createElement("div",{className:"prose max-w-none whitespace-pre-wrap text-sm text-gray-900"},r.content)),e.createElement("div",{className:"flex items-center justify-between border-t border-gray-100 px-5 py-3 sm:px-6"},e.createElement("div",{className:"flex items-center gap-2"},e.createElement("button",{onClick:F,disabled:m,className:"rounded-lg border px-3 py-1 text-sm hover:bg-gray-50 disabled:opacity-60",title:m?"You can‚Äôt like your own post.":"Like post"},"üëç Like"),e.createElement("span",{className:"text-xs text-gray-500"},((L=r.thumbsUpUsers)==null?void 0:L.length)||0," likes")),e.createElement("div",{className:"flex items-center gap-2"},m&&!i&&e.createElement(e.Fragment,null,e.createElement("button",{onClick:()=>f(!0),className:"rounded-lg border px-3 py-1 text-sm hover:bg-gray-50"},"‚úèÔ∏è Edit"),e.createElement("button",{onClick:D,className:"rounded-lg border px-3 py-1 text-sm text-red-600 hover:bg-red-50"},"üóëÔ∏è Delete")),m&&i&&e.createElement(e.Fragment,null,e.createElement("button",{onClick:A,disabled:S,className:"rounded-lg border px-3 py-1 text-sm text-white",style:{backgroundColor:"#111827"}},S?"Saving...":"Save"),e.createElement("button",{onClick:R,className:"rounded-lg border px-3 py-1 text-sm"},"Cancel")))),e.createElement("div",{className:"border-t border-gray-100 p-5 sm:p-6"},e.createElement(O,{postId:r._id,authorEmail:r.email}))),e.createElement("div",{className:"mt-6"},e.createElement("button",{onClick:()=>h(C("/career")),className:"text-sm text-gray-600 hover:underline"},"‚Üê Back to list")))):e.createElement("div",{className:"flex min-h-screen items-center justify-center text-sm text-gray-600",style:{backgroundColor:(n==null?void 0:n.bg)||"#f6f3ff"}},"Loading‚Ä¶")}export{te as default};
