import{u as k,r as i,R as e,a as C,b as S,c as M,N as A,L as u,d as v,e as P}from"./index-808f52da.js";import{l as L,g as $}from"./posts-a526a031.js";import{u as O}from"./useLoginGate-b5ea3a07.js";import{g as j}from"./schedule-a23efbaf.js";import{M as F,T as _,a as R,P as U}from"./leaflet-a1517919.js";import"./en-afea8aa1.js";const D=n=>n>=8?"fall":n>=5?"summer":"spring";function H(){const n=new Date,f=n.getFullYear(),p=D(n.getMonth()+1);return`${f}-${p}`}function z({school:n,primary:f="#6b46c1",textColor:p="#111827",ensureAuth:o,schoolPath:s,navigate:x}){const{token:a}=k(),[c,b]=i.useState(H()),[N,w]=i.useState(!1),[g,d]=i.useState([]);i.useEffect(()=>{let t=!0;if(!a||!n||!c){d([]);return}return(async()=>{try{w(!0);const l=await j({school:n,token:a,semester:c}),r=Array.isArray(l==null?void 0:l.slots)?l.slots:[],E=Array.from(new Set(r.map(m=>(m.label||"").trim()).filter(Boolean))).slice(0,5);t&&d(E)}catch{t&&d([])}finally{t&&w(!1)}})(),()=>{t=!1}},[a,n,c]);const h=i.useMemo(()=>{const l=new Date().getFullYear();return Array.from(new Set([`${l-1}-fall`,`${l}-spring`,`${l}-summer`,`${l}-fall`,`${l+1}-spring`]))},[]);return e.createElement("div",{className:"h-full rounded-2xl border border-sand bg-white p-6 shadow-md"},e.createElement("div",{className:"mb-4 flex items-center justify-between"},e.createElement("h2",{className:"text-2xl font-bold",style:{color:p}},"Course Hub"),e.createElement("div",{className:"flex items-center gap-2"},e.createElement("select",{value:c,onChange:t=>b(t.target.value),className:"rounded-lg border px-2 py-1 text-xs",title:"Semester"},h.map(t=>e.createElement("option",{key:t,value:t},t))),e.createElement("button",{onClick:()=>o(()=>x(s("/courses"))),className:"text-sm text-blue-600 hover:underline"},"Browse all"))),a?N?e.createElement("ul",{className:"space-y-3"},Array.from({length:4}).map((t,l)=>e.createElement("li",{key:l,className:"animate-pulse"},e.createElement("div",{className:"h-5 w-3/4 rounded bg-gray-100"}),e.createElement("div",{className:"mt-2 h-3 w-1/3 rounded bg-gray-100"})))):g.length===0?e.createElement("div",{className:"rounded-lg border border-dashed border-gray-200 p-4 text-sm text-gray-600"},"No courses in your ",e.createElement("b",null,c)," schedule yet.",e.createElement("button",{onClick:()=>o(()=>x(s("/personal-schedule"))),className:"ml-2 inline-flex items-center underline"},"Add courses ‚Üí")):e.createElement("ul",{className:"divide-y"},g.map(t=>e.createElement("li",{key:t,className:"py-3"},e.createElement("button",{className:"block w-full text-left",onClick:()=>o(()=>x(s(`/courses/${encodeURIComponent(t)}/materials`)))},e.createElement("div",{className:"flex items-center justify-between"},e.createElement("div",{className:"font-semibold text-gray-900"},t),e.createElement("div",{className:"ml-3 shrink-0 text-xs text-gray-500"},"open materials")))))):e.createElement("div",{className:"rounded-lg border border-dashed border-gray-200 p-4 text-sm text-gray-600"},"Sign in to see quick links to ",e.createElement("b",null,"your courses")," this semester."),e.createElement("div",{className:"mt-4 flex justify-end gap-2"},e.createElement("button",{onClick:()=>o(()=>x(s("/courses/upload"))),className:"rounded-xl border px-4 py-2 text-sm font-semibold text-gray-700 hover:bg-gray-50"},"Upload note"),e.createElement("button",{onClick:()=>o(()=>x(s("/courses"))),className:"rounded-xl px-4 py-2 text-sm font-semibold text-white",style:{backgroundColor:f}},"Open Course Hub")))}v.extend(P);v.locale("en");const y=5;function Y(){const n=C(),{user:f,token:p}=k(),{school:o,schoolTheme:s,loading:x}=S(),a=M(),{ensureAuth:c}=O(),[b,N]=i.useState([]),[w,g]=i.useState(!0),d=i.useMemo(()=>({lat:40.7291,lon:-73.9965}),[]);if(x)return null;if(!o)return e.createElement(A,{to:"/select-school",replace:!0});i.useEffect(()=>{let r=!0;if(o)return(async()=>{g(!0);try{let E=[];if(p){const m=await L({school:o,token:p,page:1,limit:y});E=Array.isArray(m)?m.slice(0,y):[]}else{const m=await $({school:o,page:1,limit:y,sort:"new"});E=Array.isArray(m==null?void 0:m.items)?m.items.slice(0,y):[]}r&&N(E)}catch{r&&N([])}finally{r&&g(!1)}})(),()=>{r=!1}},[o,p]);const h=(s==null?void 0:s.bg)||"#f6f3ff",t=(s==null?void 0:s.primary)||"#6b46c1",l=(s==null?void 0:s.text)||"#111827";return e.createElement("div",{className:"min-h-screen",style:{backgroundColor:h}},e.createElement("div",{className:"mx-auto flex w-full max-w-screen-xl flex-col gap-8 px-6 py-12 lg:flex-row"},e.createElement("aside",{className:"w-full shrink-0 rounded-2xl border border-sand bg-white/80 p-6 shadow-md backdrop-blur-md lg:w-72"},e.createElement("div",{className:"text-center"},e.createElement("div",{className:"mx-auto h-20 w-20 rounded-full",style:{backgroundColor:t}}),e.createElement("p",{className:"mt-4 text-xl font-bold",style:{color:l}},(f==null?void 0:f.nickname)||o.toUpperCase()),e.createElement("p",{className:"text-sm text-gray-500"},o.toUpperCase())),e.createElement("ul",{className:"mt-6 space-y-3 text-sm text-gray-700"},e.createElement("li",null,e.createElement(u,{to:a("/myposts"),className:"transition hover:text-indigo-600"},"My Posts")),e.createElement("li",null,e.createElement(u,{to:a("/liked"),className:"transition hover:text-indigo-600"},"Liked")),e.createElement("li",null,e.createElement(u,{to:a("/commented"),className:"transition hover:text-indigo-600"},"Commented")),e.createElement("li",null,e.createElement(u,{to:a("/personal-schedule"),className:"transition hover:text-indigo-600"},"Schedule")),e.createElement("li",null,e.createElement(u,{to:a("/market"),className:"transition hover:text-indigo-600"},"Marketplace")),e.createElement("li",null,e.createElement(u,{to:a("/foodmap"),className:"transition hover:text-indigo-600"},"Food Map")))),e.createElement("main",{className:"flex w-full flex-1 flex-col"},e.createElement("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-12"},e.createElement("section",{className:"lg:col-span-8 rounded-2xl border border-sand bg-white p-6 shadow-md"},e.createElement("div",{className:"mb-4 flex items-center justify-between"},e.createElement(u,{to:a("/freeboard")},e.createElement("h2",{className:"cursor-pointer text-2xl font-bold hover:underline",style:{color:l}},"Free Board")),e.createElement(u,{to:a("/freeboard"),className:"text-sm text-blue-600 hover:underline"},"View All")),w?e.createElement("ul",{className:"space-y-3"},Array.from({length:y}).map((r,E)=>e.createElement("li",{key:E,className:"animate-pulse"},e.createElement("div",{className:"h-5 w-2/3 rounded bg-gray-100"}),e.createElement("div",{className:"mt-2 h-3 w-1/3 rounded bg-gray-100"})))):b.length===0?e.createElement("p",{className:"text-sm text-gray-500"},"Latest posts will appear here."):e.createElement("ul",{className:"divide-y"},b.map(r=>e.createElement("li",{key:r._id||r.id,className:"py-3"},e.createElement("button",{className:"block w-full text-left",onClick:()=>c(()=>n(a(`/freeboard/${r._id||r.id}`)))},e.createElement("div",{className:"flex items-center justify-between"},e.createElement("div",{className:"font-medium text-gray-900 line-clamp-2"},r.title),e.createElement("div",{className:"ml-3 shrink-0 text-xs text-gray-500"},r.createdAt?v(r.createdAt).fromNow():"")))))),e.createElement("div",{className:"mt-4 flex justify-end"},e.createElement("button",{onClick:()=>c(()=>n(a("/freeboard/write"))),className:"rounded-xl px-4 py-2 text-sm font-semibold text-white shadow",style:{backgroundColor:t}},"+ Write Post"))),e.createElement("section",{className:"lg:col-span-4"},e.createElement(z,{school:o,primary:t,textColor:l,ensureAuth:c,schoolPath:a,navigate:n}))),e.createElement("section",{onClick:()=>n(a("/foodmap")),className:"mt-6 cursor-pointer overflow-hidden rounded-2xl border border-sand bg-white p-0 shadow-inner transition hover:shadow-lg",title:"Go to Food Map"},e.createElement("div",{className:"p-6"},e.createElement("h2",{className:"mb-1 flex items-center gap-2 text-lg font-semibold",style:{color:l}},"üçΩÔ∏è Explore Nearby Food",e.createElement("span",{className:"ml-2 text-xs text-blue-600 underline"},"Open map")),e.createElement("p",{className:"text-sm text-gray-700"},"Discover top-rated restaurants and cafes near campus. Click to open the full map.")),e.createElement("div",{className:"h-56 select-none"},e.createElement(F,{center:[d.lat,d.lon],zoom:15,style:{height:"100%",width:"100%"},attributionControl:!1,zoomControl:!1},e.createElement(_,{attribution:"¬© OpenStreetMap contributors",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),e.createElement(R,{position:[d.lat,d.lon]},e.createElement(U,null,"Campus Center"))))))))}export{Y as default};
