import{d as y,c as _,a as P,r as c,R as e,A as C,e as B,u as I}from"./index-0f5aaadd.js";import"./en-75e8a66d.js";import{a as L,d as U,t as J}from"./posts-ea4b05b3.js";const f="https://api.cnapss.com/api",q=async(l,r="freeboard",n=null)=>{const t=n?`?type=${r}&email=${n}`:`?type=${r}`,m=await fetch(`${f}/comments/${l}${t}`),i=await m.json();if(!m.ok)throw new Error("ÎåìÍ∏Ä Î∂àÎü¨Ïò§Í∏∞ Ïã§Ìå®");return i},T=async({postId:l,email:r,content:n,parentId:t=null})=>{const m=await fetch(`${f}/comments/${l}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:r,content:n,parentId:t})}),i=await m.json();if(!m.ok)throw new Error(i.message||"ÎåìÍ∏Ä Îì±Î°ù Ïã§Ìå®");return i},F=async({commentId:l,email:r,content:n})=>{const t=await fetch(`${f}/comments/${l}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:r,content:n})}),m=await t.json();if(!t.ok)throw new Error(m.message||"ÎåìÍ∏Ä ÏàòÏ†ï Ïã§Ìå®");return m},W=async({commentId:l,email:r})=>{const n=await fetch(`${f}/comments/${l}`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:r})}),t=await n.json();if(!n.ok)throw new Error(t.message||"ÎåìÍ∏Ä ÏÇ≠Ï†ú Ïã§Ìå®");return t},z=async({commentId:l,email:r})=>{const n=await fetch(`${f}/comments/${l}/thumb`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:r})}),t=await n.json();if(!n.ok)throw new Error(t.message||"Ï∂îÏ≤ú Ïã§Ìå®");return t};y.extend(_);y.locale("en");function G({postId:l,postAuthorEmail:r}){const{user:n}=P(),[t,m]=c.useState([]),[i,w]=c.useState(""),[p,x]=c.useState(null),[E,g]=c.useState(""),[N,d]=c.useState(null),[v,k]=c.useState(""),S=c.useCallback(s=>{const o={};let b=1;return r&&(o[r]=`anonymous${b++}`),s.map(a=>(o[a.email]||(o[a.email]=`anonymous${b++}`),{...a,anonymousId:o[a.email]}))},[r]),u=c.useCallback(async()=>{try{const s=await q(l,"freeboard");m(S(s))}catch(s){console.error("ÎåìÍ∏Ä Î∂àÎü¨Ïò§Í∏∞ Ïã§Ìå®:",s),alert("ÎåìÍ∏Ä Î°úÎî©Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.")}},[l,S]);c.useEffect(()=>{u()},[u]);const A=async()=>{if(i.trim())try{await T({postId:l,email:n.email,content:i}),w(""),u()}catch(s){alert(s.message)}},D=async s=>{if(v.trim())try{await T({postId:l,email:n.email,content:v,parentId:s}),k(""),d(null),u()}catch(o){alert(o.message)}},j=async s=>{if(window.confirm("Ï†ïÎßê ÏÇ≠Ï†úÌï†ÍπåÏöî?"))try{await W({commentId:s,email:n.email}),u()}catch(o){alert(o.message)}},R=async s=>{try{await F({commentId:s,email:n.email,content:E}),x(null),g(""),u()}catch(o){alert(o.message)}},O=async s=>{try{await z({commentId:s,email:n.email}),u()}catch(o){alert(o.message)}},$=(s=null,o=0)=>{const b=t.filter(a=>(a.parentId||null)===s).sort((a,h)=>new Date(a.createdAt)-new Date(h.createdAt));return b.length===0?null:e.createElement("ul",{className:s?"ml-6 pl-4 border-l-2 border-gray-200":"space-y-4"},b.map(a=>e.createElement("li",{key:a._id,className:`text-sm ${s?"bg-gray-50 rounded-md p-2":"border-b border-gray-300 pb-3"}`},e.createElement("div",{className:"flex items-center text-sm text-gray-700"},e.createElement("strong",null,a.anonymousId),e.createElement("span",{className:"ml-2 text-gray-500"},a.createdAt?y(a.createdAt).fromNow():"")),p===a._id?e.createElement("div",{className:"mt-1 flex items-center space-x-2"},e.createElement("input",{value:E,onChange:h=>g(h.target.value),className:"border rounded px-2 py-1 w-2/3"}),e.createElement(C,{onClick:()=>R(a._id),loadingText:"Saving...",className:"text-sm px-2 py-1 bg-green-500 text-white rounded"},"Save"),e.createElement("button",{onClick:()=>x(null),className:"text-sm text-gray-500"},"Cancel")):e.createElement("div",{className:"mt-1 text-gray-800"},a.content),p!==a._id&&e.createElement("div",{className:"mt-1 flex flex-wrap items-center gap-2 text-sm"},e.createElement("button",{onClick:()=>O(a._id),className:"px-2 py-0.5 rounded bg-gray-100 hover:bg-yellow-100 text-gray-600"},"üëç ",a.thumbsUp||0),(n==null?void 0:n.email)===a.email&&e.createElement(e.Fragment,null,e.createElement("button",{onClick:()=>{x(a._id),g(a.content)},className:"px-2 py-0.5 rounded bg-yellow-100 text-yellow-800 hover:bg-yellow-200"},"‚úèÔ∏è Edit"),e.createElement(C,{onClick:()=>j(a._id),loadingText:"Deleting...",className:"px-2 py-0.5 rounded bg-red-100 text-red-600 hover:bg-red-200"},"üóëÔ∏è Delete")),e.createElement("button",{onClick:()=>d(a._id),className:"px-2 py-0.5 rounded bg-blue-100 text-blue-700 hover:bg-blue-200"},"‚Ü©Ô∏è Reply")),N===a._id&&e.createElement("div",{className:"mt-2 flex items-center gap-2"},e.createElement("input",{type:"text",value:v,onChange:h=>k(h.target.value),className:"border rounded px-2 py-1 w-2/3",placeholder:"Write a reply...",required:!0}),e.createElement(C,{onClick:()=>D(a._id),loadingText:"Replying...",className:"text-sm px-2 py-1 bg-blue-500 text-white rounded"},"Reply"),e.createElement("button",{type:"button",onClick:()=>d(null),className:"text-sm text-gray-500"},"Cancel")),$(a._id,o+1))))};return e.createElement("div",{className:"mt-8"},e.createElement("h3",{className:"text-lg font-bold mb-4"},"üí¨ Comments"),e.createElement("form",{onSubmit:s=>s.preventDefault(),className:"mb-4 flex gap-2"},e.createElement("input",{type:"text",value:i,onChange:s=>w(s.target.value),className:"border rounded px-3 py-1 w-2/3",placeholder:"Write a comment...",required:!0}),e.createElement(C,{onClick:A,loadingText:"Posting...",className:"bg-blue-500 text-white px-3 py-1 rounded"},"Post")),e.createElement("ul",{className:"space-y-2"},$()))}y.extend(_);y.locale("en");function Q(){var N;const{id:l}=B(),{user:r}=P(),n=I(),[t,m]=c.useState(null),[i,w]=c.useState(""),p=async()=>{try{const d=await L(l);m(d)}catch(d){w(d.message)}};c.useEffect(()=>{p()},[l]);const x=async()=>{if(window.confirm("Are you sure you want to delete this post?"))try{await U(l,r.email),alert("Post deleted successfully"),n("/freeboard")}catch(d){alert("Delete failed: "+d.message)}},E=async()=>{try{await J(l,r.email),p()}catch(d){alert("Ï∂îÏ≤ú Ïã§Ìå®: "+d.message)}};if(i)return e.createElement("p",{className:"text-red-500"},i);if(!t)return e.createElement("p",null,"Loading...");const g=(r==null?void 0:r.email)===t.email;return e.createElement("div",{className:"px-4 py-6 sm:px-6 md:px-8 max-w-3xl mx-auto"}," ",e.createElement("div",{className:"bg-white shadow-md rounded-2xl px-4 py-5 sm:p-6 mb-6"}," ",e.createElement("h2",{className:"text-xl sm:text-2xl font-bold mb-2"}," ",t.title),e.createElement("p",{className:"text-gray-500 text-xs sm:text-sm mb-4"}," ","Posted by anonymous1 ‚Ä¢ ",y(t.createdAt).fromNow()),e.createElement("p",{className:"text-sm sm:text-base mb-6 whitespace-pre-wrap"}," ",t.content),e.createElement("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-3 mb-4"}," ",e.createElement("button",{onClick:E,className:"text-xs sm:text-sm px-3 py-1 rounded bg-gray-100 hover:bg-gray-200"},"üëç ",((N=t.thumbsUpUsers)==null?void 0:N.length)||0),g&&e.createElement(e.Fragment,null,e.createElement("button",{onClick:()=>n(`/freeboard/edit/${t._id}`),className:"px-4 py-1 bg-yellow-400 hover:bg-yellow-500 text-white text-sm font-medium rounded-xl"},"Edit"),e.createElement("button",{onClick:x,className:"px-4 py-1 bg-red-500 hover:bg-red-600 text-white text-sm font-medium rounded-xl"},"Delete"))),e.createElement("button",{onClick:()=>n("/freeboard"),className:"text-sm text-blue-600 hover:underline"},"‚Üê Back to List")),(t==null?void 0:t._id)&&e.createElement(G,{postId:t._id,postAuthorEmail:t.email}))}export{Q as default};
