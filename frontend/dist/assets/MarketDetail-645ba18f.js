import{e as k,u as w,a as S,b as $,r as n,R as e,L as d}from"./index-97226d42.js";import{a as o}from"./axios-b5ee139b.js";const R=()=>{const{id:c}=k(),u=w(),{user:r}=S(),{schoolTheme:f}=$(),l="https://api.cnapss.com/api",[s,b]=n.useState(null),[g,p]=n.useState(null),[m,y]=n.useState(""),[i,E]=n.useState("idle");n.useEffect(()=>{(async()=>{try{const a=await o.get(`${l}/market/${c}`);b(a.data)}catch(a){console.error("âŒ ê²Œì‹œê¸€ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨",a)}})(),r&&(async()=>{try{(await o.get(`${l}/market/request/${c}/${r.email}`)).data.alreadySent&&E("already")}catch(h){console.error("âŒ ë¬¸ì˜ ì—¬ë¶€ í™•ì¸ ì‹¤íŒ¨",h)}})()},[c,l,r]);const N=async()=>{if(window.confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?"))try{await o.delete(`${l}/market/${c}`),u("/market")}catch{alert("ì‚­ì œ ì‹¤íŒ¨")}},v=async()=>{if(m.trim())try{const t=await o.post(`${l}/market/request`,{itemId:c,buyer:r.email,message:m}),{conversationId:a}=t.data;a?u(`/messages?conversation=${a}`):(console.error("âŒ ì„œë²„ì—ì„œ conversationIdë¥¼ ë°›ì§€ ëª»í–ˆì–´ìš”:",t.data),alert("ì„œë²„ ì‘ë‹µì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤."))}catch(t){console.error("âŒ ë¬¸ì˜ ì „ì†¡ ì‹¤íŒ¨:",t),alert("ì „ì†¡ ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}};if(!s)return e.createElement("div",{className:"p-6"},"ë¡œë”© ì¤‘...");const x=(r==null?void 0:r.email)===s.seller;return e.createElement("div",{className:"min-h-screen p-6",style:{backgroundColor:f.bg}},e.createElement("div",{className:"max-w-3xl mx-auto bg-white p-6 rounded shadow space-y-4"},e.createElement("h2",{className:"text-2xl font-bold"},s.title),e.createElement("p",{className:"text-gray-700"},s.description),e.createElement("p",{className:"text-gray-800 font-semibold"},"ğŸ’µ $",s.price),e.createElement("p",{className:"text-sm text-gray-400"},"íŒë§¤ì: ",s.sellerNickname),s.images&&s.images.length>0&&e.createElement("div",{className:"flex gap-3 mt-4 overflow-x-auto"},s.images.map((t,a)=>e.createElement("img",{key:a,src:t,alt:`íŒë§¤ ì´ë¯¸ì§€-${a}`,className:"w-40 h-40 object-cover rounded border cursor-pointer",onClick:()=>p(t)}))),x&&e.createElement("div",{className:"flex gap-3 mt-4"},e.createElement(d,{to:`/market/${c}/edit`,className:"px-4 py-1.5 rounded bg-purple-600 text-white hover:bg-purple-700"},"ìˆ˜ì •"),e.createElement("button",{onClick:N,className:"px-4 py-1.5 rounded bg-red-500 text-white hover:bg-red-600"},"ì‚­ì œ")),!x&&r&&e.createElement("div",{className:"mt-6"},i==="already"&&e.createElement("div",{className:"border p-4 rounded bg-gray-100 text-center text-gray-700"},"ğŸ“¨ Request already sent.",e.createElement(d,{to:"/messages",className:"ml-2 text-blue-600 underline"},"Go to Chat ğŸ’¬")),i==="sent"&&e.createElement("div",{className:"border p-4 rounded bg-green-100 text-center text-green-700"},"âœ… Message Sent Successfully!",e.createElement(d,{to:"/messages",className:"ml-2 text-blue-600 underline"},"Go to Chat ğŸ’¬")),i==="idle"&&e.createElement("div",{className:"flex flex-col sm:flex-row gap-2 items-center"},e.createElement("input",{type:"text",value:m,onChange:t=>y(t.target.value),placeholder:"ë¬¸ì˜ ì‚¬í•­ì„ ì ì–´ ì£¼ì„¸ìš”!",className:"border px-3 py-2 rounded flex-1 bg-red-50"}),e.createElement("button",{onClick:v,className:"bg-blue-200 text-indigo-600 font-semibold px-4 py-2 rounded"},"Send")))),g&&e.createElement("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50",onClick:()=>p(null)},e.createElement("img",{src:g,alt:"í™•ëŒ€ ì´ë¯¸ì§€",className:"max-w-[90vw] max-h-[90vh] rounded shadow-lg"})))};export{R as default};
