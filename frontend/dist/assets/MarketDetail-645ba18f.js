import{e as k,u as w,a as S,b as $,r as n,R as e,L as d}from"./index-97226d42.js";import{a as o}from"./axios-b5ee139b.js";const R=()=>{const{id:c}=k(),u=w(),{user:r}=S(),{schoolTheme:f}=$(),l="https://api.cnapss.com/api",[s,b]=n.useState(null),[g,p]=n.useState(null),[m,y]=n.useState(""),[i,E]=n.useState("idle");n.useEffect(()=>{(async()=>{try{const a=await o.get(`${l}/market/${c}`);b(a.data)}catch(a){console.error("❌ 게시글 불러오기 실패",a)}})(),r&&(async()=>{try{(await o.get(`${l}/market/request/${c}/${r.email}`)).data.alreadySent&&E("already")}catch(h){console.error("❌ 문의 여부 확인 실패",h)}})()},[c,l,r]);const N=async()=>{if(window.confirm("정말 삭제하시겠습니까?"))try{await o.delete(`${l}/market/${c}`),u("/market")}catch{alert("삭제 실패")}},v=async()=>{if(m.trim())try{const t=await o.post(`${l}/market/request`,{itemId:c,buyer:r.email,message:m}),{conversationId:a}=t.data;a?u(`/messages?conversation=${a}`):(console.error("❌ 서버에서 conversationId를 받지 못했어요:",t.data),alert("서버 응답에 문제가 있습니다."))}catch(t){console.error("❌ 문의 전송 실패:",t),alert("전송 중 문제가 발생했습니다.")}};if(!s)return e.createElement("div",{className:"p-6"},"로딩 중...");const x=(r==null?void 0:r.email)===s.seller;return e.createElement("div",{className:"min-h-screen p-6",style:{backgroundColor:f.bg}},e.createElement("div",{className:"max-w-3xl mx-auto bg-white p-6 rounded shadow space-y-4"},e.createElement("h2",{className:"text-2xl font-bold"},s.title),e.createElement("p",{className:"text-gray-700"},s.description),e.createElement("p",{className:"text-gray-800 font-semibold"},"💵 $",s.price),e.createElement("p",{className:"text-sm text-gray-400"},"판매자: ",s.sellerNickname),s.images&&s.images.length>0&&e.createElement("div",{className:"flex gap-3 mt-4 overflow-x-auto"},s.images.map((t,a)=>e.createElement("img",{key:a,src:t,alt:`판매 이미지-${a}`,className:"w-40 h-40 object-cover rounded border cursor-pointer",onClick:()=>p(t)}))),x&&e.createElement("div",{className:"flex gap-3 mt-4"},e.createElement(d,{to:`/market/${c}/edit`,className:"px-4 py-1.5 rounded bg-purple-600 text-white hover:bg-purple-700"},"수정"),e.createElement("button",{onClick:N,className:"px-4 py-1.5 rounded bg-red-500 text-white hover:bg-red-600"},"삭제")),!x&&r&&e.createElement("div",{className:"mt-6"},i==="already"&&e.createElement("div",{className:"border p-4 rounded bg-gray-100 text-center text-gray-700"},"📨 Request already sent.",e.createElement(d,{to:"/messages",className:"ml-2 text-blue-600 underline"},"Go to Chat 💬")),i==="sent"&&e.createElement("div",{className:"border p-4 rounded bg-green-100 text-center text-green-700"},"✅ Message Sent Successfully!",e.createElement(d,{to:"/messages",className:"ml-2 text-blue-600 underline"},"Go to Chat 💬")),i==="idle"&&e.createElement("div",{className:"flex flex-col sm:flex-row gap-2 items-center"},e.createElement("input",{type:"text",value:m,onChange:t=>y(t.target.value),placeholder:"문의 사항을 적어 주세요!",className:"border px-3 py-2 rounded flex-1 bg-red-50"}),e.createElement("button",{onClick:v,className:"bg-blue-200 text-indigo-600 font-semibold px-4 py-2 rounded"},"Send")))),g&&e.createElement("div",{className:"fixed inset-0 bg-black/70 flex items-center justify-center z-50",onClick:()=>p(null)},e.createElement("img",{src:g,alt:"확대 이미지",className:"max-w-[90vw] max-h-[90vh] rounded shadow-lg"})))};export{R as default};
