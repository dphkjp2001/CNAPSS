import{f as k,b as R,c as P,r,R as e}from"./index-076cbd2a.js";import{a as A}from"./academicPosts-9562fd64.js";import{g as C,p as L}from"./http-b5e27cd5.js";import{C as $}from"./CommentSection-879ea3da.js";import"./relativeTime-97901206.js";import"./useLoginGate-5dc1179c.js";const w="https://api.cnapss.com/api".replace(/\/$/,"");async function F({school:n,targetId:a,message:l}){return L(`${w}/${n}/request`,{targetId:a,initialMessage:l})}async function I({school:n,targetId:a}){const l=new URL(`${w}/${n}/request/exists`);return l.searchParams.set("targetId",a),C(l)}function M(n=""){const a=String(n||"").toLowerCase().replace(/[\s-]+/g,"_");return a.includes("course_material")?"ðŸ“":a.includes("study")?"ðŸ‘¥":a.includes("coffee")?"â˜•ï¸":"ðŸ“Œ"}function G(){const{school:n,id:a}=k(),{school:l}=R(),c=n||l||"nyu",{user:d}=P(),[o,f]=r.useState({loading:!0,error:"",post:null}),[m,x]=r.useState(""),[b,h]=r.useState(!1),[u,i]=r.useState(""),[p,E]=r.useState(!1);r.useEffect(()=>{let s=!0;return(async()=>{try{const t=await A({school:c,id:a});if(!s)return;f({loading:!1,error:"",post:t})}catch(t){if(!s)return;f({loading:!1,error:(t==null?void 0:t.message)||"Failed to load post.",post:null})}})(),()=>{s=!1}},[c,a]),r.useEffect(()=>{let s=!0;return(async()=>{try{if(!d)return;const t=await I({school:c,targetId:a});if(!s)return;E(!!(t!=null&&t.exists))}catch{}})(),()=>{s=!1}},[c,a,d]);const g=r.useMemo(()=>{const s=o.post||{},t=(s.mode||s.postType||s.type||(s.lookingFor?"looking_for":"general")||"general").toString().toLowerCase();return{isSeeking:t==="looking_for"||t==="seeking",mode:t,kind:s.kind||""}},[o.post]),N=async s=>{if(s.preventDefault(),!d)return i("Please log in to send a request.");if(!m.trim())return i("Please write a short message.");h(!0),i("");try{await F({school:c,targetId:a,message:m.trim()}),x(""),E(!0),i("Request sent! Check Messages.")}catch(t){i((t==null?void 0:t.message)||"Failed to send request.")}finally{h(!1)}};if(o.loading)return e.createElement("div",{className:"p-6 text-gray-500"},"Loadingâ€¦");if(o.error)return e.createElement("div",{className:"p-6 text-red-600"},o.error);if(!o.post)return e.createElement("div",{className:"p-6 text-gray-500"},"Post not found.");const{title:q,content:v,createdAt:y,kind:S}=o.post;return e.createElement("div",{className:"max-w-3xl mx-auto px-4 py-6"},e.createElement("article",{className:"bg-white rounded-2xl shadow border border-slate-200 overflow-hidden"},e.createElement("header",{className:"px-5 py-4 border-b border-slate-200"},e.createElement("div",{className:"flex items-center gap-2 text-sm text-slate-500"},e.createElement("span",{className:"inline-flex items-center gap-1"},g.isSeeking?e.createElement("span",null,M(S)):e.createElement("span",null,"ðŸ’¬"),e.createElement("span",{className:"font-medium"},g.isSeeking?"Seeking":"General question")),e.createElement("span",null,"Â·"),e.createElement("time",{dateTime:y},new Date(y).toLocaleString())),e.createElement("h1",{className:"mt-1 text-2xl font-semibold text-slate-900"},q)),e.createElement("div",{className:"px-5 py-5 whitespace-pre-wrap text-[15px] leading-7 text-slate-800"},v),g.isSeeking?e.createElement("div",{className:"px-5 py-5 border-t border-slate-200 bg-slate-50"},e.createElement("h2",{className:"text-lg font-semibold mb-2"},"Send a Request"),e.createElement("p",{className:"text-sm text-slate-600 mb-3"},"This post doesnâ€™t have comments. Send a private request to the author instead."),e.createElement("form",{onSubmit:N,className:"space-y-3"},e.createElement("textarea",{value:m,onChange:s=>x(s.target.value),placeholder:"Write a short message (who you are / what you need)â€¦",rows:4,className:"w-full rounded-xl border border-slate-300 px-3 py-2 text-[14px] focus:outline-none focus:ring-2 focus:ring-slate-900/10",disabled:p}),e.createElement("div",{className:"flex items-center justify-between"},e.createElement("p",{className:"text-xs text-slate-500"},"Target: ",e.createElement("strong",null,"Academic Â· ",S||"general")),e.createElement("button",{type:"submit",disabled:b||p||!m.trim(),className:"rounded-xl bg-black px-4 py-2 text-sm font-semibold text-white disabled:opacity-60"},p?"Already requested":b?"Sendingâ€¦":"Send request")),!!u&&e.createElement("div",{className:`text-sm px-3 py-2 rounded-lg border ${u.includes("sent")?"border-green-200 bg-green-50 text-green-700":"border-red-200 bg-red-50 text-red-700"}`},u))):e.createElement("div",{className:"px-5 py-5 border-t border-slate-200 bg-white"},e.createElement($,{targetId:a,targetType:"academic"}))))}export{G as default};
