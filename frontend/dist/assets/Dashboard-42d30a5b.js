import{u as U,r as i,R as e,a as z,b as D,c as O}from"./index-6d921834.js";import{d as E,r as G}from"./relativeTime-6db2af3b.js";import"./en-d212af0d.js";import{u as K}from"./useLoginGate-ef90e1d7.js";import{l as q,g as J}from"./posts-770f1d0e.js";import{a as Q}from"./http-08c7d507.js";import{l as T,g as V}from"./market-0e6b3d94.js";const j="https://api.cnapss.com/api".replace(/\/+$/,"");async function M({school:l,token:r,page:c=1,limit:u=20,q:s="",prof:n="",type:d="all"}={}){const g=new URLSearchParams({page:String(Math.max(1,c)),limit:String(Math.max(1,Math.min(50,u)))});s&&g.set("q",s),n&&g.set("prof",n),d&&d!=="all"&&g.set("type",d);const b=r?`${j}/${encodeURIComponent(l)}/materials/recent`:`${j}/public/${encodeURIComponent(l)}/materials/recent`,y=r?{headers:{Authorization:`Bearer ${r}`}}:{},f=await Q(`${b}?${g.toString()}`,y);if(!f.ok)throw new Error("Failed to load recent materials");return f.json()}function X({schoolKey:l="nyu",imageUrl:r="/nyu-bg.png",opacity:c=.18,gradient:u=!0,blur:s=!1,className:n=""}){const{school:d}=U();return i.useMemo(()=>String(d||"").trim().toLowerCase()===String(l).toLowerCase(),[d,l])?e.createElement("div",{className:`pointer-events-none absolute inset-0 z-0 overflow-hidden ${n}`},e.createElement("div",{className:`absolute inset-0 bg-center bg-no-repeat bg-cover ${s?"backdrop-blur-sm":""}`,style:{backgroundImage:`url("${r}")`,opacity:c}}),u&&e.createElement("div",{"aria-hidden":!0,className:"absolute inset-0",style:{background:"linear-gradient(to bottom, rgba(255,255,255,0.6) 0%, rgba(255,255,255,0.25) 40%, rgba(255,255,255,0.6) 100%)"}})):null}E.extend(G);E.locale("en");const Y=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0});function ne(){const{token:l}=z(),{school:r,schoolTheme:c}=U(),{ensureAuth:u}=K(),s=D(),n=O(),[d,g]=i.useState([]),[b,y]=i.useState(!0),[f,N]=i.useState("");i.useEffect(()=>{let t=!0;if(r)return(async()=>{y(!0),N("");try{let a;l?a=await q({school:r,token:l}):a=await J({school:r,page:1,limit:10});const o=Array.isArray(a)?a:Array.isArray(a==null?void 0:a.items)?a.items:[];t&&g(o.slice(0,5))}catch{t&&N("Failed to load posts.")}finally{t&&y(!1)}})(),()=>{t=!1}},[r,l]);const[_,F]=i.useState([]),[I,L]=i.useState([]),[H,h]=i.useState(!0),[v,k]=i.useState("");i.useEffect(()=>{let t=!0;if(r)return(async()=>{h(!0),k("");try{const a=await M({school:r,token:l,limit:5,type:"sale"}),o=Array.isArray(a==null?void 0:a.items)?a.items:Array.isArray(a)?a:[],m=await M({school:r,token:l,limit:5,type:"wanted"}),p=Array.isArray(m==null?void 0:m.items)?m.items:Array.isArray(m)?m:[];if(!t)return;F(o),L(p)}catch{t&&k("Failed to load CourseHub items.")}finally{t&&h(!1)}})(),()=>{t=!1}},[r,l]);const[A,B]=i.useState([]),[W,C]=i.useState(!0),[S,P]=i.useState("");i.useEffect(()=>{let t=!0;if(r)return(async()=>{try{C(!0),P("");let a=[];if(l){const o=await T({school:r,token:l,page:1,limit:4,sort:"latest"});o&&typeof o=="object"&&Array.isArray(o.items)?a=o.items:Array.isArray(o)&&(a=[...o].sort((p,$)=>String($.createdAt??$._id??"").localeCompare(String(p.createdAt??p._id??""))).slice(0,4))}else{const o=await V({school:r,limit:4});a=(o==null?void 0:o.items)||[]}if(!t)return;B(a.slice(0,4))}catch{t&&P("Failed to load marketplace items.")}finally{t&&C(!1)}})(),()=>{t=!1}},[r,l]);const x={color:(c==null?void 0:c.text)||"#4c1d95"},w={backgroundColor:(c==null?void 0:c.primary)||"#6b46c1"};return e.createElement("div",{className:"relative min-h-screen px-4 py-6 sm:px-6 lg:px-8"},e.createElement(X,{schoolKey:"nyu",imageUrl:"/nyu-bg.png",opacity:.18}),e.createElement("div",{className:"relative z-10 mx-auto w-full max-w-5xl space-y-5"},e.createElement("section",{className:"rounded-2xl border border-gray-200 bg-white p-4 sm:p-5 shadow-sm"},e.createElement("div",{className:"mb-3 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},e.createElement("h2",{onClick:()=>s(n("/courses")),className:"cursor-pointer text-lg font-semibold sm:text-xl hover:underline",style:x},"CourseHub"),e.createElement("div",{className:"flex w-full justify-end sm:w-auto"},e.createElement("button",{onClick:()=>u(()=>s(n("/courses/write"))),className:"rounded-xl px-4 py-2 text-sm font-semibold text-white shadow",style:w},"+ Upload Post"))),H?e.createElement("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2"},Array.from({length:2}).map((t,a)=>e.createElement("div",{key:a,className:"rounded-xl border p-4"},e.createElement("div",{className:"mb-2 h-5 w-24 animate-pulse rounded bg-gray-100"}),e.createElement("ul",{className:"divide-y divide-gray-100"},Array.from({length:5}).map((o,m)=>e.createElement("li",{key:m,className:"py-2"},e.createElement("div",{className:"flex items-center justify-between"},e.createElement("div",{className:"h-4 w-2/3 animate-pulse rounded bg-gray-100"}),e.createElement("div",{className:"h-3 w-16 animate-pulse rounded bg-gray-100"})))))))):v?e.createElement("div",{className:"rounded-lg bg-red-50 p-3 text-sm text-red-700"},v):e.createElement("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2"},e.createElement(R,{title:"For Sale",items:_,badgeClass:"bg-emerald-100 text-emerald-700",onOpen:t=>s(n(`/courses/materials/${t}`))}),e.createElement(R,{title:"Wanted",items:I,badgeClass:"bg-rose-100 text-rose-700",onOpen:t=>s(n(`/courses/materials/${t}`))}))),e.createElement("section",{className:"rounded-2xl border border-gray-200 bg-white p-4 sm:p-5 shadow-sm"},e.createElement("div",{className:"mb-3 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},e.createElement("h2",{onClick:()=>s(n("/market")),className:"cursor-pointer text-lg font-semibold sm:text-xl hover:underline",style:x},"Marketplace"),e.createElement("div",{className:"flex w-full justify-end sm:w-auto"},e.createElement("button",{onClick:()=>u(()=>s(n("/market/write"))),className:"w-full rounded-xl px-4 py-2 text-sm font-semibold text-white shadow sm:w-auto",style:w},"+ Post an item"))),W?e.createElement("div",{className:"grid grid-cols-2 gap-4 md:grid-cols-4"},Array.from({length:4}).map((t,a)=>e.createElement("div",{key:a,className:"animate-pulse rounded-2xl border border-gray-200/60 bg-white shadow-sm"},e.createElement("div",{className:"aspect-[4/3] w-full rounded-t-2xl bg-gray-100"}),e.createElement("div",{className:"p-4 space-y-3"},e.createElement("div",{className:"h-4 w-3/5 rounded bg-gray-100"}),e.createElement("div",{className:"h-4 w-2/5 rounded bg-gray-100"}),e.createElement("div",{className:"h-3 w-1/2 rounded bg-gray-100"}))))):S?e.createElement("div",{className:"rounded-lg bg-red-50 p-3 text-sm text-red-700"},S):A.length===0?e.createElement("div",{className:"rounded-lg border border-dashed border-gray-300 p-6 text-center text-sm text-gray-600"},"No listings yet."):e.createElement("div",{className:"grid grid-cols-2 gap-4 md:grid-cols-4"},A.slice(0,4).map(t=>{var m;const a=t._id||t.id,o=((m=t.images)==null?void 0:m[0])||t.image||"";return e.createElement("button",{key:a,onClick:()=>s(n(`/market/${a}`)),className:"group block overflow-hidden rounded-2xl border border-gray-200/60 bg-white text-left shadow-sm transition hover:shadow-md focus:outline-none focus:ring-2 focus:ring-gray-900/20"},e.createElement("div",{className:"relative aspect-[4/3] w-full overflow-hidden bg-gray-50"},o?e.createElement("img",{src:o,alt:t.title,className:"h-full w-full object-cover transition duration-300 group-hover:scale-[1.02]",loading:"lazy"}):e.createElement("div",{className:"flex h-full w-full items-center justify-center text-4xl"},"🖼️")),e.createElement("div",{className:"p-4"},e.createElement("h3",{className:"line-clamp-1 text-base font-semibold text-gray-900"},t.title),e.createElement("p",{className:"mt-1 text-sm font-medium text-gray-800"},Y.format(Number(t.price)||0)),e.createElement("p",{className:"mt-1 line-clamp-1 text-xs text-gray-500"},t.sellerNickname||"Unknown")))}))),e.createElement("section",{className:"rounded-2xl border border-gray-200 bg-white p-4 sm:p-5 shadow-sm"},e.createElement("div",{className:"mb-3 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between"},e.createElement("h2",{onClick:()=>s(n("/freeboard")),className:"cursor-pointer text-lg font-semibold sm:text-xl hover:underline",style:x},"Free Board"),e.createElement("button",{onClick:()=>u(()=>s(n("/freeboard/write"))),className:"w-full rounded-xl px-4 py-2 text-sm font-semibold text-white shadow sm:w-auto",style:w},"+ Write Post")),b?e.createElement("ul",{className:"space-y-2"},Array.from({length:5}).map((t,a)=>e.createElement("li",{key:a},e.createElement("div",{className:"h-4 w-3/4 animate-pulse rounded bg-gray-100"})))):f?e.createElement("div",{className:"rounded-lg bg-red-50 p-3 text-sm text-red-700"},f):d.length===0?e.createElement("div",{className:"rounded-lg border border-dashed border-gray-300 p-6 text-center text-sm text-gray-600"},"No posts yet. Be the first to write!"):e.createElement("ul",{className:"divide-y divide-gray-100"},d.map(t=>e.createElement("li",{key:t._id,className:"py-2"},e.createElement("button",{onClick:()=>u(()=>s(n(`/freeboard/${t._id}`))),className:"flex w-full items-center justify-between text-left"},e.createElement("h3",{className:"min-w-0 truncate text-sm font-semibold text-gray-900 hover:underline"},t.title),e.createElement("span",{className:"ml-3 shrink-0 text-[11px] text-gray-500"},E(t.createdAt).fromNow()))))))))}function R({title:l,items:r,badgeClass:c,onOpen:u}){return e.createElement("div",{className:"rounded-xl border p-4 bg-white"},e.createElement("div",{className:"mb-2 text-sm font-semibold text-gray-900"},l),!r||r.length===0?e.createElement("div",{className:"rounded-lg border border-dashed border-gray-300 p-6 text-center text-sm text-gray-600"},"No postings yet."):e.createElement("ul",{className:"divide-y divide-gray-100"},r.map(s=>{const n=s._id||s.id,d=(s.courseCode||s.course||"").toUpperCase(),g=s.professor||"Unknown";return e.createElement("li",{key:n,className:"py-2"},e.createElement("button",{onClick:()=>u(n),className:"flex w-full items-center justify-between text-left hover:opacity-95"},e.createElement("div",{className:"min-w-0"},e.createElement("div",{className:"flex flex-wrap items-center gap-2"},e.createElement("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-[11px] font-semibold ${c}`},l),e.createElement("span",{className:"truncate text-sm font-semibold text-gray-900"},d||"UNKNOWN"),e.createElement("span",{className:"truncate text-xs font-medium text-gray-700"},g)))))})))}export{ne as default};
