import{l as j,u as M,c as $,r as x,R as e,i as P,b as L,o as R,p as U,q as D}from"./index-ae6c7b32.js";import{A as T,U as q,C as B}from"./CommentSection-5ab4c354.js";import{d as A,r as H}from"./relativeTime-dfae6197.js";import{c as N}from"./createLucideIcon-1adbd0ab.js";import"./useLoginGate-b22409a5.js";/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]],y=N("book-open",G);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],V=N("clock",O);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M14 2v2",key:"6buw04"}],["path",{d:"M16 8a1 1 0 0 1 1 1v8a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V9a1 1 0 0 1 1-1h14a4 4 0 1 1 0 8h-1",key:"pwadti"}],["path",{d:"M6 2v2",key:"colzsn"}]],z=N("coffee",Y);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],K=N("ellipsis-vertical",Q);/**
 * @license lucide-react v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]],_=N("graduation-cap",W);async function X({school:l,targetId:s,message:c}){const h="https://api.cnapss.com/api".replace(/\/$/,"");return j(`${h}/${l}/request`,{method:"POST",headers:{"Content-Type":"application/json"},body:{targetId:s,initialMessage:c}})}function F({label:l,value:s,selected:c,onChange:h}){return e.createElement("label",{className:"flex items-center gap-3 cursor-pointer select-none"},e.createElement("input",{type:"radio",className:"h-4 w-4 accent-red-500",checked:c===s,onChange:()=>h(s)}),e.createElement("span",{className:"text-sm text-slate-700"},l))}function J({school:l,postId:s,kind:c}){const h=M(),{user:u}=$(),o=c==="course_materials",i=c==="coffee_chat",f=c==="study_mate"||c==="study_group",t=`Hi,
I would love to study with you!
Let me know what days you are thinking of :)`,[m,g]=x.useState("lunch"),[b,w]=x.useState(""),v=x.useMemo(()=>f?t:o?`Hi,
I have the class materials you're looking for. You can get it for ${m==="lunch"?"lunch/dinner":m==="small"?"a small cost":"anything is fine"}.`:i?`Hi,
I can have a coffee chat with you for ${m==="lunch"?"lunch/dinner":m==="small"?"a small cost":"anything is fine"}.`:b||"",[o,i,f,b,m]),[n,p]=x.useState(!1),C=!!s&&!!l&&v.trim().length>0,k=async()=>{if(!u){alert("Please log in to send a message.");return}try{p(!0);const r=await X({school:l,targetId:s,message:f?t:v}),E=r==null?void 0:r.conversationId;h(E?`/${encodeURIComponent(l)}/messages?c=${encodeURIComponent(E)}`:`/${encodeURIComponent(l)}/messages`)}catch(r){alert((r==null?void 0:r.message)||"Failed to send.")}finally{p(!1)}};return e.createElement("aside",{className:"bg-white rounded-2xl shadow border border-slate-200 p-4 h-max"},e.createElement("div",{className:"text-sm text-slate-900 font-semibold mb-1"},"Hi,"),e.createElement("div",{className:"text-sm text-slate-700 mb-3"},o&&"I have the class materials you're looking for. You can get it for",i&&"I can have a coffee chat with you for",f&&"Send a request message:"),(o||i)&&e.createElement("div",{className:"space-y-3 mb-4"},e.createElement(F,{label:"lunch/dinner",value:"lunch",selected:m,onChange:g}),e.createElement(F,{label:"small cost",value:"small",selected:m,onChange:g}),e.createElement(F,{label:"Anything is fine",value:"free",selected:m,onChange:g})),!f&&!(o||i)&&e.createElement("textarea",{value:b,onChange:r=>w(r.target.value),rows:5,className:"w-full rounded-xl border border-slate-300 px-3 py-2 text-sm mb-4",placeholder:"Write a short messageâ€¦"}),e.createElement("div",{className:"mb-3 rounded-lg bg-slate-50 border border-slate-200 p-3 text-xs whitespace-pre-wrap text-slate-700"},v),e.createElement("button",{onClick:k,disabled:n||!C,className:"w-full rounded-xl bg-red-500 text-white font-semibold py-2 shadow hover:bg-red-600 disabled:opacity-60"},f?n?"Sendingâ€¦":"Send a request":n?"Sendingâ€¦":"Send an offer"))}A.extend(H);A.locale("en");const Z={accent:"#FF7A70",accentHover:"#FF6B61"};function ee(l=""){const s=String(l||"").toLowerCase().replace(/[\s-]+/g,"_");return s.includes("course_material")?"ðŸ“":s.includes("study")?"ðŸ‘¥":s.includes("coffee")?"â˜•ï¸":"ðŸ“Œ"}function le(){var k,r,E,I;const{school:l,id:s}=P(),c=M(),{school:h}=L(),u=l||h||"nyu",{user:o}=$(),[i,f]=x.useState({loading:!0,error:"",post:null});if(x.useEffect(()=>{let a=!0;return(async()=>{try{const d=await R({school:u,id:s});if(!a)return;f({loading:!1,error:"",post:d})}catch(d){if(!a)return;f({loading:!1,error:(d==null?void 0:d.message)||"Failed to load post.",post:null})}})(),()=>{a=!1}},[u,s]),x.useEffect(()=>{if(!o)return;let a=!0;return(async()=>{try{const d=await U({school:u,id:s});if(!a)return;f(S=>({...S,post:d||S.post}))}catch{}})(),()=>{a=!1}},[o,u,s]),i.loading)return e.createElement("div",{className:"min-h-screen bg-[#F8F9FA] flex items-center justify-center"},e.createElement("div",{className:"text-gray-600"},"Loadingâ€¦"));if(i.error)return e.createElement("div",{className:"min-h-screen bg-[#F8F9FA] flex items-center justify-center"},e.createElement("div",{className:"text-red-600"},i.error));if(!i.post)return e.createElement("div",{className:"min-h-screen bg-[#F8F9FA] flex items-center justify-center"},e.createElement("div",{className:"text-gray-600"},"Post not found."));const t=i.post,m=(t.mode||t.postType||t.type||"").toString().toLowerCase(),g=m==="seeking"||m==="looking_for",b=!g,w=o&&[(k=t.author)==null?void 0:k._id,(r=t.author)==null?void 0:r.id,t.userId,t.authorId].filter(Boolean).map(String).some(a=>String(a)===String(o._id||o.id)),v=async()=>{if(window.confirm("Delete this post?"))try{await D({school:u,id:s}),alert("Post deleted."),c(`/${encodeURIComponent(u)}/dashboard?tab=academic`)}catch(a){alert("Delete failed: "+((a==null?void 0:a.message)||"Unknown error"))}},n=a=>a&&String(a).trim()!==""?String(a):"Not specified";let p=[];if(b)p=[{label:"Related Course",value:n(t.courseName),icon:_},{label:"Question Details",value:n(t.content),icon:y}];else{const a=String(t.kind||"").toLowerCase().replace(/[\s-]+/g,"_");a==="course_materials"?p=[{label:"Course Name",value:n(t.title||t.courseName),icon:y},{label:"Professor",value:n(t.professor),icon:_},{label:"Semester",value:n(t.semester),icon:V},{label:"Looking for Materials",value:Array.isArray(t.materials)&&t.materials.length?t.materials.map(d=>d.replace(/_/g," ")).join(", "):"Not specified",icon:y}]:a==="coffee_chat"?p=[{label:"Title",value:n(t.title),icon:z},{label:"Topic",value:n(t.content),icon:y}]:a==="study_mate"?p=[{label:"Class",value:n(t.courseName),icon:_},{label:"Topic",value:n(t.content),icon:y}]:p=[{label:"Content",value:n(t.content),icon:y}]}const C=((E=t.author)==null?void 0:E.name)||((I=t.author)==null?void 0:I.username)||"Anonymous";return g&&String(t.kind||"").replace(/_/g," "),e.createElement("div",{className:"min-h-screen bg-[#F8F9FA] py-8"},e.createElement("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},e.createElement("button",{onClick:()=>c(`/${encodeURIComponent(u)}/dashboard?tab=academic`),className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-6 font-medium transition-colors"},e.createElement(T,{className:"w-4 h-4"}),e.createElement("span",null,"Back to Academic Board")),e.createElement("div",{className:"grid gap-6 lg:grid-cols-[1fr,380px]"},e.createElement("article",{className:"bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden"},e.createElement("header",{className:"px-6 py-5 border-b border-gray-100"},e.createElement("div",{className:"flex items-start justify-between gap-4 mb-4"},e.createElement("div",{className:"flex items-start gap-3 flex-1"},e.createElement("div",{className:"w-11 h-11 rounded-full bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center shrink-0"},e.createElement(q,{className:"w-5 h-5 text-gray-600"})),e.createElement("div",{className:"flex-1 min-w-0"},e.createElement("div",{className:"flex items-center gap-2 flex-wrap"},e.createElement("span",{className:"font-semibold text-gray-900"},C),e.createElement("span",{className:"text-gray-400"},"â€¢"),e.createElement("span",{className:"text-sm text-gray-500"},A(t.createdAt).fromNow())),e.createElement("div",{className:"flex items-center gap-2 mt-1"},e.createElement("span",{className:"text-sm text-gray-500"},"Academic Board"),g&&e.createElement(e.Fragment,null,e.createElement("span",{className:"text-gray-300"},"â€¢"),e.createElement("span",{className:"inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-medium text-white",style:{backgroundColor:Z.accent}},e.createElement("span",null,ee(t.kind)),e.createElement("span",null,"Seeking")))))),w&&e.createElement("button",{className:"text-gray-400 hover:text-gray-600 transition-colors"},e.createElement(K,{className:"w-5 h-5"}))),e.createElement("h1",{className:"text-2xl font-bold text-gray-900 leading-tight"},t.title||"Untitled"),b&&e.createElement("div",{className:"mt-3 inline-flex items-center gap-2 px-3 py-1.5 bg-blue-50 border border-blue-200 rounded-lg"},e.createElement("span",{className:"text-base"},"ðŸ’¬"),e.createElement("span",{className:"text-sm font-medium text-blue-700"},"General Question"))),e.createElement("div",{className:"px-6 py-6"},e.createElement("div",{className:"space-y-6"},p.map((a,d)=>{const S=a.icon||y;return e.createElement("div",{key:d,className:"flex items-start gap-4"},e.createElement("div",{className:"w-10 h-10 rounded-lg bg-gray-100 flex items-center justify-center shrink-0"},e.createElement(S,{className:"w-5 h-5 text-gray-600"})),e.createElement("div",{className:"flex-1 min-w-0"},e.createElement("p",{className:"text-sm font-medium text-gray-500 mb-1.5"},a.label),e.createElement("p",{className:"text-gray-900 whitespace-pre-wrap leading-relaxed"},a.value)))})),w&&e.createElement("div",{className:"mt-8 pt-6 border-t border-gray-100"},e.createElement("button",{onClick:v,className:"px-4 py-2.5 bg-red-500 text-white font-medium rounded-lg hover:bg-red-600 active:scale-[0.98] transition-all shadow-sm"},"Delete Post"))),!g&&e.createElement("div",{className:"border-t border-gray-200 bg-gray-50/50"},e.createElement("div",{className:"px-6 py-6"},e.createElement("h3",{className:"font-semibold text-gray-900 mb-4"},"Comments"),e.createElement(B,{postId:t._id||s})))),g&&e.createElement("div",{className:"lg:sticky lg:top-24 self-start"},e.createElement(J,{school:u,postId:t._id||s,kind:String(t.kind||"").toLowerCase().replace(/[\s-]+/g,"_")})))))}export{le as default};
