import{u as v,r as c,R as e,a as h,b as C,c as S,d as N,e as A}from"./index-919d62e0.js";import"./en-37a672a3.js";import{u as P}from"./useLoginGate-f338ded0.js";import{l as $,g as M}from"./posts-7c3d1405.js";import{g as j}from"./schedule-0375a6db.js";const H=a=>a>=8?"fall":a>=5?"summer":"spring";function F(){const a=new Date,m=a.getFullYear(),o=H(a.getMonth()+1);return`${m}-${o}`}function L({school:a,primary:m="#6b46c1",textColor:o="#111827",ensureAuth:r,schoolPath:i,navigate:l}){const{token:n}=v(),[d,y]=c.useState(F()),[p,g]=c.useState(!1),[x,u]=c.useState([]);c.useEffect(()=>{let t=!0;if(!n||!a||!d){u([]);return}return(async()=>{try{g(!0);const s=await j({school:a,token:n,semester:d}),E=Array.isArray(s==null?void 0:s.slots)?s.slots:[],w=Array.from(new Set(E.map(k=>(k.label||"").trim()).filter(Boolean))).slice(0,5);t&&u(w)}catch{t&&u([])}finally{t&&g(!1)}})(),()=>{t=!1}},[n,a,d]);const f=c.useMemo(()=>{const s=new Date().getFullYear();return Array.from(new Set([`${s-1}-fall`,`${s}-spring`,`${s}-summer`,`${s}-fall`,`${s+1}-spring`]))},[]);return e.createElement("div",{className:"h-full rounded-2xl border border-sand bg-white p-6 shadow-md"},e.createElement("div",{className:"mb-4 flex items-center justify-between"},e.createElement("h2",{className:"text-2xl font-bold",style:{color:o}},"Course Hub"),e.createElement("div",{className:"flex items-center gap-2"},e.createElement("select",{value:d,onChange:t=>y(t.target.value),className:"rounded-lg border px-2 py-1 text-xs",title:"Semester"},f.map(t=>e.createElement("option",{key:t,value:t},t))),e.createElement("button",{onClick:()=>r(()=>l(i("/courses"))),className:"text-sm text-blue-600 hover:underline"},"Browse all"))),n?p?e.createElement("ul",{className:"space-y-3"},Array.from({length:4}).map((t,s)=>e.createElement("li",{key:s,className:"animate-pulse"},e.createElement("div",{className:"h-5 w-3/4 rounded bg-gray-100"}),e.createElement("div",{className:"mt-2 h-3 w-1/3 rounded bg-gray-100"})))):x.length===0?e.createElement("div",{className:"rounded-lg border border-dashed border-gray-200 p-4 text-sm text-gray-600"},"No courses in your ",e.createElement("b",null,d)," schedule yet.",e.createElement("button",{onClick:()=>r(()=>l(i("/personal-schedule"))),className:"ml-2 inline-flex items-center underline"},"Add courses ‚Üí")):e.createElement("ul",{className:"divide-y"},x.map(t=>e.createElement("li",{key:t,className:"py-3"},e.createElement("button",{className:"block w-full text-left",onClick:()=>r(()=>l(i(`/courses/${encodeURIComponent(t)}/materials`)))},e.createElement("div",{className:"flex items-center justify-between"},e.createElement("div",{className:"font-semibold text-gray-900"},t),e.createElement("div",{className:"ml-3 shrink-0 text-xs text-gray-500"},"open materials")))))):e.createElement("div",{className:"rounded-lg border border-dashed border-gray-200 p-4 text-sm text-gray-600"},"Sign in to see quick links to ",e.createElement("b",null,"your courses")," this semester."),e.createElement("div",{className:"mt-4 flex justify-end gap-2"},e.createElement("button",{onClick:()=>r(()=>l(i("/courses/upload"))),className:"rounded-xl border px-4 py-2 text-sm font-semibold text-gray-700 hover:bg-gray-50"},"Upload note"),e.createElement("button",{onClick:()=>r(()=>l(i("/courses"))),className:"rounded-xl px-4 py-2 text-sm font-semibold text-white",style:{backgroundColor:m}},"Open Course Hub")))}N.extend(A);N.locale("en");const O=a=>({background:a||"linear-gradient(135deg, rgba(124,58,237,0.12), rgba(99,102,241,0.12))"});function R(){const{user:a,token:m}=v(),{school:o,schoolTheme:r}=h(),{ensureAuth:i}=P(),l=C(),n=S(),[d,y]=c.useState([]),[p,g]=c.useState(!0),[x,u]=c.useState("");c.useEffect(()=>{let t=!0;if(o)return(async()=>{g(!0),u("");try{let s;m?s=await $({school:o,token:m}):s=await M({school:o,page:1,limit:10});const E=Array.isArray(s)?s:Array.isArray(s==null?void 0:s.items)?s.items:[];t&&y(E.slice(0,5))}catch{t&&u("Failed to load posts.")}finally{t&&g(!1)}})(),()=>{t=!1}},[o,m]);const f=c.useMemo(()=>((a==null?void 0:a.nickname)||(a!=null&&a.email?a.email.split("@")[0]:"Guest")).slice(0,2).toUpperCase(),[a]);return e.createElement("div",{className:"min-h-screen px-4 py-6 sm:px-6",style:{backgroundColor:(r==null?void 0:r.bg)||"#f6f3ff"}},e.createElement("div",{className:"mx-auto max-w-7xl"},e.createElement("div",{className:"grid grid-cols-1 gap-5 lg:grid-cols-12"},e.createElement("aside",{className:"lg:col-span-3"},e.createElement("div",{className:"rounded-2xl border border-gray-200 bg-white p-6 shadow-sm"},e.createElement("div",{className:"mx-auto mb-4 flex h-24 w-24 items-center justify-center rounded-full text-2xl font-bold text-gray-900",style:O(r==null?void 0:r.bg)},f),e.createElement("div",{className:"text-center"},e.createElement("div",{className:"text-lg font-bold text-gray-900"},(a==null?void 0:a.nickname)||"Guest"),e.createElement("div",{className:"mt-0.5 text-xs uppercase tracking-wide text-gray-500"},(o==null?void 0:o.toUpperCase())||"SCHOOL")),e.createElement("nav",{className:"mt-6 space-y-2 text-sm"},e.createElement(b,{onClick:()=>l(n("/myposts"))},"My Posts"),e.createElement(b,{onClick:()=>l(n("/liked"))},"Liked"),e.createElement(b,{onClick:()=>l(n("/commented"))},"Commented"),e.createElement(b,{onClick:()=>l(n("/personal-schedule"))},"Schedule"),e.createElement(b,{onClick:()=>l(n("/market"))},"Marketplace"),e.createElement(b,{onClick:()=>l(n("/foodmap"))},"Food Map")))),e.createElement("main",{className:"lg:col-span-6"},e.createElement("section",{className:"rounded-2xl border border-gray-200 bg-white p-5 shadow-sm"},e.createElement("div",{className:"mb-3 flex items-center justify-between"},e.createElement("h2",{onClick:()=>l(n("/freeboard")),className:"cursor-pointer text-2xl font-extrabold hover:underline",style:{color:(r==null?void 0:r.text)||"#4c1d95"}},"Free Board")),p?e.createElement("ul",{className:"space-y-4"},Array.from({length:3}).map((t,s)=>e.createElement("li",{key:s},e.createElement("div",{className:"h-5 w-2/3 animate-pulse rounded bg-gray-100"}),e.createElement("div",{className:"mt-2 h-3 w-1/3 animate-pulse rounded bg-gray-100"})))):x?e.createElement("div",{className:"rounded-lg bg-red-50 p-3 text-sm text-red-700"},x):d.length===0?e.createElement("div",{className:"rounded-lg border border-dashed border-gray-300 p-6 text-center text-sm text-gray-600"},"No posts yet. Be the first to write!"):e.createElement("ul",{className:"divide-y divide-gray-100"},d.map(t=>e.createElement("li",{key:t._id,className:"py-4"},e.createElement("button",{onClick:()=>i(()=>l(n(`/freeboard/${t._id}`))),className:"block w-full text-left"},e.createElement("h3",{className:"line-clamp-1 text-base font-semibold text-gray-900 hover:underline"},t.title),e.createElement("p",{className:"mt-1 text-xs text-gray-500"},N(t.createdAt).fromNow()))))),e.createElement("div",{className:"mt-4 text-right"},e.createElement("button",{onClick:()=>i(()=>l(n("/freeboard/write"))),className:"rounded-xl px-4 py-2 text-sm font-semibold text-white shadow",style:{backgroundColor:(r==null?void 0:r.primary)||"#6b46c1"}},"+ Write Post"))),e.createElement("section",{className:"mt-5 rounded-2xl border border-gray-200 bg-white p-5 shadow-sm"},e.createElement("div",{className:"mb-3 flex items-center justify-between"},e.createElement("h2",{onClick:()=>l(n("/courses")),className:"cursor-pointer text-2xl font-extrabold hover:underline",style:{color:(r==null?void 0:r.text)||"#4c1d95"}},"CourseHub")),e.createElement(L,null))),e.createElement("aside",{className:"space-y-5 lg:col-span-3"},e.createElement("div",{className:"rounded-2xl border border-gray-200 bg-white p-5 shadow-sm"},e.createElement("h3",{onClick:()=>l(n("/courses")),className:"mb-3 cursor-pointer text-lg font-bold text-gray-900 hover:underline"},"Course Hub"),e.createElement("div",{className:"flex gap-2"},e.createElement("button",{onClick:()=>l(n("/courses/write")),className:"flex-1 rounded-xl border border-gray-300 bg-white px-3 py-2 text-sm text-gray-800 shadow-sm hover:bg-gray-50"},"Upload note"),e.createElement("button",{onClick:()=>l(n("/courses")),className:"flex-1 rounded-xl px-3 py-2 text-sm font-semibold text-white shadow",style:{backgroundColor:(r==null?void 0:r.primary)||"#6b46c1"}},"Open Course Hub"))),e.createElement("div",{className:"rounded-2xl border border-gray-200 bg-white p-5 shadow-sm"},e.createElement("div",{onClick:()=>l(n("/foodmap")),className:"mb-2 cursor-pointer text-sm font-semibold text-gray-900 hover:underline"},"üç± Explore Nearby Food"),e.createElement("p",{className:"text-xs text-gray-600"},"Discover top-rated restaurants and cafes near campus."),e.createElement("div",{className:"mt-3 h-28 w-full overflow-hidden rounded-lg bg-gray-100"},e.createElement("div",{className:"h-full w-full animate-pulse"})))))))}function b({children:a,onClick:m}){return e.createElement("button",{onClick:m,className:"w-full rounded-xl border border-transparent px-3 py-2 text-left text-gray-700 hover:border-gray-200 hover:bg-gray-50"},a)}export{R as default};
