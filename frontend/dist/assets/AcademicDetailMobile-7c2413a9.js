import{j as I,u as T,b as j,d as L,r as p,p as O,q as S,R as e,G as g}from"./index-f5d06e92.js";import{A as M,U as R,C as B}from"./CommentSection-2998421b.js";import{d as b,r as D}from"./relativeTime-0382aa45.js";import{B as r,C as G,a as U}from"./coffee-f70703db.js";import"./useLoginGate-5c668411.js";b.extend(D);b.locale("en");const l=u=>u&&String(u).trim()!==""?String(u):"Not specified";function J(){var h,v,w,A;const{school:u,id:o}=I(),k=T(),{school:F}=j(),n=u||F||"nyu",{user:c,token:y}=L(),[d,f]=p.useState({loading:!0,error:"",post:null}),[x,Q]=p.useState(!1);if(console.log("✅ Rendering AcademicDetailMobile"),p.useEffect(()=>{let a=!0;return(async()=>{try{const s=await O({school:n,id:o});if(!a)return;if(console.log("✅ Public post loaded:",s),f({loading:!1,error:"",post:s}),c&&y){const m=await S({school:n,id:o});if(!a)return;f(C=>({...C,post:m||C.post}))}}catch(s){if(!a)return;console.error("❌ Failed public load:",s),f({loading:!1,error:(s==null?void 0:s.message)||"Failed to load post.",post:null})}})(),()=>{a=!1}},[n,o]),p.useEffect(()=>{if(!c)return;let a=!0;return(async()=>{try{const s=await S({school:n,id:o});if(!a)return;f(m=>({...m,post:s||m.post}))}catch{}})(),()=>{a=!1}},[c,y,n,o]),p.useEffect(()=>{if(x){const a=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=a}}},[x]),d.loading)return e.createElement("div",{className:"min-h-screen bg-[#F8F9FA] flex items-center justify-center"},e.createElement("div",{className:"text-gray-600"},"Loading…"));if(d.error)return e.createElement("div",{className:"min-h-screen bg-[#F8F9FA] flex items-center justify-center"},e.createElement("div",{className:"text-red-600"},d.error));if(!d.post)return e.createElement("div",{className:"min-h-screen bg-[#F8F9FA] flex items-center justify-center"},e.createElement("div",{className:"text-gray-600"},"Post not found."));const t=d.post,E=(t.mode||t.postType||t.type||"").toString().toLowerCase(),N=E==="seeking"||E==="looking_for",P=!N;c&&[(h=t.author)==null?void 0:h._id,(v=t.author)==null?void 0:v.id,t.userId,t.authorId].filter(Boolean).map(String).some(a=>String(a)===String(c._id||c.id));let i=[];if(P)i=[{label:"Related Course",value:l(t.courseName),icon:g},{label:"Question Details",value:l(t.content),icon:r}];else{const a=String(t.kind||"").toLowerCase().replace(/[\s-]+/g,"_");a==="course_materials"?i=[{label:"Course Name",value:l(t.title||t.courseName),icon:r},{label:"Professor",value:l(t.professor),icon:g},{label:"Semester",value:l(t.semester),icon:G},{label:"Looking for Materials",value:Array.isArray(t.materials)&&t.materials.length?t.materials.map(s=>s.replace(/_/g," ")).join(", "):"Not specified",icon:r}]:a==="coffee_chat"?i=[{label:"Title",value:l(t.title),icon:U},{label:"Topic",value:l(t.content),icon:r}]:a==="study_mate"?i=[{label:"Class",value:l(t.courseName),icon:g},{label:"Topic",value:l(t.content),icon:r}]:i=[{label:"Content",value:l(t.content),icon:r}]}const _=((w=t.author)==null?void 0:w.name)||((A=t.author)==null?void 0:A.username)||"Anonymous";return e.createElement("div",{className:"min-h-screen bg-gray-50"},e.createElement("div",{className:"sticky top-0 z-30 bg-white border-b border-gray-200"},e.createElement("div",{className:"flex items-center px-3 py-2"},e.createElement("button",{onClick:()=>k(`/${encodeURIComponent(n)}/dashboard?tab=academic`),className:"flex items-center text-gray-700"},e.createElement(M,{className:"w-5 h-5"})),e.createElement("h1",{className:"ml-3 text-base font-semibold text-gray-900 truncate"},"Academic Detail"))),e.createElement("div",{className:"text-center text-[11px] text-gray-400 my-1"},"[MOBILE COMPONENT ACTIVE]"),e.createElement("div",{className:"px-3 py-4"},e.createElement("div",{className:"flex items-center gap-2 text-sm text-gray-600 mb-3"},e.createElement(R,{className:"w-4 h-4 text-gray-400"}),e.createElement("span",null,_),e.createElement("span",null,"•"),e.createElement("span",null,b(t.createdAt).fromNow())),e.createElement("h2",{className:"text-lg font-bold text-gray-900 leading-snug"},t.title),!N&&e.createElement("span",{className:"mt-1 inline-block text-xs font-medium text-blue-700 bg-blue-50 border border-blue-200 rounded px-2 py-0.5"},"General Question"),e.createElement("ul",{className:"mt-4 space-y-3"},i.map((a,s)=>{const m=a.icon||r;return e.createElement("li",{key:s,className:"flex items-start gap-2"},e.createElement(m,{className:"w-4 h-4 mt-0.5 text-gray-500"}),e.createElement("div",null,e.createElement("p",{className:"text-xs text-gray-500"},a.label),e.createElement("p",{className:"text-sm text-gray-900 whitespace-pre-wrap"},a.value)))})),e.createElement("div",{className:"mt-6"},e.createElement(B,{postId:t._id||o}))))}export{J as default};
